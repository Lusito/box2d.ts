"use strict";(()=>{var Xx=Object.create;var Cu=Object.defineProperty;var Hx=Object.getOwnPropertyDescriptor;var Ox=Object.getOwnPropertyNames;var Nx=Object.getPrototypeOf,Zx=Object.prototype.hasOwnProperty;var Et=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),Of=(i,t)=>{for(var e in t)Cu(i,e,{get:t[e],enumerable:!0})},Qx=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ox(t))!Zx.call(i,o)&&o!==e&&Cu(i,o,{get:()=>t[o],enumerable:!(r=Hx(t,o))||r.enumerable});return i};var mt=(i,t,e)=>(e=i!=null?Xx(Nx(i)):{},Qx(t||!i||!i.__esModule?Cu(e,"default",{value:i,enumerable:!0}):e,i));var ob=Et(st=>{"use strict";var Ts=Symbol.for("react.element"),qx=Symbol.for("react.portal"),Wx=Symbol.for("react.fragment"),Kx=Symbol.for("react.strict_mode"),$x=Symbol.for("react.profiler"),tg=Symbol.for("react.provider"),eg=Symbol.for("react.context"),ig=Symbol.for("react.forward_ref"),rg=Symbol.for("react.suspense"),og=Symbol.for("react.memo"),sg=Symbol.for("react.lazy"),Nf=Symbol.iterator;function ng(i){return i===null||typeof i!="object"?null:(i=Nf&&i[Nf]||i["@@iterator"],typeof i=="function"?i:null)}var qf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wf=Object.assign,Kf={};function go(i,t,e){this.props=i,this.context=t,this.refs=Kf,this.updater=e||qf}go.prototype.isReactComponent={};go.prototype.setState=function(i,t){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,t,"setState")};go.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function $f(){}$f.prototype=go.prototype;function Tu(i,t,e){this.props=i,this.context=t,this.refs=Kf,this.updater=e||qf}var Pu=Tu.prototype=new $f;Pu.constructor=Tu;Wf(Pu,go.prototype);Pu.isPureReactComponent=!0;var Zf=Array.isArray,tb=Object.prototype.hasOwnProperty,Du={current:null},eb={key:!0,ref:!0,__self:!0,__source:!0};function ib(i,t,e){var r,o={},s=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(s=""+t.key),t)tb.call(t,r)&&!eb.hasOwnProperty(r)&&(o[r]=t[r]);var a=arguments.length-2;if(a===1)o.children=e;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];o.children=c}if(i&&i.defaultProps)for(r in a=i.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:Ts,type:i,key:s,ref:l,props:o,_owner:Du.current}}function lg(i,t){return{$$typeof:Ts,type:i.type,key:t,ref:i.ref,props:i.props,_owner:i._owner}}function Mu(i){return typeof i=="object"&&i!==null&&i.$$typeof===Ts}function ag(i){var t={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(e){return t[e]})}var Qf=/\/+/g;function Au(i,t){return typeof i=="object"&&i!==null&&i.key!=null?ag(""+i.key):t.toString(36)}function nl(i,t,e,r,o){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var l=!1;if(i===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(i.$$typeof){case Ts:case qx:l=!0}}if(l)return l=i,o=o(l),i=r===""?"."+Au(l,0):r,Zf(o)?(e="",i!=null&&(e=i.replace(Qf,"$&/")+"/"),nl(o,t,e,"",function(u){return u})):o!=null&&(Mu(o)&&(o=lg(o,e+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(Qf,"$&/")+"/")+i)),t.push(o)),1;if(l=0,r=r===""?".":r+":",Zf(i))for(var a=0;a<i.length;a++){s=i[a];var c=r+Au(s,a);l+=nl(s,t,e,c,o)}else if(c=ng(i),typeof c=="function")for(i=c.call(i),a=0;!(s=i.next()).done;)s=s.value,c=r+Au(s,a++),l+=nl(s,t,e,c,o);else if(s==="object")throw t=String(i),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function sl(i,t,e){if(i==null)return i;var r=[],o=0;return nl(i,r,"","",function(s){return t.call(e,s,o++)}),r}function cg(i){if(i._status===-1){var t=i._result;t=t(),t.then(function(e){(i._status===0||i._status===-1)&&(i._status=1,i._result=e)},function(e){(i._status===0||i._status===-1)&&(i._status=2,i._result=e)}),i._status===-1&&(i._status=0,i._result=t)}if(i._status===1)return i._result.default;throw i._result}var _e={current:null},ll={transition:null},ug={ReactCurrentDispatcher:_e,ReactCurrentBatchConfig:ll,ReactCurrentOwner:Du};function rb(){throw Error("act(...) is not supported in production builds of React.")}st.Children={map:sl,forEach:function(i,t,e){sl(i,function(){t.apply(this,arguments)},e)},count:function(i){var t=0;return sl(i,function(){t++}),t},toArray:function(i){return sl(i,function(t){return t})||[]},only:function(i){if(!Mu(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};st.Component=go;st.Fragment=Wx;st.Profiler=$x;st.PureComponent=Tu;st.StrictMode=Kx;st.Suspense=rg;st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ug;st.act=rb;st.cloneElement=function(i,t,e){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var r=Wf({},i.props),o=i.key,s=i.ref,l=i._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,l=Du.current),t.key!==void 0&&(o=""+t.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(c in t)tb.call(t,c)&&!eb.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=e;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ts,type:i.type,key:o,ref:s,props:r,_owner:l}};st.createContext=function(i){return i={$$typeof:eg,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:tg,_context:i},i.Consumer=i};st.createElement=ib;st.createFactory=function(i){var t=ib.bind(null,i);return t.type=i,t};st.createRef=function(){return{current:null}};st.forwardRef=function(i){return{$$typeof:ig,render:i}};st.isValidElement=Mu;st.lazy=function(i){return{$$typeof:sg,_payload:{_status:-1,_result:i},_init:cg}};st.memo=function(i,t){return{$$typeof:og,type:i,compare:t===void 0?null:t}};st.startTransition=function(i){var t=ll.transition;ll.transition={};try{i()}finally{ll.transition=t}};st.unstable_act=rb;st.useCallback=function(i,t){return _e.current.useCallback(i,t)};st.useContext=function(i){return _e.current.useContext(i)};st.useDebugValue=function(){};st.useDeferredValue=function(i){return _e.current.useDeferredValue(i)};st.useEffect=function(i,t){return _e.current.useEffect(i,t)};st.useId=function(){return _e.current.useId()};st.useImperativeHandle=function(i,t,e){return _e.current.useImperativeHandle(i,t,e)};st.useInsertionEffect=function(i,t){return _e.current.useInsertionEffect(i,t)};st.useLayoutEffect=function(i,t){return _e.current.useLayoutEffect(i,t)};st.useMemo=function(i,t){return _e.current.useMemo(i,t)};st.useReducer=function(i,t,e){return _e.current.useReducer(i,t,e)};st.useRef=function(i){return _e.current.useRef(i)};st.useState=function(i){return _e.current.useState(i)};st.useSyncExternalStore=function(i,t,e){return _e.current.useSyncExternalStore(i,t,e)};st.useTransition=function(){return _e.current.useTransition()};st.version="18.3.1"});var Ut=Et((MA,sb)=>{"use strict";sb.exports=ob()});var fb=Et(yt=>{"use strict";function Iu(i,t){var e=i.length;i.push(t);t:for(;0<e;){var r=e-1>>>1,o=i[r];if(0<al(o,t))i[r]=t,i[e]=o,e=r;else break t}}function li(i){return i.length===0?null:i[0]}function ul(i){if(i.length===0)return null;var t=i[0],e=i.pop();if(e!==t){i[0]=e;t:for(var r=0,o=i.length,s=o>>>1;r<s;){var l=2*(r+1)-1,a=i[l],c=l+1,u=i[c];if(0>al(a,e))c<o&&0>al(u,a)?(i[r]=u,i[c]=e,r=c):(i[r]=a,i[l]=e,r=l);else if(c<o&&0>al(u,e))i[r]=u,i[c]=e,r=c;else break t}}return t}function al(i,t){var e=i.sortIndex-t.sortIndex;return e!==0?e:i.id-t.id}typeof performance=="object"&&typeof performance.now=="function"?(nb=performance,yt.unstable_now=function(){return nb.now()}):(Ru=Date,lb=Ru.now(),yt.unstable_now=function(){return Ru.now()-lb});var nb,Ru,lb,vi=[],nr=[],mg=1,Ze=null,le=3,ml=!1,Zr=!1,Ds=!1,ub=typeof setTimeout=="function"?setTimeout:null,mb=typeof clearTimeout=="function"?clearTimeout:null,ab=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Lu(i){for(var t=li(nr);t!==null;){if(t.callback===null)ul(nr);else if(t.startTime<=i)ul(nr),t.sortIndex=t.expirationTime,Iu(vi,t);else break;t=li(nr)}}function Gu(i){if(Ds=!1,Lu(i),!Zr)if(li(vi)!==null)Zr=!0,Eu(Vu);else{var t=li(nr);t!==null&&Uu(Gu,t.startTime-i)}}function Vu(i,t){Zr=!1,Ds&&(Ds=!1,mb(Ms),Ms=-1),ml=!0;var e=le;try{for(Lu(t),Ze=li(vi);Ze!==null&&(!(Ze.expirationTime>t)||i&&!hb());){var r=Ze.callback;if(typeof r=="function"){Ze.callback=null,le=Ze.priorityLevel;var o=r(Ze.expirationTime<=t);t=yt.unstable_now(),typeof o=="function"?Ze.callback=o:Ze===li(vi)&&ul(vi),Lu(t)}else ul(vi);Ze=li(vi)}if(Ze!==null)var s=!0;else{var l=li(nr);l!==null&&Uu(Gu,l.startTime-t),s=!1}return s}finally{Ze=null,le=e,ml=!1}}var pl=!1,cl=null,Ms=-1,pb=5,db=-1;function hb(){return!(yt.unstable_now()-db<pb)}function ku(){if(cl!==null){var i=yt.unstable_now();db=i;var t=!0;try{t=cl(!0,i)}finally{t?Ps():(pl=!1,cl=null)}}else pl=!1}var Ps;typeof ab=="function"?Ps=function(){ab(ku)}:typeof MessageChannel<"u"?(Fu=new MessageChannel,cb=Fu.port2,Fu.port1.onmessage=ku,Ps=function(){cb.postMessage(null)}):Ps=function(){ub(ku,0)};var Fu,cb;function Eu(i){cl=i,pl||(pl=!0,Ps())}function Uu(i,t){Ms=ub(function(){i(yt.unstable_now())},t)}yt.unstable_IdlePriority=5;yt.unstable_ImmediatePriority=1;yt.unstable_LowPriority=4;yt.unstable_NormalPriority=3;yt.unstable_Profiling=null;yt.unstable_UserBlockingPriority=2;yt.unstable_cancelCallback=function(i){i.callback=null};yt.unstable_continueExecution=function(){Zr||ml||(Zr=!0,Eu(Vu))};yt.unstable_forceFrameRate=function(i){0>i||125<i?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pb=0<i?Math.floor(1e3/i):5};yt.unstable_getCurrentPriorityLevel=function(){return le};yt.unstable_getFirstCallbackNode=function(){return li(vi)};yt.unstable_next=function(i){switch(le){case 1:case 2:case 3:var t=3;break;default:t=le}var e=le;le=t;try{return i()}finally{le=e}};yt.unstable_pauseExecution=function(){};yt.unstable_requestPaint=function(){};yt.unstable_runWithPriority=function(i,t){switch(i){case 1:case 2:case 3:case 4:case 5:break;default:i=3}var e=le;le=i;try{return t()}finally{le=e}};yt.unstable_scheduleCallback=function(i,t,e){var r=yt.unstable_now();switch(typeof e=="object"&&e!==null?(e=e.delay,e=typeof e=="number"&&0<e?r+e:r):e=r,i){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=e+o,i={id:mg++,callback:t,priorityLevel:i,startTime:e,expirationTime:o,sortIndex:-1},e>r?(i.sortIndex=e,Iu(nr,i),li(vi)===null&&i===li(nr)&&(Ds?(mb(Ms),Ms=-1):Ds=!0,Uu(Gu,e-r))):(i.sortIndex=o,Iu(vi,i),Zr||ml||(Zr=!0,Eu(Vu))),i};yt.unstable_shouldYield=hb;yt.unstable_wrapCallback=function(i){var t=le;return function(){var e=le;le=t;try{return i.apply(this,arguments)}finally{le=e}}}});var _b=Et((kA,bb)=>{"use strict";bb.exports=fb()});var S2=Et(Je=>{"use strict";var pg=Ut(),Ue=_b();function J(i){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+i,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+i+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var B_=new Set,Ks={};function lo(i,t){Jo(i,t),Jo(i+"Capture",t)}function Jo(i,t){for(Ks[i]=t,i=0;i<t.length;i++)B_.add(t[i])}var zi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),am=Object.prototype.hasOwnProperty,dg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yb={},xb={};function hg(i){return am.call(xb,i)?!0:am.call(yb,i)?!1:dg.test(i)?xb[i]=!0:(yb[i]=!0,!1)}function fg(i,t,e,r){if(e!==null&&e.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:e!==null?!e.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function bg(i,t,e,r){if(t===null||typeof t>"u"||fg(i,t,e,r))return!0;if(r)return!1;if(e!==null)switch(e.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ge(i,t,e,r,o,s,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=e,this.propertyName=i,this.type=t,this.sanitizeURL=s,this.removeEmptyString=l}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ne[i]=new ge(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var t=i[0];ne[t]=new ge(t,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ne[i]=new ge(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ne[i]=new ge(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ne[i]=new ge(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ne[i]=new ge(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ne[i]=new ge(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ne[i]=new ge(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ne[i]=new ge(i,5,!1,i.toLowerCase(),null,!1,!1)});var tp=/[\-:]([a-z])/g;function ep(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var t=i.replace(tp,ep);ne[t]=new ge(t,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var t=i.replace(tp,ep);ne[t]=new ge(t,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var t=i.replace(tp,ep);ne[t]=new ge(t,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ne[i]=new ge(i,1,!1,i.toLowerCase(),null,!1,!1)});ne.xlinkHref=new ge("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ne[i]=new ge(i,1,!1,i.toLowerCase(),null,!0,!0)});function ip(i,t,e,r){var o=ne.hasOwnProperty(t)?ne[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(bg(t,e,o,r)&&(e=null),r||o===null?hg(t)&&(e===null?i.removeAttribute(t):i.setAttribute(t,""+e)):o.mustUseProperty?i[o.propertyName]=e===null?o.type===3?!1:"":e:(t=o.attributeName,r=o.attributeNamespace,e===null?i.removeAttribute(t):(o=o.type,e=o===3||o===4&&e===!0?"":""+e,r?i.setAttributeNS(r,t,e):i.setAttribute(t,e))))}var Ni=pg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,dl=Symbol.for("react.element"),vo=Symbol.for("react.portal"),Bo=Symbol.for("react.fragment"),rp=Symbol.for("react.strict_mode"),cm=Symbol.for("react.profiler"),C_=Symbol.for("react.provider"),A_=Symbol.for("react.context"),op=Symbol.for("react.forward_ref"),um=Symbol.for("react.suspense"),mm=Symbol.for("react.suspense_list"),sp=Symbol.for("react.memo"),ar=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var T_=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var gb=Symbol.iterator;function Rs(i){return i===null||typeof i!="object"?null:(i=gb&&i[gb]||i["@@iterator"],typeof i=="function"?i:null)}var It=Object.assign,Yu;function Us(i){if(Yu===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);Yu=t&&t[1]||""}return`
`+Yu+i}var Ju=!1;function ju(i,t){if(!i||Ju)return"";Ju=!0;var e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(i,[],t)}else{try{t.call()}catch(u){r=u}i.call(t.prototype)}else{try{throw Error()}catch(u){r=u}i()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),s=r.stack.split(`
`),l=o.length-1,a=s.length-1;1<=l&&0<=a&&o[l]!==s[a];)a--;for(;1<=l&&0<=a;l--,a--)if(o[l]!==s[a]){if(l!==1||a!==1)do if(l--,a--,0>a||o[l]!==s[a]){var c=`
`+o[l].replace(" at new "," at ");return i.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",i.displayName)),c}while(1<=l&&0<=a);break}}}finally{Ju=!1,Error.prepareStackTrace=e}return(i=i?i.displayName||i.name:"")?Us(i):""}function _g(i){switch(i.tag){case 5:return Us(i.type);case 16:return Us("Lazy");case 13:return Us("Suspense");case 19:return Us("SuspenseList");case 0:case 2:case 15:return i=ju(i.type,!1),i;case 11:return i=ju(i.type.render,!1),i;case 1:return i=ju(i.type,!0),i;default:return""}}function pm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Bo:return"Fragment";case vo:return"Portal";case cm:return"Profiler";case rp:return"StrictMode";case um:return"Suspense";case mm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case A_:return(i.displayName||"Context")+".Consumer";case C_:return(i._context.displayName||"Context")+".Provider";case op:var t=i.render;return i=i.displayName,i||(i=t.displayName||t.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case sp:return t=i.displayName||null,t!==null?t:pm(i.type)||"Memo";case ar:t=i._payload,i=i._init;try{return pm(i(t))}catch{}}return null}function yg(i){var t=i.type;switch(i.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=t.render,i=i.displayName||i.name||"",t.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pm(t);case 8:return t===rp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function wr(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function P_(i){var t=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function xg(i){var t=P_(i)?"checked":"value",e=Object.getOwnPropertyDescriptor(i.constructor.prototype,t),r=""+i[t];if(!i.hasOwnProperty(t)&&typeof e<"u"&&typeof e.get=="function"&&typeof e.set=="function"){var o=e.get,s=e.set;return Object.defineProperty(i,t,{configurable:!0,get:function(){return o.call(this)},set:function(l){r=""+l,s.call(this,l)}}),Object.defineProperty(i,t,{enumerable:e.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){i._valueTracker=null,delete i[t]}}}}function hl(i){i._valueTracker||(i._valueTracker=xg(i))}function D_(i){if(!i)return!1;var t=i._valueTracker;if(!t)return!0;var e=t.getValue(),r="";return i&&(r=P_(i)?i.checked?"true":"false":i.value),i=r,i!==e?(t.setValue(i),!0):!1}function jl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function dm(i,t){var e=t.checked;return It({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:e??i._wrapperState.initialChecked})}function Sb(i,t){var e=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;e=wr(t.value!=null?t.value:e),i._wrapperState={initialChecked:r,initialValue:e,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function M_(i,t){t=t.checked,t!=null&&ip(i,"checked",t,!1)}function hm(i,t){M_(i,t);var e=wr(t.value),r=t.type;if(e!=null)r==="number"?(e===0&&i.value===""||i.value!=e)&&(i.value=""+e):i.value!==""+e&&(i.value=""+e);else if(r==="submit"||r==="reset"){i.removeAttribute("value");return}t.hasOwnProperty("value")?fm(i,t.type,e):t.hasOwnProperty("defaultValue")&&fm(i,t.type,wr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(i.defaultChecked=!!t.defaultChecked)}function wb(i,t,e){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+i._wrapperState.initialValue,e||t===i.value||(i.value=t),i.defaultValue=t}e=i.name,e!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,e!==""&&(i.name=e)}function fm(i,t,e){(t!=="number"||jl(i.ownerDocument)!==i)&&(e==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+e&&(i.defaultValue=""+e))}var Ys=Array.isArray;function Lo(i,t,e,r){if(i=i.options,t){t={};for(var o=0;o<e.length;o++)t["$"+e[o]]=!0;for(e=0;e<i.length;e++)o=t.hasOwnProperty("$"+i[e].value),i[e].selected!==o&&(i[e].selected=o),o&&r&&(i[e].defaultSelected=!0)}else{for(e=""+wr(e),t=null,o=0;o<i.length;o++){if(i[o].value===e){i[o].selected=!0,r&&(i[o].defaultSelected=!0);return}t!==null||i[o].disabled||(t=i[o])}t!==null&&(t.selected=!0)}}function bm(i,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return It({},t,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function vb(i,t){var e=t.value;if(e==null){if(e=t.children,t=t.defaultValue,e!=null){if(t!=null)throw Error(J(92));if(Ys(e)){if(1<e.length)throw Error(J(93));e=e[0]}t=e}t==null&&(t=""),e=t}i._wrapperState={initialValue:wr(e)}}function R_(i,t){var e=wr(t.value),r=wr(t.defaultValue);e!=null&&(e=""+e,e!==i.value&&(i.value=e),t.defaultValue==null&&i.defaultValue!==e&&(i.defaultValue=e)),r!=null&&(i.defaultValue=""+r)}function Bb(i){var t=i.textContent;t===i._wrapperState.initialValue&&t!==""&&t!==null&&(i.value=t)}function k_(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _m(i,t){return i==null||i==="http://www.w3.org/1999/xhtml"?k_(t):i==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var fl,F_=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,e,r,o){MSApp.execUnsafeLocalFunction(function(){return i(t,e,r,o)})}:i}(function(i,t){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=t;else{for(fl=fl||document.createElement("div"),fl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=fl.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;t.firstChild;)i.appendChild(t.firstChild)}});function $s(i,t){if(t){var e=i.firstChild;if(e&&e===i.lastChild&&e.nodeType===3){e.nodeValue=t;return}}i.textContent=t}var zs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gg=["Webkit","ms","Moz","O"];Object.keys(zs).forEach(function(i){gg.forEach(function(t){t=t+i.charAt(0).toUpperCase()+i.substring(1),zs[t]=zs[i]})});function I_(i,t,e){return t==null||typeof t=="boolean"||t===""?"":e||typeof t!="number"||t===0||zs.hasOwnProperty(i)&&zs[i]?(""+t).trim():t+"px"}function L_(i,t){i=i.style;for(var e in t)if(t.hasOwnProperty(e)){var r=e.indexOf("--")===0,o=I_(e,t[e],r);e==="float"&&(e="cssFloat"),r?i.setProperty(e,o):i[e]=o}}var Sg=It({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ym(i,t){if(t){if(Sg[i]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,i));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function xm(i,t){if(i.indexOf("-")===-1)return typeof t.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gm=null;function np(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Sm=null,Go=null,Vo=null;function Cb(i){if(i=yn(i)){if(typeof Sm!="function")throw Error(J(280));var t=i.stateNode;t&&(t=ba(t),Sm(i.stateNode,i.type,t))}}function G_(i){Go?Vo?Vo.push(i):Vo=[i]:Go=i}function V_(){if(Go){var i=Go,t=Vo;if(Vo=Go=null,Cb(i),t)for(i=0;i<t.length;i++)Cb(t[i])}}function E_(i,t){return i(t)}function U_(){}var zu=!1;function Y_(i,t,e){if(zu)return i(t,e);zu=!0;try{return E_(i,t,e)}finally{zu=!1,(Go!==null||Vo!==null)&&(U_(),V_())}}function tn(i,t){var e=i.stateNode;if(e===null)return null;var r=ba(e);if(r===null)return null;e=r[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(i=i.type,r=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!r;break t;default:i=!1}if(i)return null;if(e&&typeof e!="function")throw Error(J(231,t,typeof e));return e}var wm=!1;if(zi)try{So={},Object.defineProperty(So,"passive",{get:function(){wm=!0}}),window.addEventListener("test",So,So),window.removeEventListener("test",So,So)}catch{wm=!1}var So;function wg(i,t,e,r,o,s,l,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(e,u)}catch(m){this.onError(m)}}var Xs=!1,zl=null,Xl=!1,vm=null,vg={onError:function(i){Xs=!0,zl=i}};function Bg(i,t,e,r,o,s,l,a,c){Xs=!1,zl=null,wg.apply(vg,arguments)}function Cg(i,t,e,r,o,s,l,a,c){if(Bg.apply(this,arguments),Xs){if(Xs){var u=zl;Xs=!1,zl=null}else throw Error(J(198));Xl||(Xl=!0,vm=u)}}function ao(i){var t=i,e=i;if(i.alternate)for(;t.return;)t=t.return;else{i=t;do t=i,t.flags&4098&&(e=t.return),i=t.return;while(i)}return t.tag===3?e:null}function J_(i){if(i.tag===13){var t=i.memoizedState;if(t===null&&(i=i.alternate,i!==null&&(t=i.memoizedState)),t!==null)return t.dehydrated}return null}function Ab(i){if(ao(i)!==i)throw Error(J(188))}function Ag(i){var t=i.alternate;if(!t){if(t=ao(i),t===null)throw Error(J(188));return t!==i?null:i}for(var e=i,r=t;;){var o=e.return;if(o===null)break;var s=o.alternate;if(s===null){if(r=o.return,r!==null){e=r;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===e)return Ab(o),i;if(s===r)return Ab(o),t;s=s.sibling}throw Error(J(188))}if(e.return!==r.return)e=o,r=s;else{for(var l=!1,a=o.child;a;){if(a===e){l=!0,e=o,r=s;break}if(a===r){l=!0,r=o,e=s;break}a=a.sibling}if(!l){for(a=s.child;a;){if(a===e){l=!0,e=s,r=o;break}if(a===r){l=!0,r=s,e=o;break}a=a.sibling}if(!l)throw Error(J(189))}}if(e.alternate!==r)throw Error(J(190))}if(e.tag!==3)throw Error(J(188));return e.stateNode.current===e?i:t}function j_(i){return i=Ag(i),i!==null?z_(i):null}function z_(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var t=z_(i);if(t!==null)return t;i=i.sibling}return null}var X_=Ue.unstable_scheduleCallback,Tb=Ue.unstable_cancelCallback,Tg=Ue.unstable_shouldYield,Pg=Ue.unstable_requestPaint,zt=Ue.unstable_now,Dg=Ue.unstable_getCurrentPriorityLevel,lp=Ue.unstable_ImmediatePriority,H_=Ue.unstable_UserBlockingPriority,Hl=Ue.unstable_NormalPriority,Mg=Ue.unstable_LowPriority,O_=Ue.unstable_IdlePriority,pa=null,Ti=null;function Rg(i){if(Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(pa,i,void 0,(i.current.flags&128)===128)}catch{}}var pi=Math.clz32?Math.clz32:Ig,kg=Math.log,Fg=Math.LN2;function Ig(i){return i>>>=0,i===0?32:31-(kg(i)/Fg|0)|0}var bl=64,_l=4194304;function Js(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Ol(i,t){var e=i.pendingLanes;if(e===0)return 0;var r=0,o=i.suspendedLanes,s=i.pingedLanes,l=e&268435455;if(l!==0){var a=l&~o;a!==0?r=Js(a):(s&=l,s!==0&&(r=Js(s)))}else l=e&~o,l!==0?r=Js(l):s!==0&&(r=Js(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,s=t&-t,o>=s||o===16&&(s&4194240)!==0))return t;if(r&4&&(r|=e&16),t=i.entangledLanes,t!==0)for(i=i.entanglements,t&=r;0<t;)e=31-pi(t),o=1<<e,r|=i[e],t&=~o;return r}function Lg(i,t){switch(i){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gg(i,t){for(var e=i.suspendedLanes,r=i.pingedLanes,o=i.expirationTimes,s=i.pendingLanes;0<s;){var l=31-pi(s),a=1<<l,c=o[l];c===-1?(!(a&e)||a&r)&&(o[l]=Lg(a,t)):c<=t&&(i.expiredLanes|=a),s&=~a}}function Bm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function N_(){var i=bl;return bl<<=1,!(bl&4194240)&&(bl=64),i}function Xu(i){for(var t=[],e=0;31>e;e++)t.push(i);return t}function bn(i,t,e){i.pendingLanes|=t,t!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,t=31-pi(t),i[t]=e}function Vg(i,t){var e=i.pendingLanes&~t;i.pendingLanes=t,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=t,i.mutableReadLanes&=t,i.entangledLanes&=t,t=i.entanglements;var r=i.eventTimes;for(i=i.expirationTimes;0<e;){var o=31-pi(e),s=1<<o;t[o]=0,r[o]=-1,i[o]=-1,e&=~s}}function ap(i,t){var e=i.entangledLanes|=t;for(i=i.entanglements;e;){var r=31-pi(e),o=1<<r;o&t|i[r]&t&&(i[r]|=t),e&=~o}}var bt=0;function Z_(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Q_,cp,q_,W_,K_,Cm=!1,yl=[],hr=null,fr=null,br=null,en=new Map,rn=new Map,ur=[],Eg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pb(i,t){switch(i){case"focusin":case"focusout":hr=null;break;case"dragenter":case"dragleave":fr=null;break;case"mouseover":case"mouseout":br=null;break;case"pointerover":case"pointerout":en.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":rn.delete(t.pointerId)}}function ks(i,t,e,r,o,s){return i===null||i.nativeEvent!==s?(i={blockedOn:t,domEventName:e,eventSystemFlags:r,nativeEvent:s,targetContainers:[o]},t!==null&&(t=yn(t),t!==null&&cp(t)),i):(i.eventSystemFlags|=r,t=i.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),i)}function Ug(i,t,e,r,o){switch(t){case"focusin":return hr=ks(hr,i,t,e,r,o),!0;case"dragenter":return fr=ks(fr,i,t,e,r,o),!0;case"mouseover":return br=ks(br,i,t,e,r,o),!0;case"pointerover":var s=o.pointerId;return en.set(s,ks(en.get(s)||null,i,t,e,r,o)),!0;case"gotpointercapture":return s=o.pointerId,rn.set(s,ks(rn.get(s)||null,i,t,e,r,o)),!0}return!1}function $_(i){var t=Wr(i.target);if(t!==null){var e=ao(t);if(e!==null){if(t=e.tag,t===13){if(t=J_(e),t!==null){i.blockedOn=t,K_(i.priority,function(){q_(e)});return}}else if(t===3&&e.stateNode.current.memoizedState.isDehydrated){i.blockedOn=e.tag===3?e.stateNode.containerInfo:null;return}}}i.blockedOn=null}function kl(i){if(i.blockedOn!==null)return!1;for(var t=i.targetContainers;0<t.length;){var e=Am(i.domEventName,i.eventSystemFlags,t[0],i.nativeEvent);if(e===null){e=i.nativeEvent;var r=new e.constructor(e.type,e);gm=r,e.target.dispatchEvent(r),gm=null}else return t=yn(e),t!==null&&cp(t),i.blockedOn=e,!1;t.shift()}return!0}function Db(i,t,e){kl(i)&&e.delete(t)}function Yg(){Cm=!1,hr!==null&&kl(hr)&&(hr=null),fr!==null&&kl(fr)&&(fr=null),br!==null&&kl(br)&&(br=null),en.forEach(Db),rn.forEach(Db)}function Fs(i,t){i.blockedOn===t&&(i.blockedOn=null,Cm||(Cm=!0,Ue.unstable_scheduleCallback(Ue.unstable_NormalPriority,Yg)))}function on(i){function t(o){return Fs(o,i)}if(0<yl.length){Fs(yl[0],i);for(var e=1;e<yl.length;e++){var r=yl[e];r.blockedOn===i&&(r.blockedOn=null)}}for(hr!==null&&Fs(hr,i),fr!==null&&Fs(fr,i),br!==null&&Fs(br,i),en.forEach(t),rn.forEach(t),e=0;e<ur.length;e++)r=ur[e],r.blockedOn===i&&(r.blockedOn=null);for(;0<ur.length&&(e=ur[0],e.blockedOn===null);)$_(e),e.blockedOn===null&&ur.shift()}var Eo=Ni.ReactCurrentBatchConfig,Nl=!0;function Jg(i,t,e,r){var o=bt,s=Eo.transition;Eo.transition=null;try{bt=1,up(i,t,e,r)}finally{bt=o,Eo.transition=s}}function jg(i,t,e,r){var o=bt,s=Eo.transition;Eo.transition=null;try{bt=4,up(i,t,e,r)}finally{bt=o,Eo.transition=s}}function up(i,t,e,r){if(Nl){var o=Am(i,t,e,r);if(o===null)Wu(i,t,r,Zl,e),Pb(i,r);else if(Ug(o,i,t,e,r))r.stopPropagation();else if(Pb(i,r),t&4&&-1<Eg.indexOf(i)){for(;o!==null;){var s=yn(o);if(s!==null&&Q_(s),s=Am(i,t,e,r),s===null&&Wu(i,t,r,Zl,e),s===o)break;o=s}o!==null&&r.stopPropagation()}else Wu(i,t,r,null,e)}}var Zl=null;function Am(i,t,e,r){if(Zl=null,i=np(r),i=Wr(i),i!==null)if(t=ao(i),t===null)i=null;else if(e=t.tag,e===13){if(i=J_(t),i!==null)return i;i=null}else if(e===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;i=null}else t!==i&&(i=null);return Zl=i,null}function ty(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Dg()){case lp:return 1;case H_:return 4;case Hl:case Mg:return 16;case O_:return 536870912;default:return 16}default:return 16}}var pr=null,mp=null,Fl=null;function ey(){if(Fl)return Fl;var i,t=mp,e=t.length,r,o="value"in pr?pr.value:pr.textContent,s=o.length;for(i=0;i<e&&t[i]===o[i];i++);var l=e-i;for(r=1;r<=l&&t[e-r]===o[s-r];r++);return Fl=o.slice(i,1<r?1-r:void 0)}function Il(i){var t=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&t===13&&(i=13)):i=t,i===10&&(i=13),32<=i||i===13?i:0}function xl(){return!0}function Mb(){return!1}function Ye(i){function t(e,r,o,s,l){this._reactName=e,this._targetInst=o,this.type=r,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(e=i[a],this[a]=e?e(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?xl:Mb,this.isPropagationStopped=Mb,this}return It(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!="unknown"&&(e.returnValue=!1),this.isDefaultPrevented=xl)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!="unknown"&&(e.cancelBubble=!0),this.isPropagationStopped=xl)},persist:function(){},isPersistent:xl}),t}var Zo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pp=Ye(Zo),_n=It({},Zo,{view:0,detail:0}),zg=Ye(_n),Hu,Ou,Is,da=It({},_n,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dp,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Is&&(Is&&i.type==="mousemove"?(Hu=i.screenX-Is.screenX,Ou=i.screenY-Is.screenY):Ou=Hu=0,Is=i),Hu)},movementY:function(i){return"movementY"in i?i.movementY:Ou}}),Rb=Ye(da),Xg=It({},da,{dataTransfer:0}),Hg=Ye(Xg),Og=It({},_n,{relatedTarget:0}),Nu=Ye(Og),Ng=It({},Zo,{animationName:0,elapsedTime:0,pseudoElement:0}),Zg=Ye(Ng),Qg=It({},Zo,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),qg=Ye(Qg),Wg=It({},Zo,{data:0}),kb=Ye(Wg),Kg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$g={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eS(i){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(i):(i=tS[i])?!!t[i]:!1}function dp(){return eS}var iS=It({},_n,{key:function(i){if(i.key){var t=Kg[i.key]||i.key;if(t!=="Unidentified")return t}return i.type==="keypress"?(i=Il(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?$g[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dp,charCode:function(i){return i.type==="keypress"?Il(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Il(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),rS=Ye(iS),oS=It({},da,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fb=Ye(oS),sS=It({},_n,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dp}),nS=Ye(sS),lS=It({},Zo,{propertyName:0,elapsedTime:0,pseudoElement:0}),aS=Ye(lS),cS=It({},da,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),uS=Ye(cS),mS=[9,13,27,32],hp=zi&&"CompositionEvent"in window,Hs=null;zi&&"documentMode"in document&&(Hs=document.documentMode);var pS=zi&&"TextEvent"in window&&!Hs,iy=zi&&(!hp||Hs&&8<Hs&&11>=Hs),Ib=" ",Lb=!1;function ry(i,t){switch(i){case"keyup":return mS.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oy(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Co=!1;function dS(i,t){switch(i){case"compositionend":return oy(t);case"keypress":return t.which!==32?null:(Lb=!0,Ib);case"textInput":return i=t.data,i===Ib&&Lb?null:i;default:return null}}function hS(i,t){if(Co)return i==="compositionend"||!hp&&ry(i,t)?(i=ey(),Fl=mp=pr=null,Co=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return iy&&t.locale!=="ko"?null:t.data;default:return null}}var fS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gb(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t==="input"?!!fS[i.type]:t==="textarea"}function sy(i,t,e,r){G_(r),t=Ql(t,"onChange"),0<t.length&&(e=new pp("onChange","change",null,e,r),i.push({event:e,listeners:t}))}var Os=null,sn=null;function bS(i){by(i,0)}function ha(i){var t=Po(i);if(D_(t))return i}function _S(i,t){if(i==="change")return t}var ny=!1;zi&&(zi?(Sl="oninput"in document,Sl||(Zu=document.createElement("div"),Zu.setAttribute("oninput","return;"),Sl=typeof Zu.oninput=="function"),gl=Sl):gl=!1,ny=gl&&(!document.documentMode||9<document.documentMode));var gl,Sl,Zu;function Vb(){Os&&(Os.detachEvent("onpropertychange",ly),sn=Os=null)}function ly(i){if(i.propertyName==="value"&&ha(sn)){var t=[];sy(t,sn,i,np(i)),Y_(bS,t)}}function yS(i,t,e){i==="focusin"?(Vb(),Os=t,sn=e,Os.attachEvent("onpropertychange",ly)):i==="focusout"&&Vb()}function xS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ha(sn)}function gS(i,t){if(i==="click")return ha(t)}function SS(i,t){if(i==="input"||i==="change")return ha(t)}function wS(i,t){return i===t&&(i!==0||1/i===1/t)||i!==i&&t!==t}var hi=typeof Object.is=="function"?Object.is:wS;function nn(i,t){if(hi(i,t))return!0;if(typeof i!="object"||i===null||typeof t!="object"||t===null)return!1;var e=Object.keys(i),r=Object.keys(t);if(e.length!==r.length)return!1;for(r=0;r<e.length;r++){var o=e[r];if(!am.call(t,o)||!hi(i[o],t[o]))return!1}return!0}function Eb(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Ub(i,t){var e=Eb(i);i=0;for(var r;e;){if(e.nodeType===3){if(r=i+e.textContent.length,i<=t&&r>=t)return{node:e,offset:t-i};i=r}t:{for(;e;){if(e.nextSibling){e=e.nextSibling;break t}e=e.parentNode}e=void 0}e=Eb(e)}}function ay(i,t){return i&&t?i===t?!0:i&&i.nodeType===3?!1:t&&t.nodeType===3?ay(i,t.parentNode):"contains"in i?i.contains(t):i.compareDocumentPosition?!!(i.compareDocumentPosition(t)&16):!1:!1}function cy(){for(var i=window,t=jl();t instanceof i.HTMLIFrameElement;){try{var e=typeof t.contentWindow.location.href=="string"}catch{e=!1}if(e)i=t.contentWindow;else break;t=jl(i.document)}return t}function fp(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t&&(t==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||t==="textarea"||i.contentEditable==="true")}function vS(i){var t=cy(),e=i.focusedElem,r=i.selectionRange;if(t!==e&&e&&e.ownerDocument&&ay(e.ownerDocument.documentElement,e)){if(r!==null&&fp(e)){if(t=r.start,i=r.end,i===void 0&&(i=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(i,e.value.length);else if(i=(t=e.ownerDocument||document)&&t.defaultView||window,i.getSelection){i=i.getSelection();var o=e.textContent.length,s=Math.min(r.start,o);r=r.end===void 0?s:Math.min(r.end,o),!i.extend&&s>r&&(o=r,r=s,s=o),o=Ub(e,s);var l=Ub(e,r);o&&l&&(i.rangeCount!==1||i.anchorNode!==o.node||i.anchorOffset!==o.offset||i.focusNode!==l.node||i.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),i.removeAllRanges(),s>r?(i.addRange(t),i.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),i.addRange(t)))}}for(t=[],i=e;i=i.parentNode;)i.nodeType===1&&t.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof e.focus=="function"&&e.focus(),e=0;e<t.length;e++)i=t[e],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var BS=zi&&"documentMode"in document&&11>=document.documentMode,Ao=null,Tm=null,Ns=null,Pm=!1;function Yb(i,t,e){var r=e.window===e?e.document:e.nodeType===9?e:e.ownerDocument;Pm||Ao==null||Ao!==jl(r)||(r=Ao,"selectionStart"in r&&fp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ns&&nn(Ns,r)||(Ns=r,r=Ql(Tm,"onSelect"),0<r.length&&(t=new pp("onSelect","select",null,t,e),i.push({event:t,listeners:r}),t.target=Ao)))}function wl(i,t){var e={};return e[i.toLowerCase()]=t.toLowerCase(),e["Webkit"+i]="webkit"+t,e["Moz"+i]="moz"+t,e}var To={animationend:wl("Animation","AnimationEnd"),animationiteration:wl("Animation","AnimationIteration"),animationstart:wl("Animation","AnimationStart"),transitionend:wl("Transition","TransitionEnd")},Qu={},uy={};zi&&(uy=document.createElement("div").style,"AnimationEvent"in window||(delete To.animationend.animation,delete To.animationiteration.animation,delete To.animationstart.animation),"TransitionEvent"in window||delete To.transitionend.transition);function fa(i){if(Qu[i])return Qu[i];if(!To[i])return i;var t=To[i],e;for(e in t)if(t.hasOwnProperty(e)&&e in uy)return Qu[i]=t[e];return i}var my=fa("animationend"),py=fa("animationiteration"),dy=fa("animationstart"),hy=fa("transitionend"),fy=new Map,Jb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Br(i,t){fy.set(i,t),lo(t,[i])}for(vl=0;vl<Jb.length;vl++)Bl=Jb[vl],jb=Bl.toLowerCase(),zb=Bl[0].toUpperCase()+Bl.slice(1),Br(jb,"on"+zb);var Bl,jb,zb,vl;Br(my,"onAnimationEnd");Br(py,"onAnimationIteration");Br(dy,"onAnimationStart");Br("dblclick","onDoubleClick");Br("focusin","onFocus");Br("focusout","onBlur");Br(hy,"onTransitionEnd");Jo("onMouseEnter",["mouseout","mouseover"]);Jo("onMouseLeave",["mouseout","mouseover"]);Jo("onPointerEnter",["pointerout","pointerover"]);Jo("onPointerLeave",["pointerout","pointerover"]);lo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lo("onBeforeInput",["compositionend","keypress","textInput","paste"]);lo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var js="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CS=new Set("cancel close invalid load scroll toggle".split(" ").concat(js));function Xb(i,t,e){var r=i.type||"unknown-event";i.currentTarget=e,Cg(r,t,void 0,i),i.currentTarget=null}function by(i,t){t=(t&4)!==0;for(var e=0;e<i.length;e++){var r=i[e],o=r.event;r=r.listeners;t:{var s=void 0;if(t)for(var l=r.length-1;0<=l;l--){var a=r[l],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==s&&o.isPropagationStopped())break t;Xb(o,a,u),s=c}else for(l=0;l<r.length;l++){if(a=r[l],c=a.instance,u=a.currentTarget,a=a.listener,c!==s&&o.isPropagationStopped())break t;Xb(o,a,u),s=c}}}if(Xl)throw i=vm,Xl=!1,vm=null,i}function vt(i,t){var e=t[Fm];e===void 0&&(e=t[Fm]=new Set);var r=i+"__bubble";e.has(r)||(_y(t,i,2,!1),e.add(r))}function qu(i,t,e){var r=0;t&&(r|=4),_y(e,i,r,t)}var Cl="_reactListening"+Math.random().toString(36).slice(2);function ln(i){if(!i[Cl]){i[Cl]=!0,B_.forEach(function(e){e!=="selectionchange"&&(CS.has(e)||qu(e,!1,i),qu(e,!0,i))});var t=i.nodeType===9?i:i.ownerDocument;t===null||t[Cl]||(t[Cl]=!0,qu("selectionchange",!1,t))}}function _y(i,t,e,r){switch(ty(t)){case 1:var o=Jg;break;case 4:o=jg;break;default:o=up}e=o.bind(null,t,e,i),o=void 0,!wm||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?i.addEventListener(t,e,{capture:!0,passive:o}):i.addEventListener(t,e,!0):o!==void 0?i.addEventListener(t,e,{passive:o}):i.addEventListener(t,e,!1)}function Wu(i,t,e,r,o){var s=r;if(!(t&1)&&!(t&2)&&r!==null)t:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(l===4)for(l=r.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===o||c.nodeType===8&&c.parentNode===o))return;l=l.return}for(;a!==null;){if(l=Wr(a),l===null)return;if(c=l.tag,c===5||c===6){r=s=l;continue t}a=a.parentNode}}r=r.return}Y_(function(){var u=s,m=np(e),p=[];t:{var d=fy.get(i);if(d!==void 0){var h=pp,f=i;switch(i){case"keypress":if(Il(e)===0)break t;case"keydown":case"keyup":h=rS;break;case"focusin":f="focus",h=Nu;break;case"focusout":f="blur",h=Nu;break;case"beforeblur":case"afterblur":h=Nu;break;case"click":if(e.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Rb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Hg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=nS;break;case my:case py:case dy:h=Zg;break;case hy:h=aS;break;case"scroll":h=zg;break;case"wheel":h=uS;break;case"copy":case"cut":case"paste":h=qg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Fb}var b=(t&4)!==0,x=!b&&i==="scroll",_=b?d!==null?d+"Capture":null:d;b=[];for(var y=u,g;y!==null;){g=y;var S=g.stateNode;if(g.tag===5&&S!==null&&(g=S,_!==null&&(S=tn(y,_),S!=null&&b.push(an(y,S,g)))),x)break;y=y.return}0<b.length&&(d=new h(d,f,null,e,m),p.push({event:d,listeners:b}))}}if(!(t&7)){t:{if(d=i==="mouseover"||i==="pointerover",h=i==="mouseout"||i==="pointerout",d&&e!==gm&&(f=e.relatedTarget||e.fromElement)&&(Wr(f)||f[Xi]))break t;if((h||d)&&(d=m.window===m?m:(d=m.ownerDocument)?d.defaultView||d.parentWindow:window,h?(f=e.relatedTarget||e.toElement,h=u,f=f?Wr(f):null,f!==null&&(x=ao(f),f!==x||f.tag!==5&&f.tag!==6)&&(f=null)):(h=null,f=u),h!==f)){if(b=Rb,S="onMouseLeave",_="onMouseEnter",y="mouse",(i==="pointerout"||i==="pointerover")&&(b=Fb,S="onPointerLeave",_="onPointerEnter",y="pointer"),x=h==null?d:Po(h),g=f==null?d:Po(f),d=new b(S,y+"leave",h,e,m),d.target=x,d.relatedTarget=g,S=null,Wr(m)===u&&(b=new b(_,y+"enter",f,e,m),b.target=g,b.relatedTarget=x,S=b),x=S,h&&f)e:{for(b=h,_=f,y=0,g=b;g;g=wo(g))y++;for(g=0,S=_;S;S=wo(S))g++;for(;0<y-g;)b=wo(b),y--;for(;0<g-y;)_=wo(_),g--;for(;y--;){if(b===_||_!==null&&b===_.alternate)break e;b=wo(b),_=wo(_)}b=null}else b=null;h!==null&&Hb(p,d,h,b,!1),f!==null&&x!==null&&Hb(p,x,f,b,!0)}}t:{if(d=u?Po(u):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var w=_S;else if(Gb(d))if(ny)w=SS;else{w=xS;var B=yS}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(w=gS);if(w&&(w=w(i,u))){sy(p,w,e,m);break t}B&&B(i,d,u),i==="focusout"&&(B=d._wrapperState)&&B.controlled&&d.type==="number"&&fm(d,"number",d.value)}switch(B=u?Po(u):window,i){case"focusin":(Gb(B)||B.contentEditable==="true")&&(Ao=B,Tm=u,Ns=null);break;case"focusout":Ns=Tm=Ao=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,Yb(p,e,m);break;case"selectionchange":if(BS)break;case"keydown":case"keyup":Yb(p,e,m)}var C;if(hp)t:{switch(i){case"compositionstart":var A="onCompositionStart";break t;case"compositionend":A="onCompositionEnd";break t;case"compositionupdate":A="onCompositionUpdate";break t}A=void 0}else Co?ry(i,e)&&(A="onCompositionEnd"):i==="keydown"&&e.keyCode===229&&(A="onCompositionStart");A&&(iy&&e.locale!=="ko"&&(Co||A!=="onCompositionStart"?A==="onCompositionEnd"&&Co&&(C=ey()):(pr=m,mp="value"in pr?pr.value:pr.textContent,Co=!0)),B=Ql(u,A),0<B.length&&(A=new kb(A,i,null,e,m),p.push({event:A,listeners:B}),C?A.data=C:(C=oy(e),C!==null&&(A.data=C)))),(C=pS?dS(i,e):hS(i,e))&&(u=Ql(u,"onBeforeInput"),0<u.length&&(m=new kb("onBeforeInput","beforeinput",null,e,m),p.push({event:m,listeners:u}),m.data=C))}by(p,t)})}function an(i,t,e){return{instance:i,listener:t,currentTarget:e}}function Ql(i,t){for(var e=t+"Capture",r=[];i!==null;){var o=i,s=o.stateNode;o.tag===5&&s!==null&&(o=s,s=tn(i,e),s!=null&&r.unshift(an(i,s,o)),s=tn(i,t),s!=null&&r.push(an(i,s,o))),i=i.return}return r}function wo(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Hb(i,t,e,r,o){for(var s=t._reactName,l=[];e!==null&&e!==r;){var a=e,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,o?(c=tn(e,s),c!=null&&l.unshift(an(e,c,a))):o||(c=tn(e,s),c!=null&&l.push(an(e,c,a)))),e=e.return}l.length!==0&&i.push({event:t,listeners:l})}var AS=/\r\n?/g,TS=/\u0000|\uFFFD/g;function Ob(i){return(typeof i=="string"?i:""+i).replace(AS,`
`).replace(TS,"")}function Al(i,t,e){if(t=Ob(t),Ob(i)!==t&&e)throw Error(J(425))}function ql(){}var Dm=null,Mm=null;function Rm(i,t){return i==="textarea"||i==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var km=typeof setTimeout=="function"?setTimeout:void 0,PS=typeof clearTimeout=="function"?clearTimeout:void 0,Nb=typeof Promise=="function"?Promise:void 0,DS=typeof queueMicrotask=="function"?queueMicrotask:typeof Nb<"u"?function(i){return Nb.resolve(null).then(i).catch(MS)}:km;function MS(i){setTimeout(function(){throw i})}function Ku(i,t){var e=t,r=0;do{var o=e.nextSibling;if(i.removeChild(e),o&&o.nodeType===8)if(e=o.data,e==="/$"){if(r===0){i.removeChild(o),on(t);return}r--}else e!=="$"&&e!=="$?"&&e!=="$!"||r++;e=o}while(e);on(t)}function _r(i){for(;i!=null;i=i.nextSibling){var t=i.nodeType;if(t===1||t===3)break;if(t===8){if(t=i.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return i}function Zb(i){i=i.previousSibling;for(var t=0;i;){if(i.nodeType===8){var e=i.data;if(e==="$"||e==="$!"||e==="$?"){if(t===0)return i;t--}else e==="/$"&&t++}i=i.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),Ai="__reactFiber$"+Qo,cn="__reactProps$"+Qo,Xi="__reactContainer$"+Qo,Fm="__reactEvents$"+Qo,RS="__reactListeners$"+Qo,kS="__reactHandles$"+Qo;function Wr(i){var t=i[Ai];if(t)return t;for(var e=i.parentNode;e;){if(t=e[Xi]||e[Ai]){if(e=t.alternate,t.child!==null||e!==null&&e.child!==null)for(i=Zb(i);i!==null;){if(e=i[Ai])return e;i=Zb(i)}return t}i=e,e=i.parentNode}return null}function yn(i){return i=i[Ai]||i[Xi],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Po(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(J(33))}function ba(i){return i[cn]||null}var Im=[],Do=-1;function Cr(i){return{current:i}}function Bt(i){0>Do||(i.current=Im[Do],Im[Do]=null,Do--)}function xt(i,t){Do++,Im[Do]=i.current,i.current=t}var vr={},me=Cr(vr),Te=Cr(!1),io=vr;function jo(i,t){var e=i.type.contextTypes;if(!e)return vr;var r=i.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},s;for(s in e)o[s]=t[s];return r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=t,i.__reactInternalMemoizedMaskedChildContext=o),o}function Pe(i){return i=i.childContextTypes,i!=null}function Wl(){Bt(Te),Bt(me)}function Qb(i,t,e){if(me.current!==vr)throw Error(J(168));xt(me,t),xt(Te,e)}function yy(i,t,e){var r=i.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return e;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(J(108,yg(i)||"Unknown",o));return It({},e,r)}function Kl(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||vr,io=me.current,xt(me,i),xt(Te,Te.current),!0}function qb(i,t,e){var r=i.stateNode;if(!r)throw Error(J(169));e?(i=yy(i,t,io),r.__reactInternalMemoizedMergedChildContext=i,Bt(Te),Bt(me),xt(me,i)):Bt(Te),xt(Te,e)}var Ui=null,_a=!1,$u=!1;function xy(i){Ui===null?Ui=[i]:Ui.push(i)}function FS(i){_a=!0,xy(i)}function Ar(){if(!$u&&Ui!==null){$u=!0;var i=0,t=bt;try{var e=Ui;for(bt=1;i<e.length;i++){var r=e[i];do r=r(!0);while(r!==null)}Ui=null,_a=!1}catch(o){throw Ui!==null&&(Ui=Ui.slice(i+1)),X_(lp,Ar),o}finally{bt=t,$u=!1}}return null}var Mo=[],Ro=0,$l=null,ta=0,Qe=[],qe=0,ro=null,Yi=1,Ji="";function Qr(i,t){Mo[Ro++]=ta,Mo[Ro++]=$l,$l=i,ta=t}function gy(i,t,e){Qe[qe++]=Yi,Qe[qe++]=Ji,Qe[qe++]=ro,ro=i;var r=Yi;i=Ji;var o=32-pi(r)-1;r&=~(1<<o),e+=1;var s=32-pi(t)+o;if(30<s){var l=o-o%5;s=(r&(1<<l)-1).toString(32),r>>=l,o-=l,Yi=1<<32-pi(t)+o|e<<o|r,Ji=s+i}else Yi=1<<s|e<<o|r,Ji=i}function bp(i){i.return!==null&&(Qr(i,1),gy(i,1,0))}function _p(i){for(;i===$l;)$l=Mo[--Ro],Mo[Ro]=null,ta=Mo[--Ro],Mo[Ro]=null;for(;i===ro;)ro=Qe[--qe],Qe[qe]=null,Ji=Qe[--qe],Qe[qe]=null,Yi=Qe[--qe],Qe[qe]=null}var Ee=null,Ve=null,Pt=!1,mi=null;function Sy(i,t){var e=We(5,null,null,0);e.elementType="DELETED",e.stateNode=t,e.return=i,t=i.deletions,t===null?(i.deletions=[e],i.flags|=16):t.push(e)}function Wb(i,t){switch(i.tag){case 5:var e=i.type;return t=t.nodeType!==1||e.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(i.stateNode=t,Ee=i,Ve=_r(t.firstChild),!0):!1;case 6:return t=i.pendingProps===""||t.nodeType!==3?null:t,t!==null?(i.stateNode=t,Ee=i,Ve=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(e=ro!==null?{id:Yi,overflow:Ji}:null,i.memoizedState={dehydrated:t,treeContext:e,retryLane:1073741824},e=We(18,null,null,0),e.stateNode=t,e.return=i,i.child=e,Ee=i,Ve=null,!0):!1;default:return!1}}function Lm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Gm(i){if(Pt){var t=Ve;if(t){var e=t;if(!Wb(i,t)){if(Lm(i))throw Error(J(418));t=_r(e.nextSibling);var r=Ee;t&&Wb(i,t)?Sy(r,e):(i.flags=i.flags&-4097|2,Pt=!1,Ee=i)}}else{if(Lm(i))throw Error(J(418));i.flags=i.flags&-4097|2,Pt=!1,Ee=i}}}function Kb(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ee=i}function Tl(i){if(i!==Ee)return!1;if(!Pt)return Kb(i),Pt=!0,!1;var t;if((t=i.tag!==3)&&!(t=i.tag!==5)&&(t=i.type,t=t!=="head"&&t!=="body"&&!Rm(i.type,i.memoizedProps)),t&&(t=Ve)){if(Lm(i))throw wy(),Error(J(418));for(;t;)Sy(i,t),t=_r(t.nextSibling)}if(Kb(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));t:{for(i=i.nextSibling,t=0;i;){if(i.nodeType===8){var e=i.data;if(e==="/$"){if(t===0){Ve=_r(i.nextSibling);break t}t--}else e!=="$"&&e!=="$!"&&e!=="$?"||t++}i=i.nextSibling}Ve=null}}else Ve=Ee?_r(i.stateNode.nextSibling):null;return!0}function wy(){for(var i=Ve;i;)i=_r(i.nextSibling)}function zo(){Ve=Ee=null,Pt=!1}function yp(i){mi===null?mi=[i]:mi.push(i)}var IS=Ni.ReactCurrentBatchConfig;function Ls(i,t,e){if(i=e.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(e._owner){if(e=e._owner,e){if(e.tag!==1)throw Error(J(309));var r=e.stateNode}if(!r)throw Error(J(147,i));var o=r,s=""+i;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(l){var a=o.refs;l===null?delete a[s]:a[s]=l},t._stringRef=s,t)}if(typeof i!="string")throw Error(J(284));if(!e._owner)throw Error(J(290,i))}return i}function Pl(i,t){throw i=Object.prototype.toString.call(t),Error(J(31,i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i))}function $b(i){var t=i._init;return t(i._payload)}function vy(i){function t(_,y){if(i){var g=_.deletions;g===null?(_.deletions=[y],_.flags|=16):g.push(y)}}function e(_,y){if(!i)return null;for(;y!==null;)t(_,y),y=y.sibling;return null}function r(_,y){for(_=new Map;y!==null;)y.key!==null?_.set(y.key,y):_.set(y.index,y),y=y.sibling;return _}function o(_,y){return _=Sr(_,y),_.index=0,_.sibling=null,_}function s(_,y,g){return _.index=g,i?(g=_.alternate,g!==null?(g=g.index,g<y?(_.flags|=2,y):g):(_.flags|=2,y)):(_.flags|=1048576,y)}function l(_){return i&&_.alternate===null&&(_.flags|=2),_}function a(_,y,g,S){return y===null||y.tag!==6?(y=nm(g,_.mode,S),y.return=_,y):(y=o(y,g),y.return=_,y)}function c(_,y,g,S){var w=g.type;return w===Bo?m(_,y,g.props.children,S,g.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ar&&$b(w)===y.type)?(S=o(y,g.props),S.ref=Ls(_,y,g),S.return=_,S):(S=Jl(g.type,g.key,g.props,null,_.mode,S),S.ref=Ls(_,y,g),S.return=_,S)}function u(_,y,g,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==g.containerInfo||y.stateNode.implementation!==g.implementation?(y=lm(g,_.mode,S),y.return=_,y):(y=o(y,g.children||[]),y.return=_,y)}function m(_,y,g,S,w){return y===null||y.tag!==7?(y=eo(g,_.mode,S,w),y.return=_,y):(y=o(y,g),y.return=_,y)}function p(_,y,g){if(typeof y=="string"&&y!==""||typeof y=="number")return y=nm(""+y,_.mode,g),y.return=_,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case dl:return g=Jl(y.type,y.key,y.props,null,_.mode,g),g.ref=Ls(_,null,y),g.return=_,g;case vo:return y=lm(y,_.mode,g),y.return=_,y;case ar:var S=y._init;return p(_,S(y._payload),g)}if(Ys(y)||Rs(y))return y=eo(y,_.mode,g,null),y.return=_,y;Pl(_,y)}return null}function d(_,y,g,S){var w=y!==null?y.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return w!==null?null:a(_,y,""+g,S);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case dl:return g.key===w?c(_,y,g,S):null;case vo:return g.key===w?u(_,y,g,S):null;case ar:return w=g._init,d(_,y,w(g._payload),S)}if(Ys(g)||Rs(g))return w!==null?null:m(_,y,g,S,null);Pl(_,g)}return null}function h(_,y,g,S,w){if(typeof S=="string"&&S!==""||typeof S=="number")return _=_.get(g)||null,a(y,_,""+S,w);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case dl:return _=_.get(S.key===null?g:S.key)||null,c(y,_,S,w);case vo:return _=_.get(S.key===null?g:S.key)||null,u(y,_,S,w);case ar:var B=S._init;return h(_,y,g,B(S._payload),w)}if(Ys(S)||Rs(S))return _=_.get(g)||null,m(y,_,S,w,null);Pl(y,S)}return null}function f(_,y,g,S){for(var w=null,B=null,C=y,A=y=0,k=null;C!==null&&A<g.length;A++){C.index>A?(k=C,C=null):k=C.sibling;var M=d(_,C,g[A],S);if(M===null){C===null&&(C=k);break}i&&C&&M.alternate===null&&t(_,C),y=s(M,y,A),B===null?w=M:B.sibling=M,B=M,C=k}if(A===g.length)return e(_,C),Pt&&Qr(_,A),w;if(C===null){for(;A<g.length;A++)C=p(_,g[A],S),C!==null&&(y=s(C,y,A),B===null?w=C:B.sibling=C,B=C);return Pt&&Qr(_,A),w}for(C=r(_,C);A<g.length;A++)k=h(C,_,A,g[A],S),k!==null&&(i&&k.alternate!==null&&C.delete(k.key===null?A:k.key),y=s(k,y,A),B===null?w=k:B.sibling=k,B=k);return i&&C.forEach(function(E){return t(_,E)}),Pt&&Qr(_,A),w}function b(_,y,g,S){var w=Rs(g);if(typeof w!="function")throw Error(J(150));if(g=w.call(g),g==null)throw Error(J(151));for(var B=w=null,C=y,A=y=0,k=null,M=g.next();C!==null&&!M.done;A++,M=g.next()){C.index>A?(k=C,C=null):k=C.sibling;var E=d(_,C,M.value,S);if(E===null){C===null&&(C=k);break}i&&C&&E.alternate===null&&t(_,C),y=s(E,y,A),B===null?w=E:B.sibling=E,B=E,C=k}if(M.done)return e(_,C),Pt&&Qr(_,A),w;if(C===null){for(;!M.done;A++,M=g.next())M=p(_,M.value,S),M!==null&&(y=s(M,y,A),B===null?w=M:B.sibling=M,B=M);return Pt&&Qr(_,A),w}for(C=r(_,C);!M.done;A++,M=g.next())M=h(C,_,A,M.value,S),M!==null&&(i&&M.alternate!==null&&C.delete(M.key===null?A:M.key),y=s(M,y,A),B===null?w=M:B.sibling=M,B=M);return i&&C.forEach(function(L){return t(_,L)}),Pt&&Qr(_,A),w}function x(_,y,g,S){if(typeof g=="object"&&g!==null&&g.type===Bo&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case dl:t:{for(var w=g.key,B=y;B!==null;){if(B.key===w){if(w=g.type,w===Bo){if(B.tag===7){e(_,B.sibling),y=o(B,g.props.children),y.return=_,_=y;break t}}else if(B.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ar&&$b(w)===B.type){e(_,B.sibling),y=o(B,g.props),y.ref=Ls(_,B,g),y.return=_,_=y;break t}e(_,B);break}else t(_,B);B=B.sibling}g.type===Bo?(y=eo(g.props.children,_.mode,S,g.key),y.return=_,_=y):(S=Jl(g.type,g.key,g.props,null,_.mode,S),S.ref=Ls(_,y,g),S.return=_,_=S)}return l(_);case vo:t:{for(B=g.key;y!==null;){if(y.key===B)if(y.tag===4&&y.stateNode.containerInfo===g.containerInfo&&y.stateNode.implementation===g.implementation){e(_,y.sibling),y=o(y,g.children||[]),y.return=_,_=y;break t}else{e(_,y);break}else t(_,y);y=y.sibling}y=lm(g,_.mode,S),y.return=_,_=y}return l(_);case ar:return B=g._init,x(_,y,B(g._payload),S)}if(Ys(g))return f(_,y,g,S);if(Rs(g))return b(_,y,g,S);Pl(_,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,y!==null&&y.tag===6?(e(_,y.sibling),y=o(y,g),y.return=_,_=y):(e(_,y),y=nm(g,_.mode,S),y.return=_,_=y),l(_)):e(_,y)}return x}var Xo=vy(!0),By=vy(!1),ea=Cr(null),ia=null,ko=null,xp=null;function gp(){xp=ko=ia=null}function Sp(i){var t=ea.current;Bt(ea),i._currentValue=t}function Vm(i,t,e){for(;i!==null;){var r=i.alternate;if((i.childLanes&t)!==t?(i.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),i===e)break;i=i.return}}function Uo(i,t){ia=i,xp=ko=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&t&&(Ae=!0),i.firstContext=null)}function $e(i){var t=i._currentValue;if(xp!==i)if(i={context:i,memoizedValue:t,next:null},ko===null){if(ia===null)throw Error(J(308));ko=i,ia.dependencies={lanes:0,firstContext:i}}else ko=ko.next=i;return t}var Kr=null;function wp(i){Kr===null?Kr=[i]:Kr.push(i)}function Cy(i,t,e,r){var o=t.interleaved;return o===null?(e.next=e,wp(t)):(e.next=o.next,o.next=e),t.interleaved=e,Hi(i,r)}function Hi(i,t){i.lanes|=t;var e=i.alternate;for(e!==null&&(e.lanes|=t),e=i,i=i.return;i!==null;)i.childLanes|=t,e=i.alternate,e!==null&&(e.childLanes|=t),e=i,i=i.return;return e.tag===3?e.stateNode:null}var cr=!1;function vp(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ay(i,t){i=i.updateQueue,t.updateQueue===i&&(t.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ji(i,t){return{eventTime:i,lane:t,tag:0,payload:null,callback:null,next:null}}function yr(i,t,e){var r=i.updateQueue;if(r===null)return null;if(r=r.shared,ct&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Hi(i,e)}return o=r.interleaved,o===null?(t.next=t,wp(r)):(t.next=o.next,o.next=t),r.interleaved=t,Hi(i,e)}function Ll(i,t,e){if(t=t.updateQueue,t!==null&&(t=t.shared,(e&4194240)!==0)){var r=t.lanes;r&=i.pendingLanes,e|=r,t.lanes=e,ap(i,e)}}function t_(i,t){var e=i.updateQueue,r=i.alternate;if(r!==null&&(r=r.updateQueue,e===r)){var o=null,s=null;if(e=e.firstBaseUpdate,e!==null){do{var l={eventTime:e.eventTime,lane:e.lane,tag:e.tag,payload:e.payload,callback:e.callback,next:null};s===null?o=s=l:s=s.next=l,e=e.next}while(e!==null);s===null?o=s=t:s=s.next=t}else o=s=t;e={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:r.shared,effects:r.effects},i.updateQueue=e;return}i=e.lastBaseUpdate,i===null?e.firstBaseUpdate=t:i.next=t,e.lastBaseUpdate=t}function ra(i,t,e,r){var o=i.updateQueue;cr=!1;var s=o.firstBaseUpdate,l=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var c=a,u=c.next;c.next=null,l===null?s=u:l.next=u,l=c;var m=i.alternate;m!==null&&(m=m.updateQueue,a=m.lastBaseUpdate,a!==l&&(a===null?m.firstBaseUpdate=u:a.next=u,m.lastBaseUpdate=c))}if(s!==null){var p=o.baseState;l=0,m=u=c=null,a=s;do{var d=a.lane,h=a.eventTime;if((r&d)===d){m!==null&&(m=m.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var f=i,b=a;switch(d=t,h=e,b.tag){case 1:if(f=b.payload,typeof f=="function"){p=f.call(h,p,d);break t}p=f;break t;case 3:f.flags=f.flags&-65537|128;case 0:if(f=b.payload,d=typeof f=="function"?f.call(h,p,d):f,d==null)break t;p=It({},p,d);break t;case 2:cr=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,d=o.effects,d===null?o.effects=[a]:d.push(a))}else h={eventTime:h,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},m===null?(u=m=h,c=p):m=m.next=h,l|=d;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;d=a,a=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(!0);if(m===null&&(c=p),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=m,t=o.shared.interleaved,t!==null){o=t;do l|=o.lane,o=o.next;while(o!==t)}else s===null&&(o.shared.lanes=0);so|=l,i.lanes=l,i.memoizedState=p}}function e_(i,t,e){if(i=t.effects,t.effects=null,i!==null)for(t=0;t<i.length;t++){var r=i[t],o=r.callback;if(o!==null){if(r.callback=null,r=e,typeof o!="function")throw Error(J(191,o));o.call(r)}}}var xn={},Pi=Cr(xn),un=Cr(xn),mn=Cr(xn);function $r(i){if(i===xn)throw Error(J(174));return i}function Bp(i,t){switch(xt(mn,t),xt(un,i),xt(Pi,xn),i=t.nodeType,i){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_m(null,"");break;default:i=i===8?t.parentNode:t,t=i.namespaceURI||null,i=i.tagName,t=_m(t,i)}Bt(Pi),xt(Pi,t)}function Ho(){Bt(Pi),Bt(un),Bt(mn)}function Ty(i){$r(mn.current);var t=$r(Pi.current),e=_m(t,i.type);t!==e&&(xt(un,i),xt(Pi,e))}function Cp(i){un.current===i&&(Bt(Pi),Bt(un))}var kt=Cr(0);function oa(i){for(var t=i;t!==null;){if(t.tag===13){var e=t.memoizedState;if(e!==null&&(e=e.dehydrated,e===null||e.data==="$?"||e.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var tm=[];function Ap(){for(var i=0;i<tm.length;i++)tm[i]._workInProgressVersionPrimary=null;tm.length=0}var Gl=Ni.ReactCurrentDispatcher,em=Ni.ReactCurrentBatchConfig,oo=0,Ft=null,qt=null,te=null,sa=!1,Zs=!1,pn=0,LS=0;function ae(){throw Error(J(321))}function Tp(i,t){if(t===null)return!1;for(var e=0;e<t.length&&e<i.length;e++)if(!hi(i[e],t[e]))return!1;return!0}function Pp(i,t,e,r,o,s){if(oo=s,Ft=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Gl.current=i===null||i.memoizedState===null?US:YS,i=e(r,o),Zs){s=0;do{if(Zs=!1,pn=0,25<=s)throw Error(J(301));s+=1,te=qt=null,t.updateQueue=null,Gl.current=JS,i=e(r,o)}while(Zs)}if(Gl.current=na,t=qt!==null&&qt.next!==null,oo=0,te=qt=Ft=null,sa=!1,t)throw Error(J(300));return i}function Dp(){var i=pn!==0;return pn=0,i}function Ci(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return te===null?Ft.memoizedState=te=i:te=te.next=i,te}function ti(){if(qt===null){var i=Ft.alternate;i=i!==null?i.memoizedState:null}else i=qt.next;var t=te===null?Ft.memoizedState:te.next;if(t!==null)te=t,qt=i;else{if(i===null)throw Error(J(310));qt=i,i={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},te===null?Ft.memoizedState=te=i:te=te.next=i}return te}function dn(i,t){return typeof t=="function"?t(i):t}function im(i){var t=ti(),e=t.queue;if(e===null)throw Error(J(311));e.lastRenderedReducer=i;var r=qt,o=r.baseQueue,s=e.pending;if(s!==null){if(o!==null){var l=o.next;o.next=s.next,s.next=l}r.baseQueue=o=s,e.pending=null}if(o!==null){s=o.next,r=r.baseState;var a=l=null,c=null,u=s;do{var m=u.lane;if((oo&m)===m)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:i(r,u.action);else{var p={lane:m,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=p,l=r):c=c.next=p,Ft.lanes|=m,so|=m}u=u.next}while(u!==null&&u!==s);c===null?l=r:c.next=a,hi(r,t.memoizedState)||(Ae=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=c,e.lastRenderedState=r}if(i=e.interleaved,i!==null){o=i;do s=o.lane,Ft.lanes|=s,so|=s,o=o.next;while(o!==i)}else o===null&&(e.lanes=0);return[t.memoizedState,e.dispatch]}function rm(i){var t=ti(),e=t.queue;if(e===null)throw Error(J(311));e.lastRenderedReducer=i;var r=e.dispatch,o=e.pending,s=t.memoizedState;if(o!==null){e.pending=null;var l=o=o.next;do s=i(s,l.action),l=l.next;while(l!==o);hi(s,t.memoizedState)||(Ae=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),e.lastRenderedState=s}return[s,r]}function Py(){}function Dy(i,t){var e=Ft,r=ti(),o=t(),s=!hi(r.memoizedState,o);if(s&&(r.memoizedState=o,Ae=!0),r=r.queue,Mp(ky.bind(null,e,r,i),[i]),r.getSnapshot!==t||s||te!==null&&te.memoizedState.tag&1){if(e.flags|=2048,hn(9,Ry.bind(null,e,r,o,t),void 0,null),ee===null)throw Error(J(349));oo&30||My(e,t,o)}return o}function My(i,t,e){i.flags|=16384,i={getSnapshot:t,value:e},t=Ft.updateQueue,t===null?(t={lastEffect:null,stores:null},Ft.updateQueue=t,t.stores=[i]):(e=t.stores,e===null?t.stores=[i]:e.push(i))}function Ry(i,t,e,r){t.value=e,t.getSnapshot=r,Fy(t)&&Iy(i)}function ky(i,t,e){return e(function(){Fy(t)&&Iy(i)})}function Fy(i){var t=i.getSnapshot;i=i.value;try{var e=t();return!hi(i,e)}catch{return!0}}function Iy(i){var t=Hi(i,1);t!==null&&di(t,i,1,-1)}function i_(i){var t=Ci();return typeof i=="function"&&(i=i()),t.memoizedState=t.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dn,lastRenderedState:i},t.queue=i,i=i.dispatch=ES.bind(null,Ft,i),[t.memoizedState,i]}function hn(i,t,e,r){return i={tag:i,create:t,destroy:e,deps:r,next:null},t=Ft.updateQueue,t===null?(t={lastEffect:null,stores:null},Ft.updateQueue=t,t.lastEffect=i.next=i):(e=t.lastEffect,e===null?t.lastEffect=i.next=i:(r=e.next,e.next=i,i.next=r,t.lastEffect=i)),i}function Ly(){return ti().memoizedState}function Vl(i,t,e,r){var o=Ci();Ft.flags|=i,o.memoizedState=hn(1|t,e,void 0,r===void 0?null:r)}function ya(i,t,e,r){var o=ti();r=r===void 0?null:r;var s=void 0;if(qt!==null){var l=qt.memoizedState;if(s=l.destroy,r!==null&&Tp(r,l.deps)){o.memoizedState=hn(t,e,s,r);return}}Ft.flags|=i,o.memoizedState=hn(1|t,e,s,r)}function r_(i,t){return Vl(8390656,8,i,t)}function Mp(i,t){return ya(2048,8,i,t)}function Gy(i,t){return ya(4,2,i,t)}function Vy(i,t){return ya(4,4,i,t)}function Ey(i,t){if(typeof t=="function")return i=i(),t(i),function(){t(null)};if(t!=null)return i=i(),t.current=i,function(){t.current=null}}function Uy(i,t,e){return e=e!=null?e.concat([i]):null,ya(4,4,Ey.bind(null,t,i),e)}function Rp(){}function Yy(i,t){var e=ti();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Tp(t,r[1])?r[0]:(e.memoizedState=[i,t],i)}function Jy(i,t){var e=ti();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Tp(t,r[1])?r[0]:(i=i(),e.memoizedState=[i,t],i)}function jy(i,t,e){return oo&21?(hi(e,t)||(e=N_(),Ft.lanes|=e,so|=e,i.baseState=!0),t):(i.baseState&&(i.baseState=!1,Ae=!0),i.memoizedState=e)}function GS(i,t){var e=bt;bt=e!==0&&4>e?e:4,i(!0);var r=em.transition;em.transition={};try{i(!1),t()}finally{bt=e,em.transition=r}}function zy(){return ti().memoizedState}function VS(i,t,e){var r=gr(i);if(e={lane:r,action:e,hasEagerState:!1,eagerState:null,next:null},Xy(i))Hy(t,e);else if(e=Cy(i,t,e,r),e!==null){var o=xe();di(e,i,r,o),Oy(e,t,r)}}function ES(i,t,e){var r=gr(i),o={lane:r,action:e,hasEagerState:!1,eagerState:null,next:null};if(Xy(i))Hy(t,o);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var l=t.lastRenderedState,a=s(l,e);if(o.hasEagerState=!0,o.eagerState=a,hi(a,l)){var c=t.interleaved;c===null?(o.next=o,wp(t)):(o.next=c.next,c.next=o),t.interleaved=o;return}}catch{}finally{}e=Cy(i,t,o,r),e!==null&&(o=xe(),di(e,i,r,o),Oy(e,t,r))}}function Xy(i){var t=i.alternate;return i===Ft||t!==null&&t===Ft}function Hy(i,t){Zs=sa=!0;var e=i.pending;e===null?t.next=t:(t.next=e.next,e.next=t),i.pending=t}function Oy(i,t,e){if(e&4194240){var r=t.lanes;r&=i.pendingLanes,e|=r,t.lanes=e,ap(i,e)}}var na={readContext:$e,useCallback:ae,useContext:ae,useEffect:ae,useImperativeHandle:ae,useInsertionEffect:ae,useLayoutEffect:ae,useMemo:ae,useReducer:ae,useRef:ae,useState:ae,useDebugValue:ae,useDeferredValue:ae,useTransition:ae,useMutableSource:ae,useSyncExternalStore:ae,useId:ae,unstable_isNewReconciler:!1},US={readContext:$e,useCallback:function(i,t){return Ci().memoizedState=[i,t===void 0?null:t],i},useContext:$e,useEffect:r_,useImperativeHandle:function(i,t,e){return e=e!=null?e.concat([i]):null,Vl(4194308,4,Ey.bind(null,t,i),e)},useLayoutEffect:function(i,t){return Vl(4194308,4,i,t)},useInsertionEffect:function(i,t){return Vl(4,2,i,t)},useMemo:function(i,t){var e=Ci();return t=t===void 0?null:t,i=i(),e.memoizedState=[i,t],i},useReducer:function(i,t,e){var r=Ci();return t=e!==void 0?e(t):t,r.memoizedState=r.baseState=t,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:t},r.queue=i,i=i.dispatch=VS.bind(null,Ft,i),[r.memoizedState,i]},useRef:function(i){var t=Ci();return i={current:i},t.memoizedState=i},useState:i_,useDebugValue:Rp,useDeferredValue:function(i){return Ci().memoizedState=i},useTransition:function(){var i=i_(!1),t=i[0];return i=GS.bind(null,i[1]),Ci().memoizedState=i,[t,i]},useMutableSource:function(){},useSyncExternalStore:function(i,t,e){var r=Ft,o=Ci();if(Pt){if(e===void 0)throw Error(J(407));e=e()}else{if(e=t(),ee===null)throw Error(J(349));oo&30||My(r,t,e)}o.memoizedState=e;var s={value:e,getSnapshot:t};return o.queue=s,r_(ky.bind(null,r,s,i),[i]),r.flags|=2048,hn(9,Ry.bind(null,r,s,e,t),void 0,null),e},useId:function(){var i=Ci(),t=ee.identifierPrefix;if(Pt){var e=Ji,r=Yi;e=(r&~(1<<32-pi(r)-1)).toString(32)+e,t=":"+t+"R"+e,e=pn++,0<e&&(t+="H"+e.toString(32)),t+=":"}else e=LS++,t=":"+t+"r"+e.toString(32)+":";return i.memoizedState=t},unstable_isNewReconciler:!1},YS={readContext:$e,useCallback:Yy,useContext:$e,useEffect:Mp,useImperativeHandle:Uy,useInsertionEffect:Gy,useLayoutEffect:Vy,useMemo:Jy,useReducer:im,useRef:Ly,useState:function(){return im(dn)},useDebugValue:Rp,useDeferredValue:function(i){var t=ti();return jy(t,qt.memoizedState,i)},useTransition:function(){var i=im(dn)[0],t=ti().memoizedState;return[i,t]},useMutableSource:Py,useSyncExternalStore:Dy,useId:zy,unstable_isNewReconciler:!1},JS={readContext:$e,useCallback:Yy,useContext:$e,useEffect:Mp,useImperativeHandle:Uy,useInsertionEffect:Gy,useLayoutEffect:Vy,useMemo:Jy,useReducer:rm,useRef:Ly,useState:function(){return rm(dn)},useDebugValue:Rp,useDeferredValue:function(i){var t=ti();return qt===null?t.memoizedState=i:jy(t,qt.memoizedState,i)},useTransition:function(){var i=rm(dn)[0],t=ti().memoizedState;return[i,t]},useMutableSource:Py,useSyncExternalStore:Dy,useId:zy,unstable_isNewReconciler:!1};function ci(i,t){if(i&&i.defaultProps){t=It({},t),i=i.defaultProps;for(var e in i)t[e]===void 0&&(t[e]=i[e]);return t}return t}function Em(i,t,e,r){t=i.memoizedState,e=e(r,t),e=e==null?t:It({},t,e),i.memoizedState=e,i.lanes===0&&(i.updateQueue.baseState=e)}var xa={isMounted:function(i){return(i=i._reactInternals)?ao(i)===i:!1},enqueueSetState:function(i,t,e){i=i._reactInternals;var r=xe(),o=gr(i),s=ji(r,o);s.payload=t,e!=null&&(s.callback=e),t=yr(i,s,o),t!==null&&(di(t,i,o,r),Ll(t,i,o))},enqueueReplaceState:function(i,t,e){i=i._reactInternals;var r=xe(),o=gr(i),s=ji(r,o);s.tag=1,s.payload=t,e!=null&&(s.callback=e),t=yr(i,s,o),t!==null&&(di(t,i,o,r),Ll(t,i,o))},enqueueForceUpdate:function(i,t){i=i._reactInternals;var e=xe(),r=gr(i),o=ji(e,r);o.tag=2,t!=null&&(o.callback=t),t=yr(i,o,r),t!==null&&(di(t,i,r,e),Ll(t,i,r))}};function o_(i,t,e,r,o,s,l){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(r,s,l):t.prototype&&t.prototype.isPureReactComponent?!nn(e,r)||!nn(o,s):!0}function Ny(i,t,e){var r=!1,o=vr,s=t.contextType;return typeof s=="object"&&s!==null?s=$e(s):(o=Pe(t)?io:me.current,r=t.contextTypes,s=(r=r!=null)?jo(i,o):vr),t=new t(e,s),i.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=xa,i.stateNode=t,t._reactInternals=i,r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=s),t}function s_(i,t,e,r){i=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(e,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(e,r),t.state!==i&&xa.enqueueReplaceState(t,t.state,null)}function Um(i,t,e,r){var o=i.stateNode;o.props=e,o.state=i.memoizedState,o.refs={},vp(i);var s=t.contextType;typeof s=="object"&&s!==null?o.context=$e(s):(s=Pe(t)?io:me.current,o.context=jo(i,s)),o.state=i.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Em(i,t,s,e),o.state=i.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&xa.enqueueReplaceState(o,o.state,null),ra(i,e,o,r),o.state=i.memoizedState),typeof o.componentDidMount=="function"&&(i.flags|=4194308)}function Oo(i,t){try{var e="",r=t;do e+=_g(r),r=r.return;while(r);var o=e}catch(s){o=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:t,stack:o,digest:null}}function om(i,t,e){return{value:i,source:null,stack:e??null,digest:t??null}}function Ym(i,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var jS=typeof WeakMap=="function"?WeakMap:Map;function Zy(i,t,e){e=ji(-1,e),e.tag=3,e.payload={element:null};var r=t.value;return e.callback=function(){aa||(aa=!0,qm=r),Ym(i,t)},e}function Qy(i,t,e){e=ji(-1,e),e.tag=3;var r=i.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;e.payload=function(){return r(o)},e.callback=function(){Ym(i,t)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(e.callback=function(){Ym(i,t),typeof r!="function"&&(xr===null?xr=new Set([this]):xr.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),e}function n_(i,t,e){var r=i.pingCache;if(r===null){r=i.pingCache=new jS;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(e)||(o.add(e),i=iw.bind(null,i,t,e),t.then(i,i))}function l_(i){do{var t;if((t=i.tag===13)&&(t=i.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return i;i=i.return}while(i!==null);return null}function a_(i,t,e,r,o){return i.mode&1?(i.flags|=65536,i.lanes=o,i):(i===t?i.flags|=65536:(i.flags|=128,e.flags|=131072,e.flags&=-52805,e.tag===1&&(e.alternate===null?e.tag=17:(t=ji(-1,1),t.tag=2,yr(e,t,1))),e.lanes|=1),i)}var zS=Ni.ReactCurrentOwner,Ae=!1;function ye(i,t,e,r){t.child=i===null?By(t,null,e,r):Xo(t,i.child,e,r)}function c_(i,t,e,r,o){e=e.render;var s=t.ref;return Uo(t,o),r=Pp(i,t,e,r,s,o),e=Dp(),i!==null&&!Ae?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~o,Oi(i,t,o)):(Pt&&e&&bp(t),t.flags|=1,ye(i,t,r,o),t.child)}function u_(i,t,e,r,o){if(i===null){var s=e.type;return typeof s=="function"&&!Up(s)&&s.defaultProps===void 0&&e.compare===null&&e.defaultProps===void 0?(t.tag=15,t.type=s,qy(i,t,s,r,o)):(i=Jl(e.type,null,r,t,t.mode,o),i.ref=t.ref,i.return=t,t.child=i)}if(s=i.child,!(i.lanes&o)){var l=s.memoizedProps;if(e=e.compare,e=e!==null?e:nn,e(l,r)&&i.ref===t.ref)return Oi(i,t,o)}return t.flags|=1,i=Sr(s,r),i.ref=t.ref,i.return=t,t.child=i}function qy(i,t,e,r,o){if(i!==null){var s=i.memoizedProps;if(nn(s,r)&&i.ref===t.ref)if(Ae=!1,t.pendingProps=r=s,(i.lanes&o)!==0)i.flags&131072&&(Ae=!0);else return t.lanes=i.lanes,Oi(i,t,o)}return Jm(i,t,e,r,o)}function Wy(i,t,e){var r=t.pendingProps,o=r.children,s=i!==null?i.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(Io,Ge),Ge|=e;else{if(!(e&1073741824))return i=s!==null?s.baseLanes|e:e,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:i,cachePool:null,transitions:null},t.updateQueue=null,xt(Io,Ge),Ge|=i,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:e,xt(Io,Ge),Ge|=r}else s!==null?(r=s.baseLanes|e,t.memoizedState=null):r=e,xt(Io,Ge),Ge|=r;return ye(i,t,o,e),t.child}function Ky(i,t){var e=t.ref;(i===null&&e!==null||i!==null&&i.ref!==e)&&(t.flags|=512,t.flags|=2097152)}function Jm(i,t,e,r,o){var s=Pe(e)?io:me.current;return s=jo(t,s),Uo(t,o),e=Pp(i,t,e,r,s,o),r=Dp(),i!==null&&!Ae?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~o,Oi(i,t,o)):(Pt&&r&&bp(t),t.flags|=1,ye(i,t,e,o),t.child)}function m_(i,t,e,r,o){if(Pe(e)){var s=!0;Kl(t)}else s=!1;if(Uo(t,o),t.stateNode===null)El(i,t),Ny(t,e,r),Um(t,e,r,o),r=!0;else if(i===null){var l=t.stateNode,a=t.memoizedProps;l.props=a;var c=l.context,u=e.contextType;typeof u=="object"&&u!==null?u=$e(u):(u=Pe(e)?io:me.current,u=jo(t,u));var m=e.getDerivedStateFromProps,p=typeof m=="function"||typeof l.getSnapshotBeforeUpdate=="function";p||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==r||c!==u)&&s_(t,l,r,u),cr=!1;var d=t.memoizedState;l.state=d,ra(t,r,l,o),c=t.memoizedState,a!==r||d!==c||Te.current||cr?(typeof m=="function"&&(Em(t,e,m,r),c=t.memoizedState),(a=cr||o_(t,e,a,r,d,c,u))?(p||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),l.props=r,l.state=c,l.context=u,r=a):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,Ay(i,t),a=t.memoizedProps,u=t.type===t.elementType?a:ci(t.type,a),l.props=u,p=t.pendingProps,d=l.context,c=e.contextType,typeof c=="object"&&c!==null?c=$e(c):(c=Pe(e)?io:me.current,c=jo(t,c));var h=e.getDerivedStateFromProps;(m=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==p||d!==c)&&s_(t,l,r,c),cr=!1,d=t.memoizedState,l.state=d,ra(t,r,l,o);var f=t.memoizedState;a!==p||d!==f||Te.current||cr?(typeof h=="function"&&(Em(t,e,h,r),f=t.memoizedState),(u=cr||o_(t,e,u,r,d,f,c)||!1)?(m||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,f,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,f,c)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),l.props=r,l.state=f,l.context=c,r=u):(typeof l.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=1024),r=!1)}return jm(i,t,e,r,s,o)}function jm(i,t,e,r,o,s){Ky(i,t);var l=(t.flags&128)!==0;if(!r&&!l)return o&&qb(t,e,!1),Oi(i,t,s);r=t.stateNode,zS.current=t;var a=l&&typeof e.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,i!==null&&l?(t.child=Xo(t,i.child,null,s),t.child=Xo(t,null,a,s)):ye(i,t,a,s),t.memoizedState=r.state,o&&qb(t,e,!0),t.child}function $y(i){var t=i.stateNode;t.pendingContext?Qb(i,t.pendingContext,t.pendingContext!==t.context):t.context&&Qb(i,t.context,!1),Bp(i,t.containerInfo)}function p_(i,t,e,r,o){return zo(),yp(o),t.flags|=256,ye(i,t,e,r),t.child}var zm={dehydrated:null,treeContext:null,retryLane:0};function Xm(i){return{baseLanes:i,cachePool:null,transitions:null}}function t2(i,t,e){var r=t.pendingProps,o=kt.current,s=!1,l=(t.flags&128)!==0,a;if((a=l)||(a=i!==null&&i.memoizedState===null?!1:(o&2)!==0),a?(s=!0,t.flags&=-129):(i===null||i.memoizedState!==null)&&(o|=1),xt(kt,o&1),i===null)return Gm(t),i=t.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(t.mode&1?i.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,i=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=l):s=wa(l,r,0,null),i=eo(i,r,e,null),s.return=t,i.return=t,s.sibling=i,t.child=s,t.child.memoizedState=Xm(e),t.memoizedState=zm,i):kp(t,l));if(o=i.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return XS(i,t,l,r,a,o,e);if(s){s=r.fallback,l=t.mode,o=i.child,a=o.sibling;var c={mode:"hidden",children:r.children};return!(l&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=Sr(o,c),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?s=Sr(a,s):(s=eo(s,l,e,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=i.child.memoizedState,l=l===null?Xm(e):{baseLanes:l.baseLanes|e,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=i.childLanes&~e,t.memoizedState=zm,r}return s=i.child,i=s.sibling,r=Sr(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=e),r.return=t,r.sibling=null,i!==null&&(e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)),t.child=r,t.memoizedState=null,r}function kp(i,t){return t=wa({mode:"visible",children:t},i.mode,0,null),t.return=i,i.child=t}function Dl(i,t,e,r){return r!==null&&yp(r),Xo(t,i.child,null,e),i=kp(t,t.pendingProps.children),i.flags|=2,t.memoizedState=null,i}function XS(i,t,e,r,o,s,l){if(e)return t.flags&256?(t.flags&=-257,r=om(Error(J(422))),Dl(i,t,l,r)):t.memoizedState!==null?(t.child=i.child,t.flags|=128,null):(s=r.fallback,o=t.mode,r=wa({mode:"visible",children:r.children},o,0,null),s=eo(s,o,l,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Xo(t,i.child,null,l),t.child.memoizedState=Xm(l),t.memoizedState=zm,s);if(!(t.mode&1))return Dl(i,t,l,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(J(419)),r=om(s,r,void 0),Dl(i,t,l,r)}if(a=(l&i.childLanes)!==0,Ae||a){if(r=ee,r!==null){switch(l&-l){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|l)?0:o,o!==0&&o!==s.retryLane&&(s.retryLane=o,Hi(i,o),di(r,i,o,-1))}return Ep(),r=om(Error(J(421))),Dl(i,t,l,r)}return o.data==="$?"?(t.flags|=128,t.child=i.child,t=rw.bind(null,i),o._reactRetry=t,null):(i=s.treeContext,Ve=_r(o.nextSibling),Ee=t,Pt=!0,mi=null,i!==null&&(Qe[qe++]=Yi,Qe[qe++]=Ji,Qe[qe++]=ro,Yi=i.id,Ji=i.overflow,ro=t),t=kp(t,r.children),t.flags|=4096,t)}function d_(i,t,e){i.lanes|=t;var r=i.alternate;r!==null&&(r.lanes|=t),Vm(i.return,t,e)}function sm(i,t,e,r,o){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:e,tailMode:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=e,s.tailMode=o)}function e2(i,t,e){var r=t.pendingProps,o=r.revealOrder,s=r.tail;if(ye(i,t,r.children,e),r=kt.current,r&2)r=r&1|2,t.flags|=128;else{if(i!==null&&i.flags&128)t:for(i=t.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&d_(i,e,t);else if(i.tag===19)d_(i,e,t);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break t;for(;i.sibling===null;){if(i.return===null||i.return===t)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}r&=1}if(xt(kt,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(e=t.child,o=null;e!==null;)i=e.alternate,i!==null&&oa(i)===null&&(o=e),e=e.sibling;e=o,e===null?(o=t.child,t.child=null):(o=e.sibling,e.sibling=null),sm(t,!1,o,e,s);break;case"backwards":for(e=null,o=t.child,t.child=null;o!==null;){if(i=o.alternate,i!==null&&oa(i)===null){t.child=o;break}i=o.sibling,o.sibling=e,e=o,o=i}sm(t,!0,e,null,s);break;case"together":sm(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function El(i,t){!(t.mode&1)&&i!==null&&(i.alternate=null,t.alternate=null,t.flags|=2)}function Oi(i,t,e){if(i!==null&&(t.dependencies=i.dependencies),so|=t.lanes,!(e&t.childLanes))return null;if(i!==null&&t.child!==i.child)throw Error(J(153));if(t.child!==null){for(i=t.child,e=Sr(i,i.pendingProps),t.child=e,e.return=t;i.sibling!==null;)i=i.sibling,e=e.sibling=Sr(i,i.pendingProps),e.return=t;e.sibling=null}return t.child}function HS(i,t,e){switch(t.tag){case 3:$y(t),zo();break;case 5:Ty(t);break;case 1:Pe(t.type)&&Kl(t);break;case 4:Bp(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;xt(ea,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(xt(kt,kt.current&1),t.flags|=128,null):e&t.child.childLanes?t2(i,t,e):(xt(kt,kt.current&1),i=Oi(i,t,e),i!==null?i.sibling:null);xt(kt,kt.current&1);break;case 19:if(r=(e&t.childLanes)!==0,i.flags&128){if(r)return e2(i,t,e);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),xt(kt,kt.current),r)break;return null;case 22:case 23:return t.lanes=0,Wy(i,t,e)}return Oi(i,t,e)}var i2,Hm,r2,o2;i2=function(i,t){for(var e=t.child;e!==null;){if(e.tag===5||e.tag===6)i.appendChild(e.stateNode);else if(e.tag!==4&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return;e=e.return}e.sibling.return=e.return,e=e.sibling}};Hm=function(){};r2=function(i,t,e,r){var o=i.memoizedProps;if(o!==r){i=t.stateNode,$r(Pi.current);var s=null;switch(e){case"input":o=dm(i,o),r=dm(i,r),s=[];break;case"select":o=It({},o,{value:void 0}),r=It({},r,{value:void 0}),s=[];break;case"textarea":o=bm(i,o),r=bm(i,r),s=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(i.onclick=ql)}ym(e,r);var l;e=null;for(u in o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var a=o[u];for(l in a)a.hasOwnProperty(l)&&(e||(e={}),e[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ks.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(a=o?.[u],r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(l in a)!a.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(e||(e={}),e[l]="");for(l in c)c.hasOwnProperty(l)&&a[l]!==c[l]&&(e||(e={}),e[l]=c[l])}else e||(s||(s=[]),s.push(u,e)),e=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ks.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&vt("scroll",i),s||a===c||(s=[])):(s=s||[]).push(u,c))}e&&(s=s||[]).push("style",e);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};o2=function(i,t,e,r){e!==r&&(t.flags|=4)};function Gs(i,t){if(!Pt)switch(i.tailMode){case"hidden":t=i.tail;for(var e=null;t!==null;)t.alternate!==null&&(e=t),t=t.sibling;e===null?i.tail=null:e.sibling=null;break;case"collapsed":e=i.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t||i.tail===null?i.tail=null:i.tail.sibling=null:r.sibling=null}}function ce(i){var t=i.alternate!==null&&i.alternate.child===i.child,e=0,r=0;if(t)for(var o=i.child;o!==null;)e|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=i,o=o.sibling;else for(o=i.child;o!==null;)e|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=i,o=o.sibling;return i.subtreeFlags|=r,i.childLanes=e,t}function OS(i,t,e){var r=t.pendingProps;switch(_p(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ce(t),null;case 1:return Pe(t.type)&&Wl(),ce(t),null;case 3:return r=t.stateNode,Ho(),Bt(Te),Bt(me),Ap(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(i===null||i.child===null)&&(Tl(t)?t.flags|=4:i===null||i.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,mi!==null&&($m(mi),mi=null))),Hm(i,t),ce(t),null;case 5:Cp(t);var o=$r(mn.current);if(e=t.type,i!==null&&t.stateNode!=null)r2(i,t,e,r,o),i.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return ce(t),null}if(i=$r(Pi.current),Tl(t)){r=t.stateNode,e=t.type;var s=t.memoizedProps;switch(r[Ai]=t,r[cn]=s,i=(t.mode&1)!==0,e){case"dialog":vt("cancel",r),vt("close",r);break;case"iframe":case"object":case"embed":vt("load",r);break;case"video":case"audio":for(o=0;o<js.length;o++)vt(js[o],r);break;case"source":vt("error",r);break;case"img":case"image":case"link":vt("error",r),vt("load",r);break;case"details":vt("toggle",r);break;case"input":Sb(r,s),vt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},vt("invalid",r);break;case"textarea":vb(r,s),vt("invalid",r)}ym(e,s),o=null;for(var l in s)if(s.hasOwnProperty(l)){var a=s[l];l==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Al(r.textContent,a,i),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Al(r.textContent,a,i),o=["children",""+a]):Ks.hasOwnProperty(l)&&a!=null&&l==="onScroll"&&vt("scroll",r)}switch(e){case"input":hl(r),wb(r,s,!0);break;case"textarea":hl(r),Bb(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ql)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=o.nodeType===9?o:o.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=k_(e)),i==="http://www.w3.org/1999/xhtml"?e==="script"?(i=l.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof r.is=="string"?i=l.createElement(e,{is:r.is}):(i=l.createElement(e),e==="select"&&(l=i,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):i=l.createElementNS(i,e),i[Ai]=t,i[cn]=r,i2(i,t,!1,!1),t.stateNode=i;t:{switch(l=xm(e,r),e){case"dialog":vt("cancel",i),vt("close",i),o=r;break;case"iframe":case"object":case"embed":vt("load",i),o=r;break;case"video":case"audio":for(o=0;o<js.length;o++)vt(js[o],i);o=r;break;case"source":vt("error",i),o=r;break;case"img":case"image":case"link":vt("error",i),vt("load",i),o=r;break;case"details":vt("toggle",i),o=r;break;case"input":Sb(i,r),o=dm(i,r),vt("invalid",i);break;case"option":o=r;break;case"select":i._wrapperState={wasMultiple:!!r.multiple},o=It({},r,{value:void 0}),vt("invalid",i);break;case"textarea":vb(i,r),o=bm(i,r),vt("invalid",i);break;default:o=r}ym(e,o),a=o;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?L_(i,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&F_(i,c)):s==="children"?typeof c=="string"?(e!=="textarea"||c!=="")&&$s(i,c):typeof c=="number"&&$s(i,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ks.hasOwnProperty(s)?c!=null&&s==="onScroll"&&vt("scroll",i):c!=null&&ip(i,s,c,l))}switch(e){case"input":hl(i),wb(i,r,!1);break;case"textarea":hl(i),Bb(i);break;case"option":r.value!=null&&i.setAttribute("value",""+wr(r.value));break;case"select":i.multiple=!!r.multiple,s=r.value,s!=null?Lo(i,!!r.multiple,s,!1):r.defaultValue!=null&&Lo(i,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(i.onclick=ql)}switch(e){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break t;case"img":r=!0;break t;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ce(t),null;case 6:if(i&&t.stateNode!=null)o2(i,t,i.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(e=$r(mn.current),$r(Pi.current),Tl(t)){if(r=t.stateNode,e=t.memoizedProps,r[Ai]=t,(s=r.nodeValue!==e)&&(i=Ee,i!==null))switch(i.tag){case 3:Al(r.nodeValue,e,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Al(r.nodeValue,e,(i.mode&1)!==0)}s&&(t.flags|=4)}else r=(e.nodeType===9?e:e.ownerDocument).createTextNode(r),r[Ai]=t,t.stateNode=r}return ce(t),null;case 13:if(Bt(kt),r=t.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Pt&&Ve!==null&&t.mode&1&&!(t.flags&128))wy(),zo(),t.flags|=98560,s=!1;else if(s=Tl(t),r!==null&&r.dehydrated!==null){if(i===null){if(!s)throw Error(J(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(J(317));s[Ai]=t}else zo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ce(t),s=!1}else mi!==null&&($m(mi),mi=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=e,t):(r=r!==null,r!==(i!==null&&i.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(i===null||kt.current&1?Wt===0&&(Wt=3):Ep())),t.updateQueue!==null&&(t.flags|=4),ce(t),null);case 4:return Ho(),Hm(i,t),i===null&&ln(t.stateNode.containerInfo),ce(t),null;case 10:return Sp(t.type._context),ce(t),null;case 17:return Pe(t.type)&&Wl(),ce(t),null;case 19:if(Bt(kt),s=t.memoizedState,s===null)return ce(t),null;if(r=(t.flags&128)!==0,l=s.rendering,l===null)if(r)Gs(s,!1);else{if(Wt!==0||i!==null&&i.flags&128)for(i=t.child;i!==null;){if(l=oa(i),l!==null){for(t.flags|=128,Gs(s,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=e,e=t.child;e!==null;)s=e,i=r,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),e=e.sibling;return xt(kt,kt.current&1|2),t.child}i=i.sibling}s.tail!==null&&zt()>No&&(t.flags|=128,r=!0,Gs(s,!1),t.lanes=4194304)}else{if(!r)if(i=oa(l),i!==null){if(t.flags|=128,r=!0,e=i.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),Gs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!Pt)return ce(t),null}else 2*zt()-s.renderingStartTime>No&&e!==1073741824&&(t.flags|=128,r=!0,Gs(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(e=s.last,e!==null?e.sibling=l:t.child=l,s.last=l)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=zt(),t.sibling=null,e=kt.current,xt(kt,r?e&1|2:e&1),t):(ce(t),null);case 22:case 23:return Vp(),r=t.memoizedState!==null,i!==null&&i.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Ge&1073741824&&(ce(t),t.subtreeFlags&6&&(t.flags|=8192)):ce(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function NS(i,t){switch(_p(t),t.tag){case 1:return Pe(t.type)&&Wl(),i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 3:return Ho(),Bt(Te),Bt(me),Ap(),i=t.flags,i&65536&&!(i&128)?(t.flags=i&-65537|128,t):null;case 5:return Cp(t),null;case 13:if(Bt(kt),i=t.memoizedState,i!==null&&i.dehydrated!==null){if(t.alternate===null)throw Error(J(340));zo()}return i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 19:return Bt(kt),null;case 4:return Ho(),null;case 10:return Sp(t.type._context),null;case 22:case 23:return Vp(),null;case 24:return null;default:return null}}var Ml=!1,ue=!1,ZS=typeof WeakSet=="function"?WeakSet:Set,X=null;function Fo(i,t){var e=i.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(r){Yt(i,t,r)}else e.current=null}function Om(i,t,e){try{e()}catch(r){Yt(i,t,r)}}var h_=!1;function QS(i,t){if(Dm=Nl,i=cy(),fp(i)){if("selectionStart"in i)var e={start:i.selectionStart,end:i.selectionEnd};else t:{e=(e=i.ownerDocument)&&e.defaultView||window;var r=e.getSelection&&e.getSelection();if(r&&r.rangeCount!==0){e=r.anchorNode;var o=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{e.nodeType,s.nodeType}catch{e=null;break t}var l=0,a=-1,c=-1,u=0,m=0,p=i,d=null;e:for(;;){for(var h;p!==e||o!==0&&p.nodeType!==3||(a=l+o),p!==s||r!==0&&p.nodeType!==3||(c=l+r),p.nodeType===3&&(l+=p.nodeValue.length),(h=p.firstChild)!==null;)d=p,p=h;for(;;){if(p===i)break e;if(d===e&&++u===o&&(a=l),d===s&&++m===r&&(c=l),(h=p.nextSibling)!==null)break;p=d,d=p.parentNode}p=h}e=a===-1||c===-1?null:{start:a,end:c}}else e=null}e=e||{start:0,end:0}}else e=null;for(Mm={focusedElem:i,selectionRange:e},Nl=!1,X=t;X!==null;)if(t=X,i=t.child,(t.subtreeFlags&1028)!==0&&i!==null)i.return=t,X=i;else for(;X!==null;){t=X;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var b=f.memoizedProps,x=f.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?b:ci(t.type,b),x);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(S){Yt(t,t.return,S)}if(i=t.sibling,i!==null){i.return=t.return,X=i;break}X=t.return}return f=h_,h_=!1,f}function Qs(i,t,e){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&i)===i){var s=o.destroy;o.destroy=void 0,s!==void 0&&Om(t,e,s)}o=o.next}while(o!==r)}}function ga(i,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&i)===i){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}}function Nm(i){var t=i.ref;if(t!==null){var e=i.stateNode;switch(i.tag){case 5:i=e;break;default:i=e}typeof t=="function"?t(i):t.current=i}}function s2(i){var t=i.alternate;t!==null&&(i.alternate=null,s2(t)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(t=i.stateNode,t!==null&&(delete t[Ai],delete t[cn],delete t[Fm],delete t[RS],delete t[kS])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function n2(i){return i.tag===5||i.tag===3||i.tag===4}function f_(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||n2(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Zm(i,t,e){var r=i.tag;if(r===5||r===6)i=i.stateNode,t?e.nodeType===8?e.parentNode.insertBefore(i,t):e.insertBefore(i,t):(e.nodeType===8?(t=e.parentNode,t.insertBefore(i,e)):(t=e,t.appendChild(i)),e=e._reactRootContainer,e!=null||t.onclick!==null||(t.onclick=ql));else if(r!==4&&(i=i.child,i!==null))for(Zm(i,t,e),i=i.sibling;i!==null;)Zm(i,t,e),i=i.sibling}function Qm(i,t,e){var r=i.tag;if(r===5||r===6)i=i.stateNode,t?e.insertBefore(i,t):e.appendChild(i);else if(r!==4&&(i=i.child,i!==null))for(Qm(i,t,e),i=i.sibling;i!==null;)Qm(i,t,e),i=i.sibling}var oe=null,ui=!1;function lr(i,t,e){for(e=e.child;e!==null;)l2(i,t,e),e=e.sibling}function l2(i,t,e){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(pa,e)}catch{}switch(e.tag){case 5:ue||Fo(e,t);case 6:var r=oe,o=ui;oe=null,lr(i,t,e),oe=r,ui=o,oe!==null&&(ui?(i=oe,e=e.stateNode,i.nodeType===8?i.parentNode.removeChild(e):i.removeChild(e)):oe.removeChild(e.stateNode));break;case 18:oe!==null&&(ui?(i=oe,e=e.stateNode,i.nodeType===8?Ku(i.parentNode,e):i.nodeType===1&&Ku(i,e),on(i)):Ku(oe,e.stateNode));break;case 4:r=oe,o=ui,oe=e.stateNode.containerInfo,ui=!0,lr(i,t,e),oe=r,ui=o;break;case 0:case 11:case 14:case 15:if(!ue&&(r=e.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var s=o,l=s.destroy;s=s.tag,l!==void 0&&(s&2||s&4)&&Om(e,t,l),o=o.next}while(o!==r)}lr(i,t,e);break;case 1:if(!ue&&(Fo(e,t),r=e.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=e.memoizedProps,r.state=e.memoizedState,r.componentWillUnmount()}catch(a){Yt(e,t,a)}lr(i,t,e);break;case 21:lr(i,t,e);break;case 22:e.mode&1?(ue=(r=ue)||e.memoizedState!==null,lr(i,t,e),ue=r):lr(i,t,e);break;default:lr(i,t,e)}}function b_(i){var t=i.updateQueue;if(t!==null){i.updateQueue=null;var e=i.stateNode;e===null&&(e=i.stateNode=new ZS),t.forEach(function(r){var o=ow.bind(null,i,r);e.has(r)||(e.add(r),r.then(o,o))})}}function ai(i,t){var e=t.deletions;if(e!==null)for(var r=0;r<e.length;r++){var o=e[r];try{var s=i,l=t,a=l;t:for(;a!==null;){switch(a.tag){case 5:oe=a.stateNode,ui=!1;break t;case 3:oe=a.stateNode.containerInfo,ui=!0;break t;case 4:oe=a.stateNode.containerInfo,ui=!0;break t}a=a.return}if(oe===null)throw Error(J(160));l2(s,l,o),oe=null,ui=!1;var c=o.alternate;c!==null&&(c.return=null),o.return=null}catch(u){Yt(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)a2(t,i),t=t.sibling}function a2(i,t){var e=i.alternate,r=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ai(t,i),Bi(i),r&4){try{Qs(3,i,i.return),ga(3,i)}catch(b){Yt(i,i.return,b)}try{Qs(5,i,i.return)}catch(b){Yt(i,i.return,b)}}break;case 1:ai(t,i),Bi(i),r&512&&e!==null&&Fo(e,e.return);break;case 5:if(ai(t,i),Bi(i),r&512&&e!==null&&Fo(e,e.return),i.flags&32){var o=i.stateNode;try{$s(o,"")}catch(b){Yt(i,i.return,b)}}if(r&4&&(o=i.stateNode,o!=null)){var s=i.memoizedProps,l=e!==null?e.memoizedProps:s,a=i.type,c=i.updateQueue;if(i.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&M_(o,s),xm(a,l);var u=xm(a,s);for(l=0;l<c.length;l+=2){var m=c[l],p=c[l+1];m==="style"?L_(o,p):m==="dangerouslySetInnerHTML"?F_(o,p):m==="children"?$s(o,p):ip(o,m,p,u)}switch(a){case"input":hm(o,s);break;case"textarea":R_(o,s);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?Lo(o,!!s.multiple,h,!1):d!==!!s.multiple&&(s.defaultValue!=null?Lo(o,!!s.multiple,s.defaultValue,!0):Lo(o,!!s.multiple,s.multiple?[]:"",!1))}o[cn]=s}catch(b){Yt(i,i.return,b)}}break;case 6:if(ai(t,i),Bi(i),r&4){if(i.stateNode===null)throw Error(J(162));o=i.stateNode,s=i.memoizedProps;try{o.nodeValue=s}catch(b){Yt(i,i.return,b)}}break;case 3:if(ai(t,i),Bi(i),r&4&&e!==null&&e.memoizedState.isDehydrated)try{on(t.containerInfo)}catch(b){Yt(i,i.return,b)}break;case 4:ai(t,i),Bi(i);break;case 13:ai(t,i),Bi(i),o=i.child,o.flags&8192&&(s=o.memoizedState!==null,o.stateNode.isHidden=s,!s||o.alternate!==null&&o.alternate.memoizedState!==null||(Lp=zt())),r&4&&b_(i);break;case 22:if(m=e!==null&&e.memoizedState!==null,i.mode&1?(ue=(u=ue)||m,ai(t,i),ue=u):ai(t,i),Bi(i),r&8192){if(u=i.memoizedState!==null,(i.stateNode.isHidden=u)&&!m&&i.mode&1)for(X=i,m=i.child;m!==null;){for(p=X=m;X!==null;){switch(d=X,h=d.child,d.tag){case 0:case 11:case 14:case 15:Qs(4,d,d.return);break;case 1:Fo(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,e=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(b){Yt(r,e,b)}}break;case 5:Fo(d,d.return);break;case 22:if(d.memoizedState!==null){y_(p);continue}}h!==null?(h.return=d,X=h):y_(p)}m=m.sibling}t:for(m=null,p=i;;){if(p.tag===5){if(m===null){m=p;try{o=p.stateNode,u?(s=o.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,c=p.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=I_("display",l))}catch(b){Yt(i,i.return,b)}}}else if(p.tag===6){if(m===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(b){Yt(i,i.return,b)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===i)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===i)break t;for(;p.sibling===null;){if(p.return===null||p.return===i)break t;m===p&&(m=null),p=p.return}m===p&&(m=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ai(t,i),Bi(i),r&4&&b_(i);break;case 21:break;default:ai(t,i),Bi(i)}}function Bi(i){var t=i.flags;if(t&2){try{t:{for(var e=i.return;e!==null;){if(n2(e)){var r=e;break t}e=e.return}throw Error(J(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&($s(o,""),r.flags&=-33);var s=f_(i);Qm(i,s,o);break;case 3:case 4:var l=r.stateNode.containerInfo,a=f_(i);Zm(i,a,l);break;default:throw Error(J(161))}}catch(c){Yt(i,i.return,c)}i.flags&=-3}t&4096&&(i.flags&=-4097)}function qS(i,t,e){X=i,c2(i,t,e)}function c2(i,t,e){for(var r=(i.mode&1)!==0;X!==null;){var o=X,s=o.child;if(o.tag===22&&r){var l=o.memoizedState!==null||Ml;if(!l){var a=o.alternate,c=a!==null&&a.memoizedState!==null||ue;a=Ml;var u=ue;if(Ml=l,(ue=c)&&!u)for(X=o;X!==null;)l=X,c=l.child,l.tag===22&&l.memoizedState!==null?x_(o):c!==null?(c.return=l,X=c):x_(o);for(;s!==null;)X=s,c2(s,t,e),s=s.sibling;X=o,Ml=a,ue=u}__(i,t,e)}else o.subtreeFlags&8772&&s!==null?(s.return=o,X=s):__(i,t,e)}}function __(i){for(;X!==null;){var t=X;if(t.flags&8772){var e=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ue||ga(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ue)if(e===null)r.componentDidMount();else{var o=t.elementType===t.type?e.memoizedProps:ci(t.type,e.memoizedProps);r.componentDidUpdate(o,e.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&e_(t,s,r);break;case 3:var l=t.updateQueue;if(l!==null){if(e=null,t.child!==null)switch(t.child.tag){case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}e_(t,l,e)}break;case 5:var a=t.stateNode;if(e===null&&t.flags&4){e=a;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&e.focus();break;case"img":c.src&&(e.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var m=u.memoizedState;if(m!==null){var p=m.dehydrated;p!==null&&on(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}ue||t.flags&512&&Nm(t)}catch(d){Yt(t,t.return,d)}}if(t===i){X=null;break}if(e=t.sibling,e!==null){e.return=t.return,X=e;break}X=t.return}}function y_(i){for(;X!==null;){var t=X;if(t===i){X=null;break}var e=t.sibling;if(e!==null){e.return=t.return,X=e;break}X=t.return}}function x_(i){for(;X!==null;){var t=X;try{switch(t.tag){case 0:case 11:case 15:var e=t.return;try{ga(4,t)}catch(c){Yt(t,e,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(c){Yt(t,o,c)}}var s=t.return;try{Nm(t)}catch(c){Yt(t,s,c)}break;case 5:var l=t.return;try{Nm(t)}catch(c){Yt(t,l,c)}}}catch(c){Yt(t,t.return,c)}if(t===i){X=null;break}var a=t.sibling;if(a!==null){a.return=t.return,X=a;break}X=t.return}}var WS=Math.ceil,la=Ni.ReactCurrentDispatcher,Fp=Ni.ReactCurrentOwner,Ke=Ni.ReactCurrentBatchConfig,ct=0,ee=null,Ot=null,se=0,Ge=0,Io=Cr(0),Wt=0,fn=null,so=0,Sa=0,Ip=0,qs=null,Ce=null,Lp=0,No=1/0,Ei=null,aa=!1,qm=null,xr=null,Rl=!1,dr=null,ca=0,Ws=0,Wm=null,Ul=-1,Yl=0;function xe(){return ct&6?zt():Ul!==-1?Ul:Ul=zt()}function gr(i){return i.mode&1?ct&2&&se!==0?se&-se:IS.transition!==null?(Yl===0&&(Yl=N_()),Yl):(i=bt,i!==0||(i=window.event,i=i===void 0?16:ty(i.type)),i):1}function di(i,t,e,r){if(50<Ws)throw Ws=0,Wm=null,Error(J(185));bn(i,e,r),(!(ct&2)||i!==ee)&&(i===ee&&(!(ct&2)&&(Sa|=e),Wt===4&&mr(i,se)),De(i,r),e===1&&ct===0&&!(t.mode&1)&&(No=zt()+500,_a&&Ar()))}function De(i,t){var e=i.callbackNode;Gg(i,t);var r=Ol(i,i===ee?se:0);if(r===0)e!==null&&Tb(e),i.callbackNode=null,i.callbackPriority=0;else if(t=r&-r,i.callbackPriority!==t){if(e!=null&&Tb(e),t===1)i.tag===0?FS(g_.bind(null,i)):xy(g_.bind(null,i)),DS(function(){!(ct&6)&&Ar()}),e=null;else{switch(Z_(r)){case 1:e=lp;break;case 4:e=H_;break;case 16:e=Hl;break;case 536870912:e=O_;break;default:e=Hl}e=_2(e,u2.bind(null,i))}i.callbackPriority=t,i.callbackNode=e}}function u2(i,t){if(Ul=-1,Yl=0,ct&6)throw Error(J(327));var e=i.callbackNode;if(Yo()&&i.callbackNode!==e)return null;var r=Ol(i,i===ee?se:0);if(r===0)return null;if(r&30||r&i.expiredLanes||t)t=ua(i,r);else{t=r;var o=ct;ct|=2;var s=p2();(ee!==i||se!==t)&&(Ei=null,No=zt()+500,to(i,t));do try{tw();break}catch(a){m2(i,a)}while(!0);gp(),la.current=s,ct=o,Ot!==null?t=0:(ee=null,se=0,t=Wt)}if(t!==0){if(t===2&&(o=Bm(i),o!==0&&(r=o,t=Km(i,o))),t===1)throw e=fn,to(i,0),mr(i,r),De(i,zt()),e;if(t===6)mr(i,r);else{if(o=i.current.alternate,!(r&30)&&!KS(o)&&(t=ua(i,r),t===2&&(s=Bm(i),s!==0&&(r=s,t=Km(i,s))),t===1))throw e=fn,to(i,0),mr(i,r),De(i,zt()),e;switch(i.finishedWork=o,i.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:qr(i,Ce,Ei);break;case 3:if(mr(i,r),(r&130023424)===r&&(t=Lp+500-zt(),10<t)){if(Ol(i,0)!==0)break;if(o=i.suspendedLanes,(o&r)!==r){xe(),i.pingedLanes|=i.suspendedLanes&o;break}i.timeoutHandle=km(qr.bind(null,i,Ce,Ei),t);break}qr(i,Ce,Ei);break;case 4:if(mr(i,r),(r&4194240)===r)break;for(t=i.eventTimes,o=-1;0<r;){var l=31-pi(r);s=1<<l,l=t[l],l>o&&(o=l),r&=~s}if(r=o,r=zt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*WS(r/1960))-r,10<r){i.timeoutHandle=km(qr.bind(null,i,Ce,Ei),r);break}qr(i,Ce,Ei);break;case 5:qr(i,Ce,Ei);break;default:throw Error(J(329))}}}return De(i,zt()),i.callbackNode===e?u2.bind(null,i):null}function Km(i,t){var e=qs;return i.current.memoizedState.isDehydrated&&(to(i,t).flags|=256),i=ua(i,t),i!==2&&(t=Ce,Ce=e,t!==null&&$m(t)),i}function $m(i){Ce===null?Ce=i:Ce.push.apply(Ce,i)}function KS(i){for(var t=i;;){if(t.flags&16384){var e=t.updateQueue;if(e!==null&&(e=e.stores,e!==null))for(var r=0;r<e.length;r++){var o=e[r],s=o.getSnapshot;o=o.value;try{if(!hi(s(),o))return!1}catch{return!1}}}if(e=t.child,t.subtreeFlags&16384&&e!==null)e.return=t,t=e;else{if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function mr(i,t){for(t&=~Ip,t&=~Sa,i.suspendedLanes|=t,i.pingedLanes&=~t,i=i.expirationTimes;0<t;){var e=31-pi(t),r=1<<e;i[e]=-1,t&=~r}}function g_(i){if(ct&6)throw Error(J(327));Yo();var t=Ol(i,0);if(!(t&1))return De(i,zt()),null;var e=ua(i,t);if(i.tag!==0&&e===2){var r=Bm(i);r!==0&&(t=r,e=Km(i,r))}if(e===1)throw e=fn,to(i,0),mr(i,t),De(i,zt()),e;if(e===6)throw Error(J(345));return i.finishedWork=i.current.alternate,i.finishedLanes=t,qr(i,Ce,Ei),De(i,zt()),null}function Gp(i,t){var e=ct;ct|=1;try{return i(t)}finally{ct=e,ct===0&&(No=zt()+500,_a&&Ar())}}function no(i){dr!==null&&dr.tag===0&&!(ct&6)&&Yo();var t=ct;ct|=1;var e=Ke.transition,r=bt;try{if(Ke.transition=null,bt=1,i)return i()}finally{bt=r,Ke.transition=e,ct=t,!(ct&6)&&Ar()}}function Vp(){Ge=Io.current,Bt(Io)}function to(i,t){i.finishedWork=null,i.finishedLanes=0;var e=i.timeoutHandle;if(e!==-1&&(i.timeoutHandle=-1,PS(e)),Ot!==null)for(e=Ot.return;e!==null;){var r=e;switch(_p(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Wl();break;case 3:Ho(),Bt(Te),Bt(me),Ap();break;case 5:Cp(r);break;case 4:Ho();break;case 13:Bt(kt);break;case 19:Bt(kt);break;case 10:Sp(r.type._context);break;case 22:case 23:Vp()}e=e.return}if(ee=i,Ot=i=Sr(i.current,null),se=Ge=t,Wt=0,fn=null,Ip=Sa=so=0,Ce=qs=null,Kr!==null){for(t=0;t<Kr.length;t++)if(e=Kr[t],r=e.interleaved,r!==null){e.interleaved=null;var o=r.next,s=e.pending;if(s!==null){var l=s.next;s.next=o,r.next=l}e.pending=r}Kr=null}return i}function m2(i,t){do{var e=Ot;try{if(gp(),Gl.current=na,sa){for(var r=Ft.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}sa=!1}if(oo=0,te=qt=Ft=null,Zs=!1,pn=0,Fp.current=null,e===null||e.return===null){Wt=1,fn=t,Ot=null;break}t:{var s=i,l=e.return,a=e,c=t;if(t=se,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,m=a,p=m.tag;if(!(m.mode&1)&&(p===0||p===11||p===15)){var d=m.alternate;d?(m.updateQueue=d.updateQueue,m.memoizedState=d.memoizedState,m.lanes=d.lanes):(m.updateQueue=null,m.memoizedState=null)}var h=l_(l);if(h!==null){h.flags&=-257,a_(h,l,a,s,t),h.mode&1&&n_(s,u,t),t=h,c=u;var f=t.updateQueue;if(f===null){var b=new Set;b.add(c),t.updateQueue=b}else f.add(c);break t}else{if(!(t&1)){n_(s,u,t),Ep();break t}c=Error(J(426))}}else if(Pt&&a.mode&1){var x=l_(l);if(x!==null){!(x.flags&65536)&&(x.flags|=256),a_(x,l,a,s,t),yp(Oo(c,a));break t}}s=c=Oo(c,a),Wt!==4&&(Wt=2),qs===null?qs=[s]:qs.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var _=Zy(s,c,t);t_(s,_);break t;case 1:a=c;var y=s.type,g=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(xr===null||!xr.has(g)))){s.flags|=65536,t&=-t,s.lanes|=t;var S=Qy(s,a,t);t_(s,S);break t}}s=s.return}while(s!==null)}h2(e)}catch(w){t=w,Ot===e&&e!==null&&(Ot=e=e.return);continue}break}while(!0)}function p2(){var i=la.current;return la.current=na,i===null?na:i}function Ep(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),ee===null||!(so&268435455)&&!(Sa&268435455)||mr(ee,se)}function ua(i,t){var e=ct;ct|=2;var r=p2();(ee!==i||se!==t)&&(Ei=null,to(i,t));do try{$S();break}catch(o){m2(i,o)}while(!0);if(gp(),ct=e,la.current=r,Ot!==null)throw Error(J(261));return ee=null,se=0,Wt}function $S(){for(;Ot!==null;)d2(Ot)}function tw(){for(;Ot!==null&&!Tg();)d2(Ot)}function d2(i){var t=b2(i.alternate,i,Ge);i.memoizedProps=i.pendingProps,t===null?h2(i):Ot=t,Fp.current=null}function h2(i){var t=i;do{var e=t.alternate;if(i=t.return,t.flags&32768){if(e=NS(e,t),e!==null){e.flags&=32767,Ot=e;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Wt=6,Ot=null;return}}else if(e=OS(e,t,Ge),e!==null){Ot=e;return}if(t=t.sibling,t!==null){Ot=t;return}Ot=t=i}while(t!==null);Wt===0&&(Wt=5)}function qr(i,t,e){var r=bt,o=Ke.transition;try{Ke.transition=null,bt=1,ew(i,t,e,r)}finally{Ke.transition=o,bt=r}return null}function ew(i,t,e,r){do Yo();while(dr!==null);if(ct&6)throw Error(J(327));e=i.finishedWork;var o=i.finishedLanes;if(e===null)return null;if(i.finishedWork=null,i.finishedLanes=0,e===i.current)throw Error(J(177));i.callbackNode=null,i.callbackPriority=0;var s=e.lanes|e.childLanes;if(Vg(i,s),i===ee&&(Ot=ee=null,se=0),!(e.subtreeFlags&2064)&&!(e.flags&2064)||Rl||(Rl=!0,_2(Hl,function(){return Yo(),null})),s=(e.flags&15990)!==0,e.subtreeFlags&15990||s){s=Ke.transition,Ke.transition=null;var l=bt;bt=1;var a=ct;ct|=4,Fp.current=null,QS(i,e),a2(e,i),vS(Mm),Nl=!!Dm,Mm=Dm=null,i.current=e,qS(e,i,o),Pg(),ct=a,bt=l,Ke.transition=s}else i.current=e;if(Rl&&(Rl=!1,dr=i,ca=o),s=i.pendingLanes,s===0&&(xr=null),Rg(e.stateNode,r),De(i,zt()),t!==null)for(r=i.onRecoverableError,e=0;e<t.length;e++)o=t[e],r(o.value,{componentStack:o.stack,digest:o.digest});if(aa)throw aa=!1,i=qm,qm=null,i;return ca&1&&i.tag!==0&&Yo(),s=i.pendingLanes,s&1?i===Wm?Ws++:(Ws=0,Wm=i):Ws=0,Ar(),null}function Yo(){if(dr!==null){var i=Z_(ca),t=Ke.transition,e=bt;try{if(Ke.transition=null,bt=16>i?16:i,dr===null)var r=!1;else{if(i=dr,dr=null,ca=0,ct&6)throw Error(J(331));var o=ct;for(ct|=4,X=i.current;X!==null;){var s=X,l=s.child;if(X.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(X=u;X!==null;){var m=X;switch(m.tag){case 0:case 11:case 15:Qs(8,m,s)}var p=m.child;if(p!==null)p.return=m,X=p;else for(;X!==null;){m=X;var d=m.sibling,h=m.return;if(s2(m),m===u){X=null;break}if(d!==null){d.return=h,X=d;break}X=h}}}var f=s.alternate;if(f!==null){var b=f.child;if(b!==null){f.child=null;do{var x=b.sibling;b.sibling=null,b=x}while(b!==null)}}X=s}}if(s.subtreeFlags&2064&&l!==null)l.return=s,X=l;else t:for(;X!==null;){if(s=X,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Qs(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,X=_;break t}X=s.return}}var y=i.current;for(X=y;X!==null;){l=X;var g=l.child;if(l.subtreeFlags&2064&&g!==null)g.return=l,X=g;else t:for(l=y;X!==null;){if(a=X,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ga(9,a)}}catch(w){Yt(a,a.return,w)}if(a===l){X=null;break t}var S=a.sibling;if(S!==null){S.return=a.return,X=S;break t}X=a.return}}if(ct=o,Ar(),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(pa,i)}catch{}r=!0}return r}finally{bt=e,Ke.transition=t}}return!1}function S_(i,t,e){t=Oo(e,t),t=Zy(i,t,1),i=yr(i,t,1),t=xe(),i!==null&&(bn(i,1,t),De(i,t))}function Yt(i,t,e){if(i.tag===3)S_(i,i,e);else for(;t!==null;){if(t.tag===3){S_(t,i,e);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xr===null||!xr.has(r))){i=Oo(e,i),i=Qy(t,i,1),t=yr(t,i,1),i=xe(),t!==null&&(bn(t,1,i),De(t,i));break}}t=t.return}}function iw(i,t,e){var r=i.pingCache;r!==null&&r.delete(t),t=xe(),i.pingedLanes|=i.suspendedLanes&e,ee===i&&(se&e)===e&&(Wt===4||Wt===3&&(se&130023424)===se&&500>zt()-Lp?to(i,0):Ip|=e),De(i,t)}function f2(i,t){t===0&&(i.mode&1?(t=_l,_l<<=1,!(_l&130023424)&&(_l=4194304)):t=1);var e=xe();i=Hi(i,t),i!==null&&(bn(i,t,e),De(i,e))}function rw(i){var t=i.memoizedState,e=0;t!==null&&(e=t.retryLane),f2(i,e)}function ow(i,t){var e=0;switch(i.tag){case 13:var r=i.stateNode,o=i.memoizedState;o!==null&&(e=o.retryLane);break;case 19:r=i.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),f2(i,e)}var b2;b2=function(i,t,e){if(i!==null)if(i.memoizedProps!==t.pendingProps||Te.current)Ae=!0;else{if(!(i.lanes&e)&&!(t.flags&128))return Ae=!1,HS(i,t,e);Ae=!!(i.flags&131072)}else Ae=!1,Pt&&t.flags&1048576&&gy(t,ta,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;El(i,t),i=t.pendingProps;var o=jo(t,me.current);Uo(t,e),o=Pp(null,t,r,i,o,e);var s=Dp();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pe(r)?(s=!0,Kl(t)):s=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,vp(t),o.updater=xa,t.stateNode=o,o._reactInternals=t,Um(t,r,i,e),t=jm(null,t,r,!0,s,e)):(t.tag=0,Pt&&s&&bp(t),ye(null,t,o,e),t=t.child),t;case 16:r=t.elementType;t:{switch(El(i,t),i=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=nw(r),i=ci(r,i),o){case 0:t=Jm(null,t,r,i,e);break t;case 1:t=m_(null,t,r,i,e);break t;case 11:t=c_(null,t,r,i,e);break t;case 14:t=u_(null,t,r,ci(r.type,i),e);break t}throw Error(J(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ci(r,o),Jm(i,t,r,o,e);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ci(r,o),m_(i,t,r,o,e);case 3:t:{if($y(t),i===null)throw Error(J(387));r=t.pendingProps,s=t.memoizedState,o=s.element,Ay(i,t),ra(t,r,null,e);var l=t.memoizedState;if(r=l.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){o=Oo(Error(J(423)),t),t=p_(i,t,r,e,o);break t}else if(r!==o){o=Oo(Error(J(424)),t),t=p_(i,t,r,e,o);break t}else for(Ve=_r(t.stateNode.containerInfo.firstChild),Ee=t,Pt=!0,mi=null,e=By(t,null,r,e),t.child=e;e;)e.flags=e.flags&-3|4096,e=e.sibling;else{if(zo(),r===o){t=Oi(i,t,e);break t}ye(i,t,r,e)}t=t.child}return t;case 5:return Ty(t),i===null&&Gm(t),r=t.type,o=t.pendingProps,s=i!==null?i.memoizedProps:null,l=o.children,Rm(r,o)?l=null:s!==null&&Rm(r,s)&&(t.flags|=32),Ky(i,t),ye(i,t,l,e),t.child;case 6:return i===null&&Gm(t),null;case 13:return t2(i,t,e);case 4:return Bp(t,t.stateNode.containerInfo),r=t.pendingProps,i===null?t.child=Xo(t,null,r,e):ye(i,t,r,e),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ci(r,o),c_(i,t,r,o,e);case 7:return ye(i,t,t.pendingProps,e),t.child;case 8:return ye(i,t,t.pendingProps.children,e),t.child;case 12:return ye(i,t,t.pendingProps.children,e),t.child;case 10:t:{if(r=t.type._context,o=t.pendingProps,s=t.memoizedProps,l=o.value,xt(ea,r._currentValue),r._currentValue=l,s!==null)if(hi(s.value,l)){if(s.children===o.children&&!Te.current){t=Oi(i,t,e);break t}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){l=s.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=ji(-1,e&-e),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var m=u.pending;m===null?c.next=c:(c.next=m.next,m.next=c),u.pending=c}}s.lanes|=e,c=s.alternate,c!==null&&(c.lanes|=e),Vm(s.return,e,t),a.lanes|=e;break}c=c.next}}else if(s.tag===10)l=s.type===t.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(J(341));l.lanes|=e,a=l.alternate,a!==null&&(a.lanes|=e),Vm(l,e,t),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===t){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}ye(i,t,o.children,e),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Uo(t,e),o=$e(o),r=r(o),t.flags|=1,ye(i,t,r,e),t.child;case 14:return r=t.type,o=ci(r,t.pendingProps),o=ci(r.type,o),u_(i,t,r,o,e);case 15:return qy(i,t,t.type,t.pendingProps,e);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ci(r,o),El(i,t),t.tag=1,Pe(r)?(i=!0,Kl(t)):i=!1,Uo(t,e),Ny(t,r,o),Um(t,r,o,e),jm(null,t,r,!0,i,e);case 19:return e2(i,t,e);case 22:return Wy(i,t,e)}throw Error(J(156,t.tag))};function _2(i,t){return X_(i,t)}function sw(i,t,e,r){this.tag=i,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function We(i,t,e,r){return new sw(i,t,e,r)}function Up(i){return i=i.prototype,!(!i||!i.isReactComponent)}function nw(i){if(typeof i=="function")return Up(i)?1:0;if(i!=null){if(i=i.$$typeof,i===op)return 11;if(i===sp)return 14}return 2}function Sr(i,t){var e=i.alternate;return e===null?(e=We(i.tag,t,i.key,i.mode),e.elementType=i.elementType,e.type=i.type,e.stateNode=i.stateNode,e.alternate=i,i.alternate=e):(e.pendingProps=t,e.type=i.type,e.flags=0,e.subtreeFlags=0,e.deletions=null),e.flags=i.flags&14680064,e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},e.sibling=i.sibling,e.index=i.index,e.ref=i.ref,e}function Jl(i,t,e,r,o,s){var l=2;if(r=i,typeof i=="function")Up(i)&&(l=1);else if(typeof i=="string")l=5;else t:switch(i){case Bo:return eo(e.children,o,s,t);case rp:l=8,o|=8;break;case cm:return i=We(12,e,t,o|2),i.elementType=cm,i.lanes=s,i;case um:return i=We(13,e,t,o),i.elementType=um,i.lanes=s,i;case mm:return i=We(19,e,t,o),i.elementType=mm,i.lanes=s,i;case T_:return wa(e,o,s,t);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case C_:l=10;break t;case A_:l=9;break t;case op:l=11;break t;case sp:l=14;break t;case ar:l=16,r=null;break t}throw Error(J(130,i==null?i:typeof i,""))}return t=We(l,e,t,o),t.elementType=i,t.type=r,t.lanes=s,t}function eo(i,t,e,r){return i=We(7,i,r,t),i.lanes=e,i}function wa(i,t,e,r){return i=We(22,i,r,t),i.elementType=T_,i.lanes=e,i.stateNode={isHidden:!1},i}function nm(i,t,e){return i=We(6,i,null,t),i.lanes=e,i}function lm(i,t,e){return t=We(4,i.children!==null?i.children:[],i.key,t),t.lanes=e,t.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},t}function lw(i,t,e,r,o){this.tag=t,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xu(0),this.expirationTimes=Xu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xu(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Yp(i,t,e,r,o,s,l,a,c){return i=new lw(i,t,e,a,c),t===1?(t=1,s===!0&&(t|=8)):t=0,s=We(3,null,null,t),i.current=s,s.stateNode=i,s.memoizedState={element:r,isDehydrated:e,cache:null,transitions:null,pendingSuspenseBoundaries:null},vp(s),i}function aw(i,t,e){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vo,key:r==null?null:""+r,children:i,containerInfo:t,implementation:e}}function y2(i){if(!i)return vr;i=i._reactInternals;t:{if(ao(i)!==i||i.tag!==1)throw Error(J(170));var t=i;do{switch(t.tag){case 3:t=t.stateNode.context;break t;case 1:if(Pe(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break t}}t=t.return}while(t!==null);throw Error(J(171))}if(i.tag===1){var e=i.type;if(Pe(e))return yy(i,e,t)}return t}function x2(i,t,e,r,o,s,l,a,c){return i=Yp(e,r,!0,i,o,s,l,a,c),i.context=y2(null),e=i.current,r=xe(),o=gr(e),s=ji(r,o),s.callback=t??null,yr(e,s,o),i.current.lanes=o,bn(i,o,r),De(i,r),i}function va(i,t,e,r){var o=t.current,s=xe(),l=gr(o);return e=y2(e),t.context===null?t.context=e:t.pendingContext=e,t=ji(s,l),t.payload={element:i},r=r===void 0?null:r,r!==null&&(t.callback=r),i=yr(o,t,l),i!==null&&(di(i,o,l,s),Ll(i,o,l)),l}function ma(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function w_(i,t){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var e=i.retryLane;i.retryLane=e!==0&&e<t?e:t}}function Jp(i,t){w_(i,t),(i=i.alternate)&&w_(i,t)}function cw(){return null}var g2=typeof reportError=="function"?reportError:function(i){console.error(i)};function jp(i){this._internalRoot=i}Ba.prototype.render=jp.prototype.render=function(i){var t=this._internalRoot;if(t===null)throw Error(J(409));va(i,t,null,null)};Ba.prototype.unmount=jp.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var t=i.containerInfo;no(function(){va(null,i,null,null)}),t[Xi]=null}};function Ba(i){this._internalRoot=i}Ba.prototype.unstable_scheduleHydration=function(i){if(i){var t=W_();i={blockedOn:null,target:i,priority:t};for(var e=0;e<ur.length&&t!==0&&t<ur[e].priority;e++);ur.splice(e,0,i),e===0&&$_(i)}};function zp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Ca(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function v_(){}function uw(i,t,e,r,o){if(o){if(typeof r=="function"){var s=r;r=function(){var u=ma(l);s.call(u)}}var l=x2(t,r,i,0,null,!1,!1,"",v_);return i._reactRootContainer=l,i[Xi]=l.current,ln(i.nodeType===8?i.parentNode:i),no(),l}for(;o=i.lastChild;)i.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var u=ma(c);a.call(u)}}var c=Yp(i,0,!1,null,null,!1,!1,"",v_);return i._reactRootContainer=c,i[Xi]=c.current,ln(i.nodeType===8?i.parentNode:i),no(function(){va(t,c,e,r)}),c}function Aa(i,t,e,r,o){var s=e._reactRootContainer;if(s){var l=s;if(typeof o=="function"){var a=o;o=function(){var c=ma(l);a.call(c)}}va(t,l,i,o)}else l=uw(e,t,i,o,r);return ma(l)}Q_=function(i){switch(i.tag){case 3:var t=i.stateNode;if(t.current.memoizedState.isDehydrated){var e=Js(t.pendingLanes);e!==0&&(ap(t,e|1),De(t,zt()),!(ct&6)&&(No=zt()+500,Ar()))}break;case 13:no(function(){var r=Hi(i,1);if(r!==null){var o=xe();di(r,i,1,o)}}),Jp(i,1)}};cp=function(i){if(i.tag===13){var t=Hi(i,134217728);if(t!==null){var e=xe();di(t,i,134217728,e)}Jp(i,134217728)}};q_=function(i){if(i.tag===13){var t=gr(i),e=Hi(i,t);if(e!==null){var r=xe();di(e,i,t,r)}Jp(i,t)}};W_=function(){return bt};K_=function(i,t){var e=bt;try{return bt=i,t()}finally{bt=e}};Sm=function(i,t,e){switch(t){case"input":if(hm(i,e),t=e.name,e.type==="radio"&&t!=null){for(e=i;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<e.length;t++){var r=e[t];if(r!==i&&r.form===i.form){var o=ba(r);if(!o)throw Error(J(90));D_(r),hm(r,o)}}}break;case"textarea":R_(i,e);break;case"select":t=e.value,t!=null&&Lo(i,!!e.multiple,t,!1)}};E_=Gp;U_=no;var mw={usingClientEntryPoint:!1,Events:[yn,Po,ba,G_,V_,Gp]},Vs={findFiberByHostInstance:Wr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pw={bundleType:Vs.bundleType,version:Vs.version,rendererPackageName:Vs.rendererPackageName,rendererConfig:Vs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ni.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=j_(i),i===null?null:i.stateNode},findFiberByHostInstance:Vs.findFiberByHostInstance||cw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(Es=__REACT_DEVTOOLS_GLOBAL_HOOK__,!Es.isDisabled&&Es.supportsFiber))try{pa=Es.inject(pw),Ti=Es}catch{}var Es;Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mw;Je.createPortal=function(i,t){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zp(t))throw Error(J(200));return aw(i,t,null,e)};Je.createRoot=function(i,t){if(!zp(i))throw Error(J(299));var e=!1,r="",o=g2;return t!=null&&(t.unstable_strictMode===!0&&(e=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Yp(i,1,!1,null,null,e,!1,r,o),i[Xi]=t.current,ln(i.nodeType===8?i.parentNode:i),new jp(t)};Je.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var t=i._reactInternals;if(t===void 0)throw typeof i.render=="function"?Error(J(188)):(i=Object.keys(i).join(","),Error(J(268,i)));return i=j_(t),i=i===null?null:i.stateNode,i};Je.flushSync=function(i){return no(i)};Je.hydrate=function(i,t,e){if(!Ca(t))throw Error(J(200));return Aa(null,i,t,!0,e)};Je.hydrateRoot=function(i,t,e){if(!zp(i))throw Error(J(405));var r=e!=null&&e.hydratedSources||null,o=!1,s="",l=g2;if(e!=null&&(e.unstable_strictMode===!0&&(o=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(l=e.onRecoverableError)),t=x2(t,null,i,1,e??null,o,!1,s,l),i[Xi]=t.current,ln(i),r)for(i=0;i<r.length;i++)e=r[i],o=e._getVersion,o=o(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,o]:t.mutableSourceEagerHydrationData.push(e,o);return new Ba(t)};Je.render=function(i,t,e){if(!Ca(t))throw Error(J(200));return Aa(null,i,t,!1,e)};Je.unmountComponentAtNode=function(i){if(!Ca(i))throw Error(J(40));return i._reactRootContainer?(no(function(){Aa(null,null,i,!1,function(){i._reactRootContainer=null,i[Xi]=null})}),!0):!1};Je.unstable_batchedUpdates=Gp;Je.unstable_renderSubtreeIntoContainer=function(i,t,e,r){if(!Ca(e))throw Error(J(200));if(i==null||i._reactInternals===void 0)throw Error(J(38));return Aa(i,t,e,!1,r)};Je.version="18.3.1-next-f1338f8080-20240426"});var B2=Et((IA,v2)=>{"use strict";function w2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(w2)}catch(i){console.error(i)}}w2(),v2.exports=S2()});var A2=Et(Xp=>{"use strict";var C2=B2();Xp.createRoot=C2.createRoot,Xp.hydrateRoot=C2.hydrateRoot;var LA});var M2=Et(Da=>{"use strict";var hw=Ut(),fw=Symbol.for("react.element"),bw=Symbol.for("react.fragment"),_w=Object.prototype.hasOwnProperty,yw=hw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xw={key:!0,ref:!0,__self:!0,__source:!0};function D2(i,t,e){var r,o={},s=null,l=null;e!==void 0&&(s=""+e),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)_w.call(t,r)&&!xw.hasOwnProperty(r)&&(o[r]=t[r]);if(i&&i.defaultProps)for(r in t=i.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:fw,type:i,key:s,ref:l,props:o,_owner:yw.current}}Da.Fragment=bw;Da.jsx=D2;Da.jsxs=D2});var Ma=Et((OA,R2)=>{"use strict";R2.exports=M2()});var ms=Et(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.Collector=void 0;var md=class{constructor(t){this.emit=(...e)=>{t.emitCollecting(this,e)}}};Rc.Collector=md});var _0=Et(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.CollectorArray=void 0;var d1=ms(),pd=class extends d1.Collector{constructor(){super(...arguments),this.result=[]}handleResult(t){return this.result.push(t),!0}getResult(){return this.result}reset(){this.result.length=0}};kc.CollectorArray=pd});var y0=Et(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.CollectorLast=void 0;var h1=ms(),dd=class extends h1.Collector{handleResult(t){return this.result=t,!0}getResult(){return this.result}reset(){delete this.result}};Fc.CollectorLast=dd});var x0=Et(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.CollectorUntil0=void 0;var f1=ms(),hd=class extends f1.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,this.result}getResult(){return this.result}reset(){this.result=!1}};Ic.CollectorUntil0=hd});var g0=Et(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.CollectorWhile0=void 0;var b1=ms(),fd=class extends b1.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,!this.result}getResult(){return this.result}reset(){this.result=!1}};Lc.CollectorWhile0=fd});var S0=Et(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.SignalConnectionImpl=void 0;var bd=class{constructor(t){this.link=t}disconnect(){return this.link.unlink()}set enabled(t){this.link.setEnabled(t)}get enabled(){return this.link.isEnabled()}};Gc.SignalConnectionImpl=bd});var w0=Et(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.SignalLink=void 0;var _d=class i{constructor(t,e,r){this.enabled=!0,this.newLink=!1,this.prev=t??this,this.next=e??this,this.order=r.order,this.isPublic=r.isPublic,this.callback=r.callback,this.onUnlink=r.onUnlink}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){return this.callback?(delete this.callback,this.next.prev=this.prev,this.prev.next=this.next,this.onUnlink(),!0):!1}insert(t){let{order:e}=t,r=this.prev;for(;r!==this&&!(r.order<=e);)r=r.prev;let o=new i(r,r.next,t);return r.next=o,o.next.prev=o,o}};Vc.SignalLink=_d});var v0=Et(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.Signal=void 0;var _1=S0(),y1=w0(),x1={order:0,isPublic:!0,onUnlink(){}},yd=class{constructor(){this.head=new y1.SignalLink(null,null,x1),this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0,this.onUnlink=()=>{this.connectionsCount--}}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(t,{order:e=0,isPublic:r=!0}={}){this.connectionsCount++;let o=this.head.insert({callback:t,order:e,isPublic:r,onUnlink:this.onUnlink});return this.emitDepth>0&&(this.hasNewLinks=!0,o.newLink=!0),new _1.SignalConnectionImpl(o)}disconnect(t){for(let e=this.head.next;e!==this.head;e=e.next)if(e.callback===t)return e.unlink(),!0;return!1}disconnectAll(){let{next:t}=this.head;for(;t!==this.head;)t.isPublic&&t.unlink(),t=t.next}emit(...t){this.emitDepth++;for(let e=this.head.next;e!==this.head;e=e.next)e.isEnabled()&&e.callback&&e.callback.apply(null,t);this.emitDepth--,this.unsetNewLink()}emitCollecting(t,e){this.emitDepth++;for(let r=this.head.next;r!==this.head;r=r.next)if(r.isEnabled()&&r.callback){let o=r.callback.apply(null,e);if(!t.handleResult(o))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let t=this.head.next;t!==this.head;t=t.next)t.newLink=!1;this.hasNewLinks=!1}}};Ec.Signal=yd});var B0=Et(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.SignalConnections=void 0;var xd=class{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(let t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}};Uc.SignalConnections=xd});var C0=Et(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.SignalConnections=he.Signal=he.CollectorWhile0=he.CollectorUntil0=he.CollectorLast=he.CollectorArray=he.Collector=void 0;var g1=ms();Object.defineProperty(he,"Collector",{enumerable:!0,get:function(){return g1.Collector}});var S1=_0();Object.defineProperty(he,"CollectorArray",{enumerable:!0,get:function(){return S1.CollectorArray}});var w1=y0();Object.defineProperty(he,"CollectorLast",{enumerable:!0,get:function(){return w1.CollectorLast}});var v1=x0();Object.defineProperty(he,"CollectorUntil0",{enumerable:!0,get:function(){return v1.CollectorUntil0}});var B1=g0();Object.defineProperty(he,"CollectorWhile0",{enumerable:!0,get:function(){return B1.CollectorWhile0}});var C1=v0();Object.defineProperty(he,"Signal",{enumerable:!0,get:function(){return C1.Signal}});var A1=B0();Object.defineProperty(he,"SignalConnections",{enumerable:!0,get:function(){return A1.SignalConnections}})});var N0=Et(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.factoriesGl1=void 0;Yc.factoriesGl1={uniform1f:(i,t)=>({location:t,set:e=>i.uniform1f(t,e),setV:e=>i.uniform1fv(t,e)}),uniform2f:(i,t)=>({location:t,set:(e,r)=>i.uniform2f(t,e,r),setV:e=>i.uniform2fv(t,e)}),uniform3f:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3f(t,e,r,o),setV:e=>i.uniform3fv(t,e)}),uniform4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4f(t,e,r,o,s),setV:e=>i.uniform4fv(t,e)}),uniform1i:(i,t)=>({location:t,set:e=>i.uniform1i(t,e),setV:e=>i.uniform1iv(t,e)}),uniform2i:(i,t)=>({location:t,set:(e,r)=>i.uniform2i(t,e,r),setV:e=>i.uniform2iv(t,e)}),uniform3i:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3i(t,e,r,o),setV:e=>i.uniform3iv(t,e)}),uniform4i:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4i(t,e,r,o,s),setV:e=>i.uniform4iv(t,e)}),uniformMatrix2f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix2fv(t,e,r)}),uniformMatrix3f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix3fv(t,e,r)}),uniformMatrix4f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix4fv(t,e,r)}),vertexAttrib1f:(i,t)=>({location:t,set:e=>i.vertexAttrib1f(t,e),setV:e=>i.vertexAttrib1fv(t,e)}),vertexAttrib2f:(i,t)=>({location:t,set:(e,r)=>i.vertexAttrib2f(t,e,r),setV:e=>i.vertexAttrib2fv(t,e)}),vertexAttrib3f:(i,t)=>({location:t,set:(e,r,o)=>i.vertexAttrib3f(t,e,r,o),setV:e=>i.vertexAttrib3fv(t,e)}),vertexAttrib4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttrib4f(t,e,r,o,s),setV:e=>i.vertexAttrib4fv(t,e)}),vertexAttribPointer:(i,t)=>({location:t,enable:()=>i.enableVertexAttribArray(t),disable:()=>i.disableVertexAttribArray(t),set:(e,r,o,s,l)=>i.vertexAttribPointer(t,e,r,o,s,l)})}});var Z0=Et(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.factoriesGl2=void 0;var cC=N0();Jc.factoriesGl2=Object.assign(Object.assign({},cC.factoriesGl1),{uniform1ui:(i,t)=>({location:t,set:e=>i.uniform1ui(t,e),setV:(e,r,o)=>i.uniform1uiv(t,e,r,o)}),uniform2ui:(i,t)=>({location:t,set:(e,r)=>i.uniform2ui(t,e,r),setV:(e,r,o)=>i.uniform2uiv(t,e,r,o)}),uniform3ui:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3ui(t,e,r,o),setV:(e,r,o)=>i.uniform3uiv(t,e,r,o)}),uniform4ui:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4ui(t,e,r,o,s),setV:(e,r,o)=>i.uniform4uiv(t,e,r,o)}),uniformMatrix2x3f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix2x3fv(t,e,r,o,s)}),uniformMatrix2x4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix2x4fv(t,e,r,o,s)}),uniformMatrix3x2f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix3x2fv(t,e,r,o,s)}),uniformMatrix3x4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix3x4fv(t,e,r,o,s)}),uniformMatrix4x2f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix4x2fv(t,e,r,o,s)}),uniformMatrix4x3f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix4x3fv(t,e,r,o,s)}),vertexAttribDivisor:(i,t)=>({location:t,set:e=>i.vertexAttribDivisor(t,e)}),vertexAttribI4i:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttribI4i(t,e,r,o,s),setV:e=>i.vertexAttribI4iv(t,e)}),vertexAttribI4ui:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttribI4ui(t,e,r,o,s),setV:e=>i.vertexAttribI4uiv(t,e)}),vertexAttribIPointer:(i,t)=>({location:t,enable:()=>i.enableVertexAttribArray(t),disable:()=>i.disableVertexAttribArray(t),set:(e,r,o,s)=>i.vertexAttribIPointer(t,e,r,o,s)})})});var ho=Et(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.createShaderProgram=ps.glsl=void 0;var uC=Z0();function mC(i,...t){let e="";for(let r=0;r<t.length;r++)e+=i[r],e+=t[r];return e.replace(/^[\r\n]+/,"")+i[i.length-1]}ps.glsl=mC;function Q0(i,t,e,r){let o=i.createShader(e);return i.shaderSource(o,r),i.compileShader(o),i.attachShader(t,o),o}function pC(i,t,e,r){let o=i.createProgram(),s={},l=Q0(i,o,i.VERTEX_SHADER,t),a=Q0(i,o,i.FRAGMENT_SHADER,e);i.linkProgram(o),i.useProgram(o);for(let c of Object.keys(r)){let u=r[c],m=uC.factoriesGl2[u];if(!m)throw new Error(`Can't handle ${u}!`);let p=u.startsWith("uniform")?i.getUniformLocation(o,c):i.getAttribLocation(o,c);s[c]=m(i,p)}return Object.assign(Object.assign({},s),{use(){i.useProgram(o)},dispose(){i.useProgram(null),i.deleteShader(a),i.deleteShader(l),i.deleteProgram(o)}})}ps.createShaderProgram=pC});var Nr=mt(Ut()),jx=mt(A2());var Ta=i=>document.location.pathname.substring(i.length);var dw=function(i,t,e,r){function o(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function a(m){try{u(r.next(m))}catch(p){l(p)}}function c(m){try{u(r.throw(m))}catch(p){l(p)}}function u(m){m.done?s(m.value):o(m.value).then(a,c)}u((r=r.apply(i,t||[])).next())})},Hp=()=>window.location.hash.substr(1);function T2({hashMode:i,basename:t,setPath:e,onNavigate:r}){let{location:o,history:s}=window,l=i?()=>e(Hp()):()=>e(Ta(t)),a=i?u=>`${o.pathname}${o.search}#${u}`:u=>`${t}${u}`;function c(u,m){return dw(this,void 0,void 0,function*(){let p=a(u),d=o.pathname+o.search+o.hash;if(p!==d){if(r&&!(yield r({from:d,to:p,type:"push"})))return!1;m==="push"?s.pushState({},"",p):s.replaceState({},"",p),l()}return!0})}return{push:u=>c(u,"push"),replace:u=>c(u,"replace"),onChange:l,urlTo:a}}var Op=mt(Ut());var P2=mt(Ut()),qo=()=>{throw new Error("You forgot to add a Router element to your app.")},Pa=(0,P2.createContext)({basename:"",path:"",history:{push:qo,replace:qo,onChange:qo,urlTo:qo},matchRoute:qo,urlTo:qo});var Zi=()=>(0,Op.useContext)(Pa);var k2=mt(Ma()),F2=mt(Ut());function gw(i,t){let{history:e}=Zi();return(0,F2.useMemo)(()=>({onClick(r){try{t?.(r)}catch(o){console.error(o)}r.defaultPrevented||(r.preventDefault(),e.push(i))},href:e.urlTo(i)}),[i,t,e])}function I2(i){let t=gw(i.href,i.onClick);return(0,k2.jsx)("a",Object.assign({},i,{href:t.href,onClick:t.onClick}))}var L2=mt(Ma()),Sw=mt(Ut());function G2(i){let t={};return(e,r)=>(t[e]||(t[e]=i(e)))(r)}var E2=mt(Ma()),Tr=mt(Ut());function V2(i){return t=>t===i||i==="*"?{}:null}var U2=({basename:i="",mode:t,routeMatcherFactory:e=V2,children:r,onNavigate:o})=>{let s=t==="hash",[l,a]=(0,Tr.useState)(()=>s?Hp():Ta(i)),c=(0,Tr.useMemo)(()=>T2({hashMode:s,basename:i,setPath:a,onNavigate:o}),[a,i,s,o]),u=(0,Tr.useMemo)(()=>G2(e),[e]),m=(0,Tr.useMemo)(()=>({basename:i,path:l,history:c,matchRoute:u,urlTo:c.urlTo}),[i,l,c,u]);return(0,Tr.useEffect)(()=>(window.addEventListener("popstate",c.onChange),()=>window.removeEventListener("popstate",c.onChange)),[c]),(0,E2.jsx)(Pa.Provider,{value:m,children:r})};var ww=mt(Ut());var ft=mt(Ut());var vw={lengthUnitsPerMeter:1,maxPolygonVertices:8},Np={...vw};var Pr=Np.lengthUnitsPerMeter,Kt=Np.maxPolygonVertices;function N(i,t){if(!i)throw new Error(t)}function at(i){if(i===null)throw new Error;return i}var $=1e37,gt=1e-5,Dr=gt*gt,Nt=2,Ra=.1*Pr,Zp=4,Z=.005*Pr,fi=2/180*Math.PI,Me=2*Z,Y2=8,ka=32,Wo=.2*Pr,wn=8/180*Math.PI,gn=2*Pr,Qp=gn*gn,Sn=.5*Math.PI,qp=Sn*Sn,J2=.2,j2=.75,z2=.5,Wp=.01*Pr,Kp=2/180*Math.PI;function je(i,t=0){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}function X2(i,t=!1){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}function H(i,t){let e=new Array(i);for(let r=0;r<i;r++)e[r]=new t;return e}var Bw=Math.PI/180,Cw=180/Math.PI,H2=2*Math.PI;function tt(i,t,e){return i<t?t:i>e?e:i}function pt(i){return i*Bw}function O2(i){return i*Cw}function vn(){return Math.random()*2-1}function W(i,t){return(t-i)*Math.random()+i}function Fa(i,t){return Math.round((t-i)*Math.random()+i)}var n=class i{static{this.ZERO=new i}static{this.UNITX=new i(1,0)}static{this.UNITY=new i(0,1)}static{this.s_t0=new i}static{this.s_t1=new i}static{this.s_t2=new i}static{this.s_t3=new i}constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new i(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}Add(t){return this.x+=t.x,this.y+=t.y,this}AddXY(t,e){return this.x+=t,this.y+=e,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this}SubtractXY(t,e){return this.x-=t,this.y-=e,this}Scale(t){return this.x*=t,this.y*=t,this}AddScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SubtractScaled(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){let{x:t,y:e}=this;return Math.sqrt(t*t+e*e)}LengthSquared(){let{x:t,y:e}=this;return t*t+e*e}Normalize(){let t=this.Length();if(t<gt)return 0;let e=1/t;return this.x*=e,this.y*=e,t}Rotate(t){let e=Math.cos(t),r=Math.sin(t),{x:o}=this;return this.x=e*o-r*this.y,this.y=r*o+e*this.y,this}RotateCosSin(t,e){let{x:r}=this;return this.x=t*r-e*this.y,this.y=e*r+t*this.y,this}IsValid(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}Abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}GetAbs(t){return t.x=Math.abs(this.x),t.y=Math.abs(this.y),t}Negate(){return this.x=-this.x,this.y=-this.y,this}Skew(){let{x:t}=this;return this.x=-this.y,this.y=t,this}static Min(t,e,r){return r.x=Math.min(t.x,e.x),r.y=Math.min(t.y,e.y),r}static Max(t,e,r){return r.x=Math.max(t.x,e.x),r.y=Math.max(t.y,e.y),r}static Clamp(t,e,r,o){return o.x=tt(t.x,e.x,r.x),o.y=tt(t.y,e.y,r.y),o}static Rotate(t,e,r){let o=t.x,s=t.y,l=Math.cos(e),a=Math.sin(e);return r.x=l*o-a*s,r.y=a*o+l*s,r}static Dot(t,e){return t.x*e.x+t.y*e.y}static Cross(t,e){return t.x*e.y-t.y*e.x}static CrossVec2Scalar(t,e,r){let o=t.x;return r.x=e*t.y,r.y=-e*o,r}static CrossVec2One(t,e){let r=t.x;return e.x=t.y,e.y=-r,e}static CrossScalarVec2(t,e,r){let o=e.x;return r.x=-t*e.y,r.y=t*o,r}static CrossOneVec2(t,e){let r=t.x;return e.x=-t.y,e.y=r,e}static Add(t,e,r){return r.x=t.x+e.x,r.y=t.y+e.y,r}static Subtract(t,e,r){return r.x=t.x-e.x,r.y=t.y-e.y,r}static Scale(t,e,r){return r.x=e.x*t,r.y=e.y*t,r}static AddScaled(t,e,r,o){return o.x=t.x+e*r.x,o.y=t.y+e*r.y,o}static SubtractScaled(t,e,r,o){return o.x=t.x-e*r.x,o.y=t.y-e*r.y,o}static AddCrossScalarVec2(t,e,r,o){let s=r.x;return o.x=t.x-e*r.y,o.y=t.y+e*s,o}static Mid(t,e,r){return r.x=(t.x+e.x)*.5,r.y=(t.y+e.y)*.5,r}static Extents(t,e,r){return r.x=(e.x-t.x)*.5,r.y=(e.y-t.y)*.5,r}static Equals(t,e){return t.x===e.x&&t.y===e.y}static Distance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}static DistanceSquared(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}static Negate(t,e){return e.x=-t.x,e.y=-t.y,e}static Normalize(t,e){let r=t.x**2+t.y**2;if(r>=Dr){let o=1/Math.sqrt(r);e.x=o*t.x,e.y=o*t.y}else e.x=0,e.y=0;return e}static Skew(t,e){let{x:r}=t;return e.x=-t.y,e.y=r,e}},Se=class i{static{this.ZERO=new i(0,0,0)}static{this.s_t0=new i}constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}Clone(){return new i(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}Set(t,e,r){return this.x=t,this.y=e,this.z=r,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}Negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}Add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}AddXYZ(t,e,r){return this.x+=t,this.y+=e,this.z+=r,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SubtractXYZ(t,e,r){return this.x-=t,this.y-=e,this.z-=r,this}Scale(t){return this.x*=t,this.y*=t,this.z*=t,this}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static Cross(t,e,r){let o=t.x,s=t.y,l=t.z,a=e.x,c=e.y,u=e.z;return r.x=s*u-l*c,r.y=l*a-o*u,r.z=o*c-s*a,r}},Lt=class i{constructor(){this.ex=new n(1,0);this.ey=new n(0,1)}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}static FromColumns(t,e){return new i().SetColumns(t,e)}static FromScalars(t,e,r,o){return new i().SetScalars(t,e,r,o)}static FromAngle(t){return new i().SetAngle(t)}SetScalars(t,e,r,o){return this.ex.Set(t,r),this.ey.Set(e,o),this}SetColumns(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){let e=Math.cos(t),r=Math.sin(t);return this.ex.Set(e,r),this.ey.Set(-r,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}Solve(t,e,r){let o=this.ex.x,s=this.ey.x,l=this.ex.y,a=this.ey.y,c=o*a-s*l;return c!==0&&(c=1/c),r.x=c*(a*t-s*e),r.y=c*(o*e-l*t),r}Abs(){return this.ex.Abs(),this.ey.Abs(),this}Inverse(){return this.GetInverse(this),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this}Subtract(t){return this.ex.Subtract(t.ex),this.ey.Subtract(t.ey),this}GetInverse(t){let e=this.ex.x,r=this.ey.x,o=this.ex.y,s=this.ey.y,l=e*s-r*o;return l!==0&&(l=1/l),t.ex.x=l*s,t.ey.x=-l*r,t.ex.y=-l*o,t.ey.y=l*e,t}GetAbs(t){return t.ex.x=Math.abs(this.ex.x),t.ex.y=Math.abs(this.ex.y),t.ey.x=Math.abs(this.ey.x),t.ey.y=Math.abs(this.ey.y),t}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.ex.x*o+t.ey.x*s,r.y=t.ex.y*o+t.ey.y*s,r}static TransposeMultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.ex.x*o+t.ex.y*s,r.y=t.ey.x*o+t.ey.y*s,r}static Add(t,e,r){return r.ex.x=t.ex.x+e.ex.x,r.ex.y=t.ex.y+e.ex.y,r.ey.x=t.ey.x+e.ey.x,r.ey.y=t.ey.y+e.ey.y,r}static Multiply(t,e,r){let o=t.ex.x,s=t.ex.y,l=t.ey.x,a=t.ey.y,c=e.ex.x,u=e.ex.y,m=e.ey.x,p=e.ey.y;return r.ex.x=o*c+l*u,r.ex.y=s*c+a*u,r.ey.x=o*m+l*p,r.ey.y=s*m+a*p,r}static TransposeMultiply(t,e,r){let o=t.ex.x,s=t.ex.y,l=t.ey.x,a=t.ey.y,c=e.ex.x,u=e.ex.y,m=e.ey.x,p=e.ey.y;return r.ex.x=o*c+s*u,r.ex.y=l*c+a*u,r.ey.x=o*m+s*p,r.ey.y=l*m+a*p,r}},Qi=class i{constructor(){this.ex=new Se(1,0,0);this.ey=new Se(0,1,0);this.ez=new Se(0,0,1)}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}SetColumns(t,e,r){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(r),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this.ez.Add(t.ez),this}Solve33(t,e,r,o){let s=this.ex.x,l=this.ex.y,a=this.ex.z,c=this.ey.x,u=this.ey.y,m=this.ey.z,p=this.ez.x,d=this.ez.y,h=this.ez.z,f=s*(u*h-m*d)+l*(m*p-c*h)+a*(c*d-u*p);return f!==0&&(f=1/f),o.x=f*(t*(u*h-m*d)+e*(m*p-c*h)+r*(c*d-u*p)),o.y=f*(s*(e*h-r*d)+l*(r*p-t*h)+a*(t*d-e*p)),o.z=f*(s*(u*r-m*e)+l*(m*t-c*r)+a*(c*e-u*t)),o}Solve22(t,e,r){let o=this.ex.x,s=this.ey.x,l=this.ex.y,a=this.ey.y,c=o*a-s*l;return c!==0&&(c=1/c),r.x=c*(a*t-s*e),r.y=c*(o*e-l*t),r}GetInverse22(t){let e=this.ex.x,r=this.ey.x,o=this.ex.y,s=this.ey.y,l=e*s-r*o;l!==0&&(l=1/l),t.ex.x=l*s,t.ey.x=-l*r,t.ex.z=0,t.ex.y=-l*o,t.ey.y=l*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=Se.Dot(this.ex,Se.Cross(this.ey,this.ez,Se.s_t0));e!==0&&(e=1/e);let r=this.ex.x,o=this.ey.x,s=this.ez.x,l=this.ey.y,a=this.ez.y,c=this.ez.z;t.ex.x=e*(l*c-a*a),t.ex.y=e*(s*a-o*c),t.ex.z=e*(o*a-s*l),t.ey.x=t.ex.y,t.ey.y=e*(r*c-s*s),t.ey.z=e*(s*o-r*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(r*l-o*o)}static MultiplyVec3(t,e,r){let{x:o,y:s,z:l}=e;return r.x=t.ex.x*o+t.ey.x*s+t.ez.x*l,r.y=t.ex.y*o+t.ey.y*s+t.ez.y*l,r.z=t.ex.z*o+t.ey.z*s+t.ez.z*l,r}static MultiplyVec2(t,e,r){let{x:o,y:s}=e;return r.x=t.ex.x*o+t.ey.x*s,r.y=t.ex.y*o+t.ey.y*s,r}},D=class i{constructor(t=0){this.s=0;this.c=1;t&&(this.s=Math.sin(t),this.c=Math.cos(t))}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}Set(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static Multiply(t,e,r){let o=t.s*e.c+t.c*e.s,s=t.c*e.c-t.s*e.s;return r.s=o,r.c=s,r}static TransposeMultiply(t,e,r){let o=t.c*e.s-t.s*e.c,s=t.c*e.c+t.s*e.s;return r.s=o,r.c=s,r}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.c*o-t.s*s,r.y=t.s*o+t.c*s,r}static TransposeMultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.c*o+t.s*s,r.y=-t.s*o+t.c*s,r}},T=class i{constructor(){this.p=new n;this.q=new D}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.Set(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.Set(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetAngle(){return this.q.GetAngle()}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.q.c*o-t.q.s*s+t.p.x,r.y=t.q.s*o+t.q.c*s+t.p.y,r}static TransposeMultiplyVec2(t,e,r){let o=e.x-t.p.x,s=e.y-t.p.y;return r.x=t.q.c*o+t.q.s*s,r.y=-t.q.s*o+t.q.c*s,r}static Multiply(t,e,r){return D.Multiply(t.q,e.q,r.q),D.MultiplyVec2(t.q,e.p,r.p).Add(t.p),r}static TransposeMultiply(t,e,r){return D.TransposeMultiply(t.q,e.q,r.q),D.TransposeMultiplyVec2(t.q,n.Subtract(e.p,t.p,r.p),r.p),r}},ie=class i{constructor(){this.localCenter=new n;this.c0=new n;this.c=new n;this.a0=0;this.a=0;this.alpha0=0}Clone(){return new i().Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){let r=1-e;t.p.x=r*this.c0.x+e*this.c.x,t.p.y=r*this.c0.y+e*this.c.y;let o=r*this.a0+e*this.a;return t.q.Set(o),t.p.Subtract(D.MultiplyVec2(t.q,this.localCenter,n.s_t0)),t}Advance(t){let e=(t-this.alpha0)/(1-this.alpha0);this.c0.x+=e*(this.c.x-this.c0.x),this.c0.y+=e*(this.c.y-this.c0.y),this.a0+=e*(this.a-this.a0),this.alpha0=t}Normalize(){let t=H2*Math.floor(this.a0/H2);this.a0-=t,this.a-=t}};var F=class i{static{this.ZERO=new i(0,0,0,0)}static{this.RED=new i(1,0,0)}static{this.GREEN=new i(0,1,0)}static{this.BLUE=new i(0,0,1)}static{this.WHITE=new i(1,1,1)}static{this.BLACK=new i(0,0,0)}constructor(t=.5,e=.5,r=.5,o=1){this.r=t,this.g=e,this.b=r,this.a=o}Clone(){return new i(this.r,this.g,this.b,this.a)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return this.r===0&&this.g===0&&this.b===0&&this.a===0}SetByteRGB(t,e,r){return this.r=t/255,this.g=e/255,this.b=r/255,this}SetByteRGBA(t,e,r,o){return this.r=t/255,this.g=e/255,this.b=r/255,this.a=o/255,this}SetRGB(t,e,r){return this.r=t,this.g=e,this.b=r,this}SetRGBA(t,e,r,o){return this.r=t,this.g=e,this.b=r,this.a=o,this}Add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Subtract(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Scale(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mix(t,e){i.MixColors(this,t,e)}static Add(t,e,r){return r.r=t.r+e.r,r.g=t.g+e.g,r.b=t.b+e.b,r.a=t.a+e.a,r}static Subtract(t,e,r){return r.r=t.r-e.r,r.g=t.g-e.g,r.b=t.b-e.b,r.a=t.a-e.a,r}static Scale(t,e,r){return r.r=t.r*e,r.g=t.g*e,r.b=t.b*e,r.a=t.a*e,r}static MixColors(t,e,r){let o=r*(e.r-t.r),s=r*(e.g-t.g),l=r*(e.b-t.b),a=r*(e.a-t.a);t.r+=o,t.g+=s,t.b+=l,t.a+=a,e.r-=o,e.g-=s,e.b-=l,e.a-=a}},Q={badBody:new F(1,0,0),disabledBody:new F(.5,.5,.3),staticBody:new F(.5,.9,.5),kinematicBody:new F(.5,.5,.9),sleepingBody:new F(.6,.6,.6),body:new F(.9,.7,.7),pair:new F(.3,.9,.9),aabb:new F(.9,.3,.9),joint1:new F(.7,.7,.7),joint2:new F(.3,.9,.3),joint3:new F(.9,.3,.3),joint4:new F(.3,.3,.9),joint5:new F(.4,.4,.4),joint6:new F(.5,.8,.8),joint7:new F(0,1,0),joint8:new F(.8,.8,.8),rope:new F(.4,.5,.7),ropePointG:new F(.1,.8,.1),ropePointD:new F(.7,.2,.4)};var Re=class{constructor(){this.mass=0;this.center=new n;this.I=0}};var ei=class{constructor(t,e){this.m_radius=0;this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}};var qi=class{constructor(){this.m_buffer=H(2,n);this.m_vertices=this.m_buffer;this.m_count=0;this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0]=t.m_buffer[0],this.m_buffer[1]=t.m_buffer[1]):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}SetVerticesRadius(t,e,r){this.m_vertices=t,this.m_count=e,this.m_radius=r}GetSupport(t){let e=0,r=n.Dot(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){let s=n.Dot(this.m_vertices[o],t);s>r&&(e=o,r=s)}return e}GetSupportVertex(t){let e=0,r=n.Dot(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){let s=n.Dot(this.m_vertices[o],t);s>r&&(e=o,r=s)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}},Di=class{constructor(){this.metric=0;this.count=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}},Mi=class{constructor(){this.proxyA=new qi;this.proxyB=new qi;this.transformA=new T;this.transformB=new T;this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}},Ri=class{constructor(){this.pointA=new n;this.pointB=new n;this.distance=0;this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}},Ia=class{constructor(){this.proxyA=new qi;this.proxyB=new qi;this.transformA=new T;this.transformB=new T;this.translationB=new n}},La=class{constructor(){this.point=new n;this.normal=new n;this.lambda=0;this.iterations=0}},$t={calls:0,iters:0,maxIters:0,reset(){this.calls=0,this.iters=0,this.maxIters=0}},Bn=class{constructor(){this.wA=new n;this.wB=new n;this.w=new n;this.a=0;this.indexA=0;this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}},Ga=class i{constructor(){this.m_v1=new Bn;this.m_v2=new Bn;this.m_v3=new Bn;this.m_count=0;this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}ReadCache(t,e,r,o,s){this.m_count=t.count;let l=this.m_vertices;for(let a=0;a<this.m_count;++a){let c=l[a];c.indexA=t.indexA[a],c.indexB=t.indexB[a];let u=e.GetVertex(c.indexA),m=o.GetVertex(c.indexB);T.MultiplyVec2(r,u,c.wA),T.MultiplyVec2(s,m,c.wB),n.Subtract(c.wB,c.wA,c.w),c.a=0}if(this.m_count>1){let a=t.metric,c=this.GetMetric();(c<.5*a||2*a<c||c<gt)&&(this.m_count=0)}if(this.m_count===0){let a=l[0];a.indexA=0,a.indexB=0;let c=e.GetVertex(0),u=o.GetVertex(0);T.MultiplyVec2(r,c,a.wA),T.MultiplyVec2(s,u,a.wB),n.Subtract(a.wB,a.wA,a.w),a.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;let e=this.m_vertices;for(let r=0;r<this.m_count;++r)t.indexA[r]=e[r].indexA,t.indexB[r]=e[r].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return n.Negate(this.m_v1.w,t);case 2:{let e=n.Subtract(this.m_v2.w,this.m_v1.w,t);return n.Cross(e,n.Negate(this.m_v1.w,n.s_t0))>0?n.CrossOneVec2(e,t):n.CrossVec2One(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return t.SetZero();default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:break}}GetMetric(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return n.Distance(this.m_v1.w,this.m_v2.w);case 3:return n.Cross(n.Subtract(this.m_v2.w,this.m_v1.w,n.s_t0),n.Subtract(this.m_v3.w,this.m_v1.w,n.s_t1));default:return 0}}Solve2(){let t=this.m_v1.w,e=this.m_v2.w,r=n.Subtract(e,t,i.s_e12),o=-n.Dot(t,r);if(o<=0){this.m_v1.a=1,this.m_count=1;return}let s=n.Dot(e,r);if(s<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}let l=1/(s+o);this.m_v1.a=s*l,this.m_v2.a=o*l,this.m_count=2}Solve3(){let t=this.m_v1.w,e=this.m_v2.w,r=this.m_v3.w,o=n.Subtract(e,t,i.s_e12),s=n.Dot(t,o),a=n.Dot(e,o),c=-s,u=n.Subtract(r,t,i.s_e13),m=n.Dot(t,u),d=n.Dot(r,u),h=-m,f=n.Subtract(r,e,i.s_e23),b=n.Dot(e,f),_=n.Dot(r,f),y=-b,g=n.Cross(o,u),S=g*n.Cross(e,r),w=g*n.Cross(r,t),B=g*n.Cross(t,e);if(c<=0&&h<=0){this.m_v1.a=1,this.m_count=1;return}if(a>0&&c>0&&B<=0){let A=1/(a+c);this.m_v1.a=a*A,this.m_v2.a=c*A,this.m_count=2;return}if(d>0&&h>0&&w<=0){let A=1/(d+h);this.m_v1.a=d*A,this.m_v3.a=h*A,this.m_count=2,this.m_v2.Copy(this.m_v3);return}if(a<=0&&y<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}if(d<=0&&_<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);return}if(_>0&&y>0&&S<=0){let A=1/(_+y);this.m_v2.a=_*A,this.m_v3.a=y*A,this.m_count=2,this.m_v1.Copy(this.m_v3);return}let C=1/(S+w+B);this.m_v1.a=S*C,this.m_v2.a=w*C,this.m_v3.a=B*C,this.m_count=3}static{this.s_e12=new n}static{this.s_e13=new n}static{this.s_e23=new n}},Aw=new Ga,Tw=[0,0,0],Pw=[0,0,0],Dw=new n,Mw=new n,Rw=new n,kw=new n,Fw=new n;function Mr(i,t,e){++$t.calls;let{proxyA:r,proxyB:o,transformA:s,transformB:l}=e,a=Aw;a.ReadCache(t,r,s,o,l);let c=a.m_vertices,u=20,m=Tw,p=Pw,d=0,h=0;for(;h<u;){d=a.m_count;for(let _=0;_<d;++_)m[_]=c[_].indexA,p[_]=c[_].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3();break}if(a.m_count===3)break;let f=a.GetSearchDirection(Mw);if(f.LengthSquared()<Dr)break;let b=c[a.m_count];b.indexA=r.GetSupport(D.TransposeMultiplyVec2(s.q,n.Negate(f,n.s_t0),kw)),T.MultiplyVec2(s,r.GetVertex(b.indexA),b.wA),b.indexB=o.GetSupport(D.TransposeMultiplyVec2(l.q,f,Fw)),T.MultiplyVec2(l,o.GetVertex(b.indexB),b.wB),n.Subtract(b.wB,b.wA,b.w),++h,++$t.iters;let x=!1;for(let _=0;_<d;++_)if(b.indexA===m[_]&&b.indexB===p[_]){x=!0;break}if(x)break;++a.m_count}if($t.maxIters=Math.max($t.maxIters,h),a.GetWitnessPoints(i.pointA,i.pointB),i.distance=n.Distance(i.pointA,i.pointB),i.iterations=h,a.WriteCache(t),e.useRadii)if(i.distance<gt){let f=n.Mid(i.pointA,i.pointB,Dw);i.pointA.Copy(f),i.pointB.Copy(f),i.distance=0}else{let f=r.m_radius,b=o.m_radius,x=n.Subtract(i.pointB,i.pointA,Rw);x.Normalize(),i.distance=Math.max(0,i.distance-f-b),i.pointA.AddScaled(f,x),i.pointB.SubtractScaled(b,x)}}var Iw=new n,Lw=new Ga,N2=new n,Z2=new n,Gw=new n,Vw=new n,Ew=new n,Uw=new n;function Q2(i,t){i.iterations=0,i.lambda=1,i.normal.SetZero(),i.point.SetZero();let{proxyA:e,proxyB:r}=t,o=Math.max(e.m_radius,Me),s=Math.max(r.m_radius,Me),l=o+s,a=t.transformA,c=t.transformB,u=t.translationB,m=Iw.SetZero(),p=0,d=Lw;d.m_count=0;let h=d.m_vertices,f=e.GetSupport(D.TransposeMultiplyVec2(a.q,n.Negate(u,n.s_t1),n.s_t0)),b=T.MultiplyVec2(a,e.GetVertex(f),N2),x=r.GetSupport(D.TransposeMultiplyVec2(c.q,u,n.s_t0)),_=T.MultiplyVec2(c,r.GetVertex(x),Z2),y=n.Subtract(b,_,Gw),g=Math.max(Me,l-Me),S=.5*Z,w=20,B=0;for(;B<w&&y.Length()-g>S;){i.iterations+=1,f=e.GetSupport(D.TransposeMultiplyVec2(a.q,n.Negate(y,n.s_t1),n.s_t0)),b=T.MultiplyVec2(a,e.GetVertex(f),N2),x=r.GetSupport(D.TransposeMultiplyVec2(c.q,y,n.s_t0)),_=T.MultiplyVec2(c,r.GetVertex(x),Z2);let k=n.Subtract(b,_,Vw);y.Normalize();let M=n.Dot(y,k),E=n.Dot(y,u);if(M-g>p*E){if(E<=0||(p=(M-g)/E,p>1))return!1;n.Negate(y,m),d.m_count=0}let L=h[d.m_count];switch(L.indexA=x,n.AddScaled(_,p,u,L.wA),L.indexB=f,L.wB.Copy(b),n.Subtract(L.wB,L.wA,L.w),L.a=1,d.m_count+=1,d.m_count){case 1:break;case 2:d.Solve2();break;case 3:d.Solve3();break}if(d.m_count===3)return!1;d.GetClosestPoint(y),++B}if(B===0)return!1;let C=Ew,A=Uw;return d.GetWitnessPoints(C,A),y.LengthSquared()>0&&(n.Negate(y,m),m.Normalize()),n.AddScaled(C,o,m,i.point),i.normal.Copy(m),i.lambda=p,i.iterations=B,!0}var $p=class{constructor(){this.m_key=0;this.m_key_invalid=!1;this.m_indexA=0;this.m_indexB=0;this.m_typeA=0;this.m_typeB=0}get key(){return this.m_key_invalid&&(this.m_key_invalid=!1,this.m_key=this.m_indexA|this.m_indexB<<8|this.m_typeA<<16|this.m_typeB<<24),this.m_key}set key(t){this.m_key=t,this.m_key_invalid=!1,this.m_indexA=this.m_key&255,this.m_indexB=this.m_key>>8&255,this.m_typeA=this.m_key>>16&255,this.m_typeB=this.m_key>>24&255}get indexA(){return this.m_indexA}set indexA(t){this.m_indexA=t,this.m_key_invalid=!0}get indexB(){return this.m_indexB}set indexB(t){this.m_indexB=t,this.m_key_invalid=!0}get typeA(){return this.m_typeA}set typeA(t){this.m_typeA=t,this.m_key_invalid=!0}get typeB(){return this.m_typeB}set typeB(t){this.m_typeB=t,this.m_key_invalid=!0}},Ko=class i{constructor(){this.cf=new $p}Copy(t){return this.key=t.key,this}Clone(){return new i().Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}},td=class{constructor(){this.localPoint=new n;this.normalImpulse=0;this.tangentImpulse=0;this.id=new Ko}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}};var co=class i{constructor(){this.points=H(Nt,td);this.localNormal=new n;this.localPoint=new n;this.type=0;this.pointCount=0}Reset(){for(let t=0;t<Nt;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=0,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<Nt;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return new i().Copy(this)}},ki=class i{constructor(){this.normal=new n;this.points=H(Nt,n);this.separations=je(Nt)}static{this.Initialize_s_pointA=new n}static{this.Initialize_s_pointB=new n}static{this.Initialize_s_cA=new n}static{this.Initialize_s_cB=new n}static{this.Initialize_s_planePoint=new n}static{this.Initialize_s_clipPoint=new n}Initialize(t,e,r,o,s){if(t.pointCount!==0)switch(t.type){case 0:{this.normal.Set(1,0);let l=T.MultiplyVec2(e,t.localPoint,i.Initialize_s_pointA),a=T.MultiplyVec2(o,t.points[0].localPoint,i.Initialize_s_pointB);n.DistanceSquared(l,a)>Dr&&n.Subtract(a,l,this.normal).Normalize();let c=n.AddScaled(l,r,this.normal,i.Initialize_s_cA),u=n.SubtractScaled(a,s,this.normal,i.Initialize_s_cB);n.Mid(c,u,this.points[0]),this.separations[0]=n.Dot(n.Subtract(u,c,n.s_t0),this.normal);break}case 1:{D.MultiplyVec2(e.q,t.localNormal,this.normal);let l=T.MultiplyVec2(e,t.localPoint,i.Initialize_s_planePoint);for(let a=0;a<t.pointCount;++a){let c=T.MultiplyVec2(o,t.points[a].localPoint,i.Initialize_s_clipPoint),u=r-n.Dot(n.Subtract(c,l,n.s_t0),this.normal),m=n.AddScaled(c,u,this.normal,i.Initialize_s_cA),p=n.SubtractScaled(c,s,this.normal,i.Initialize_s_cB);n.Mid(m,p,this.points[a]),this.separations[a]=n.Dot(n.Subtract(p,m,n.s_t0),this.normal)}break}case 2:{D.MultiplyVec2(o.q,t.localNormal,this.normal);let l=T.MultiplyVec2(o,t.localPoint,i.Initialize_s_planePoint);for(let a=0;a<t.pointCount;++a){let c=T.MultiplyVec2(e,t.points[a].localPoint,i.Initialize_s_clipPoint),u=s-n.Dot(n.Subtract(c,l,n.s_t0),this.normal),m=n.AddScaled(c,u,this.normal,i.Initialize_s_cB),p=n.SubtractScaled(c,r,this.normal,i.Initialize_s_cA);n.Mid(p,m,this.points[a]),this.separations[a]=n.Dot(n.Subtract(p,m,n.s_t0),this.normal)}this.normal.Negate();break}}}};function t0(i,t,e,r){let o;for(o=0;o<e.pointCount;++o){let{key:s}=e.points[o].id;i[o]=3;for(let l=0;l<r.pointCount;++l)if(r.points[l].id.key===s){i[o]=2;break}}for(;o<Nt;++o)i[o]=0;for(o=0;o<r.pointCount;++o){let{key:s}=r.points[o].id;t[o]=1;for(let l=0;l<e.pointCount;++l)if(e.points[l].id.key===s){t[o]=2;break}}for(;o<Nt;++o)t[o]=0}var pe=class{constructor(){this.v=new n;this.id=new Ko}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}},bi=class{constructor(){this.p1=new n;this.p2=new n;this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}},_i=class{constructor(){this.normal=new n;this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}},nt=class{constructor(){this.lowerBound=new n;this.upperBound=new n}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){return this.lowerBound.IsValid()&&this.upperBound.IsValid()&&this.upperBound.x>=this.lowerBound.x&&this.upperBound.y>=this.lowerBound.y}GetCenter(t){return n.Mid(this.lowerBound,this.upperBound,t)}GetExtents(t){return n.Extents(this.lowerBound,this.upperBound,t)}GetPerimeter(){let t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)}Combine1(t){return this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,r){return r.Combine2(t,e),r}Contains(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let r=-$,o=$,s=e.p1.x,l=e.p1.y,a=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,u=Math.abs(a),m=Math.abs(c),{normal:p}=t;if(u<gt){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{let d=1/a,h=(this.lowerBound.x-s)*d,f=(this.upperBound.x-s)*d,b=-1;if(h>f){let x=h;h=f,f=x,b=1}if(h>r&&(p.x=b,p.y=0,r=h),o=Math.min(o,f),r>o)return!1}if(m<gt){if(l<this.lowerBound.y||this.upperBound.y<l)return!1}else{let d=1/c,h=(this.lowerBound.y-l)*d,f=(this.upperBound.y-l)*d,b=-1;if(h>f){let x=h;h=f,f=x,b=1}if(h>r&&(p.x=0,p.y=b,r=h),o=Math.min(o,f),r>o)return!1}return r<0||e.maxFraction<r?!1:(t.fraction=r,!0)}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}};function $o(i,[t,e],r,o,s){let l=0,a=n.Dot(r,t.v)-o,c=n.Dot(r,e.v)-o;if(a<=0&&i[l++].Copy(t),c<=0&&i[l++].Copy(e),a*c<0){let u=a/(a-c),{v:m,id:p}=i[l];m.x=t.v.x+u*(e.v.x-t.v.x),m.y=t.v.y+u*(e.v.y-t.v.y),p.cf.indexA=s,p.cf.indexB=t.id.cf.indexB,p.cf.typeA=0,p.cf.typeB=1,++l}return l}var Yw=new Mi,Jw=new Di,jw=new Ri;function ts(i,t,e,r,o,s){let l=Yw.Reset();l.proxyA.SetShape(i,t),l.proxyB.SetShape(e,r),l.transformA.Copy(o),l.transformB.Copy(s),l.useRadii=!0;let a=Jw.Reset();a.count=0;let c=jw.Reset();return Mr(c,a,l),c.distance<10*gt}var zw=new n,q2=new n,Cn=[];function Va(i,t,e){if(e.length===0)return Cn;let r=n.Subtract(t,i,zw);r.Normalize();let o=[],s=0,l=n.Cross(n.Subtract(e[s],i,q2),r);l>0&&o.push(e[s]);for(let p=1;p<e.length;++p){let d=n.Cross(n.Subtract(e[p],i,q2),r);d>l&&(s=p,l=d),d>0&&o.push(e[p])}if(l<2*Z)return Cn;let a=e[s],c=Va(i,a,o),u=Va(a,t,o),m=[...c,a,...u];return N(m.length<Kt),m}var W2=new n,Xw=new n,Hw=new n,Ow=new n,Nw=new nt;function An(i,t){if(t<3||t>Kt)return Cn;t=Math.min(t,Kt);let e=Nw;e.lowerBound.Set($,$),e.upperBound.Set(-$,-$);let r=[],o=16*Z*Z;for(let S=0;S<t;++S){n.Min(e.lowerBound,i[S],e.lowerBound),n.Max(e.upperBound,i[S],e.upperBound);let w=i[S],B=!0;for(let C=0;C<S;++C){let A=i[C];if(n.DistanceSquared(w,A)<o){B=!1;break}}B&&r.push(w)}let s=r.length;if(s<3)return Cn;let l=e.GetCenter(Hw),a=0,c=n.DistanceSquared(l,r[a]);for(let S=1;S<s;++S){let w=n.DistanceSquared(l,r[S]);w>c&&(a=S,c=w)}let u=r[a];r[a]=r[s-1],s-=1;let m=0,p=n.DistanceSquared(u,r[m]);for(let S=1;S<s;++S){let w=n.DistanceSquared(u,r[S]);w>p&&(m=S,p=w)}let d=r[m];r[m]=r[s-1],s-=1;let h=[],f=[],b=n.Subtract(d,u,W2);b.Normalize();for(let S=0;S<s;++S){let w=n.Cross(n.Subtract(r[S],u,Ow),b);w>=2*Z?h.push(r[S]):w<=-2*Z&&f.push(r[S])}let x=Va(u,d,h),_=Va(d,u,f);if(x.length===0&&_.length===0)return Cn;let y=[u,...x,d,..._];N(y.length<=Kt);let g=!0;for(;g&&y.length>2;){g=!1;for(let S=0;S<y.length;++S){let w=S,B=(S+1)%y.length,C=(S+2)%y.length,A=y[w],k=y[B],M=y[C],E=n.Subtract(M,A,W2);E.Normalize();let L=n.Subtract(k,A,Xw);if(n.Cross(L,E)<=2*Z){y.splice(B,1),g=!0;break}}}return y.length<3&&(y.length=0),y}var K2=new n,$2=new n;function Tn(i,t){if(t<3||Kt<t)return!1;for(let e=0;e<t;++e){let r=e,o=e<t-1?r+1:0,s=i[r],l=n.Subtract(i[o],s,K2);l.Normalize();for(let a=0;a<t;++a){if(a===r||a===o)continue;if(n.Cross(n.Subtract(i[a],s,$2),l)>=0)return!1}}for(let e=0;e<t;++e){let r=e,o=(e+1)%t,s=(e+2)%t,l=i[r],a=i[o],c=i[s],u=n.Subtract(c,l,K2);if(u.Normalize(),n.Cross(n.Subtract(a,l,$2),u)<=Z)return!1}return!0}var Zw={c1:new n,c2:new n},Ea={categoryBits:1,maskBits:65535,groupIndex:0},ed=class{constructor(t,e,r,o){this.aabb=new nt;this.fixture=t,this.childIndex=o,t.m_shape.ComputeAABB(this.aabb,r,o),this.treeNode=e.CreateProxy(this.aabb,this)}},Qw=new nt,qw=new nt,Ww=new n,Ua=class{constructor(t,e){this.m_density=0;this.m_next=null;this.m_friction=0;this.m_restitution=0;this.m_restitutionThreshold=0;this.m_proxies=[];this.m_isSensor=!1;this.m_userData={};this.m_body=t,this.m_shape=e.shape.Clone(),e.userData&&this.SetUserData(e.userData),this.m_friction=e.friction??.2,this.m_restitution=e.restitution??0,this.m_restitutionThreshold=e.restitutionThreshold??Pr,this.m_filter={...Ea,...e.filter},this.m_isSensor=e.isSensor??!1,this.m_density=e.density??0}get m_proxyCount(){return this.m_proxies.length}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.categoryBits=t.categoryBits??Ea.categoryBits,this.m_filter.groupIndex=t.groupIndex??Ea.groupIndex,this.m_filter.maskBits=t.maskBits??Ea.maskBits,this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){let{contact:o}=t,s=o.GetFixtureA(),l=o.GetFixtureB();(s===this||l===this)&&o.FlagForFiltering(),t=t.next}let r=this.m_body.GetWorld().m_contactManager.m_broadPhase;for(let o of this.m_proxies)r.TouchProxy(o.treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}RayCast(t,e,r){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),r)}GetMassData(t=new Re){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetAABB(t){return this.m_proxies[t].aabb}CreateProxies(t,e){N(this.m_proxies.length===0),this.m_proxies.length=this.m_shape.GetChildCount();for(let r=0;r<this.m_proxies.length;++r)this.m_proxies[r]=new ed(this,t,e,r)}DestroyProxies(t){for(let e of this.m_proxies)t.DestroyProxy(e.treeNode);this.m_proxies.length=0}Synchronize(t,e,r){let{c1:o,c2:s}=Zw,l=Ww;for(let a of this.m_proxies){let c=Qw,u=qw;this.m_shape.ComputeAABB(c,e,a.childIndex),this.m_shape.ComputeAABB(u,r,a.childIndex),a.aabb.Combine2(c,u),n.Subtract(u.GetCenter(s),c.GetCenter(o),l),t.MoveProxy(a.treeNode,a.aabb,l)}}};var uo=class i{constructor(t,e){this.m_type=0;this.m_islandFlag=!1;this.m_awakeFlag=!1;this.m_autoSleepFlag=!1;this.m_bulletFlag=!1;this.m_fixedRotationFlag=!1;this.m_enabledFlag=!1;this.m_toiFlag=!1;this.m_islandIndex=0;this.m_xf=new T;this.m_sweep=new ie;this.m_linearVelocity=new n;this.m_angularVelocity=0;this.m_force=new n;this.m_torque=0;this.m_prev=null;this.m_next=null;this.m_fixtureList=null;this.m_fixtureCount=0;this.m_jointList=null;this.m_contactList=null;this.m_mass=1;this.m_invMass=1;this.m_I=0;this.m_invI=0;this.m_linearDamping=0;this.m_angularDamping=0;this.m_gravityScale=1;this.m_sleepTime=0;this.m_userData={};this.m_bulletFlag=t.bullet??!1,this.m_fixedRotationFlag=t.fixedRotation??!1,this.m_autoSleepFlag=t.allowSleep??!0,(t.awake??!0)&&(t.type??0)!==0&&(this.m_awakeFlag=!0),this.m_enabledFlag=t.enabled??!0,this.m_world=e,this.m_xf.p.Copy(t.position??n.ZERO),this.m_xf.q.Set(t.angle??0),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity??n.ZERO),this.m_angularVelocity=t.angularVelocity??0,this.m_linearDamping=t.linearDamping??0,this.m_angularDamping=t.angularDamping??0,this.m_gravityScale=t.gravityScale??1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type??0,this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,t.userData&&this.SetUserData(t.userData),this.m_fixtureList=null,this.m_fixtureCount=0}CreateFixture(t){N(!this.m_world.IsLocked());let e=new Ua(this,t);if(this.m_enabledFlag){let r=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(r,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}DestroyFixture(t){N(!this.m_world.IsLocked());let e=this.m_fixtureList,r=null;for(;e!==null;){if(e===t){r?r.m_next=t.m_next:this.m_fixtureList=t.m_next;break}r=e,e=e.m_next}let o=t.m_density,s=this.m_contactList;for(;s;){let l=s.contact;s=s.next;let a=l.GetFixtureA(),c=l.GetFixtureB();(t===a||t===c)&&this.m_world.m_contactManager.Destroy(l)}if(this.m_enabledFlag){let l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(l)}t.m_next=null,--this.m_fixtureCount,o>0&&this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,r){N(!this.m_world.IsLocked()),this.m_xf.q.Set(r),this.m_xf.p.Set(t,e),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=r,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=r;let o=this.m_world.m_contactManager.m_broadPhase;for(let s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(o,this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==0&&(n.Dot(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==0&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}ApplyForce(t,e,r=!0){this.m_type===2&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,r=!0){this.m_type===2&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*n.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*n.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}static{this.SetMassData_s_oldCenter=new n}SetMassData(t){if(N(!this.m_world.IsLocked()),this.m_type!==2)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*n.Dot(t.center,t.center),this.m_invI=1/this.m_I);let e=i.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(this.m_sweep.c,e,n.s_t0),this.m_linearVelocity)}static{this.ResetMassData_s_localCenter=new n}static{this.ResetMassData_s_oldCenter=new n}static{this.ResetMassData_s_massData=new Re}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===0||this.m_type===1){this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}let t=i.ResetMassData_s_localCenter.SetZero();for(let r=this.m_fixtureList;r;r=r.m_next){if(r.m_density===0)continue;let o=r.GetMassData(i.ResetMassData_s_massData);this.m_mass+=o.mass,t.AddScaled(o.mass,o.center),this.m_I+=o.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,t.Scale(this.m_invMass)),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*n.Dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);let e=i.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(this.m_sweep.c,e,n.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return T.MultiplyVec2(this.m_xf,t,e)}GetWorldVector(t,e){return D.MultiplyVec2(this.m_xf.q,t,e)}GetLocalPoint(t,e){return T.TransposeMultiplyVec2(this.m_xf,t,e)}GetLocalVector(t,e){return D.TransposeMultiplyVec2(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(t,this.m_sweep.c,n.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if(N(!this.m_world.IsLocked()),this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===0&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){let o=e;e=e.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null;let r=this.m_world.m_contactManager.m_broadPhase;for(let o=this.m_fixtureList;o;o=o.m_next)for(let s of o.m_proxies)r.TouchProxy(s.treeNode)}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){this.m_type!==0&&(t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(t){if(N(!this.m_world.IsLocked()),t===this.IsEnabled())return;this.m_enabledFlag=t;let e=this.m_world.m_contactManager.m_broadPhase;if(t){for(let r=this.m_fixtureList;r;r=r.m_next)r.CreateProxies(e,this.m_xf);this.m_world.m_newContacts=!0}else{for(let o=this.m_fixtureList;o;o=o.m_next)o.DestroyProxies(e);let r=this.m_contactList;for(;r;){let o=r;r=r.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}GetWorld(){return this.m_world}static{this.SynchronizeFixtures_s_xf1=new T}SynchronizeFixtures(){let t=this.m_world.m_contactManager.m_broadPhase;if(this.m_awakeFlag){let e=i.SynchronizeFixtures_s_xf1;e.q.Set(this.m_sweep.a0),D.MultiplyVec2(e.q,this.m_sweep.localCenter,e.p),n.Subtract(this.m_sweep.c0,e.p,e.p);for(let r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(t,e,this.m_xf)}else for(let e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.Set(this.m_sweep.a),D.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return this.m_type!==2&&t.m_type!==2?!1:this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),D.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}};var e0={cA:new n,cB:new n,vs:H(4,n),xf:new T};function Kw(i){return i.GetType()===2&&i.m_mass===0?Q.badBody:i.IsEnabled()?i.GetType()===0?Q.staticBody:i.GetType()===1?Q.kinematicBody:i.IsAwake()?Q.body:Q.sleepingBody:Q.disabledBody}function $w(i,t){for(let e=0;e<i.m_proxyCount;e++)if(t.TestOverlap(i.GetAABB(e)))return!0;return!1}function i0(i,t,e){for(let r=t.GetBodyList();r;r=r.m_next){let o=r.m_xf;i.PushTransform(o);for(let s=r.GetFixtureList();s;s=s.m_next)e&&!$w(s,e)||s.GetShape().Draw(i,Kw(r));i.PopTransform(o)}}function r0(i,t){for(let e=t.GetJointList();e;e=e.m_next)e.Draw(i)}function o0(i,t,e){let{vs:r}=e0;for(let o=t.GetBodyList();o;o=o.m_next)if(o.IsEnabled())for(let s=o.GetFixtureList();s;s=s.m_next)for(let l=0;l<s.m_proxyCount;++l){let{aabb:a}=s.m_proxies[l].treeNode;e&&!e.TestOverlap(a)||(r[0].Set(a.lowerBound.x,a.lowerBound.y),r[1].Set(a.upperBound.x,a.lowerBound.y),r[2].Set(a.upperBound.x,a.upperBound.y),r[3].Set(a.lowerBound.x,a.upperBound.y),i.DrawPolygon(r,4,Q.aabb))}}function s0(i,t){let{xf:e}=e0;for(let r=t.GetBodyList();r;r=r.m_next)e.q.Copy(r.m_xf.q),e.p.Copy(r.GetWorldCenter()),i.DrawTransform(e)}var ii=class{constructor(){this.m_start=performance.now()}Reset(){return this.m_start=performance.now(),this}GetMilliseconds(){return performance.now()-this.m_start}};function Fi(i,t){for(let e of Object.keys(t)){let r=t[e],o=i[e],s=function(...l){return r.call(this,o.bind(this),...l)};Object.defineProperty(s,"name",{value:e}),i[e]=s}}var Wi={stack:[],t:new n,r:new n,v:new n,abs_v:new n,segmentAABB:new nt,subInput:new bi,combinedAABB:new nt,aabb:new nt,fatAABB:new nt,hugeAABB:new nt,c:new n,h:new n},tv=0,Pn=class{constructor(){this.aabb=new nt;this.userData=null;this.parent=null;this.child1=null;this.child2=null;this.height=0;this.moved=!1;this.id=tv++}Reset(){this.child1=null,this.child2=null,this.height=-1,this.userData=null}IsLeaf(){return this.child1===null}GetArea(){if(this.IsLeaf())return 0;let t=this.aabb.GetPerimeter();return this.child1&&(t+=this.child1.GetArea()),this.child2&&(t+=this.child2.GetArea()),t}ComputeHeight(){if(this.IsLeaf())return 0;N(this.child1!==null&&this.child2!==null);let t=at(this.child1).ComputeHeight(),e=at(this.child2).ComputeHeight();return 1+Math.max(t,e)}GetMaxBalance(){if(this.height<=1)return 0;let t=at(this.child1),e=at(this.child2);return Math.max(t.GetMaxBalance(),e.GetMaxBalance(),Math.abs(e.height-t.height))}ShiftOrigin(t){this.height<=1||(at(this.child1).ShiftOrigin(t),at(this.child2).ShiftOrigin(t),this.aabb.lowerBound.Subtract(t),this.aabb.upperBound.Subtract(t))}},es=class{constructor(){this.m_root=null;this.m_freeList=null}Query(t,e){let r=Wi.stack;r.length=0;let o=this.m_root;for(;o;){if(o.aabb.TestOverlap(t))if(o.IsLeaf()){if(!e(o))return}else r.push(o.child1),r.push(o.child2);o=r.pop()}}QueryPoint(t,e){let r=Wi.stack;r.length=0;let o=this.m_root;for(;o;){if(o.aabb.TestContain(t))if(o.IsLeaf()){if(!e(o))return}else r.push(o.child1),r.push(o.child2);o=r.pop()}}RayCast(t,e){let{p1:r,p2:o}=t,s=n.Subtract(o,r,Wi.r);s.Normalize();let l=n.CrossOneVec2(s,Wi.v),a=l.GetAbs(Wi.abs_v),{maxFraction:c}=t,{segmentAABB:u,subInput:m,c:p,h:d,t:h}=Wi;n.AddScaled(r,c,n.Subtract(o,r,h),h),n.Min(r,h,u.lowerBound),n.Max(r,h,u.upperBound);let f=Wi.stack;f.length=0;let b=this.m_root;for(;b;){if(!b.aabb.TestOverlap(u)){b=f.pop();continue}if(b.aabb.GetCenter(p),b.aabb.GetExtents(d),Math.abs(n.Dot(l,n.Subtract(r,p,n.s_t0)))-n.Dot(a,d)>0){b=f.pop();continue}if(b.IsLeaf()){m.p1.Copy(t.p1),m.p2.Copy(t.p2),m.maxFraction=c;let _=e(m,b);if(_===0)return;_>0&&(c=_,n.AddScaled(r,c,n.Subtract(o,r,h),h),n.Min(r,h,u.lowerBound),n.Max(r,h,u.upperBound))}else f.push(b.child1),f.push(b.child2);b=f.pop()}}AllocateNode(){if(this.m_freeList===null)return new Pn;let t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}FreeNode(t){t.parent=this.m_freeList,t.Reset(),this.m_freeList=t}CreateProxy(t,e){let r=this.AllocateNode(),o=Ra;return r.aabb.lowerBound.Set(t.lowerBound.x-o,t.lowerBound.y-o),r.aabb.upperBound.Set(t.upperBound.x+o,t.upperBound.y+o),r.userData=e,r.height=0,r.moved=!0,this.InsertLeaf(r),r}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,r){let{fatAABB:o,hugeAABB:s}=Wi,l=Ra;o.lowerBound.Set(e.lowerBound.x-l,e.lowerBound.y-l),o.upperBound.Set(e.upperBound.x+l,e.upperBound.y+l);let a=Zp*r.x,c=Zp*r.y;a<0?o.lowerBound.x+=a:o.upperBound.x+=a,c<0?o.lowerBound.y+=c:o.upperBound.y+=c;let u=t.aabb;if(u.Contains(e)){let m=4*Ra;if(s.lowerBound.Set(o.lowerBound.x-m,e.lowerBound.y-m),s.upperBound.Set(o.upperBound.x+m,e.upperBound.y+m),s.Contains(u))return!1}return this.RemoveLeaf(t),t.aabb.Copy(o),this.InsertLeaf(t),t.moved=!0,!0}InsertLeaf(t){if(this.m_root===null){this.m_root=t,this.m_root.parent=null;return}let{combinedAABB:e,aabb:r}=Wi,o=t.aabb,s=this.m_root;for(;!s.IsLeaf();){let u=at(s.child1),m=at(s.child2),p=s.aabb.GetPerimeter();e.Combine2(s.aabb,o);let d=e.GetPerimeter(),h=2*d,f=2*(d-p),b,x,_;u.IsLeaf()?(r.Combine2(o,u.aabb),b=r.GetPerimeter()+f):(r.Combine2(o,u.aabb),x=u.aabb.GetPerimeter(),_=r.GetPerimeter(),b=_-x+f);let y;if(m.IsLeaf()?(r.Combine2(o,m.aabb),y=r.GetPerimeter()+f):(r.Combine2(o,m.aabb),x=m.aabb.GetPerimeter(),_=r.GetPerimeter(),y=_-x+f),h<b&&h<y)break;b<y?s=u:s=m}let l=s.parent,a=this.AllocateNode();a.parent=l,a.userData=null,a.aabb.Combine2(o,s.aabb),a.height=s.height+1,l!==null?(l.child1===s?l.child1=a:l.child2=a,a.child1=s,a.child2=t,s.parent=a,t.parent=a):(a.child1=s,a.child2=t,s.parent=a,t.parent=a,this.m_root=a);let c=t.parent;for(;c!==null;){c=this.Balance(c);let u=at(c.child1),m=at(c.child2);c.height=1+Math.max(u.height,m.height),c.aabb.Combine2(u.aabb,m.aabb),c=c.parent}}RemoveLeaf(t){if(t===this.m_root){this.m_root=null;return}let e=at(t.parent),r=e.parent,o=at(e.child1===t?e.child2:e.child1);if(r!==null){r.child1===e?r.child1=o:r.child2=o,o.parent=r,this.FreeNode(e);let s=r;for(;s!==null;){s=this.Balance(s);let l=at(s.child1),a=at(s.child2);s.aabb.Combine2(l.aabb,a.aabb),s.height=1+Math.max(l.height,a.height),s=s.parent}}else this.m_root=o,o.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;let e=at(t.child1),r=at(t.child2),o=r.height-e.height;if(o>1){let s=at(r.child1),l=at(r.child2);return r.child1=t,r.parent=t.parent,t.parent=r,r.parent!==null?r.parent.child1===t?r.parent.child1=r:r.parent.child2=r:this.m_root=r,s.height>l.height?(r.child2=s,t.child2=l,l.parent=t,t.aabb.Combine2(e.aabb,l.aabb),r.aabb.Combine2(t.aabb,s.aabb),t.height=1+Math.max(e.height,l.height),r.height=1+Math.max(t.height,s.height)):(r.child2=l,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),r.aabb.Combine2(t.aabb,l.aabb),t.height=1+Math.max(e.height,s.height),r.height=1+Math.max(t.height,l.height)),r}if(o<-1){let s=at(e.child1),l=at(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,e.parent!==null?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,s.height>l.height?(e.child2=s,t.child1=l,l.parent=t,t.aabb.Combine2(r.aabb,l.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+Math.max(r.height,l.height),e.height=1+Math.max(t.height,s.height)):(e.child2=l,t.child1=s,s.parent=t,t.aabb.Combine2(r.aabb,s.aabb),e.aabb.Combine2(t.aabb,l.aabb),t.height=1+Math.max(r.height,s.height),e.height=1+Math.max(t.height,l.height)),e}return t}GetHeight(){return this.m_root===null?0:this.m_root.height}GetAreaRatio(){if(this.m_root===null)return 0;let t=this.m_root,e=t.aabb.GetPerimeter();return t.GetArea()/e}GetMaxBalance(){return this.m_root===null?0:this.m_root.GetMaxBalance()}ShiftOrigin(t){this.m_root?.ShiftOrigin(t)}};var Ya=class{constructor(){this.m_tree=new es;this.m_proxyCount=0;this.m_moveCount=0;this.m_moveBuffer=[];this.m_pairCount=0;this.m_pairBuffer=[];this.m_queryProxy=new Pn;this.QueryCallback=t=>(t.id===this.m_queryProxy.id||t.moved&&t.id>this.m_queryProxy.id||(this.m_pairBuffer[this.m_pairCount]=t.id<this.m_queryProxy.id?[t,this.m_queryProxy]:[this.m_queryProxy,t],++this.m_pairCount),!0)}CreateProxy(t,e){let r=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(r),r}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,r){this.m_tree.MoveProxy(t,e,r)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let e=0;e<this.m_moveCount;++e){let r=this.m_moveBuffer[e];if(r===null)continue;this.m_queryProxy=r;let o=r.aabb;this.m_tree.Query(o,this.QueryCallback)}for(let e=0;e<this.m_pairCount;++e){let r=this.m_pairBuffer[e],o=at(r[0].userData),s=at(r[1].userData);t(o,s)}for(let e=0;e<this.m_moveCount;++e){let r=this.m_moveBuffer[e];r&&(r.moved=!1)}this.m_moveCount=0}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){for(let e=0;e<this.m_moveCount;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)}};var rt={time:0,maxTime:0,calls:0,iters:0,maxIters:0,rootIters:0,maxRootIters:0,reset(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}},Ja=new T,ja=new T,Ki=new n,$i=new n,is=new n,n0=new n,l0=new n,rs=class{constructor(){this.proxyA=new qi;this.proxyB=new qi;this.sweepA=new ie;this.sweepB=new ie;this.tMax=0}};var os=class{constructor(){this.state=0;this.t=0}};var id=class{constructor(){this.m_sweepA=new ie;this.m_sweepB=new ie;this.m_type=0;this.m_localPoint=new n;this.m_axis=new n}Initialize(t,e,r,o,s,l){this.m_proxyA=e,this.m_proxyB=o;let{count:a}=t;this.m_sweepA.Copy(r),this.m_sweepB.Copy(s);let c=this.m_sweepA.GetTransform(Ja,l),u=this.m_sweepB.GetTransform(ja,l);if(a===1){this.m_type=0;let _=this.m_proxyA.GetVertex(t.indexA[0]),y=this.m_proxyB.GetVertex(t.indexB[0]),g=T.MultiplyVec2(c,_,Ki),S=T.MultiplyVec2(u,y,$i);return n.Subtract(S,g,this.m_axis),this.m_axis.Normalize()}if(t.indexA[0]===t.indexA[1]){this.m_type=2;let _=this.m_proxyB.GetVertex(t.indexB[0]),y=this.m_proxyB.GetVertex(t.indexB[1]);n.CrossVec2One(n.Subtract(y,_,n.s_t0),this.m_axis).Normalize();let g=D.MultiplyVec2(u.q,this.m_axis,is);n.Mid(_,y,this.m_localPoint);let S=T.MultiplyVec2(u,this.m_localPoint,$i),w=this.m_proxyA.GetVertex(t.indexA[0]),B=T.MultiplyVec2(c,w,Ki),C=n.Dot(n.Subtract(B,S,n.s_t0),g);return C<0&&(this.m_axis.Negate(),C=-C),C}this.m_type=1;let m=this.m_proxyA.GetVertex(t.indexA[0]),p=this.m_proxyA.GetVertex(t.indexA[1]);n.CrossVec2One(n.Subtract(p,m,n.s_t0),this.m_axis).Normalize();let d=D.MultiplyVec2(c.q,this.m_axis,is);n.Mid(m,p,this.m_localPoint);let h=T.MultiplyVec2(c,this.m_localPoint,Ki),f=this.m_proxyB.GetVertex(t.indexB[0]),b=T.MultiplyVec2(u,f,$i),x=n.Dot(n.Subtract(b,h,n.s_t0),d);return x<0&&(this.m_axis.Negate(),x=-x),x}FindMinSeparation(t,e,r){let o=this.m_sweepA.GetTransform(Ja,r),s=this.m_sweepB.GetTransform(ja,r);switch(this.m_type){case 0:{let l=D.TransposeMultiplyVec2(o.q,this.m_axis,n0),a=D.TransposeMultiplyVec2(s.q,n.Negate(this.m_axis,n.s_t0),l0);t[0]=this.m_proxyA.GetSupport(l),e[0]=this.m_proxyB.GetSupport(a);let c=this.m_proxyA.GetVertex(t[0]),u=this.m_proxyB.GetVertex(e[0]),m=T.MultiplyVec2(o,c,Ki),p=T.MultiplyVec2(s,u,$i);return n.Dot(n.Subtract(p,m,n.s_t0),this.m_axis)}case 1:{let l=D.MultiplyVec2(o.q,this.m_axis,is),a=T.MultiplyVec2(o,this.m_localPoint,Ki),c=D.TransposeMultiplyVec2(s.q,n.Negate(l,n.s_t0),l0);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);let u=this.m_proxyB.GetVertex(e[0]),m=T.MultiplyVec2(s,u,$i);return n.Dot(n.Subtract(m,a,n.s_t0),l)}case 2:{let l=D.MultiplyVec2(s.q,this.m_axis,is),a=T.MultiplyVec2(s,this.m_localPoint,$i),c=D.TransposeMultiplyVec2(o.q,n.Negate(l,n.s_t0),n0);e[0]=-1,t[0]=this.m_proxyA.GetSupport(c);let u=this.m_proxyA.GetVertex(t[0]),m=T.MultiplyVec2(o,u,Ki);return n.Dot(n.Subtract(m,a,n.s_t0),l)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,r){let o=this.m_sweepA.GetTransform(Ja,r),s=this.m_sweepB.GetTransform(ja,r);switch(this.m_type){case 0:{let l=this.m_proxyA.GetVertex(t),a=this.m_proxyB.GetVertex(e),c=T.MultiplyVec2(o,l,Ki),u=T.MultiplyVec2(s,a,$i);return n.Dot(n.Subtract(u,c,n.s_t0),this.m_axis)}case 1:{let l=D.MultiplyVec2(o.q,this.m_axis,is),a=T.MultiplyVec2(o,this.m_localPoint,Ki),c=this.m_proxyB.GetVertex(e),u=T.MultiplyVec2(s,c,$i);return n.Dot(n.Subtract(u,a,n.s_t0),l)}case 2:{let l=D.MultiplyVec2(s.q,this.m_axis,is),a=T.MultiplyVec2(s,this.m_localPoint,$i),c=this.m_proxyA.GetVertex(t),u=T.MultiplyVec2(o,c,Ki);return n.Dot(n.Subtract(u,a,n.s_t0),l)}default:return N(!1),0}}},ev=new ii,iv=new Di,rv=new Mi,ov=new Ri,sv=new id,nv=[0],lv=[0],av=new ie,cv=new ie;function za(i,t){let e=ev.Reset();++rt.calls,i.state=0,i.t=t.tMax;let{proxyA:r,proxyB:o,tMax:s}=t,l=Math.max(Kt,r.m_count,o.m_count),a=av.Copy(t.sweepA),c=cv.Copy(t.sweepB);a.Normalize(),c.Normalize();let u=r.m_radius+o.m_radius,m=Math.max(Z,u-3*Z),p=.25*Z,d=0,h=20,f=0,b=iv;b.count=0;let x=rv;for(x.proxyA.Copy(t.proxyA),x.proxyB.Copy(t.proxyB),x.useRadii=!1;;){let y=a.GetTransform(Ja,d),g=c.GetTransform(ja,d);x.transformA.Copy(y),x.transformB.Copy(g);let S=ov;if(Mr(S,b,x),S.distance<=0){i.state=2,i.t=0;break}if(S.distance<m+p){i.state=3,i.t=d;break}let w=sv;w.Initialize(b,r,a,o,c,d);let B=!1,C=s,A=0;for(;;){let k=nv,M=lv,E=w.FindMinSeparation(k,M,C);if(E>m+p){i.state=4,i.t=s,B=!0;break}if(E>m-p){d=C;break}let L=w.Evaluate(k[0],M[0],d);if(L<m-p){i.state=1,i.t=d,B=!0;break}if(L<=m+p){i.state=3,i.t=d,B=!0;break}let U=0,Y=d,O=C;for(;;){let K;U&1?K=Y+(m-L)*(O-Y)/(E-L):K=.5*(Y+O),++U,++rt.rootIters;let ut=w.Evaluate(k[0],M[0],K);if(Math.abs(ut-m)<p){C=K;break}if(ut>m?(Y=K,L=ut):(O=K,E=ut),U===50)break}if(rt.maxRootIters=Math.max(rt.maxRootIters,U),++A,A===l)break}if(++f,++rt.iters,B)break;if(f===h){i.state=1,i.t=d;break}}rt.maxIters=Math.max(rt.maxIters,f);let _=e.GetMilliseconds();rt.maxTime=Math.max(rt.maxTime,_),rt.time+=_}var uv=new n,mv=new n;function a0(i,t,e,r,o){i.pointCount=0;let s=T.MultiplyVec2(e,t.m_p,uv),l=T.MultiplyVec2(o,r.m_p,mv),a=n.DistanceSquared(s,l),c=t.m_radius+r.m_radius;a>c*c||(i.type=0,i.localPoint.Copy(t.m_p),i.localNormal.SetZero(),i.pointCount=1,i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0)}var pv=new n,dv=new n,hv=new n;function c0(i,t,e,r,o){i.pointCount=0;let s=T.MultiplyVec2(o,r.m_p,pv),l=T.TransposeMultiplyVec2(e,s,dv),a=0,c=-$,u=t.m_radius+r.m_radius,m=t.m_count,p=t.m_vertices,d=t.m_normals;for(let g=0;g<m;++g){let S=n.Dot(d[g],n.Subtract(l,p[g],n.s_t0));if(S>u)return;S>c&&(c=S,a=g)}let h=a,f=h+1<m?h+1:0,b=p[h],x=p[f];if(c<gt){i.pointCount=1,i.type=1,i.localNormal.Copy(d[a]),n.Mid(b,x,i.localPoint),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0;return}let _=n.Dot(n.Subtract(l,b,n.s_t0),n.Subtract(x,b,n.s_t1)),y=n.Dot(n.Subtract(l,x,n.s_t0),n.Subtract(b,x,n.s_t1));if(_<=0){if(n.DistanceSquared(l,b)>u*u)return;i.pointCount=1,i.type=1,n.Subtract(l,b,i.localNormal).Normalize(),i.localPoint.Copy(b),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}else if(y<=0){if(n.DistanceSquared(l,x)>u*u)return;i.pointCount=1,i.type=1,n.Subtract(l,x,i.localNormal).Normalize(),i.localPoint.Copy(x),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}else{let g=n.Mid(b,x,hv);if(n.Dot(n.Subtract(l,g,n.s_t1),d[h])>u)return;i.pointCount=1,i.type=1,i.localNormal.Copy(d[h]),i.localPoint.Copy(g),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}}var bv=new T,_v=new n,yv=new n;function u0(i,t,e,r,o){let s=t.m_count,l=r.m_count,a=t.m_normals,c=t.m_vertices,u=r.m_vertices,m=T.TransposeMultiply(o,e,bv),p=0,d=-$;for(let h=0;h<s;++h){let f=D.MultiplyVec2(m.q,a[h],_v),b=T.MultiplyVec2(m,c[h],yv),x=$;for(let _=0;_<l;++_){let y=n.Dot(f,n.Subtract(u[_],b,n.s_t0));y<x&&(x=y)}x>d&&(d=x,p=h)}return i[0]=p,d}var xv=new n;function gv(i,t,e,r,o,s){let l=t.m_normals,a=o.m_count,c=o.m_vertices,u=o.m_normals,m=D.TransposeMultiplyVec2(s.q,D.MultiplyVec2(e.q,l[r],n.s_t0),xv),p=0,d=$;for(let g=0;g<a;++g){let S=n.Dot(m,u[g]);S<d&&(d=S,p=g)}let h=p,f=h+1<a?h+1:0,b=i[0];T.MultiplyVec2(s,c[h],b.v);let x=b.id.cf;x.indexA=r,x.indexB=h,x.typeA=1,x.typeB=0;let _=i[1];T.MultiplyVec2(s,c[f],_.v);let y=_.id.cf;y.indexA=r,y.indexB=f,y.typeA=1,y.typeB=0}var Sv=[new pe,new pe],wv=[new pe,new pe],vv=[new pe,new pe],Bv=[0],Cv=[0],Av=new n,Tv=new n,Pv=new n,Dv=new n,Mv=new n,Rv=new n,kv=new n,Fv=new n;function Xa(i,t,e,r,o){i.pointCount=0;let s=t.m_radius+r.m_radius,l=Bv,a=u0(l,t,e,r,o);if(a>s)return;let c=Cv,u=u0(c,r,o,t,e);if(u>s)return;let m,p,d,h,f,b,x=.1*Z;u>a+x?(m=r,p=t,d=o,h=e,f=c[0],i.type=2,b=1):(m=t,p=r,d=e,h=o,f=l[0],i.type=1,b=0);let _=Sv;gv(_,m,d,f,p,h);let y=m.m_count,g=m.m_vertices,S=f,w=f+1<y?f+1:0,B=g[S],C=g[w],A=n.Subtract(C,B,Av);A.Normalize();let k=n.CrossVec2One(A,Tv),M=n.Mid(B,C,Pv),E=D.MultiplyVec2(d.q,A,Mv),L=n.CrossVec2One(E,Dv);B=T.MultiplyVec2(d,B,kv),C=T.MultiplyVec2(d,C,Fv);let U=n.Dot(L,B),Y=-n.Dot(E,B)+s,O=n.Dot(E,C)+s,K=wv,ut=vv,lt=n.Negate(E,Rv),Tt=$o(K,_,lt,Y,S);if(Tt<2||(Tt=$o(ut,K,E,O,w),Tt<2))return;i.localNormal.Copy(k),i.localPoint.Copy(M);let Vt=0;for(let wt=0;wt<Nt;++wt){let Be=ut[wt];if(n.Dot(L,Be.v)-U<=s){let ni=i.points[Vt];if(T.TransposeMultiplyVec2(h,Be.v,ni.localPoint),ni.id.Copy(Be.id),b){let{cf:Ht}=ni.id;Ht.indexA=Ht.indexB,Ht.indexB=Ht.indexA,Ht.typeA=Ht.typeB,Ht.typeB=Ht.typeA}++Vt}}i.pointCount=Vt}var Iv=new n,Lv=new n,od=new n,Gv=new n,Vv=new n,Ev=new n,Uv=new n,Yv=new Ko;function Oa(i,t,e,r,o){i.pointCount=0;let s=T.TransposeMultiplyVec2(e,T.MultiplyVec2(o,r.m_p,n.s_t0),Iv),l=t.m_vertex1,a=t.m_vertex2,c=n.Subtract(a,l,Lv),u=Uv.Set(c.y,-c.x),m=n.Dot(u,n.Subtract(s,l,n.s_t0));if(t.m_oneSided&&m<0)return;let d=n.Dot(c,n.Subtract(a,s,n.s_t0)),h=n.Dot(c,n.Subtract(s,l,n.s_t0)),f=t.m_radius+r.m_radius,b=Yv;if(b.cf.indexB=0,b.cf.typeB=0,h<=0){let S=l,w=n.Subtract(s,S,od);if(n.Dot(w,w)>f*f)return;if(t.m_oneSided){let C=t.m_vertex0,A=l,k=n.Subtract(A,C,Gv);if(n.Dot(k,n.Subtract(A,s,n.s_t0))>0)return}b.cf.indexA=0,b.cf.typeA=0,i.pointCount=1,i.type=0,i.localNormal.SetZero(),i.localPoint.Copy(S),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p);return}if(d<=0){let S=a,w=n.Subtract(s,S,od);if(n.Dot(w,w)>f*f)return;if(t.m_oneSided){let C=t.m_vertex3,A=a,k=n.Subtract(C,A,Vv);if(n.Dot(k,n.Subtract(s,A,n.s_t0))>0)return}b.cf.indexA=1,b.cf.typeA=0,i.pointCount=1,i.type=0,i.localNormal.SetZero(),i.localPoint.Copy(S),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p);return}let x=n.Dot(c,c),_=Ev;_.x=1/x*(d*l.x+h*a.x),_.y=1/x*(d*l.y+h*a.y);let y=n.Subtract(s,_,od);n.Dot(y,y)>f*f||(m<0&&u.Set(-u.x,-u.y),u.Normalize(),b.cf.indexA=0,b.cf.typeA=1,i.pointCount=1,i.type=1,i.localNormal.Copy(u),i.localPoint.Copy(l),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p))}var Ha=class{constructor(){this.normal=new n;this.type=0;this.index=0;this.separation=0}},sd=class{constructor(){this.vertices=H(Kt,n);this.normals=H(Kt,n);this.count=0}},nd=class{constructor(){this.i1=0;this.i2=0;this.v1=new n;this.v2=new n;this.normal=new n;this.sideNormal1=new n;this.sideOffset1=0;this.sideNormal2=new n;this.sideOffset2=0}},Jv=new Ha,jv=[new n,new n];function zv(i,t,e){let r=Jv;r.type=1,r.index=-1,r.separation=-$,r.normal.SetZero();let o=jv;o[0].Copy(e),n.Negate(e,o[1]);for(let s=0;s<2;++s){let l=$;for(let a=0;a<i.count;++a){let c=n.Dot(o[s],n.Subtract(i.vertices[a],t,n.s_t0));c<l&&(l=c)}l>r.separation&&(r.index=s,r.separation=l,r.normal.Copy(o[s]))}return r}var Xv=new Ha,Hv=new n;function Ov(i,t,e){let r=Xv;r.type=0,r.index=-1,r.separation=-$,r.normal.SetZero();for(let o=0;o<i.count;++o){let s=n.Negate(i.normals[o],Hv),l=n.Dot(s,n.Subtract(i.vertices[o],t,n.s_t0)),a=n.Dot(s,n.Subtract(i.vertices[o],e,n.s_t0)),c=Math.min(l,a);c>r.separation&&(r.type=2,r.index=o,r.separation=c,r.normal.Copy(s))}return r}var Nv=new T,Zv=new n,Qv=new n,qv=new n,Wv=new n,Kv=new n,$v=new n,t1=new n,e1=new sd,i1=new nd,r1=[new pe,new pe],o1=[new pe,new pe],s1=[new pe,new pe];function Na(i,t,e,r,o){i.pointCount=0;let s=T.TransposeMultiply(e,o,Nv),l=T.MultiplyVec2(s,r.m_centroid,Zv),a=t.m_vertex1,c=t.m_vertex2,u=n.Subtract(c,a,Qv);u.Normalize();let m=qv.Set(u.y,-u.x),p=n.Dot(m,n.Subtract(l,a,n.s_t0)),d=t.m_oneSided;if(d&&p<0)return;let h=e1;h.count=r.m_count;for(let M=0;M<r.m_count;++M)T.MultiplyVec2(s,r.m_vertices[M],h.vertices[M]),D.MultiplyVec2(s.q,r.m_normals[M],h.normals[M]);let f=r.m_radius+t.m_radius,b=zv(h,a,m);if(b.separation>f)return;let x=Ov(h,a,c);if(x.separation>f)return;let _=.98,y=.001,g;if(x.separation-f>_*(b.separation-f)+y?g=x:g=b,d){let M=n.Subtract(a,t.m_vertex0,Wv);M.Normalize();let E=Kv.Set(M.y,-M.x),L=n.Cross(M,u)>=0,U=n.Subtract(t.m_vertex3,c,$v);U.Normalize();let Y=t1.Set(U.y,-U.x),O=n.Cross(u,U)>=0,K=.1;if(n.Dot(g.normal,u)<=0)if(L){if(n.Cross(g.normal,E)>K)return}else g=b;else if(O){if(n.Cross(Y,g.normal)>K)return}else g=b}let S=r1,w=i1;if(g.type===1){i.type=1;let M=0,E=n.Dot(g.normal,h.normals[0]);for(let Y=1;Y<h.count;++Y){let O=n.Dot(g.normal,h.normals[Y]);O<E&&(E=O,M=Y)}let L=M,U=L+1<h.count?L+1:0;S[0].v.Copy(h.vertices[L]),S[0].id.cf.indexA=0,S[0].id.cf.indexB=L,S[0].id.cf.typeA=1,S[0].id.cf.typeB=0,S[1].v.Copy(h.vertices[U]),S[1].id.cf.indexA=0,S[1].id.cf.indexB=U,S[1].id.cf.typeA=1,S[1].id.cf.typeB=0,w.i1=0,w.i2=1,w.v1.Copy(a),w.v2.Copy(c),w.normal.Copy(g.normal),n.Negate(u,w.sideNormal1),w.sideNormal2.Copy(u)}else i.type=2,S[0].v.Copy(c),S[0].id.cf.indexA=1,S[0].id.cf.indexB=g.index,S[0].id.cf.typeA=0,S[0].id.cf.typeB=1,S[1].v.Copy(a),S[1].id.cf.indexA=0,S[1].id.cf.indexB=g.index,S[1].id.cf.typeA=0,S[1].id.cf.typeB=1,w.i1=g.index,w.i2=w.i1+1<h.count?w.i1+1:0,w.v1.Copy(h.vertices[w.i1]),w.v2.Copy(h.vertices[w.i2]),w.normal.Copy(h.normals[w.i1]),w.sideNormal1.Set(w.normal.y,-w.normal.x),n.Negate(w.sideNormal1,w.sideNormal2);w.sideOffset1=n.Dot(w.sideNormal1,w.v1),w.sideOffset2=n.Dot(w.sideNormal2,w.v2);let B=o1,C=s1,A;if(A=$o(B,S,w.sideNormal1,w.sideOffset1,w.i1),A<Nt||(A=$o(C,B,w.sideNormal2,w.sideOffset2,w.i2),A<Nt))return;g.type===1?(i.localNormal.Copy(w.normal),i.localPoint.Copy(w.v1)):(i.localNormal.Copy(r.m_normals[w.i1]),i.localPoint.Copy(r.m_vertices[w.i1]));let k=0;for(let M=0;M<Nt;++M)if(n.Dot(w.normal,n.Subtract(C[M].v,w.v1,n.s_t0))<=f){let L=i.points[k];g.type===1?(T.TransposeMultiplyVec2(s,C[M].v,L.localPoint),L.id.Copy(C[M].id)):(L.localPoint.Copy(C[M].v),L.id.cf.typeA=C[M].id.cf.typeB,L.id.cf.typeB=C[M].id.cf.typeA,L.id.cf.indexA=C[M].id.cf.indexB,L.id.cf.indexB=C[M].id.cf.indexA),++k}i.pointCount=k}var V=class i extends ei{constructor(e=0){super(0,e);this.m_p=new n}Set(e,r=this.m_radius){return this.m_p.Copy(e),this.m_radius=r,this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.m_p.Copy(e.m_p),this}GetChildCount(){return 1}static{this.TestPoint_s_center=new n}static{this.TestPoint_s_d=new n}TestPoint(e,r){let o=T.MultiplyVec2(e,this.m_p,i.TestPoint_s_center),s=n.Subtract(r,o,i.TestPoint_s_d);return n.Dot(s,s)<=this.m_radius**2}static{this.RayCast_s_position=new n}static{this.RayCast_s_s=new n}static{this.RayCast_s_r=new n}RayCast(e,r,o,s){let l=T.MultiplyVec2(o,this.m_p,i.RayCast_s_position),a=n.Subtract(r.p1,l,i.RayCast_s_s),c=n.Dot(a,a)-this.m_radius**2,u=n.Subtract(r.p2,r.p1,i.RayCast_s_r),m=n.Dot(a,u),p=n.Dot(u,u),d=m*m-p*c;if(d<0||p<gt)return!1;let h=-(m+Math.sqrt(d));return h>=0&&h<=r.maxFraction*p?(h/=p,e.fraction=h,n.AddScaled(a,h,u,e.normal).Normalize(),!0):!1}static{this.ComputeAABB_s_p=new n}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_p,i.ComputeAABB_s_p);e.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),e.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}ComputeMass(e,r){let o=this.m_radius**2;e.mass=r*Math.PI*o,e.center.Copy(this.m_p),e.I=e.mass*(.5*o+n.Dot(this.m_p,this.m_p))}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_p,e.m_count=1,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_p,s=this.m_radius,l=n.UNITX;e.DrawSolidCircle(o,s,l,r)}};var yi={ComputeCentroid:{s:new n,p1:new n,p2:new n,p3:new n,e1:new n,e2:new n},TestPoint:{pLocal:new n},ComputeAABB:{v:new n},ComputeMass:{center:new n,s:new n,e1:new n,e2:new n},Validate:{e:new n,v:new n},Set:{r:new n,v:new n},RayCast:{p1:new n,p2:new n,d:new n},SetAsBox:{xf:new T}};function n1(i,t,e){let r=e;r.SetZero();let o=0,{s,p1:l,p2:a,p3:c,e1:u,e2:m}=yi.ComputeCentroid;s.Copy(i[0]);let p=1/3;for(let h=0;h<t;++h){n.Subtract(i[0],s,l),n.Subtract(i[h],s,a),n.Subtract(i[h+1<t?h+1:0],s,c),n.Subtract(a,l,u),n.Subtract(c,l,m);let b=.5*n.Cross(u,m);o+=b,r.x+=b*p*(l.x+a.x+c.x),r.y+=b*p*(l.y+a.y+c.y)}let d=1/o;return r.x=d*r.x+s.x,r.y=d*r.y+s.y,r}var l1=new n,v=class i extends ei{constructor(){super(2,Me);this.m_centroid=new n;this.m_vertices=[];this.m_normals=[];this.m_count=0}Clone(){return new i().Copy(this)}Copy(e){super.Copy(e),this.m_centroid.Copy(e.m_centroid),this.m_count=e.m_count,this.m_vertices=H(this.m_count,n),this.m_normals=H(this.m_count,n);for(let r=0;r<this.m_count;++r)this.m_vertices[r].Copy(e.m_vertices[r]),this.m_normals[r].Copy(e.m_normals[r]);return this}GetChildCount(){return 1}Set(e,r=e.length){let o=An(e,r);return o.length<3?!1:(this.SetHull(o,o.length),!0)}SetHull(e,r){N(r>=3),this.m_count=r,this.m_vertices=H(r,n);for(let o=0;o<r;++o)this.m_vertices[o].Copy(e[o]);this.m_normals=H(r,n);for(let o=0;o<this.m_count;++o){let s=o,l=o+1<this.m_count?o+1:0,a=n.Subtract(this.m_vertices[l],this.m_vertices[s],l1);n.CrossVec2Scalar(a,1,this.m_normals[o]),this.m_normals[o].Normalize()}return n1(this.m_vertices,this.m_count,this.m_centroid),this}SetAsBox(e,r,o,s=0){if(this.m_count=4,this.m_vertices=H(this.m_count,n),this.m_normals=H(this.m_count,n),this.m_vertices[0].Set(-e,-r),this.m_vertices[1].Set(e,-r),this.m_vertices[2].Set(e,r),this.m_vertices[3].Set(-e,r),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),o){this.m_centroid.Copy(o);let{xf:l}=yi.SetAsBox;l.SetPosition(o),l.SetRotationAngle(s);for(let a=0;a<this.m_count;++a)T.MultiplyVec2(l,this.m_vertices[a],this.m_vertices[a]),D.MultiplyVec2(l.q,this.m_normals[a],this.m_normals[a])}else this.m_centroid.SetZero();return this}TestPoint(e,r){let o=T.TransposeMultiplyVec2(e,r,yi.TestPoint.pLocal);for(let s=0;s<this.m_count;++s)if(n.Dot(this.m_normals[s],n.Subtract(o,this.m_vertices[s],n.s_t0))>0)return!1;return!0}RayCast(e,r,o,s){let l=T.TransposeMultiplyVec2(o,r.p1,yi.RayCast.p1),a=T.TransposeMultiplyVec2(o,r.p2,yi.RayCast.p2),c=n.Subtract(a,l,yi.RayCast.d),u=0,m=r.maxFraction,p=-1;for(let d=0;d<this.m_count;++d){let h=n.Dot(this.m_normals[d],n.Subtract(this.m_vertices[d],l,n.s_t0)),f=n.Dot(this.m_normals[d],c);if(f===0){if(h<0)return!1}else f<0&&h<u*f?(u=h/f,p=d):f>0&&h<m*f&&(m=h/f);if(m<u)return!1}return p>=0?(e.fraction=u,D.MultiplyVec2(o.q,this.m_normals[p],e.normal),!0):!1}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_vertices[0],e.lowerBound),l=e.upperBound.Copy(s);for(let c=1;c<this.m_count;++c){let u=T.MultiplyVec2(r,this.m_vertices[c],yi.ComputeAABB.v);n.Min(s,u,s),n.Max(l,u,l)}let a=this.m_radius;s.SubtractXY(a,a),l.AddXY(a,a)}ComputeMass(e,r){let o=yi.ComputeMass.center.SetZero(),s=0,l=0,a=yi.ComputeMass.s.Copy(this.m_vertices[0]),c=1/3;for(let u=0;u<this.m_count;++u){let m=n.Subtract(this.m_vertices[u],a,yi.ComputeMass.e1),p=n.Subtract(this.m_vertices[u+1<this.m_count?u+1:0],a,yi.ComputeMass.e2),d=n.Cross(m,p),h=.5*d;s+=h,o.AddScaled(h*c,n.Add(m,p,n.s_t0));let f=m.x,b=m.y,x=p.x,_=p.y,y=f*f+x*f+x*x,g=b*b+_*b+_*_;l+=.25*c*d*(y+g)}e.mass=r*s,o.Scale(1/s),n.Add(o,a,e.center),e.I=r*l,e.I+=e.mass*(n.Dot(e.center,e.center)-n.Dot(o,o))}Validate(){return this.m_count<3||Kt<this.m_count?!1:Tn(this.m_vertices,this.m_count)}SetupDistanceProxy(e,r){e.m_vertices=this.m_vertices,e.m_count=this.m_count,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_count,s=this.m_vertices;e.DrawSolidPolygon(s,o,r)}};var I=class i extends ei{constructor(){super(1,Me);this.m_vertex1=new n;this.m_vertex2=new n;this.m_vertex0=new n;this.m_vertex3=new n;this.m_oneSided=!1}SetOneSided(e,r,o,s){return this.m_vertex0.Copy(e),this.m_vertex1.Copy(r),this.m_vertex2.Copy(o),this.m_vertex3.Copy(s),this.m_oneSided=!0,this}SetTwoSided(e,r){return this.m_vertex1.Copy(e),this.m_vertex2.Copy(r),this.m_oneSided=!1,this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.m_vertex1.Copy(e.m_vertex1),this.m_vertex2.Copy(e.m_vertex2),this.m_vertex0.Copy(e.m_vertex0),this.m_vertex3.Copy(e.m_vertex3),this.m_oneSided=e.m_oneSided,this}GetChildCount(){return 1}TestPoint(e,r){return!1}static{this.RayCast_s_p1=new n}static{this.RayCast_s_p2=new n}static{this.RayCast_s_d=new n}static{this.RayCast_s_e=new n}static{this.RayCast_s_q=new n}static{this.RayCast_s_r=new n}RayCast(e,r,o,s){let l=T.TransposeMultiplyVec2(o,r.p1,i.RayCast_s_p1),a=T.TransposeMultiplyVec2(o,r.p2,i.RayCast_s_p2),c=n.Subtract(a,l,i.RayCast_s_d),u=this.m_vertex1,m=this.m_vertex2,p=n.Subtract(m,u,i.RayCast_s_e),{normal:d}=e;d.Set(p.y,-p.x).Normalize();let h=n.Dot(d,n.Subtract(u,l,n.s_t0));if(this.m_oneSided&&h>0)return!1;let f=n.Dot(d,c);if(f===0)return!1;let b=h/f;if(b<0||r.maxFraction<b)return!1;let x=n.AddScaled(l,b,c,i.RayCast_s_q),_=n.Subtract(m,u,i.RayCast_s_r),y=n.Dot(_,_);if(y===0)return!1;let g=n.Dot(n.Subtract(x,u,n.s_t0),_)/y;return g<0||g>1?!1:(e.fraction=b,D.MultiplyVec2(o.q,e.normal,e.normal),h>0&&e.normal.Negate(),!0)}static{this.ComputeAABB_s_v1=new n}static{this.ComputeAABB_s_v2=new n}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_vertex1,i.ComputeAABB_s_v1),l=T.MultiplyVec2(r,this.m_vertex2,i.ComputeAABB_s_v2);n.Min(s,l,e.lowerBound),n.Max(s,l,e.upperBound);let a=this.m_radius;e.lowerBound.SubtractXY(a,a),e.upperBound.AddXY(a,a)}ComputeMass(e,r){e.mass=0,n.Mid(this.m_vertex1,this.m_vertex2,e.center),e.I=0}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_count=2,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_vertex1,s=this.m_vertex2;e.DrawSegment(o,s,r),this.m_oneSided===!1&&(e.DrawPoint(o,4,r),e.DrawPoint(s,4,r))}};var dt=class i extends ei{constructor(){super(3,Me);this.m_vertices=[];this.m_prevVertex=new n;this.m_nextVertex=new n}CreateLoop(e,r=e.length){if(r<3)return this;this.m_vertices.length=r+1;for(let o=0;o<r;++o){let{x:s,y:l}=e[o];this.m_vertices[o]=new n(s,l)}return this.m_vertices[r]=this.m_vertices[0].Clone(),this.m_prevVertex.Copy(this.m_vertices[this.m_vertices.length-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}CreateChain(e,r,o,s){this.m_vertices.length=r;for(let l=0;l<r;++l){let{x:a,y:c}=e[l];this.m_vertices[l]=new n(a,c)}return this.m_prevVertex.Copy(o),this.m_nextVertex.Copy(s),this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.CreateChain(e.m_vertices,e.m_vertices.length,e.m_prevVertex,e.m_nextVertex)}GetChildCount(){return this.m_vertices.length-1}GetChildEdge(e,r){e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[r]),e.m_vertex2.Copy(this.m_vertices[r+1]),e.m_oneSided=!0,r>0?e.m_vertex0.Copy(this.m_vertices[r-1]):e.m_vertex0.Copy(this.m_prevVertex),r<this.m_vertices.length-2?e.m_vertex3.Copy(this.m_vertices[r+2]):e.m_vertex3.Copy(this.m_nextVertex)}TestPoint(e,r){return!1}static{this.RayCast_s_edgeShape=new I}RayCast(e,r,o,s){let l=i.RayCast_s_edgeShape,a=s,c=s+1;return c===this.m_vertices.length&&(c=0),l.m_vertex1.Copy(this.m_vertices[a]),l.m_vertex2.Copy(this.m_vertices[c]),l.RayCast(e,r,o,0)}static{this.ComputeAABB_s_v1=new n}static{this.ComputeAABB_s_v2=new n}static{this.ComputeAABB_s_lower=new n}static{this.ComputeAABB_s_upper=new n}ComputeAABB(e,r,o){let s=o,l=o+1;l===this.m_vertices.length&&(l=0);let a=T.MultiplyVec2(r,this.m_vertices[s],i.ComputeAABB_s_v1),c=T.MultiplyVec2(r,this.m_vertices[l],i.ComputeAABB_s_v2),u=n.Min(a,c,i.ComputeAABB_s_lower),m=n.Max(a,c,i.ComputeAABB_s_upper);e.lowerBound.x=u.x-this.m_radius,e.lowerBound.y=u.y-this.m_radius,e.upperBound.x=m.x+this.m_radius,e.upperBound.y=m.y+this.m_radius}ComputeMass(e,r){e.mass=0,e.center.SetZero(),e.I=0}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_vertices[r];let o=r+1<this.m_vertices.length?r+1:0;e.m_vertices[1]=this.m_vertices[o],e.m_count=2,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_vertices,s=o[0];for(let l=1;l<o.length;++l){let a=o[l];e.DrawSegment(s,a,r),s=a}}};var m0={pA:new n,pB:new n};var Za=class{constructor(t,e){this.prev=null;this.next=null;this.joint=t,this.other=e}},Dt=class{constructor(t){this.userData={};this.collideConnected=!1;this.type=t}};function Ct(i,t,e,r,o){let s=r.GetMass(),l=o.GetMass(),a;s>0&&l>0?a=s*l/(s+l):s>0?a=s:a=l;let c=2*Math.PI*t;i.stiffness=a*c*c,i.damping=2*a*e*c}function ld(i,t,e,r,o){let s=r.GetInertia(),l=o.GetInertia(),a;s>0&&l>0?a=s*l/(s+l):s>0?a=s:a=l;let c=2*Math.PI*t;i.stiffness=a*c*c,i.damping=2*a*e*c}var Mt=class{constructor(t){this.m_type=0;this.m_prev=null;this.m_next=null;this.m_islandFlag=!1;this.m_collideConnected=!1;this.m_userData={};this.m_type=t.type,this.m_edgeA=new Za(this,t.bodyB),this.m_edgeB=new Za(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected??!1,this.SetUserData(t.userData)}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}ShiftOrigin(t){}Draw(t){let e=this.m_bodyA.GetTransform().p,r=this.m_bodyB.GetTransform().p,o=this.GetAnchorA(m0.pA),s=this.GetAnchorB(m0.pB);t.DrawSegment(e,o,Q.joint6),t.DrawSegment(o,s,Q.joint6),t.DrawSegment(r,s,Q.joint6)}};var Rt={worldPointA:new n,worldPointB:new n,vpA:new n,vpB:new n,vpBA:new n,P:new n,qA:new D,qB:new D,lalcA:new n,lalcB:new n,Draw:{pA:new n,pB:new n,axis:new n,pRest:new n,p1:new n,p2:new n}},ke=class extends Dt{constructor(){super(3);this.localAnchorA=new n;this.localAnchorB=new n;this.length=1;this.minLength=0;this.maxLength=$;this.stiffness=0;this.damping=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=Math.max(n.Distance(o,s),Z),this.minLength=this.length,this.maxLength=this.length}},Qa=class extends Mt{constructor(e){super(e);this.m_bias=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_gamma=0;this.m_impulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_indexA=0;this.m_indexB=0;this.m_u=new n;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_currentLength=0;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_softMass=0;this.m_mass=0;this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_length=Math.max(e.length,Z),this.m_minLength=Math.max(e.minLength,Z),this.m_maxLength=Math.max(e.maxLength,this.m_minLength),this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=e*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse);return r.x=o*this.m_u.x,r.y=o*this.m_u.y,r}GetReactionTorque(e){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(e){return this.m_impulse=0,this.m_length=Math.max(Z,e),this.m_length}GetLength(){return this.m_length}SetMinLength(e){return this.m_lowerImpulse=0,this.m_minLength=tt(e,Z,this.m_maxLength),this.m_minLength}GetMinLength(){return this.m_minLength}SetMaxLength(e){return this.m_upperImpulse=0,this.m_maxLength=Math.max(e,this.m_minLength),this.m_maxLength}GetMaxLength(){return this.m_maxLength}GetCurrentLength(){let e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Rt.worldPointA),r=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Rt.worldPointB);return n.Distance(r,e)}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f}=Rt;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),this.m_rA),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),this.m_u.x=a.x+this.m_rB.x-r.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-r.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>Z?this.m_u.Scale(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);let b=n.Cross(this.m_rA,this.m_u),x=n.Cross(this.m_rB,this.m_u),_=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*x*x;if(this.m_mass=_!==0?1/_:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){let y=this.m_currentLength-this.m_length,g=this.m_damping,S=this.m_stiffness,w=e.step.dt;this.m_gamma=w*(g+w*S),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=y*w*S*this.m_gamma,_+=this.m_gamma,this.m_softMass=_!==0?1/_:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let{P:y}=Rt;n.Scale(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,y),s.SubtractScaled(this.m_invMassA,y),l-=this.m_invIA*n.Cross(this.m_rA,y),u.AddScaled(this.m_invMassB,y),m+=this.m_invIB*n.Cross(this.m_rB,y)}else this.m_impulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){let a=n.AddCrossScalarVec2(r,o,this.m_rA,Rt.vpA),c=n.AddCrossScalarVec2(s,l,this.m_rB,Rt.vpB),u=n.Dot(this.m_u,n.Subtract(c,a,Rt.vpBA)),m=-this.m_softMass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;let p=n.Scale(m,this.m_u,Rt.P);r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(this.m_rB,p)}{let a=this.m_currentLength-this.m_minLength,c=Math.max(0,a)*e.step.inv_dt,u=n.AddCrossScalarVec2(r,o,this.m_rA,Rt.vpA),m=n.AddCrossScalarVec2(s,l,this.m_rB,Rt.vpB),p=n.Dot(this.m_u,n.Subtract(m,u,Rt.vpBA)),d=-this.m_mass*(p+c),h=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(0,this.m_lowerImpulse+d),d=this.m_lowerImpulse-h;let f=n.Scale(d,this.m_u,Rt.P);r.SubtractScaled(this.m_invMassA,f),o-=this.m_invIA*n.Cross(this.m_rA,f),s.AddScaled(this.m_invMassB,f),l+=this.m_invIB*n.Cross(this.m_rB,f)}{let a=this.m_maxLength-this.m_currentLength,c=Math.max(0,a)*e.step.inv_dt,u=n.AddCrossScalarVec2(r,o,this.m_rA,Rt.vpA),m=n.AddCrossScalarVec2(s,l,this.m_rB,Rt.vpB),p=n.Dot(this.m_u,n.Subtract(u,m,Rt.vpBA)),d=-this.m_mass*(p+c),h=this.m_upperImpulse;this.m_upperImpulse=Math.max(0,this.m_upperImpulse+d),d=this.m_upperImpulse-h;let f=n.Scale(-d,this.m_u,Rt.P);r.SubtractScaled(this.m_invMassA,f),o-=this.m_invIA*n.Cross(this.m_rA,f),s.AddScaled(this.m_invMassB,f),l+=this.m_invIB*n.Cross(this.m_rB,f)}}else{let a=n.AddCrossScalarVec2(r,o,this.m_rA,Rt.vpA),c=n.AddCrossScalarVec2(s,l,this.m_rB,Rt.vpB),u=n.Dot(this.m_u,n.Subtract(c,a,Rt.vpBA)),m=-this.m_mass*u;this.m_impulse+=m;let p=n.Scale(m,this.m_u,Rt.P);r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(this.m_rB,p)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,P:p}=Rt;a.Set(o),c.Set(l);let d=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),h=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB);this.m_u.x=s.x+h.x-r.x-d.x,this.m_u.y=s.y+h.y-r.y-d.y;let f=this.m_u.Normalize(),b;if(this.m_minLength===this.m_maxLength)b=f-this.m_minLength;else if(f<this.m_minLength)b=f-this.m_minLength;else if(this.m_maxLength<f)b=f-this.m_maxLength;else return!0;let x=-this.m_mass*b;return n.Scale(x,this.m_u,p),r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(d,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(h,p),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,Math.abs(b)<Z}Draw(e){let{pA:r,pB:o,axis:s,pRest:l}=Rt.Draw,a=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();if(T.MultiplyVec2(a,this.m_localAnchorA,r),T.MultiplyVec2(c,this.m_localAnchorB,o),n.Subtract(o,r,s),s.Normalize(),e.DrawSegment(r,o,Q.joint5),n.AddScaled(r,this.m_length,s,l),e.DrawPoint(l,8,Q.joint1),this.m_minLength!==this.m_maxLength){if(this.m_minLength>Z){let u=n.AddScaled(r,this.m_minLength,s,Rt.Draw.p1);e.DrawPoint(u,4,Q.joint2)}if(this.m_maxLength<$){let u=n.AddScaled(r,this.m_maxLength,s,Rt.Draw.p1);e.DrawPoint(u,4,Q.joint3)}}}};var qa=class extends Dt{constructor(){super(11);this.bodies=[];this.stiffness=0;this.damping=0}AddBody(e){this.bodies.push(e),this.bodies.length===1?this.bodyA=e:this.bodies.length===2&&(this.bodyB=e)}},Wa=class extends Mt{constructor(e){super(e);this.m_stiffness=0;this.m_damping=0;this.m_impulse=0;this.m_targetArea=0;this.m_joints=[];this.m_delta=new n;this.m_bodies=e.bodies,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0,this.m_targetLengths=je(e.bodies.length),this.m_normals=H(e.bodies.length,n),this.m_deltas=H(e.bodies.length,n);let r=new ke;r.stiffness=this.m_stiffness,r.damping=this.m_damping,this.m_targetArea=0;for(let o=0;o<this.m_bodies.length;++o){let s=this.m_bodies[o],l=this.m_bodies[(o+1)%this.m_bodies.length],a=s.GetWorldCenter(),c=l.GetWorldCenter();this.m_targetLengths[o]=n.Distance(a,c),this.m_targetArea+=n.Cross(a,c),r.Initialize(s,l,a,c),this.m_joints[o]=s.GetWorld().CreateJoint(r)}this.m_targetArea*=.5}GetAnchorA(e){return e}GetAnchorB(e){return e}GetReactionForce(e,r){return r}GetReactionTorque(e){return 0}SetStiffness(e){this.m_stiffness=e;for(let r of this.m_joints)r.SetStiffness(e)}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e;for(let r of this.m_joints)r.SetDamping(e)}GetDamping(){return this.m_damping}InitVelocityConstraints(e){for(let r=0;r<this.m_bodies.length;++r){let o=this.m_bodies[(r+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(r+1)%this.m_bodies.length],l=e.positions[o.m_islandIndex].c,a=e.positions[s.m_islandIndex].c,c=this.m_deltas[r];n.Subtract(a,l,c)}if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;for(let r=0;r<this.m_bodies.length;++r){let o=this.m_bodies[r],s=e.velocities[o.m_islandIndex].v,l=this.m_deltas[r];s.x+=o.m_invMass*l.y*.5*this.m_impulse,s.y+=o.m_invMass*-l.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(e){let r=0,o=0;for(let l=0;l<this.m_bodies.length;++l){let a=this.m_bodies[l],c=e.velocities[a.m_islandIndex].v,u=this.m_deltas[l];r+=u.LengthSquared()/a.GetMass(),o+=n.Cross(c,u)}let s=-2*o/r;this.m_impulse+=s;for(let l=0;l<this.m_bodies.length;++l){let a=this.m_bodies[l],c=e.velocities[a.m_islandIndex].v,u=this.m_deltas[l];c.x+=a.m_invMass*u.y*.5*s,c.y+=a.m_invMass*-u.x*.5*s}}SolvePositionConstraints(e){let r=0,o=0;for(let c=0;c<this.m_bodies.length;++c){let u=this.m_bodies[c],m=this.m_bodies[(c+1)%this.m_bodies.length],p=e.positions[u.m_islandIndex].c,d=e.positions[m.m_islandIndex].c,h=n.Subtract(d,p,this.m_delta),f=h.Length();f<gt&&(f=1),this.m_normals[c].x=h.y/f,this.m_normals[c].y=-h.x/f,r+=f,o+=n.Cross(p,d)}o*=.5;let l=.5*(this.m_targetArea-o)/r,a=!0;for(let c=0;c<this.m_bodies.length;++c){let u=this.m_bodies[c],m=e.positions[u.m_islandIndex].c,p=(c+1)%this.m_bodies.length,d=n.Add(this.m_normals[c],this.m_normals[p],this.m_delta);d.Scale(l);let h=d.LengthSquared();h>Wo**2&&d.Scale(Wo/Math.sqrt(h)),h>Z**2&&(a=!1),m.Add(d)}return a}};var p0={qA:new D,qB:new D,lalcA:new n,lalcB:new n,Cdot:new n,impulse:new n,oldImpulse:new n},Dn=class extends Dt{constructor(){super(9);this.localAnchorA=new n;this.localAnchorB=new n;this.maxForce=0;this.maxTorque=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB)}},Ka=class extends Mt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_linearImpulse=new n;this.m_angularImpulse=0;this.m_maxForce=0;this.m_maxTorque=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_linearMass=new Lt;this.m_angularMass=0;this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce??0,this.m_maxTorque=e.maxTorque??0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d}=p0;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB,_=this.m_linearMass;if(_.ex.x=h+f+b*this.m_rA.y*this.m_rA.y+x*this.m_rB.y*this.m_rB.y,_.ex.y=-b*this.m_rA.x*this.m_rA.y-x*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=h+f+b*this.m_rA.x*this.m_rA.x+x*this.m_rB.x*this.m_rB.x,_.Inverse(),this.m_angularMass=b+x,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.step.warmStarting){this.m_linearImpulse.Scale(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;let y=this.m_linearImpulse;o.SubtractScaled(h,y),s-=b*(n.Cross(this.m_rA,y)+this.m_angularImpulse),a.AddScaled(f,y),c+=x*(n.Cross(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=e.step.dt;{let d=l-o,h=-this.m_angularMass*d,f=this.m_angularImpulse,b=p*this.m_maxTorque;this.m_angularImpulse=tt(this.m_angularImpulse+h,-b,b),h=this.m_angularImpulse-f,o-=u*h,l+=m*h}{let{Cdot:d,impulse:h,oldImpulse:f}=p0;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),d),Lt.MultiplyVec2(this.m_linearMass,d,h).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(h);let b=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(b)),n.Subtract(this.m_linearImpulse,f,h),r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){return!0}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_linearImpulse.x,r.y=e*this.m_linearImpulse.y,r}GetReactionTorque(e){return e*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetMaxTorque(e){this.m_maxTorque=e}GetMaxTorque(){return this.m_maxTorque}};var ss={qA:new D,qB:new D,qC:new D,qD:new D,lalcA:new n,lalcB:new n,lalcC:new n,lalcD:new n,u:new n,rA:new n,rB:new n,rC:new n,rD:new n,JvAC:new n,JvBD:new n},ns=class extends Dt{constructor(){super(6);this.ratio=1}},$a=class extends Mt{constructor(e){super(e);this.m_typeA=0;this.m_typeB=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localAnchorC=new n;this.m_localAnchorD=new n;this.m_localAxisC=new n;this.m_localAxisD=new n;this.m_referenceAngleA=0;this.m_referenceAngleB=0;this.m_constant=0;this.m_ratio=0;this.m_tolerance=0;this.m_impulse=0;this.m_indexA=0;this.m_indexB=0;this.m_indexC=0;this.m_indexD=0;this.m_lcA=new n;this.m_lcB=new n;this.m_lcC=new n;this.m_lcD=new n;this.m_mA=0;this.m_mB=0;this.m_mC=0;this.m_mD=0;this.m_iA=0;this.m_iB=0;this.m_iC=0;this.m_iD=0;this.m_JvAC=new n;this.m_JvBD=new n;this.m_JwA=0;this.m_JwB=0;this.m_JwC=0;this.m_JwD=0;this.m_mass=0;this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType();let r,o;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();let s=this.m_bodyA.m_xf,l=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,c=this.m_bodyC.m_sweep.a;if(this.m_typeA===1){let h=e.joint1;this.m_localAnchorC.Copy(h.m_localAnchorA),this.m_localAnchorA.Copy(h.m_localAnchorB),this.m_referenceAngleA=h.m_referenceAngle,this.m_localAxisC.SetZero(),r=l-c-this.m_referenceAngleA,this.m_tolerance=fi}else{let h=e.joint1;this.m_localAnchorC.Copy(h.m_localAnchorA),this.m_localAnchorA.Copy(h.m_localAnchorB),this.m_referenceAngleA=h.m_referenceAngle,this.m_localAxisC.Copy(h.m_localXAxisA);let f=this.m_localAnchorC,b=D.TransposeMultiplyVec2(a.q,D.MultiplyVec2(s.q,this.m_localAnchorA,n.s_t0).Add(s.p).Subtract(a.p),n.s_t0);r=n.Dot(b.Subtract(f),this.m_localAxisC),this.m_tolerance=Z}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();let u=this.m_bodyB.m_xf,m=this.m_bodyB.m_sweep.a,p=this.m_bodyD.m_xf,d=this.m_bodyD.m_sweep.a;if(this.m_typeB===1){let h=e.joint2;this.m_localAnchorD.Copy(h.m_localAnchorA),this.m_localAnchorB.Copy(h.m_localAnchorB),this.m_referenceAngleB=h.m_referenceAngle,this.m_localAxisD.SetZero(),o=m-d-this.m_referenceAngleB}else{let h=e.joint2;this.m_localAnchorD.Copy(h.m_localAnchorA),this.m_localAnchorB.Copy(h.m_localAnchorB),this.m_referenceAngleB=h.m_referenceAngle,this.m_localAxisD.Copy(h.m_localXAxisA);let f=this.m_localAnchorD,b=D.TransposeMultiplyVec2(p.q,D.MultiplyVec2(u.q,this.m_localAnchorB,n.s_t0).Add(u.p).Subtract(p.p),n.s_t0);o=n.Dot(b.Subtract(f),this.m_localAxisD)}this.m_ratio=e.ratio??1,this.m_constant=r+this.m_ratio*o,this.m_impulse=0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,u=e.positions[this.m_indexC].a,m=e.velocities[this.m_indexC].v,p=e.velocities[this.m_indexC].w,d=e.positions[this.m_indexD].a,h=e.velocities[this.m_indexD].v,f=e.velocities[this.m_indexD].w,{qA:b,qB:x,qC:_,qD:y}=ss;if(b.Set(r),x.Set(l),_.Set(u),y.Set(d),this.m_mass=0,this.m_typeA===1)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{let{u:g,rC:S,rA:w,lalcA:B,lalcC:C}=ss;D.MultiplyVec2(_,this.m_localAxisC,g),D.MultiplyVec2(_,n.Subtract(this.m_localAnchorC,this.m_lcC,C),S),D.MultiplyVec2(b,n.Subtract(this.m_localAnchorA,this.m_lcA,B),w),this.m_JvAC.Copy(g),this.m_JwC=n.Cross(S,g),this.m_JwA=n.Cross(w,g),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===1)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{let{u:g,rB:S,rD:w,lalcB:B,lalcD:C}=ss;D.MultiplyVec2(y,this.m_localAxisD,g),D.MultiplyVec2(y,n.Subtract(this.m_localAnchorD,this.m_lcD,C),w),D.MultiplyVec2(x,n.Subtract(this.m_localAnchorB,this.m_lcB,B),S),n.Scale(this.m_ratio,g,this.m_JvBD),this.m_JwD=this.m_ratio*n.Cross(w,g),this.m_JwB=this.m_ratio*n.Cross(S,g),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(o.AddScaled(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,a.AddScaled(this.m_mB*this.m_impulse,this.m_JvBD),c+=this.m_iB*this.m_impulse*this.m_JwB,m.SubtractScaled(this.m_mC*this.m_impulse,this.m_JvAC),p-=this.m_iC*this.m_impulse*this.m_JwC,h.SubtractScaled(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c,e.velocities[this.m_indexC].w=p,e.velocities[this.m_indexD].w=f}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=e.velocities[this.m_indexC].v,c=e.velocities[this.m_indexC].w,u=e.velocities[this.m_indexD].v,m=e.velocities[this.m_indexD].w,p=n.Dot(this.m_JvAC,n.Subtract(r,a,n.s_t0))+n.Dot(this.m_JvBD,n.Subtract(s,u,n.s_t0));p+=this.m_JwA*o-this.m_JwC*c+(this.m_JwB*l-this.m_JwD*m);let d=-this.m_mass*p;this.m_impulse+=d,r.AddScaled(this.m_mA*d,this.m_JvAC),o+=this.m_iA*d*this.m_JwA,s.AddScaled(this.m_mB*d,this.m_JvBD),l+=this.m_iB*d*this.m_JwB,a.SubtractScaled(this.m_mC*d,this.m_JvAC),c-=this.m_iC*d*this.m_JwC,u.SubtractScaled(this.m_mD*d,this.m_JvBD),m-=this.m_iD*d*this.m_JwD,e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l,e.velocities[this.m_indexC].w=c,e.velocities[this.m_indexD].w=m}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,a=e.positions[this.m_indexC].c,c=e.positions[this.m_indexC].a,u=e.positions[this.m_indexD].c,m=e.positions[this.m_indexD].a,{qA:p,qB:d,qC:h,qD:f,JvAC:b,JvBD:x}=ss;p.Set(o),d.Set(l),h.Set(c),f.Set(m);let _,y,g,S,w,B,C=0;if(this.m_typeA===1)b.SetZero(),g=1,w=1,C+=this.m_iA+this.m_iC,_=o-c-this.m_referenceAngleA;else{let{u:M,rC:E,rA:L,lalcC:U,lalcA:Y}=ss;D.MultiplyVec2(h,this.m_localAxisC,M),D.MultiplyVec2(h,n.Subtract(this.m_localAnchorC,this.m_lcC,U),E),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_lcA,Y),L),b.Copy(M),w=n.Cross(E,M),g=n.Cross(L,M),C+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*g*g;let O=U,K=D.TransposeMultiplyVec2(h,n.Add(L,r,n.s_t0).Subtract(a),n.s_t0);_=n.Dot(n.Subtract(K,O,n.s_t0),this.m_localAxisC)}if(this.m_typeB===1)x.SetZero(),S=this.m_ratio,B=this.m_ratio,C+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),y=l-m-this.m_referenceAngleB;else{let{u:M,rD:E,rB:L,lalcD:U,lalcB:Y}=ss;D.MultiplyVec2(f,this.m_localAxisD,M),D.MultiplyVec2(f,n.Subtract(this.m_localAnchorD,this.m_lcD,U),E),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_lcB,Y),L),n.Scale(this.m_ratio,M,x),B=this.m_ratio*n.Cross(E,M),S=this.m_ratio*n.Cross(L,M),C+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*B*B+this.m_iB*S*S;let O=U,K=D.TransposeMultiplyVec2(f,n.Add(L,s,n.s_t0).Subtract(u),n.s_t0);y=n.Dot(K.Subtract(O),this.m_localAxisD)}let A=_+this.m_ratio*y-this.m_constant,k=0;return C>0&&(k=-A/C),r.AddScaled(this.m_mA*k,b),o+=this.m_iA*k*g,s.AddScaled(this.m_mB*k,x),l+=this.m_iB*k*S,a.SubtractScaled(this.m_mC*k,b),c-=this.m_iC*k*w,u.SubtractScaled(this.m_mD*k,x),m-=this.m_iD*k*B,e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,e.positions[this.m_indexC].a=c,e.positions[this.m_indexD].a=m,Math.abs(A)<this.m_tolerance}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return n.Scale(e*this.m_impulse,this.m_JvAC,r)}GetReactionTorque(e){return e*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(e){this.m_ratio=e}};var d0={qA:new D,qB:new D,K:new Lt,Cdot:new n,impulse:new n,oldImpulse:new n},ls=class extends Dt{constructor(){super(10);this.linearOffset=new n;this.angularOffset=0;this.maxForce=1;this.maxTorque=1;this.correctionFactor=.3}Initialize(e,r){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(r.GetPosition(),this.linearOffset);let o=e.GetAngle(),s=r.GetAngle();this.angularOffset=s-o}},tc=class extends Mt{constructor(e){super(e);this.m_linearOffset=new n;this.m_linearImpulse=new n;this.m_angularImpulse=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_linearError=new n;this.m_angularError=0;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_linearMass=new Lt;this.m_angularMass=0;this.m_linearOffset.Copy(e.linearOffset??n.ZERO),this.m_angularOffset=e.angularOffset??0,this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce??1,this.m_maxTorque=e.maxTorque??1,this.m_correctionFactor=e.correctionFactor??.3}GetAnchorA(e){let r=this.m_bodyA.GetPosition();return e.x=r.x,e.y=r.y,e}GetAnchorB(e){let r=this.m_bodyB.GetPosition();return e.x=r.x,e.y=r.y,e}GetReactionForce(e,r){return n.Scale(e,this.m_linearImpulse,r)}GetReactionTorque(e){return e*this.m_angularImpulse}SetLinearOffset(e){n.Equals(e,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(e))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(e){e!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=e)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetMaxTorque(e){this.m_maxTorque=e}GetMaxTorque(){return this.m_maxTorque}GetCorrectionFactor(){return this.m_correctionFactor}SetCorrectionFactor(e){this.m_correctionFactor=e}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d}=d0;p.Set(o),d.Set(c);let h=D.MultiplyVec2(p,n.Subtract(this.m_linearOffset,this.m_localCenterA,n.s_t0),this.m_rA),f=D.MultiplyVec2(d,n.Negate(this.m_localCenterB,n.s_t0),this.m_rB),b=this.m_invMassA,x=this.m_invMassB,_=this.m_invIA,y=this.m_invIB,g=this.m_linearMass;if(g.ex.x=b+x+_*h.y*h.y+y*f.y*f.y,g.ex.y=-_*h.x*h.y-y*f.x*f.y,g.ey.x=g.ex.y,g.ey.y=b+x+_*h.x*h.x+y*f.x*f.x,g.Inverse(),this.m_angularMass=_+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),n.Subtract(n.Add(a,f,n.s_t0),n.Add(r,h,n.s_t1),this.m_linearError),this.m_angularError=c-o-this.m_angularOffset,e.step.warmStarting){this.m_linearImpulse.Scale(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;let S=this.m_linearImpulse;s.SubtractScaled(b,S),l-=_*(n.Cross(h,S)+this.m_angularImpulse),u.AddScaled(x,S),m+=y*(n.Cross(f,S)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=e.step.dt,d=e.step.inv_dt;{let h=l-o+d*this.m_correctionFactor*this.m_angularError,f=-this.m_angularMass*h,b=this.m_angularImpulse,x=p*this.m_maxTorque;this.m_angularImpulse=tt(this.m_angularImpulse+f,-x,x),f=this.m_angularImpulse-b,o-=u*f,l+=m*f}{let{impulse:h,oldImpulse:f,Cdot:b}=d0;n.AddScaled(n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),n.s_t2),d*this.m_correctionFactor,this.m_linearError,b),Lt.MultiplyVec2(this.m_linearMass,b,h).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(h);let x=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(x)),n.Subtract(this.m_linearImpulse,f,h),r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){return!0}};var ec={qB:new D,lalcB:new n,Cdot:new n,impulse:new n,oldImpulse:new n,pA:new n,pB:new n},ic=class extends Dt{constructor(){super(5);this.target=new n;this.maxForce=0;this.stiffness=0;this.damping=0}},rc=class extends Mt{constructor(e){super(e);this.m_localAnchorB=new n;this.m_targetA=new n;this.m_stiffness=0;this.m_damping=0;this.m_beta=0;this.m_impulse=new n;this.m_maxForce=0;this.m_gamma=0;this.m_indexB=0;this.m_rB=new n;this.m_localCenterB=new n;this.m_invMassB=0;this.m_invIB=0;this.m_mass=new Lt;this.m_C=new n;this.m_targetA.Copy(e.target??n.ZERO),T.TransposeMultiplyVec2(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=e.maxForce??0,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0,this.m_beta=0,this.m_gamma=0}SetTarget(e){n.Equals(e,this.m_targetA)||(this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(e))}GetTarget(){return this.m_targetA}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexB].c,o=e.positions[this.m_indexB].a,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,{qB:a,lalcB:c}=ec;a.Set(o);let u=this.m_damping,m=this.m_stiffness,p=e.step.dt;this.m_gamma=p*(u+p*m),this.m_gamma!==0&&(this.m_gamma=1/this.m_gamma),this.m_beta=p*m*this.m_gamma,D.MultiplyVec2(a,n.Subtract(this.m_localAnchorB,this.m_localCenterB,c),this.m_rB);let d=this.m_mass;d.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,d.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,d.Inverse(),n.Add(r,this.m_rB,this.m_C).Subtract(this.m_targetA),this.m_C.Scale(this.m_beta),l*=Math.max(0,1-.02*(60*e.step.dt)),e.step.warmStarting?(this.m_impulse.Scale(e.step.dtRatio),s.AddScaled(this.m_invMassB,this.m_impulse),l+=this.m_invIB*n.Cross(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),e.velocities[this.m_indexB].w=l}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,{Cdot:s,impulse:l,oldImpulse:a}=ec;n.AddCrossScalarVec2(r,o,this.m_rB,s),Lt.MultiplyVec2(this.m_mass,n.Add(s,this.m_C,l).AddScaled(this.m_gamma,this.m_impulse).Negate(),l),a.Copy(this.m_impulse),this.m_impulse.Add(l);let c=e.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>c*c&&this.m_impulse.Scale(c/this.m_impulse.Length()),n.Subtract(this.m_impulse,a,l),r.AddScaled(this.m_invMassB,l),o+=this.m_invIB*n.Cross(this.m_rB,l),e.velocities[this.m_indexB].w=o}SolvePositionConstraints(e){return!0}GetAnchorA(e){return e.x=this.m_targetA.x,e.y=this.m_targetA.y,e}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return n.Scale(e,this.m_impulse,r)}GetReactionTorque(e){return 0}ShiftOrigin(e){this.m_targetA.Subtract(e)}Draw(e){let r=this.GetAnchorA(ec.pA),o=this.GetAnchorB(ec.pB);e.DrawPoint(r,4,Q.joint7),e.DrawPoint(o,4,Q.joint7),e.DrawSegment(r,o,Q.joint8)}};var ze={K3:new Qi,K2:new Lt,qA:new D,qB:new D,lalcA:new n,lalcB:new n,rA:new n,rB:new n,GetJointTranslation:{pA:new n,pB:new n,d:new n,axis:new n},InitVelocityConstraints:{d:new n,P:new n},SolveVelocityConstraints:{P:new n,df:new n},SolvePositionConstraints:{d:new n,impulse:new Se,impulse1:new n,P:new n},Draw:{p1:new n,p2:new n,pA:new n,pB:new n,axis:new n,lower:new n,upper:new n,perp:new n}},Zt=class extends Dt{constructor(){super(2);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n(1,0);this.referenceAngle=0;this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},oc=class extends Mt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localXAxisA=new n;this.m_localYAxisA=new n;this.m_referenceAngle=0;this.m_impulse=new n;this.m_motorImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_lowerTranslation=0;this.m_upperTranslation=0;this.m_maxMotorForce=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_enableMotor=!1;this.m_indexA=0;this.m_indexB=0;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_axis=new n;this.m_perp=new n;this.m_s1=0;this.m_s2=0;this.m_a1=0;this.m_a2=0;this.m_K=new Lt;this.m_translation=0;this.m_axialMass=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),n.Normalize(e.localAxisA??n.UNITX,this.m_localXAxisA),n.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=e.referenceAngle??0,this.m_lowerTranslation=e.lowerTranslation??0,this.m_upperTranslation=e.upperTranslation??0,this.m_maxMotorForce=e.maxMotorForce??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableLimit=e.enableLimit??!1,this.m_enableMotor=e.enableMotor??!1}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f,rA:b,rB:x}=ze;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),b),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),x);let _=n.Subtract(a,r,ze.InitVelocityConstraints.d).Add(x).Subtract(b),y=this.m_invMassA,g=this.m_invMassB,S=this.m_invIA,w=this.m_invIB;D.MultiplyVec2(p,this.m_localXAxisA,this.m_axis),this.m_a1=n.Cross(n.Add(_,b,n.s_t0),this.m_axis),this.m_a2=n.Cross(x,this.m_axis),this.m_axialMass=y+g+S*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),D.MultiplyVec2(p,this.m_localYAxisA,this.m_perp),this.m_s1=n.Cross(n.Add(_,b,n.s_t0),this.m_perp),this.m_s2=n.Cross(x,this.m_perp);let B=y+g+S*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,C=S*this.m_s1+w*this.m_s2,A=S+w;if(A===0&&(A=1),this.m_K.ex.Set(B,C),this.m_K.ey.Set(C,A),this.m_enableLimit?this.m_translation=n.Dot(this.m_axis,_):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let k=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:M}=ze.InitVelocityConstraints;n.Scale(this.m_impulse.x,this.m_perp,M).AddScaled(k,this.m_axis);let E=this.m_impulse.x*this.m_s1+this.m_impulse.y+k*this.m_a1,L=this.m_impulse.x*this.m_s2+this.m_impulse.y+k*this.m_a2;s.SubtractScaled(y,M),l-=S*E,u.AddScaled(g,M),m+=w*L}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,{P:p,df:d}=ze.SolveVelocityConstraints;if(this.m_enableMotor){let h=n.Dot(this.m_axis,n.Subtract(s,r,n.s_t0))+this.m_a2*l-this.m_a1*o,f=this.m_axialMass*(this.m_motorSpeed-h),b=this.m_motorImpulse,x=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=tt(this.m_motorImpulse+f,-x,x),f=this.m_motorImpulse-b,n.Scale(f,this.m_axis,p);let _=f*this.m_a1,y=f*this.m_a2;r.SubtractScaled(a,p),o-=u*_,s.AddScaled(c,p),l+=m*y}if(this.m_enableLimit){{let h=this.m_translation-this.m_lowerTranslation,f=n.Dot(this.m_axis,n.Subtract(s,r,n.s_t0))+this.m_a2*l-this.m_a1*o,b=-this.m_axialMass*(f+Math.max(h,0)*e.step.inv_dt),x=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+b,0),b=this.m_lowerImpulse-x,n.Scale(b,this.m_axis,p);let _=b*this.m_a1,y=b*this.m_a2;r.SubtractScaled(a,p),o-=u*_,s.AddScaled(c,p),l+=m*y}{let h=this.m_upperTranslation-this.m_translation,f=n.Dot(this.m_axis,n.Subtract(r,s,n.s_t0))+this.m_a1*o-this.m_a2*l,b=-this.m_axialMass*(f+Math.max(h,0)*e.step.inv_dt),x=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+b,0),b=this.m_upperImpulse-x,n.Scale(b,this.m_axis,p);let _=b*this.m_a1,y=b*this.m_a2;r.AddScaled(a,p),o+=u*_,s.SubtractScaled(c,p),l-=m*y}}{let h=n.Dot(this.m_perp,n.Subtract(s,r,n.s_t0))+this.m_s2*l-this.m_s1*o,f=l-o;this.m_K.Solve(-h,-f,d),this.m_impulse.Add(d),n.Scale(d.x,this.m_perp,p);let b=d.x*this.m_s1+d.y,x=d.x*this.m_s2+d.y;r.SubtractScaled(a,p),o-=u*b,s.AddScaled(c,p),l+=m*x}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,rA:p,rB:d}=ze;a.Set(o),c.Set(l);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB,{d:_,impulse:y,P:g}=ze.SolvePositionConstraints;D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),p),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),d),n.Add(s,d,_).Subtract(r).Subtract(p);let S=D.MultiplyVec2(a,this.m_localXAxisA,this.m_axis),w=n.Cross(n.Add(_,p,n.s_t0),S),B=n.Cross(d,S),C=D.MultiplyVec2(a,this.m_localYAxisA,this.m_perp),A=n.Cross(n.Add(_,p,n.s_t0),C),k=n.Cross(d,C),M=n.Dot(C,_),E=l-o-this.m_referenceAngle,L=Math.abs(M),U=Math.abs(E),Y=!1,O=0;if(this.m_enableLimit){let lt=n.Dot(S,_);Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Z?(O=lt,L=Math.max(L,Math.abs(lt)),Y=!0):lt<=this.m_lowerTranslation?(O=Math.min(lt-this.m_lowerTranslation,0),L=Math.max(L,this.m_lowerTranslation-lt),Y=!0):lt>=this.m_upperTranslation&&(O=Math.max(lt-this.m_upperTranslation,0),L=Math.max(L,lt-this.m_upperTranslation),Y=!0)}if(Y){let lt=h+f+b*A*A+x*k*k,Tt=b*A+x*k,Vt=b*A*w+x*k*B,wt=b+x;wt===0&&(wt=1);let Be=b*w+x*B,Vi=h+f+b*w*w+x*B*B,ni=ze.K3;ni.ex.Set(lt,Tt,Vt),ni.ey.Set(Tt,wt,Be),ni.ez.Set(Vt,Be,Vi),ni.Solve33(-M,-E,-O,y)}else{let lt=h+f+b*A*A+x*k*k,Tt=b*A+x*k,Vt=b+x;Vt===0&&(Vt=1);let wt=ze.K2;wt.ex.Set(lt,Tt),wt.ey.Set(Tt,Vt);let Be=wt.Solve(-M,-E,ze.SolvePositionConstraints.impulse1);y.x=Be.x,y.y=Be.y,y.z=0}n.Scale(y.x,C,g).AddScaled(y.z,S);let K=y.x*A+y.y+y.z*w,ut=y.x*k+y.y+y.z*B;return r.SubtractScaled(h,g),o-=b*K,s.AddScaled(f,g),l+=x*ut,e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,L<=Z&&U<=fi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse;return r.x=e*(this.m_impulse.x*this.m_perp.x+o*this.m_axis.x),r.y=e*(this.m_impulse.x*this.m_perp.y+o*this.m_axis.y),r}GetReactionTorque(e){return e*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){let{pA:e,pB:r,axis:o,d:s}=ze.GetJointTranslation;return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e),this.m_bodyB.GetWorldPoint(this.m_localAnchorB,r),n.Subtract(r,e,s),this.m_bodyA.GetWorldVector(this.m_localXAxisA,o),n.Dot(s,o)}GetJointSpeed(){let e=this.m_bodyA,r=this.m_bodyB,{lalcA:o,lalcB:s,rA:l,rB:a}=ze;D.MultiplyVec2(e.m_xf.q,n.Subtract(this.m_localAnchorA,e.m_sweep.localCenter,o),l),D.MultiplyVec2(r.m_xf.q,n.Subtract(this.m_localAnchorB,r.m_sweep.localCenter,s),a);let c=n.Add(e.m_sweep.c,l,n.s_t0),u=n.Add(r.m_sweep.c,a,n.s_t1),m=n.Subtract(u,c,n.s_t2),p=D.MultiplyVec2(e.m_xf.q,this.m_localXAxisA,this.m_axis),d=e.m_linearVelocity,h=r.m_linearVelocity,f=e.m_angularVelocity,b=r.m_angularVelocity;return n.Dot(m,n.CrossScalarVec2(f,p,n.s_t0))+n.Dot(p,n.Subtract(n.AddCrossScalarVec2(h,b,a,n.s_t0),n.AddCrossScalarVec2(d,f,l,n.s_t1),n.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(e,r){(e!==this.m_lowerTranslation||r!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_lowerImpulse=0,this.m_upperImpulse=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(e){e!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(e){return e*this.m_motorImpulse}Draw(e){let{p1:r,p2:o,pA:s,pB:l,axis:a}=ze.Draw,c=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();if(T.MultiplyVec2(c,this.m_localAnchorA,s),T.MultiplyVec2(u,this.m_localAnchorB,l),D.MultiplyVec2(c.q,this.m_localXAxisA,a),e.DrawSegment(s,l,Q.joint5),this.m_enableLimit){let{lower:m,upper:p,perp:d}=ze.Draw;n.AddScaled(s,this.m_lowerTranslation,a,m),n.AddScaled(s,this.m_upperTranslation,a,p),D.MultiplyVec2(c.q,this.m_localYAxisA,d),e.DrawSegment(m,p,Q.joint1),e.DrawSegment(n.SubtractScaled(m,.5,d,r),n.AddScaled(m,.5,d,o),Q.joint2),e.DrawSegment(n.SubtractScaled(p,.5,d,r),n.AddScaled(p,.5,d,o),Q.joint3)}else e.DrawSegment(n.Subtract(s,a,r),n.Add(s,a,o),Q.joint1);e.DrawPoint(s,5,Q.joint1),e.DrawPoint(l,5,Q.joint4)}};var kr={qA:new D,qB:new D,lalcA:new n,lalcB:new n,p:new n,PA:new n,PB:new n,vpA:new n,vpB:new n,pA:new n,pB:new n},sc=class extends Dt{constructor(){super(4);this.groundAnchorA=new n(-1,1);this.groundAnchorB=new n(1,1);this.localAnchorA=new n(-1,0);this.localAnchorB=new n(1,0);this.lengthA=0;this.lengthB=0;this.ratio=1;this.collideConnected=!0}Initialize(e,r,o,s,l,a,c){this.bodyA=e,this.bodyB=r,this.groundAnchorA.Copy(o),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(l,this.localAnchorA),this.bodyB.GetLocalPoint(a,this.localAnchorB),this.lengthA=n.Distance(l,o),this.lengthB=n.Distance(a,s),this.ratio=c}},a1=new n(-1,1),c1=n.UNITX,u1=new n(-1,0),m1=n.UNITX,nc=class extends Mt{constructor(e){super(e);this.m_groundAnchorA=new n;this.m_groundAnchorB=new n;this.m_lengthA=0;this.m_lengthB=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_constant=0;this.m_ratio=0;this.m_impulse=0;this.m_indexA=0;this.m_indexB=0;this.m_uA=new n;this.m_uB=new n;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_mass=0;this.m_groundAnchorA.Copy(e.groundAnchorA??a1),this.m_groundAnchorB.Copy(e.groundAnchorB??c1),this.m_localAnchorA.Copy(e.localAnchorA??u1),this.m_localAnchorB.Copy(e.localAnchorB??m1),this.m_lengthA=e.lengthA??0,this.m_lengthB=e.lengthB??0,this.m_ratio=e.ratio??1,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f}=kr;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),this.m_rA),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),n.Add(r,this.m_rA,this.m_uA).Subtract(this.m_groundAnchorA),n.Add(a,this.m_rB,this.m_uB).Subtract(this.m_groundAnchorB);let b=this.m_uA.Length(),x=this.m_uB.Length();b>10*Z?this.m_uA.Scale(1/b):this.m_uA.SetZero(),x>10*Z?this.m_uB.Scale(1/x):this.m_uB.SetZero();let _=n.Cross(this.m_rA,this.m_uA),y=n.Cross(this.m_rB,this.m_uB),g=this.m_invMassA+this.m_invIA*_*_,S=this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=g+this.m_ratio*this.m_ratio*S,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.step.warmStarting){this.m_impulse*=e.step.dtRatio;let{PA:w,PB:B}=kr;n.Scale(-this.m_impulse,this.m_uA,w),n.Scale(-this.m_ratio*this.m_impulse,this.m_uB,B),s.AddScaled(this.m_invMassA,w),l+=this.m_invIA*n.Cross(this.m_rA,w),u.AddScaled(this.m_invMassB,B),m+=this.m_invIB*n.Cross(this.m_rB,B)}else this.m_impulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,{PA:a,PB:c,vpA:u,vpB:m}=kr;n.AddCrossScalarVec2(r,o,this.m_rA,u),n.AddCrossScalarVec2(s,l,this.m_rB,m);let p=-n.Dot(this.m_uA,u)-this.m_ratio*n.Dot(this.m_uB,m),d=-this.m_mass*p;this.m_impulse+=d,n.Scale(-d,this.m_uA,a),n.Scale(-this.m_ratio*d,this.m_uB,c),r.AddScaled(this.m_invMassA,a),o+=this.m_invIA*n.Cross(this.m_rA,a),s.AddScaled(this.m_invMassB,c),l+=this.m_invIB*n.Cross(this.m_rB,c),e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,PA:p,PB:d}=kr;a.Set(o),c.Set(l);let h=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),f=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB),b=n.Add(r,h,this.m_uA).Subtract(this.m_groundAnchorA),x=n.Add(s,f,this.m_uB).Subtract(this.m_groundAnchorB),_=b.Length(),y=x.Length();_>10*Z?b.Scale(1/_):b.SetZero(),y>10*Z?x.Scale(1/y):x.SetZero();let g=n.Cross(h,b),S=n.Cross(f,x),w=this.m_invMassA+this.m_invIA*g*g,B=this.m_invMassB+this.m_invIB*S*S,C=w+this.m_ratio*this.m_ratio*B;C>0&&(C=1/C);let A=this.m_constant-_-this.m_ratio*y,k=Math.abs(A),M=-C*A;return n.Scale(-M,b,p),n.Scale(-this.m_ratio*M,x,d),r.AddScaled(this.m_invMassA,p),o+=this.m_invIA*n.Cross(h,p),s.AddScaled(this.m_invMassB,d),l+=this.m_invIB*n.Cross(f,d),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,k<Z}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse*this.m_uB.x,r.y=e*this.m_impulse*this.m_uB.y,r}GetReactionTorque(e){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){let e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,kr.p),r=this.m_groundAnchorA;return n.Distance(e,r)}GetCurrentLengthB(){let e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,kr.p),r=this.m_groundAnchorB;return n.Distance(e,r)}ShiftOrigin(e){this.m_groundAnchorA.Subtract(e),this.m_groundAnchorB.Subtract(e)}Draw(e){let r=this.GetAnchorA(kr.pA),o=this.GetAnchorB(kr.pB),s=this.GetGroundAnchorA(),l=this.GetGroundAnchorB();e.DrawSegment(s,r,Q.joint6),e.DrawSegment(l,o,Q.joint6),e.DrawSegment(s,l,Q.joint6)}};var mo={qA:new D,qB:new D,lalcA:new n,lalcB:new n,P:new n,Cdot:new n,C:new n,impulse:new n,p2:new n,r:new n,pA:new n,pB:new n,rlo:new n,rhi:new n},q=class extends Dt{constructor(){super(1);this.localAnchorA=new n;this.localAnchorB=new n;this.referenceAngle=0;this.enableLimit=!1;this.lowerAngle=0;this.upperAngle=0;this.enableMotor=!1;this.motorSpeed=0;this.maxMotorTorque=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},lc=class extends Mt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_impulse=new n;this.m_motorImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_enableMotor=!1;this.m_maxMotorTorque=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_referenceAngle=0;this.m_lowerAngle=0;this.m_upperAngle=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_K=new Lt;this.m_angle=0;this.m_axialMass=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_referenceAngle=e.referenceAngle??0,this.m_impulse.SetZero(),this.m_lowerAngle=e.lowerAngle??0,this.m_upperAngle=e.upperAngle??0,this.m_maxMotorTorque=e.maxMotorTorque??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableLimit=e.enableLimit??!1,this.m_enableMotor=e.enableMotor??!1}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d}=mo;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB;this.m_K.ex.x=h+f+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*x,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*x,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=h+f+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*x,this.m_axialMass=b+x;let _;if(this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,_=!1):_=!0,this.m_angle=l-r-this.m_referenceAngle,(this.m_enableLimit===!1||_)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(this.m_enableMotor===!1||_)&&(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let y=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,g=mo.P.Set(this.m_impulse.x,this.m_impulse.y);o.SubtractScaled(h,g),s-=b*(n.Cross(this.m_rA,g)+y),a.AddScaled(f,g),c+=x*(n.Cross(this.m_rB,g)+y)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=u+m===0;if(this.m_enableMotor&&!p){let d=l-o-this.m_motorSpeed,h=-this.m_axialMass*d,f=this.m_motorImpulse,b=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=tt(this.m_motorImpulse+h,-b,b),h=this.m_motorImpulse-f,o-=u*h,l+=m*h}if(this.m_enableLimit&&!p){{let d=this.m_angle-this.m_lowerAngle,h=l-o,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-b,o-=u*f,l+=m*f}{let d=this.m_upperAngle-this.m_angle,h=o-l,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-b,o+=u*f,l-=m*f}}{let{Cdot:d,impulse:h}=mo;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),d),this.m_K.Solve(-d.x,-d.y,h),this.m_impulse.x+=h.x,this.m_impulse.y+=h.y,r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,impulse:p}=mo;a.Set(o),c.Set(l);let d=0,h=0,f=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!f){let b=l-o-this.m_referenceAngle,x=0;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*fi?x=tt(b-this.m_lowerAngle,-wn,wn):b<=this.m_lowerAngle?x=tt(b-this.m_lowerAngle+fi,-wn,0):b>=this.m_upperAngle&&(x=tt(b-this.m_upperAngle-fi,0,wn));let _=-this.m_axialMass*x;o-=this.m_invIA*_,l+=this.m_invIB*_,d=Math.abs(x)}{a.Set(o),c.Set(l);let b=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),x=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB),_=n.Add(s,x,mo.C).Subtract(r).Subtract(b);h=_.Length();let y=this.m_invMassA,g=this.m_invMassB,S=this.m_invIA,w=this.m_invIB,B=this.m_K;B.ex.x=y+g+S*b.y*b.y+w*x.y*x.y,B.ex.y=-S*b.x*b.y-w*x.x*x.y,B.ey.x=B.ex.y,B.ey.y=y+g+S*b.x*b.x+w*x.x*x.x,B.Solve(_.x,_.y,p).Negate(),r.SubtractScaled(y,p),o-=S*n.Cross(b,p),s.AddScaled(g,p),l+=w*n.Cross(x,p)}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,h<=Z&&d<=fi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse.x,r.y=e*this.m_impulse.y,r}GetReactionTorque(e){return e*(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}GetMotorTorque(e){return e*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(e){e!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(e,r){(e!==this.m_lowerAngle||r!==this.m_upperAngle)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=e,this.m_upperAngle=r)}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}Draw(e){let{p2:r,r:o,pA:s,pB:l}=mo,a=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();T.MultiplyVec2(a,this.m_localAnchorA,s),T.MultiplyVec2(c,this.m_localAnchorB,l),e.DrawPoint(s,5,Q.joint4),e.DrawPoint(l,5,Q.joint5);let u=this.m_bodyA.GetAngle(),p=this.m_bodyB.GetAngle()-u-this.m_referenceAngle,d=.5;if(o.Set(Math.cos(p),Math.sin(p)).Scale(d),e.DrawSegment(l,n.Add(l,o,r),Q.joint1),e.DrawCircle(l,d,Q.joint1),this.m_enableLimit){let{rlo:h,rhi:f}=mo;h.Set(Math.cos(this.m_lowerAngle),Math.sin(this.m_lowerAngle)).Scale(d),f.Set(Math.cos(this.m_upperAngle),Math.sin(this.m_upperAngle)).Scale(d),e.DrawSegment(l,n.Add(l,h,r),Q.joint2),e.DrawSegment(l,n.Add(l,f,r),Q.joint3)}e.DrawSegment(a.p,s,Q.joint6),e.DrawSegment(s,l,Q.joint6),e.DrawSegment(c.p,l,Q.joint6)}};var as={qA:new D,qB:new D,rA:new n,rB:new n,lalcA:new n,lalcB:new n,K:new Qi,P:new n,Cdot1:new Se,impulse1:new n,impulse:new Se,C1:new n,C:new Se},po=class extends Dt{constructor(){super(8);this.localAnchorA=new n;this.localAnchorB=new n;this.referenceAngle=0;this.stiffness=0;this.damping=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},ac=class extends Mt{constructor(e){super(e);this.m_stiffness=0;this.m_damping=0;this.m_bias=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_referenceAngle=0;this.m_gamma=0;this.m_impulse=new Se;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_mass=new Qi;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_referenceAngle=e.referenceAngle??0,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d,K:h}=as;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let f=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,_=this.m_invIB;if(h.ex.x=f+b+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*_,h.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*_,h.ez.x=-this.m_rA.y*x-this.m_rB.y*_,h.ex.y=h.ey.x,h.ey.y=f+b+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*_,h.ez.y=this.m_rA.x*x+this.m_rB.x*_,h.ex.z=h.ez.x,h.ey.z=h.ez.y,h.ez.z=x+_,this.m_stiffness>0){h.GetInverse22(this.m_mass);let y=x+_,g=l-r-this.m_referenceAngle,S=this.m_damping,w=this.m_stiffness,B=e.step.dt;this.m_gamma=B*(S+B*w),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=g*B*w*this.m_gamma,y+=this.m_gamma,this.m_mass.ez.z=y!==0?1/y:0}else h.ez.z===0?(h.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(h.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio);let{P:y}=as;y.Copy(this.m_impulse),o.SubtractScaled(f,y),s-=x*(n.Cross(this.m_rA,y)+this.m_impulse.z),a.AddScaled(b,y),c+=_*(n.Cross(this.m_rB,y)+this.m_impulse.z)}else this.m_impulse.SetZero();e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB;if(this.m_stiffness>0){let p=l-o,d=-this.m_mass.ez.z*(p+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=d,o-=u*d,l+=m*d;let{Cdot1:h,impulse1:f}=as;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),h),Qi.MultiplyVec2(this.m_mass,h,f).Negate(),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;let b=f;r.SubtractScaled(a,b),o-=u*n.Cross(this.m_rA,b),s.AddScaled(c,b),l+=m*n.Cross(this.m_rB,b)}else{let{Cdot1:p,impulse:d,P:h}=as;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),p),p.z=l-o,Qi.MultiplyVec3(this.m_mass,p,d).Negate(),this.m_impulse.Add(d),h.Set(d.x,d.y),r.SubtractScaled(a,h),o-=u*(n.Cross(this.m_rA,h)+d.z),s.AddScaled(c,h),l+=m*(n.Cross(this.m_rB,h)+d.z)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,K:p,C1:d,P:h,rA:f,rB:b}=as;a.Set(o),c.Set(l);let x=this.m_invMassA,_=this.m_invMassB,y=this.m_invIA,g=this.m_invIB;D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),f),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),b);let S,w;if(p.ex.x=x+_+f.y*f.y*y+b.y*b.y*g,p.ey.x=-f.y*f.x*y-b.y*b.x*g,p.ez.x=-f.y*y-b.y*g,p.ex.y=p.ey.x,p.ey.y=x+_+f.x*f.x*y+b.x*b.x*g,p.ez.y=f.x*y+b.x*g,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=y+g,this.m_stiffness>0)n.Add(s,b,d).Subtract(r).Subtract(f),S=d.Length(),w=0,p.Solve22(d.x,d.y,h).Negate(),r.SubtractScaled(x,h),o-=y*n.Cross(f,h),s.AddScaled(_,h),l+=g*n.Cross(b,h);else{n.Add(s,b,d).Subtract(r).Subtract(f),n.Subtract(n.Add(s,b,n.s_t0),n.Add(r,f,n.s_t1),d);let B=l-o-this.m_referenceAngle;S=d.Length(),w=Math.abs(B);let{impulse:C,C:A}=as;A.Set(d.x,d.y,B),p.ez.z>0?p.Solve33(A.x,A.y,A.z,C).Negate():(p.Solve22(d.x,d.y,C).Negate(),C.z=0),h.Copy(C),r.SubtractScaled(x,h),o-=y*(n.Cross(f,h)+C.z),s.AddScaled(_,h),l+=g*(n.Cross(b,h)+C.z)}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,S<=Z&&w<=fi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse.x,r.y=e*this.m_impulse.y,r}GetReactionTorque(e){return e*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}};var Fr={qA:new D,qB:new D,lalcA:new n,lalcB:new n,rA:new n,rB:new n,d:new n,P:new n,ay:new n,pA:new n,pB:new n,axis:new n,Draw:{p1:new n,p2:new n,pA:new n,pB:new n,axis:new n,lower:new n,upper:new n,perp:new n}},cs=class extends Dt{constructor(){super(7);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n(1,0);this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorTorque=0;this.motorSpeed=0;this.stiffness=0;this.damping=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}},cc=class extends Mt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localXAxisA=new n;this.m_localYAxisA=new n;this.m_impulse=0;this.m_motorImpulse=0;this.m_springImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_translation=0;this.m_lowerTranslation=0;this.m_upperTranslation=0;this.m_maxMotorTorque=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_enableMotor=!1;this.m_stiffness=0;this.m_damping=0;this.m_indexA=0;this.m_indexB=0;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_ax=new n;this.m_ay=new n;this.m_sAx=0;this.m_sBx=0;this.m_sAy=0;this.m_sBy=0;this.m_mass=0;this.m_motorMass=0;this.m_axialMass=0;this.m_springMass=0;this.m_bias=0;this.m_gamma=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_localXAxisA.Copy(e.localAxisA??n.UNITX),n.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_lowerTranslation=e.lowerTranslation??0,this.m_upperTranslation=e.upperTranslation??0,this.m_enableLimit=e.enableLimit??!1,this.m_maxMotorTorque=e.maxMotorTorque??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableMotor=e.enableMotor??!1,this.m_ax.SetZero(),this.m_ay.SetZero(),this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=this.m_invMassA,o=this.m_invMassB,s=this.m_invIA,l=this.m_invIB,a=e.positions[this.m_indexA].c,c=e.positions[this.m_indexA].a,u=e.velocities[this.m_indexA].v,m=e.velocities[this.m_indexA].w,p=e.positions[this.m_indexB].c,d=e.positions[this.m_indexB].a,h=e.velocities[this.m_indexB].v,f=e.velocities[this.m_indexB].w,{qA:b,qB:x,lalcA:_,lalcB:y,rA:g,rB:S,d:w}=Fr;b.Set(c),x.Set(d),D.MultiplyVec2(b,n.Subtract(this.m_localAnchorA,this.m_localCenterA,_),g),D.MultiplyVec2(x,n.Subtract(this.m_localAnchorB,this.m_localCenterB,y),S),n.Add(p,S,w).Subtract(a).Subtract(g),D.MultiplyVec2(b,this.m_localYAxisA,this.m_ay),this.m_sAy=n.Cross(n.Add(w,g,n.s_t0),this.m_ay),this.m_sBy=n.Cross(S,this.m_ay),this.m_mass=r+o+s*this.m_sAy*this.m_sAy+l*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),D.MultiplyVec2(b,this.m_localXAxisA,this.m_ax),this.m_sAx=n.Cross(n.Add(w,g,n.s_t0),this.m_ax),this.m_sBx=n.Cross(S,this.m_ax);let B=r+o+s*this.m_sAx*this.m_sAx+l*this.m_sBx*this.m_sBx;if(B>0?this.m_axialMass=1/B:this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&B>0){this.m_springMass=1/B;let C=n.Dot(w,this.m_ax),A=e.step.dt;this.m_gamma=A*(this.m_damping+A*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=C*A*this.m_stiffness*this.m_gamma,this.m_springMass=B+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=n.Dot(this.m_ax,w):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=s+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_springImpulse*=e.step.dtRatio,this.m_motorImpulse*=e.step.dtRatio;let C=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:A}=Fr;n.Scale(this.m_impulse,this.m_ay,A).AddScaled(C,this.m_ax);let k=this.m_impulse*this.m_sAy+C*this.m_sAx+this.m_motorImpulse,M=this.m_impulse*this.m_sBy+C*this.m_sBx+this.m_motorImpulse;u.SubtractScaled(this.m_invMassA,A),m-=this.m_invIA*k,h.AddScaled(this.m_invMassB,A),f+=this.m_invIB*M}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=m,e.velocities[this.m_indexB].w=f}SolveVelocityConstraints(e){let r=this.m_invMassA,o=this.m_invMassB,s=this.m_invIA,l=this.m_invIB,a=e.velocities[this.m_indexA].v,c=e.velocities[this.m_indexA].w,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{P:p}=Fr;{let d=n.Dot(this.m_ax,n.Subtract(u,a,n.s_t0))+this.m_sBx*m-this.m_sAx*c,h=-this.m_springMass*(d+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h,n.Scale(h,this.m_ax,p);let f=h*this.m_sAx,b=h*this.m_sBx;a.SubtractScaled(r,p),c-=s*f,u.AddScaled(o,p),m+=l*b}{let d=m-c-this.m_motorSpeed,h=-this.m_motorMass*d,f=this.m_motorImpulse,b=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=tt(this.m_motorImpulse+h,-b,b),h=this.m_motorImpulse-f,c-=s*h,m+=l*h}if(this.m_enableLimit){{let d=this.m_translation-this.m_lowerTranslation,h=n.Dot(this.m_ax,n.Subtract(u,a,n.s_t0))+this.m_sBx*m-this.m_sAx*c,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-b,n.Scale(f,this.m_ax,p);let x=f*this.m_sAx,_=f*this.m_sBx;a.SubtractScaled(r,p),c-=s*x,u.AddScaled(o,p),m+=l*_}{let d=this.m_upperTranslation-this.m_translation,h=n.Dot(this.m_ax,n.Subtract(a,u,n.s_t0))+this.m_sAx*c-this.m_sBx*m,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-b,n.Scale(f,this.m_ax,p);let x=f*this.m_sAx,_=f*this.m_sBx;a.AddScaled(r,p),c+=s*x,u.SubtractScaled(o,p),m-=l*_}}{let d=n.Dot(this.m_ay,n.Subtract(u,a,n.s_t0))+this.m_sBy*m-this.m_sAy*c,h=-this.m_mass*d;this.m_impulse+=h,n.Scale(h,this.m_ay,p);let f=h*this.m_sAy,b=h*this.m_sBy;a.SubtractScaled(r,p),c-=s*f,u.AddScaled(o,p),m+=l*b}e.velocities[this.m_indexA].w=c,e.velocities[this.m_indexB].w=m}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,a=0,{qA:c,qB:u,lalcA:m,lalcB:p,rA:d,rB:h,d:f,P:b,ay:x}=Fr;if(this.m_enableLimit){c.Set(o),u.Set(l),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorA,this.m_localCenterA,m),d),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorB,this.m_localCenterB,p),h),n.Subtract(s,r,f).Add(h).Subtract(d);let _=D.MultiplyVec2(c,this.m_localXAxisA,this.m_ax),y=n.Cross(n.Add(f,d,n.s_t0),this.m_ax),g=n.Cross(h,this.m_ax),S=0,w=n.Dot(_,f);if(Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Z?S=w:w<=this.m_lowerTranslation?S=Math.min(w-this.m_lowerTranslation,0):w>=this.m_upperTranslation&&(S=Math.max(w-this.m_upperTranslation,0)),S!==0){let B=this.m_invMassA+this.m_invMassB+this.m_invIA*y*y+this.m_invIB*g*g,C=0;B!==0&&(C=-S/B),n.Scale(C,_,b);let A=C*y,k=C*g;r.SubtractScaled(this.m_invMassA,b),o-=this.m_invIA*A,s.AddScaled(this.m_invMassB,b),l+=this.m_invIB*k,a=Math.abs(S)}}{c.Set(o),u.Set(l),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorA,this.m_localCenterA,m),d),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorB,this.m_localCenterB,p),h),n.Subtract(s,r,f).Add(h).Subtract(d),D.MultiplyVec2(c,this.m_localYAxisA,x);let _=n.Cross(n.Add(f,d,n.s_t0),x),y=n.Cross(h,x),g=n.Dot(f,x),S=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,w=0;S!==0&&(w=-g/S),n.Scale(w,x,b);let B=w*_,C=w*y;r.SubtractScaled(this.m_invMassA,b),o-=this.m_invIA*B,s.AddScaled(this.m_invMassB,b),l+=this.m_invIB*C,a=Math.max(a,Math.abs(g))}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,a<=Z}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse;return r.x=e*(this.m_impulse*this.m_ay.x+o*this.m_ax.x),r.y=e*(this.m_impulse*this.m_ay.y+o*this.m_ax.y),r}GetReactionTorque(e){return e*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){let e=this.m_bodyA,r=this.m_bodyB,{pA:o,pB:s,d:l,axis:a}=Fr;return e.GetWorldPoint(this.m_localAnchorA,o),r.GetWorldPoint(this.m_localAnchorB,s),n.Subtract(s,o,l),e.GetWorldVector(this.m_localXAxisA,a),n.Dot(l,a)}GetJointLinearSpeed(){let e=this.m_bodyA,r=this.m_bodyB,{rA:o,rB:s,lalcA:l,lalcB:a,axis:c}=Fr;D.MultiplyVec2(e.m_xf.q,n.Subtract(this.m_localAnchorA,e.m_sweep.localCenter,l),o),D.MultiplyVec2(r.m_xf.q,n.Subtract(this.m_localAnchorB,r.m_sweep.localCenter,a),s);let u=n.Add(e.m_sweep.c,o,n.s_t0),m=n.Add(r.m_sweep.c,s,n.s_t1),p=n.Subtract(m,u,n.s_t2);D.MultiplyVec2(e.m_xf.q,this.m_localXAxisA,c);let d=e.m_linearVelocity,h=r.m_linearVelocity,f=e.m_angularVelocity,b=r.m_angularVelocity;return n.Dot(p,n.CrossScalarVec2(f,c,n.s_t0))+n.Dot(c,n.AddCrossScalarVec2(h,b,s,n.s_t0).Subtract(d).Subtract(n.CrossScalarVec2(f,o,n.s_t1)))}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetJointAngularSpeed(){let e=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-e}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}SetMaxMotorTorque(e){e!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e)}GetMotorTorque(e){return e*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(e,r){(e!==this.m_lowerTranslation||r!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_lowerImpulse=0,this.m_upperImpulse=0)}Draw(e){let{p1:r,p2:o,pA:s,pB:l,axis:a}=Fr.Draw,c=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();if(T.MultiplyVec2(c,this.m_localAnchorA,s),T.MultiplyVec2(u,this.m_localAnchorB,l),D.MultiplyVec2(c.q,this.m_localXAxisA,a),e.DrawSegment(s,l,Q.joint5),this.m_enableLimit){let{lower:m,upper:p,perp:d}=Fr.Draw;n.AddScaled(s,this.m_lowerTranslation,a,m),n.AddScaled(s,this.m_upperTranslation,a,p),D.MultiplyVec2(c.q,this.m_localYAxisA,d),e.DrawSegment(m,p,Q.joint1),e.DrawSegment(n.SubtractScaled(m,.5,d,r),n.AddScaled(m,.5,d,o),Q.joint2),e.DrawSegment(n.SubtractScaled(p,.5,d,r),n.AddScaled(p,.5,d,o),Q.joint3)}else e.DrawSegment(n.Subtract(s,a,r),n.Add(s,a,o),Q.joint1);e.DrawPoint(s,5,Q.joint1),e.DrawPoint(l,5,Q.joint4)}};function h0(i,t){return Math.sqrt(i*t)}function f0(i,t){return i>t?i:t}function b0(i,t){return i<t?i:t}var uc=class{constructor(t){this.m_other=null;this.prev=null;this.next=null;this.contact=t}get other(){return N(this.m_other!==null),this.m_other}set other(t){N(this.m_other===null),this.m_other=t}Reset(){this.m_other=null,this.prev=null,this.next=null}},de=class{constructor(){this.m_islandFlag=!1;this.m_touchingFlag=!1;this.m_enabledFlag=!1;this.m_filterFlag=!1;this.m_bulletHitFlag=!1;this.m_toiFlag=!1;this.m_prev=null;this.m_next=null;this.m_nodeA=new uc(this);this.m_nodeB=new uc(this);this.m_indexA=0;this.m_indexB=0;this.m_manifold=new co;this.m_toiCount=0;this.m_toi=0;this.m_friction=0;this.m_restitution=0;this.m_restitutionThreshold=0;this.m_tangentSpeed=0;this.m_oldManifold=new co}GetManifold(){return this.m_manifold}GetWorldManifold(t){let e=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody(),o=this.GetShapeA(),s=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,r.GetTransform(),s.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=h0(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=f0(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=b0(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,r,o){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=r,this.m_indexA=e,this.m_indexB=o,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=h0(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=f0(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=b0(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(t){let e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let r=!1,o=this.m_touchingFlag,s=this.m_fixtureA.IsSensor(),l=this.m_fixtureB.IsSensor(),a=s||l,c=this.m_fixtureA.GetBody(),u=this.m_fixtureB.GetBody(),m=c.GetTransform(),p=u.GetTransform();if(a){let d=this.GetShapeA(),h=this.GetShapeB();r=ts(d,this.m_indexA,h,this.m_indexB,m,p),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,m,p),r=this.m_manifold.pointCount>0;for(let d=0;d<this.m_manifold.pointCount;++d){let h=this.m_manifold.points[d];h.normalImpulse=0,h.tangentImpulse=0;let f=h.id;for(let b=0;b<this.m_oldManifold.pointCount;++b){let x=this.m_oldManifold.points[b];if(x.id.key===f.key){h.normalImpulse=x.normalImpulse,h.tangentImpulse=x.tangentImpulse;break}}}r!==o&&(c.SetAwake(!0),u.SetAwake(!0))}this.m_touchingFlag=r,!o&&r&&t&&t.BeginContact(this),o&&!r&&t&&t.EndContact(this),!a&&r&&t&&t.PreSolve(this,this.m_oldManifold)}};var mc=class extends de{Evaluate(t,e,r){a0(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var pc=class extends de{Evaluate(t,e,r){Xa(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var dc=class extends de{Evaluate(t,e,r){c0(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var hc=class extends de{Evaluate(t,e,r){Oa(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var fc=class extends de{Evaluate(t,e,r){Na(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var bc=class i extends de{static{this.Evaluate_s_edge=new I}Evaluate(t,e,r){let o=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(o,this.m_indexA),Oa(t,o,e,this.GetShapeB(),r)}};var _c=class i extends de{static{this.Evaluate_s_edge=new I}Evaluate(t,e,r){let o=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(o,this.m_indexA),Na(t,o,e,this.GetShapeB(),r)}};var yc=class{constructor(){let t=new Array(4);for(let e=0;e<4;e++)t[e]=new Array(4);this.m_registers=t,this.AddType(mc,0,0),this.AddType(dc,2,0),this.AddType(pc,2,2),this.AddType(hc,1,0),this.AddType(fc,1,2),this.AddType(bc,3,0),this.AddType(_c,3,2)}AddType(t,e,r){let o=[],s=l=>{o.push(l)};this.m_registers[e][r]={createFcn(l,a,c,u){let m=o.pop()??new t;return m.Reset(l,a,c,u),m},destroyFcn:s},e!==r&&(this.m_registers[r][e]={createFcn(l,a,c,u){let m=o.pop()??new t;return m.Reset(c,u,l,a),m},destroyFcn:s})}Create(t,e,r,o){let s=t.GetType(),l=r.GetType(),a=this.m_registers[s][l];return a?a.createFcn(t,e,r,o):null}Destroy(t){let e=t.m_fixtureA.GetType(),r=t.m_fixtureB.GetType();this.m_registers[e][r]?.destroyFcn(t)}};var Ii=class{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}},Ir=class i{ShouldCollide(t,e){let r=t.GetFilterData(),o=e.GetFilterData();return r.groupIndex===o.groupIndex&&r.groupIndex!==0?r.groupIndex>0:(r.maskBits&o.categoryBits)!==0&&(r.categoryBits&o.maskBits)!==0}static{this.b2_defaultFilter=new i}},xc=class{constructor(){this.normalImpulses=je(Nt);this.tangentImpulses=je(Nt);this.count=0}},Lr=class i{BeginContact(t){}EndContact(t){}PreSolve(t,e){}PostSolve(t,e){}static{this.b2_defaultListener=new i}};var gc=class{constructor(){this.m_broadPhase=new Ya;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=Ir.b2_defaultFilter;this.m_contactListener=Lr.b2_defaultListener;this.m_contactFactory=new yc;this.AddPair=(t,e)=>{let r=t.fixture,o=e.fixture,s=t.childIndex,l=e.childIndex,a=r.GetBody(),c=o.GetBody();if(a===c)return;let u=c.GetContactList();for(;u;){if(u.other===a){let p=u.contact.GetFixtureA(),d=u.contact.GetFixtureB(),h=u.contact.GetChildIndexA(),f=u.contact.GetChildIndexB();if(p===r&&d===o&&h===s&&f===l||p===o&&d===r&&h===l&&f===s)return}u=u.next}if(c.ShouldCollide(a)===!1||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(r,o))return;let m=this.m_contactFactory.Create(r,s,o,l);m!==null&&(r=m.GetFixtureA(),o=m.GetFixtureB(),s=m.GetChildIndexA(),l=m.GetChildIndexB(),a=r.m_body,c=o.m_body,m.m_prev=null,m.m_next=this.m_contactList,this.m_contactList!==null&&(this.m_contactList.m_prev=m),this.m_contactList=m,m.m_nodeA.other=c,m.m_nodeA.prev=null,m.m_nodeA.next=a.m_contactList,a.m_contactList!==null&&(a.m_contactList.prev=m.m_nodeA),a.m_contactList=m.m_nodeA,m.m_nodeB.other=a,m.m_nodeB.prev=null,m.m_nodeB.next=c.m_contactList,c.m_contactList!==null&&(c.m_contactList.prev=m.m_nodeB),c.m_contactList=m.m_nodeB,++this.m_contactCount)}}FindNewContacts(){this.m_broadPhase.UpdatePairs(this.AddPair)}Destroy(t){let e=t.GetFixtureA(),r=t.GetFixtureB(),o=e.GetBody(),s=r.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===s.m_contactList&&(s.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!r.IsSensor()&&(e.GetBody().SetAwake(!0),r.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){let e=t.GetFixtureA(),r=t.GetFixtureB(),o=t.GetChildIndexA(),s=t.GetChildIndexB(),l=e.GetBody(),a=r.GetBody();if(t.m_filterFlag){if(!a.ShouldCollide(l)||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,r)){let h=t;t=h.m_next,this.Destroy(h);continue}t.m_filterFlag=!1}let c=l.IsAwake()&&l.m_type!==0,u=a.IsAwake()&&a.m_type!==0;if(!c&&!u){t=t.m_next;continue}let m=e.m_proxies[o].treeNode,p=r.m_proxies[s].treeNode;if(!m.aabb.TestOverlap(p.aabb)){let h=t;t=h.m_next,this.Destroy(h);continue}t.Update(this.m_contactListener),t=t.m_next}}};var tr=class{constructor(){this.step=0;this.collide=0;this.solve=0;this.solveInit=0;this.solveVelocity=0;this.solvePosition=0;this.broadphase=0;this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}},Xe=class i{constructor(){this.dt=0;this.inv_dt=0;this.dtRatio=0;this.config={velocityIterations:0,positionIterations:0};this.warmStarting=!1}static Create(){return new i}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.config={...t.config},this.warmStarting=t.warmStarting,this}},Mn=class{constructor(){this.c=new n;this.a=0}},Rn=class{constructor(){this.v=new n;this.w=0}},Sc=class{constructor(){this.step=Xe.Create()}};var wc=!0;function Pc(i){wc=i}function Dc(){return wc}var ad=class{constructor(){this.rA=new n;this.rB=new n;this.normalImpulse=0;this.tangentImpulse=0;this.normalMass=0;this.tangentMass=0;this.velocityBias=0}},vc=class{constructor(){this.points=H(Nt,ad);this.normal=new n;this.tangent=new n;this.normalMass=new Lt;this.K=new Lt;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.invIA=0;this.invIB=0;this.friction=0;this.restitution=0;this.threshold=0;this.tangentSpeed=0;this.pointCount=0;this.contactIndex=0}},Bc=class{constructor(){this.localPoints=H(Nt,n);this.localNormal=new n;this.localPoint=new n;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.localCenterA=new n;this.localCenterB=new n;this.invIA=0;this.invIB=0;this.type=0;this.radiusA=0;this.radiusB=0;this.pointCount=0}},Cc=class{constructor(){this.step=Xe.Create();this.count=0}},Ac=class i{constructor(){this.normal=new n;this.point=new n;this.separation=0}static{this.Initialize_s_pointA=new n}static{this.Initialize_s_pointB=new n}static{this.Initialize_s_planePoint=new n}static{this.Initialize_s_clipPoint=new n}Initialize(t,e,r,o){let s=i.Initialize_s_pointA,l=i.Initialize_s_pointB,a=i.Initialize_s_planePoint,c=i.Initialize_s_clipPoint;switch(t.type){case 0:T.MultiplyVec2(e,t.localPoint,s),T.MultiplyVec2(r,t.localPoints[0],l),n.Subtract(l,s,this.normal).Normalize(),n.Mid(s,l,this.point),this.separation=n.Dot(n.Subtract(l,s,n.s_t0),this.normal)-t.radiusA-t.radiusB;break;case 1:D.MultiplyVec2(e.q,t.localNormal,this.normal),T.MultiplyVec2(e,t.localPoint,a),T.MultiplyVec2(r,t.localPoints[o],c),this.separation=n.Dot(n.Subtract(c,a,n.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(c);break;case 2:D.MultiplyVec2(r.q,t.localNormal,this.normal),T.MultiplyVec2(r,t.localPoint,a),T.MultiplyVec2(e,t.localPoints[o],c),this.separation=n.Dot(n.Subtract(c,a,n.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(c),this.normal.Negate();break}}},Tc=class i{constructor(){this.m_step=Xe.Create();this.m_positionConstraints=H(1024,Bc);this.m_velocityConstraints=H(1024,vc);this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count){let e=Math.max(this.m_positionConstraints.length*2,this.m_count);for(;this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Bc}if(this.m_velocityConstraints.length<this.m_count){let e=Math.max(this.m_velocityConstraints.length*2,this.m_count);for(;this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new vc}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let e=0;e<this.m_count;++e){let r=this.m_contacts[e],o=r.m_fixtureA,s=r.m_fixtureB,l=o.GetShape(),a=s.GetShape(),c=l.m_radius,u=a.m_radius,m=o.GetBody(),p=s.GetBody(),d=r.GetManifold(),{pointCount:h}=d,f=this.m_velocityConstraints[e];f.friction=r.m_friction,f.restitution=r.m_restitution,f.threshold=r.m_restitutionThreshold,f.tangentSpeed=r.m_tangentSpeed,f.indexA=m.m_islandIndex,f.indexB=p.m_islandIndex,f.invMassA=m.m_invMass,f.invMassB=p.m_invMass,f.invIA=m.m_invI,f.invIB=p.m_invI,f.contactIndex=e,f.pointCount=h,f.K.SetZero(),f.normalMass.SetZero();let b=this.m_positionConstraints[e];b.indexA=m.m_islandIndex,b.indexB=p.m_islandIndex,b.invMassA=m.m_invMass,b.invMassB=p.m_invMass,b.localCenterA.Copy(m.m_sweep.localCenter),b.localCenterB.Copy(p.m_sweep.localCenter),b.invIA=m.m_invI,b.invIB=p.m_invI,b.localNormal.Copy(d.localNormal),b.localPoint.Copy(d.localPoint),b.pointCount=h,b.radiusA=c,b.radiusB=u,b.type=d.type;for(let x=0;x<h;++x){let _=d.points[x],y=f.points[x];this.m_step.warmStarting?(y.normalImpulse=this.m_step.dtRatio*_.normalImpulse,y.tangentImpulse=this.m_step.dtRatio*_.tangentImpulse):(y.normalImpulse=0,y.tangentImpulse=0),y.rA.SetZero(),y.rB.SetZero(),y.normalMass=0,y.tangentMass=0,y.velocityBias=0,b.localPoints[x].Copy(_.localPoint)}}return this}static{this.InitializeVelocityConstraints_s_xfA=new T}static{this.InitializeVelocityConstraints_s_xfB=new T}static{this.InitializeVelocityConstraints_s_worldManifold=new ki}InitializeVelocityConstraints(){let t=i.InitializeVelocityConstraints_s_xfA,e=i.InitializeVelocityConstraints_s_xfB,r=i.InitializeVelocityConstraints_s_worldManifold,o=1e3;for(let s=0;s<this.m_count;++s){let l=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],{radiusA:c,radiusB:u,localCenterA:m,localCenterB:p}=a,d=this.m_contacts[l.contactIndex].GetManifold(),{indexA:h,indexB:f,tangent:b,pointCount:x}=l,_=l.invMassA,y=l.invMassB,g=l.invIA,S=l.invIB,w=this.m_positions[h].c,B=this.m_positions[h].a,C=this.m_velocities[h].v,A=this.m_velocities[h].w,k=this.m_positions[f].c,M=this.m_positions[f].a,E=this.m_velocities[f].v,L=this.m_velocities[f].w;t.q.Set(B),e.q.Set(M),n.Subtract(w,D.MultiplyVec2(t.q,m,n.s_t0),t.p),n.Subtract(k,D.MultiplyVec2(e.q,p,n.s_t0),e.p),r.Initialize(d,t,c,e,u),l.normal.Copy(r.normal),n.CrossVec2One(l.normal,b);for(let U=0;U<x;++U){let Y=l.points[U];n.Subtract(r.points[U],w,Y.rA),n.Subtract(r.points[U],k,Y.rB);let O=n.Cross(Y.rA,l.normal),K=n.Cross(Y.rB,l.normal),ut=_+y+g*O*O+S*K*K;Y.normalMass=ut>0?1/ut:0;let lt=n.Cross(Y.rA,b),Tt=n.Cross(Y.rB,b),Vt=_+y+g*lt*lt+S*Tt*Tt;Y.tangentMass=Vt>0?1/Vt:0,Y.velocityBias=0;let wt=n.Dot(l.normal,n.Subtract(n.AddCrossScalarVec2(E,L,Y.rB,n.s_t0),n.AddCrossScalarVec2(C,A,Y.rA,n.s_t1),n.s_t0));wt<-l.threshold&&(Y.velocityBias=-l.restitution*wt)}if(l.pointCount===2&&wc){let U=l.points[0],Y=l.points[1],O=n.Cross(U.rA,l.normal),K=n.Cross(U.rB,l.normal),ut=n.Cross(Y.rA,l.normal),lt=n.Cross(Y.rB,l.normal),Tt=_+y+g*O*O+S*K*K,Vt=_+y+g*ut*ut+S*lt*lt,wt=_+y+g*O*ut+S*K*lt;Tt*Tt<o*(Tt*Vt-wt*wt)?(l.K.ex.Set(Tt,wt),l.K.ey.Set(wt,Vt),l.K.GetInverse(l.normalMass)):l.pointCount=1}}}static{this.WarmStart_s_P=new n}WarmStart(){let t=i.WarmStart_s_P;for(let e=0;e<this.m_count;++e){let r=this.m_velocityConstraints[e],{indexA:o,indexB:s,pointCount:l,normal:a,tangent:c}=r,u=r.invMassA,m=r.invIA,p=r.invMassB,d=r.invIB,h=this.m_velocities[o].v,f=this.m_velocities[o].w,b=this.m_velocities[s].v,x=this.m_velocities[s].w;for(let _=0;_<l;++_){let y=r.points[_];n.Add(n.Scale(y.normalImpulse,a,n.s_t0),n.Scale(y.tangentImpulse,c,n.s_t1),t),f-=m*n.Cross(y.rA,t),h.SubtractScaled(u,t),x+=d*n.Cross(y.rB,t),b.AddScaled(p,t)}this.m_velocities[o].w=f,this.m_velocities[s].w=x}}static{this.SolveVelocityConstraints_s_dv=new n}static{this.SolveVelocityConstraints_s_dv1=new n}static{this.SolveVelocityConstraints_s_dv2=new n}static{this.SolveVelocityConstraints_s_P=new n}static{this.SolveVelocityConstraints_s_a=new n}static{this.SolveVelocityConstraints_s_b=new n}static{this.SolveVelocityConstraints_s_x=new n}static{this.SolveVelocityConstraints_s_d=new n}static{this.SolveVelocityConstraints_s_P1=new n}static{this.SolveVelocityConstraints_s_P2=new n}static{this.SolveVelocityConstraints_s_P1P2=new n}SolveVelocityConstraints(){let t=i.SolveVelocityConstraints_s_dv,e=i.SolveVelocityConstraints_s_dv1,r=i.SolveVelocityConstraints_s_dv2,o=i.SolveVelocityConstraints_s_P,s=i.SolveVelocityConstraints_s_a,l=i.SolveVelocityConstraints_s_b,a=i.SolveVelocityConstraints_s_x,c=i.SolveVelocityConstraints_s_d,u=i.SolveVelocityConstraints_s_P1,m=i.SolveVelocityConstraints_s_P2,p=i.SolveVelocityConstraints_s_P1P2;for(let d=0;d<this.m_count;++d){let h=this.m_velocityConstraints[d],{indexA:f,indexB:b,pointCount:x,normal:_,tangent:y,friction:g}=h,S=h.invMassA,w=h.invIA,B=h.invMassB,C=h.invIB,A=this.m_velocities[f].v,k=this.m_velocities[f].w,M=this.m_velocities[b].v,E=this.m_velocities[b].w;for(let L=0;L<x;++L){let U=h.points[L];n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),t);let Y=n.Dot(t,y)-h.tangentSpeed,O=U.tangentMass*-Y,K=g*U.normalImpulse,ut=tt(U.tangentImpulse+O,-K,K);O=ut-U.tangentImpulse,U.tangentImpulse=ut,n.Scale(O,y,o),A.SubtractScaled(S,o),k-=w*n.Cross(U.rA,o),M.AddScaled(B,o),E+=C*n.Cross(U.rB,o)}if(h.pointCount===1||wc===!1)for(let L=0;L<x;++L){let U=h.points[L];n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),t);let Y=n.Dot(t,_),O=-U.normalMass*(Y-U.velocityBias),K=Math.max(U.normalImpulse+O,0);O=K-U.normalImpulse,U.normalImpulse=K,n.Scale(O,_,o),A.SubtractScaled(S,o),k-=w*n.Cross(U.rA,o),M.AddScaled(B,o),E+=C*n.Cross(U.rB,o)}else{let L=h.points[0],U=h.points[1];s.Set(L.normalImpulse,U.normalImpulse),n.Subtract(n.AddCrossScalarVec2(M,E,L.rB,n.s_t0),n.AddCrossScalarVec2(A,k,L.rA,n.s_t1),e),n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),r);let Y=n.Dot(e,_),O=n.Dot(r,_);for(l.x=Y-L.velocityBias,l.y=O-U.velocityBias,l.Subtract(Lt.MultiplyVec2(h.K,s,n.s_t0));;){if(Lt.MultiplyVec2(h.normalMass,l,a).Negate(),a.x>=0&&a.y>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=-L.normalMass*l.x,a.y=0,Y=0,O=h.K.ex.y*a.x+l.y,a.x>=0&&O>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=0,a.y=-U.normalMass*l.y,Y=h.K.ey.x*a.y+l.x,O=0,a.y>=0&&Y>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=0,a.y=0,Y=l.x,O=l.y,Y>=0&&O>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}break}}this.m_velocities[f].w=k,this.m_velocities[b].w=E}}StoreImpulses(){for(let t=0;t<this.m_count;++t){let e=this.m_velocityConstraints[t],r=this.m_contacts[e.contactIndex].GetManifold();for(let o=0;o<e.pointCount;++o)r.points[o].normalImpulse=e.points[o].normalImpulse,r.points[o].tangentImpulse=e.points[o].tangentImpulse}}static{this.SolvePositionConstraints_s_xfA=new T}static{this.SolvePositionConstraints_s_xfB=new T}static{this.SolvePositionConstraints_s_psm=new Ac}static{this.SolvePositionConstraints_s_rA=new n}static{this.SolvePositionConstraints_s_rB=new n}static{this.SolvePositionConstraints_s_P=new n}SolvePositionConstraints(){let t=i.SolvePositionConstraints_s_xfA,e=i.SolvePositionConstraints_s_xfB,r=i.SolvePositionConstraints_s_psm,o=i.SolvePositionConstraints_s_rA,s=i.SolvePositionConstraints_s_rB,l=i.SolvePositionConstraints_s_P,a=0;for(let c=0;c<this.m_count;++c){let u=this.m_positionConstraints[c],{indexA:m,indexB:p,localCenterA:d,localCenterB:h,pointCount:f}=u,b=u.invMassA,x=u.invIA,_=u.invMassB,y=u.invIB,g=this.m_positions[m].c,S=this.m_positions[m].a,w=this.m_positions[p].c,B=this.m_positions[p].a;for(let C=0;C<f;++C){t.q.Set(S),e.q.Set(B),n.Subtract(g,D.MultiplyVec2(t.q,d,n.s_t0),t.p),n.Subtract(w,D.MultiplyVec2(e.q,h,n.s_t0),e.p),r.Initialize(u,t,e,C);let{normal:A,point:k,separation:M}=r;n.Subtract(k,g,o),n.Subtract(k,w,s),a=Math.min(a,M);let E=tt(J2*(M+Z),-Wo,0),L=n.Cross(o,A),U=n.Cross(s,A),Y=b+_+x*L*L+y*U*U,O=Y>0?-E/Y:0;n.Scale(O,A,l),g.SubtractScaled(b,l),S-=x*n.Cross(o,l),w.AddScaled(_,l),B+=y*n.Cross(s,l)}this.m_positions[m].c.Copy(g),this.m_positions[m].a=S,this.m_positions[p].c.Copy(w),this.m_positions[p].a=B}return a>=-3*Z}static{this.SolveTOIPositionConstraints_s_xfA=new T}static{this.SolveTOIPositionConstraints_s_xfB=new T}static{this.SolveTOIPositionConstraints_s_psm=new Ac}static{this.SolveTOIPositionConstraints_s_rA=new n}static{this.SolveTOIPositionConstraints_s_rB=new n}static{this.SolveTOIPositionConstraints_s_P=new n}SolveTOIPositionConstraints(t,e){let r=i.SolveTOIPositionConstraints_s_xfA,o=i.SolveTOIPositionConstraints_s_xfB,s=i.SolveTOIPositionConstraints_s_psm,l=i.SolveTOIPositionConstraints_s_rA,a=i.SolveTOIPositionConstraints_s_rB,c=i.SolveTOIPositionConstraints_s_P,u=0;for(let m=0;m<this.m_count;++m){let p=this.m_positionConstraints[m],{indexA:d,indexB:h,localCenterA:f,localCenterB:b,pointCount:x}=p,_=0,y=0;(d===t||d===e)&&(_=p.invMassA,y=p.invIA);let g=0,S=0;(h===t||h===e)&&(g=p.invMassB,S=p.invIB);let w=this.m_positions[d].c,B=this.m_positions[d].a,C=this.m_positions[h].c,A=this.m_positions[h].a;for(let k=0;k<x;++k){r.q.Set(B),o.q.Set(A),n.Subtract(w,D.MultiplyVec2(r.q,f,n.s_t0),r.p),n.Subtract(C,D.MultiplyVec2(o.q,b,n.s_t0),o.p),s.Initialize(p,r,o,k);let{normal:M,point:E,separation:L}=s;n.Subtract(E,w,l),n.Subtract(E,C,a),u=Math.min(u,L);let U=tt(j2*(L+Z),-Wo,0),Y=n.Cross(l,M),O=n.Cross(a,M),K=_+g+y*Y*Y+S*O*O,ut=K>0?-U/K:0;n.Scale(ut,M,c),w.SubtractScaled(_,c),B-=y*n.Cross(l,c),C.AddScaled(g,c),A+=S*n.Cross(a,c)}this.m_positions[d].a=B,this.m_positions[h].a=A}return u>=-1.5*Z}};var Mc=class i{constructor(t,e,r,o){this.m_bodyCount=0;this.m_jointCount=0;this.m_contactCount=0;this.m_bodyCapacity=t,this.m_listener=o,this.m_bodies=new Array(t),this.m_contacts=new Array(e),this.m_joints=new Array(r),this.m_velocities=H(t,Rn),this.m_positions=H(t,Mn),this.Resize(t)}Resize(t){for(;this.m_bodyCapacity<t;)this.m_velocities[this.m_bodyCapacity]=new Rn,this.m_positions[this.m_bodyCapacity]=new Mn,this.m_bodyCapacity++}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=t,++this.m_bodyCount}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}static{this.s_timer=new ii}static{this.s_solverData=new Sc}static{this.s_contactSolverDef=new Cc}static{this.s_contactSolver=new Tc}static{this.s_translation=new n}Solve(t,e,r,o){let s=i.s_timer.Reset(),l=e.dt;for(let p=0;p<this.m_bodyCount;++p){let d=this.m_bodies[p];this.m_positions[p].c.Copy(d.m_sweep.c);let{a:h}=d.m_sweep,f=this.m_velocities[p].v.Copy(d.m_linearVelocity),b=d.m_angularVelocity;d.m_sweep.c0.Copy(d.m_sweep.c),d.m_sweep.a0=d.m_sweep.a,d.m_type===2&&(f.x+=l*d.m_invMass*(d.m_gravityScale*d.m_mass*r.x+d.m_force.x),f.y+=l*d.m_invMass*(d.m_gravityScale*d.m_mass*r.y+d.m_force.y),b+=l*d.m_invI*d.m_torque,f.Scale(1/(1+l*d.m_linearDamping)),b*=1/(1+l*d.m_angularDamping)),this.m_positions[p].a=h,this.m_velocities[p].w=b}s.Reset();let a=i.s_solverData;a.step.Copy(e),a.positions=this.m_positions,a.velocities=this.m_velocities;let c=i.s_contactSolverDef;c.step.Copy(e),c.contacts=this.m_contacts,c.count=this.m_contactCount,c.positions=this.m_positions,c.velocities=this.m_velocities;let u=i.s_contactSolver.Initialize(c);u.InitializeVelocityConstraints(),e.warmStarting&&u.WarmStart();for(let p=0;p<this.m_jointCount;++p)this.m_joints[p].InitVelocityConstraints(a);t.solveInit=s.GetMilliseconds(),s.Reset();for(let p=0;p<e.config.velocityIterations;++p){for(let d=0;d<this.m_jointCount;++d)this.m_joints[d].SolveVelocityConstraints(a);u.SolveVelocityConstraints()}u.StoreImpulses(),t.solveVelocity=s.GetMilliseconds();for(let p=0;p<this.m_bodyCount;++p){let{c:d}=this.m_positions[p],{a:h}=this.m_positions[p],{v:f}=this.m_velocities[p],{w:b}=this.m_velocities[p],x=n.Scale(l,f,i.s_translation);if(n.Dot(x,x)>Qp){let y=gn/x.Length();f.Scale(y)}let _=l*b;if(_*_>qp){let y=Sn/Math.abs(_);b*=y}d.AddScaled(l,f),h+=l*b,this.m_positions[p].a=h,this.m_velocities[p].w=b}s.Reset();let m=!1;for(let p=0;p<e.config.positionIterations;++p){let d=u.SolvePositionConstraints(),h=!0;for(let f=0;f<this.m_jointCount;++f){let b=this.m_joints[f].SolvePositionConstraints(a);h=h&&b}if(d&&h){m=!0;break}}for(let p=0;p<this.m_bodyCount;++p){let d=this.m_bodies[p];d.m_sweep.c.Copy(this.m_positions[p].c),d.m_sweep.a=this.m_positions[p].a,d.m_linearVelocity.Copy(this.m_velocities[p].v),d.m_angularVelocity=this.m_velocities[p].w,d.SynchronizeTransform()}if(t.solvePosition=s.GetMilliseconds(),this.Report(u.m_velocityConstraints),o){let p=$,d=Wp*Wp,h=Kp*Kp;for(let f=0;f<this.m_bodyCount;++f){let b=this.m_bodies[f];b.GetType()!==0&&(!b.m_autoSleepFlag||b.m_angularVelocity*b.m_angularVelocity>h||n.Dot(b.m_linearVelocity,b.m_linearVelocity)>d?(b.m_sleepTime=0,p=0):(b.m_sleepTime+=l,p=Math.min(p,b.m_sleepTime)))}if(p>=z2&&m)for(let f=0;f<this.m_bodyCount;++f)this.m_bodies[f].SetAwake(!1)}}SolveTOI(t,e,r){for(let a=0;a<this.m_bodyCount;++a){let c=this.m_bodies[a];this.m_positions[a].c.Copy(c.m_sweep.c),this.m_positions[a].a=c.m_sweep.a,this.m_velocities[a].v.Copy(c.m_linearVelocity),this.m_velocities[a].w=c.m_angularVelocity}let o=i.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;let s=i.s_contactSolver.Initialize(o);for(let a=0;a<t.config.positionIterations&&!s.SolveTOIPositionConstraints(e,r);++a);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[r].m_sweep.c0.Copy(this.m_positions[r].c),this.m_bodies[r].m_sweep.a0=this.m_positions[r].a,s.InitializeVelocityConstraints();for(let a=0;a<t.config.velocityIterations;++a)s.SolveVelocityConstraints();let l=t.dt;for(let a=0;a<this.m_bodyCount;++a){let{c}=this.m_positions[a],{a:u}=this.m_positions[a],{v:m}=this.m_velocities[a],{w:p}=this.m_velocities[a],d=n.Scale(l,m,i.s_translation);if(n.Dot(d,d)>Qp){let b=gn/d.Length();m.Scale(b)}let h=l*p;if(h*h>qp){let b=Sn/Math.abs(h);p*=b}c.AddScaled(l,m),u+=l*p,this.m_positions[a].a=u,this.m_velocities[a].w=p;let f=this.m_bodies[a];f.m_sweep.c.Copy(c),f.m_sweep.a=u,f.m_linearVelocity.Copy(m),f.m_angularVelocity=p,f.SynchronizeTransform()}this.Report(s.m_velocityConstraints)}static{this.s_impulse=new xc}Report(t){for(let e=0;e<this.m_contactCount;++e){let r=this.m_contacts[e],o=t[e],s=i.s_impulse;s.count=o.pointCount;for(let l=0;l<o.pointCount;++l)s.normalImpulses[l]=o.points[l].normalImpulse,s.tangentImpulses[l]=o.points[l].tangentImpulse;this.m_listener.PostSolve(r,s)}}};var He=class i{constructor(t){this.m_contactManager=new gc;this.m_bodyList=null;this.m_jointList=null;this.m_bodyCount=0;this.m_jointCount=0;this.m_gravity=new n;this.m_allowSleep=!0;this.m_destructionListener=null;this.m_inv_dt0=0;this.m_newContacts=!1;this.m_locked=!1;this.m_clearForces=!0;this.m_warmStarting=!0;this.m_continuousPhysics=!0;this.m_subStepping=!1;this.m_stepComplete=!0;this.m_profile=new tr;this.m_island=new Mc(2*ka,ka,0,this.m_contactManager.m_contactListener);this.s_stack=[];this.m_gravity.Copy(t)}static Create(t){return new i(t)}SetDestructionListener(t){this.m_destructionListener=t}GetDestructionListener(){return this.m_destructionListener}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t,this.m_island.m_listener=t}CreateBody(t={}){N(!this.IsLocked());let e=new uo(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){N(!this.IsLocked());let e=t.m_jointList;for(;e;){let l=e;e=e.next,this.m_destructionListener?.SayGoodbyeJoint(l.joint),this.DestroyJoint(l.joint),t.m_jointList=e}t.m_jointList=null;let r=t.m_contactList;for(;r;){let l=r;r=r.next,this.m_contactManager.Destroy(l.contact)}t.m_contactList=null;let o=this.m_contactManager.m_broadPhase,s=t.m_fixtureList;for(;s;){let l=s;s=s.m_next,this.m_destructionListener?.SayGoodbyeFixture(l),l.DestroyProxies(o),t.m_fixtureList=s,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static Joint_Create(t){switch(t.type){case 3:return new Qa(t);case 5:return new rc(t);case 2:return new oc(t);case 1:return new lc(t);case 4:return new nc(t);case 6:return new $a(t);case 7:return new cc(t);case 8:return new ac(t);case 9:return new Ka(t);case 10:return new tc(t);case 11:return new Wa(t)}throw new Error}CreateJoint(t){N(!this.IsLocked());let e=i.Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;let r=e.m_bodyA,o=e.m_bodyB;if(!t.collideConnected){let s=o.GetContactList();for(;s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next}return e}DestroyJoint(t){N(!this.IsLocked()),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);let e=t.m_bodyA,r=t.m_bodyB,o=t.m_collideConnected;if(e.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!o){let s=r.GetContactList();for(;s;)s.other===e&&s.contact.FlagForFiltering(),s=s.next}}static{this.Step_s_step=Xe.Create()}static{this.Step_s_stepTimer=new ii}static{this.Step_s_timer=new ii}Step(t,e){let r=i.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;let o=i.Step_s_step;o.dt=t,o.config={...e},t>0?o.inv_dt=1/t:o.inv_dt=0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;{let s=i.Step_s_timer.Reset();this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds()}if(this.m_stepComplete&&o.dt>0){let s=i.Step_s_timer.Reset();this.Solve(o),this.m_profile.solve=s.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){let s=i.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=s.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.GetNext())t.m_force.SetZero(),t.m_torque=0}QueryAABB(t,e){this.m_contactManager.m_broadPhase.Query(t,r=>{let o=at(r.userData);return e(o.fixture)})}QueryAllAABB(t,e=[]){return this.QueryAABB(t,r=>(e.push(r),!0)),e}QueryPointAABB(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,r=>{let o=at(r.userData);return e(o.fixture)})}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(t,r=>(e.push(r),!0)),e}static{this.QueryFixtureShape_s_aabb=new nt}QueryFixtureShape(t,e,r,o){let s=i.QueryFixtureShape_s_aabb;t.ComputeAABB(s,r,e),this.m_contactManager.m_broadPhase.Query(s,l=>{let a=at(l.userData),{fixture:c}=a;return!ts(t,e,c.GetShape(),a.childIndex,r,c.GetBody().GetTransform())||o(c)})}QueryAllFixtureShape(t,e,r,o=[]){return this.QueryFixtureShape(t,e,r,s=>(o.push(s),!0)),o}QueryFixturePoint(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,r=>{let o=at(r.userData),{fixture:s}=o;return!s.TestPoint(t)||e(s)})}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(t,r=>(e.push(r),!0)),e}static{this.RayCast_s_input=new bi}static{this.RayCast_s_output=new _i}static{this.RayCast_s_point=new n}RayCast(t,e,r){let o=i.RayCast_s_input;o.maxFraction=1,o.p1.Copy(t),o.p2.Copy(e),this.m_contactManager.m_broadPhase.RayCast(o,(s,l)=>{let a=at(l.userData),{fixture:c}=a,u=a.childIndex,m=i.RayCast_s_output;if(c.RayCast(m,s,u)){let{fraction:d}=m,h=i.RayCast_s_point;return h.Set((1-d)*t.x+d*e.x,(1-d)*t.y+d*e.y),r(c,h,m.normal,d)}return s.maxFraction})}RayCastOne(t,e){let r=null,o=1;return this.RayCast(t,e,(s,l,a,c)=>(c<o&&(o=c,r=s),o)),r}RayCastAll(t,e,r=[]){return this.RayCast(t,e,o=>(r.push(o),1)),r}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t){this.m_gravity.Copy(t)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){N(!this.IsLocked());for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.Subtract(t),e.m_sweep.c0.Subtract(t),e.m_sweep.c.Subtract(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Solve(t){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;let e=this.m_island;e.Resize(this.m_bodyCount),e.Clear();for(let s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(let s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(let s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;let r=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag||!s.IsAwake()||!s.IsEnabled()||s.GetType()===0)continue;e.Clear();let l=0;for(r[l++]=s,s.m_islandFlag=!0;l>0;){let c=r[--l];if(N(c!==null),e.AddBody(c),c.GetType()!==0){c.m_awakeFlag=!0;for(let u=c.m_contactList;u;u=u.next){let{contact:m}=u;if(m.m_islandFlag||!m.IsEnabled()||!m.IsTouching())continue;let p=m.m_fixtureA.m_isSensor,d=m.m_fixtureB.m_isSensor;if(p||d)continue;e.AddContact(m),m.m_islandFlag=!0;let{other:h}=u;h.m_islandFlag||(r[l++]=h,h.m_islandFlag=!0)}for(let u=c.m_jointList;u;u=u.next){if(u.joint.m_islandFlag)continue;let{other:m}=u;m.IsEnabled()&&(e.AddJoint(u.joint),u.joint.m_islandFlag=!0,!m.m_islandFlag&&(r[l++]=m,m.m_islandFlag=!0))}}}let a=new tr;e.Solve(a,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=a.solveInit,this.m_profile.solveVelocity+=a.solveVelocity,this.m_profile.solvePosition+=a.solvePosition;for(let c=0;c<e.m_bodyCount;++c){let u=e.m_bodies[c];u.GetType()===0&&(u.m_islandFlag=!1)}}for(let s=0;s<r.length&&r[s];++s)r[s]=null;let o=new ii;for(let s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag&&s.GetType()!==0&&s.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=o.GetMilliseconds()}static{this.SolveTOI_s_subStep=Xe.Create()}static{this.SolveTOI_s_backup=new ie}static{this.SolveTOI_s_backup1=new ie}static{this.SolveTOI_s_backup2=new ie}static{this.SolveTOI_s_toi_input=new rs}static{this.SolveTOI_s_toi_output=new os}SolveTOI(t){let e=this.m_island;if(e.Clear(),this.m_stepComplete){for(let r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(let r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){let r=null,o=1;for(let d=this.m_contactManager.m_contactList;d;d=d.m_next){if(!d.IsEnabled()||d.m_toiCount>Y2)continue;let h=1;if(d.m_toiFlag)h=d.m_toi;else{let f=d.GetFixtureA(),b=d.GetFixtureB();if(f.IsSensor()||b.IsSensor())continue;let x=f.GetBody(),_=b.GetBody(),y=x.m_type,g=_.m_type,S=x.IsAwake()&&y!==0,w=_.IsAwake()&&g!==0;if(!S&&!w)continue;let B=x.IsBullet()||y!==2,C=_.IsBullet()||g!==2;if(!B&&!C)continue;let{alpha0:A}=x.m_sweep;x.m_sweep.alpha0<_.m_sweep.alpha0?(A=_.m_sweep.alpha0,x.m_sweep.Advance(A)):_.m_sweep.alpha0<x.m_sweep.alpha0&&(A=x.m_sweep.alpha0,_.m_sweep.Advance(A));let k=d.GetChildIndexA(),M=d.GetChildIndexB(),E=i.SolveTOI_s_toi_input;E.proxyA.SetShape(f.GetShape(),k),E.proxyB.SetShape(b.GetShape(),M),E.sweepA.Copy(x.m_sweep),E.sweepB.Copy(_.m_sweep),E.tMax=1;let L=i.SolveTOI_s_toi_output;za(L,E);let U=L.t;L.state===3?h=Math.min(A+(1-A)*U,1):h=1,d.m_toi=h,d.m_toiFlag=!0}h<o&&(r=d,o=h)}if(r===null||1-10*gt<o){this.m_stepComplete=!0;break}let s=r.GetFixtureA(),l=r.GetFixtureB(),a=s.GetBody(),c=l.GetBody(),u=i.SolveTOI_s_backup1.Copy(a.m_sweep),m=i.SolveTOI_s_backup2.Copy(c.m_sweep);if(a.Advance(o),c.Advance(o),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,!r.IsEnabled()||!r.IsTouching()){r.SetEnabled(!1),a.m_sweep.Copy(u),c.m_sweep.Copy(m),a.SynchronizeTransform(),c.SynchronizeTransform();continue}a.SetAwake(!0),c.SetAwake(!0),e.Clear(),e.AddBody(a),e.AddBody(c),e.AddContact(r),a.m_islandFlag=!0,c.m_islandFlag=!0,r.m_islandFlag=!0;for(let d=0;d<2;++d){let h=d===0?a:c;if(h.m_type===2)for(let f=h.m_contactList;f&&!(e.m_bodyCount===e.m_bodyCapacity||e.m_contactCount===ka);f=f.next){let{contact:b}=f;if(b.m_islandFlag)continue;let{other:x}=f;if(x.m_type===2&&!h.IsBullet()&&!x.IsBullet())continue;let _=b.m_fixtureA.m_isSensor,y=b.m_fixtureB.m_isSensor;if(_||y)continue;let g=i.SolveTOI_s_backup.Copy(x.m_sweep);if(x.m_islandFlag||x.Advance(o),b.Update(this.m_contactManager.m_contactListener),!b.IsEnabled()){x.m_sweep.Copy(g),x.SynchronizeTransform();continue}if(!b.IsTouching()){x.m_sweep.Copy(g),x.SynchronizeTransform();continue}b.m_islandFlag=!0,e.AddContact(b),!x.m_islandFlag&&(x.m_islandFlag=!0,x.m_type!==0&&x.SetAwake(!0),e.AddBody(x))}}let p=i.SolveTOI_s_subStep;p.dt=(1-o)*t.dt,p.inv_dt=1/p.dt,p.dtRatio=1,p.config={...t.config,positionIterations:20},p.warmStarting=!1,e.SolveTOI(p,a.m_islandIndex,c.m_islandIndex);for(let d=0;d<e.m_bodyCount;++d){let h=e.m_bodies[d];if(h.m_islandFlag=!1,h.m_type===2){h.SynchronizeFixtures();for(let f=h.m_contactList;f;f=f.next)f.contact.m_toiFlag=!1,f.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}};var er={J1:new n,J2:new n,J3:new n,r:new n,e1:new n,e2:new n,Jd1:new n,Jd2:new n,d:new n,u:new n,dp1:new n,dp2:new n,dp3:new n,d1:new n,d2:new n,dHat:new n};var us=class{constructor(){this.stretchingModel=0;this.bendingModel=1;this.damping=0;this.stretchStiffness=1;this.stretchHertz=1;this.stretchDamping=0;this.bendStiffness=.5;this.bendHertz=1;this.bendDamping=0;this.isometric=!1;this.fixedEffectiveMass=!1;this.warmStart=!1}Copy(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}},cd=class{constructor(){this.i1=0;this.i2=0;this.invMass1=0;this.invMass2=0;this.L=0;this.lambda=0;this.spring=0;this.damper=0}},ud=class{constructor(){this.i1=0;this.i2=0;this.i3=0;this.invMass1=0;this.invMass2=0;this.invMass3=0;this.invEffectiveMass=0;this.lambda=0;this.L1=0;this.L2=0;this.alpha1=0;this.alpha2=0;this.spring=0;this.damper=0}},kn=class{constructor(t){this.m_position=new n;this.m_count=0;this.m_stretchCount=0;this.m_bendCount=0;this.m_gravity=new n;this.m_tuning=new us;N(t.vertices.length>=3),this.m_position.Copy(t.position),this.m_count=t.vertices.length,this.m_bindPositions=H(this.m_count,n),this.m_ps=H(this.m_count,n),this.m_p0s=H(this.m_count,n),this.m_vs=H(this.m_count,n),this.m_invMasses=je(this.m_count);for(let u=0;u<this.m_count;++u){this.m_bindPositions[u].Copy(t.vertices[u]),n.Add(t.vertices[u],this.m_position,this.m_ps[u]),n.Add(t.vertices[u],this.m_position,this.m_p0s[u]),this.m_vs[u].SetZero();let m=t.masses[u];m>0?this.m_invMasses[u]=1/m:this.m_invMasses[u]=0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,this.m_stretchConstraints=new Array(this.m_stretchCount);for(let u=0;u<this.m_stretchCount;u++)this.m_stretchConstraints[u]=new cd;this.m_bendConstraints=new Array(this.m_bendCount);for(let u=0;u<this.m_bendCount;u++)this.m_bendConstraints[u]=new ud;for(let u=0;u<this.m_stretchCount;++u){let m=this.m_stretchConstraints[u],p=this.m_ps[u],d=this.m_ps[u+1];m.i1=u,m.i2=u+1,m.L=n.Distance(p,d),m.invMass1=this.m_invMasses[u],m.invMass2=this.m_invMasses[u+1],m.lambda=0,m.damper=0,m.spring=0}let{J1:e,J2:r,r:o,e1:s,e2:l,Jd1:a,Jd2:c}=er;for(let u=0;u<this.m_bendCount;++u){let m=this.m_bendConstraints[u],p=this.m_ps[u],d=this.m_ps[u+1],h=this.m_ps[u+2];m.i1=u,m.i2=u+1,m.i3=u+2,m.invMass1=this.m_invMasses[u],m.invMass2=this.m_invMasses[u+1],m.invMass3=this.m_invMasses[u+2],m.invEffectiveMass=0,m.L1=n.Distance(p,d),m.L2=n.Distance(d,h),m.lambda=0,n.Subtract(d,p,s),n.Subtract(h,d,l);let f=s.LengthSquared(),b=l.LengthSquared();if(f*b===0)continue;n.Skew(s,a).Scale(-1/f),n.Skew(l,c).Scale(1/b),n.Negate(a,e),n.Subtract(a,c,r);let x=c;m.invEffectiveMass=m.invMass1*n.Dot(e,e)+m.invMass2*n.Dot(r,r)+m.invMass3*n.Dot(x,x),n.Subtract(h,p,o);let _=o.LengthSquared();_!==0&&(m.alpha1=n.Dot(l,o)/_,m.alpha2=n.Dot(s,o)/_)}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}SetTuning(t){this.m_tuning.Copy(t);let e=2*Math.PI*this.m_tuning.bendHertz;for(let o=0;o<this.m_bendCount;++o){let s=this.m_bendConstraints[o],l=s.L1*s.L1,a=s.L2*s.L2;if(l*a===0){s.spring=0,s.damper=0;continue}let c=1/s.L1+1/s.L2,u=s.invMass1/l+s.invMass2*c*c+s.invMass3/a;if(u===0){s.spring=0,s.damper=0;continue}let m=1/u;s.spring=m*e*e,s.damper=2*m*this.m_tuning.bendDamping*e}let r=2*Math.PI*this.m_tuning.stretchHertz;for(let o=0;o<this.m_stretchCount;++o){let s=this.m_stretchConstraints[o],l=s.invMass1+s.invMass2;if(l===0)continue;let a=1/l;s.spring=a*r*r,s.damper=2*a*this.m_tuning.stretchDamping*r}}Step(t,e,r){if(t===0)return;let o=1/t,s=Math.exp(-t*this.m_tuning.damping);for(let l=0;l<this.m_count;++l)this.m_invMasses[l]>0?(this.m_vs[l].Scale(s),this.m_vs[l].AddScaled(t,this.m_gravity)):(this.m_vs[l].x=o*(this.m_bindPositions[l].x+r.x-this.m_p0s[l].x),this.m_vs[l].y=o*(this.m_bindPositions[l].y+r.y-this.m_p0s[l].y));this.m_tuning.bendingModel===0&&this.ApplyBendForces(t);for(let l=0;l<this.m_bendCount;++l)this.m_bendConstraints[l].lambda=0;for(let l=0;l<this.m_stretchCount;++l)this.m_stretchConstraints[l].lambda=0;for(let l=0;l<this.m_count;++l)this.m_ps[l].AddScaled(t,this.m_vs[l]);for(let l=0;l<e;++l)this.m_tuning.bendingModel===1?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===2?this.SolveBend_XPBD_Angle(t):this.m_tuning.bendingModel===3?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===4?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===5&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===0?this.SolveStretch_PBD():this.m_tuning.stretchingModel===1&&this.SolveStretch_XPBD(t);for(let l=0;l<this.m_count;++l)this.m_vs[l].x=o*(this.m_ps[l].x-this.m_p0s[l].x),this.m_vs[l].y=o*(this.m_ps[l].y-this.m_p0s[l].y),this.m_p0s[l].Copy(this.m_ps[l])}Reset(t){this.m_position.Copy(t);for(let e=0;e<this.m_count;++e)n.Add(this.m_bindPositions[e],this.m_position,this.m_ps[e]),this.m_p0s[e].Copy(this.m_ps[e]),this.m_vs[e].SetZero();for(let e=0;e<this.m_bendCount;++e)this.m_bendConstraints[e].lambda=0;for(let e=0;e<this.m_stretchCount;++e)this.m_stretchConstraints[e].lambda=0}SolveStretch_PBD(){let t=this.m_tuning.stretchStiffness,{d:e}=er;for(let r=0;r<this.m_stretchCount;++r){let o=this.m_stretchConstraints[r],s=this.m_ps[o.i1],l=this.m_ps[o.i2];n.Subtract(l,s,e);let a=e.Normalize(),c=o.invMass1+o.invMass2;if(c===0)continue;let u=o.invMass1/c,m=o.invMass2/c;s.SubtractScaled(t*u*(o.L-a),e),l.AddScaled(t*m*(o.L-a),e)}}SolveStretch_XPBD(t){let{dp1:e,dp2:r,u:o,J1:s}=er;for(let l=0;l<this.m_stretchCount;++l){let a=this.m_stretchConstraints[l],c=this.m_ps[a.i1],u=this.m_ps[a.i2];n.Subtract(c,this.m_p0s[a.i1],e),n.Subtract(u,this.m_p0s[a.i2],r),n.Subtract(u,c,o);let m=o.Normalize();n.Negate(o,s);let p=o,d=a.invMass1+a.invMass2;if(d===0)continue;let h=1/(a.spring*t*t),f=t*t*a.damper,b=h*f/t,x=m-a.L,_=n.Dot(s,e)+n.Dot(p,r),y=x+h*a.lambda+b*_,g=(1+b)*d+h,S=-y/g;c.AddScaled(a.invMass1*S,s),u.AddScaled(a.invMass2*S,p),a.lambda+=S}}SolveBend_PBD_Angle(){let t=this.m_tuning.bendStiffness,{Jd1:e,Jd2:r,J1:o,J2:s,d1:l,d2:a}=er;for(let c=0;c<this.m_bendCount;++c){let u=this.m_bendConstraints[c],m=this.m_ps[u.i1],p=this.m_ps[u.i2],d=this.m_ps[u.i3];n.Subtract(p,m,l),n.Subtract(d,p,a);let h=n.Cross(l,a),f=n.Dot(l,a),b=Math.atan2(h,f),x,_;if(this.m_tuning.isometric?(x=u.L1*u.L1,_=u.L2*u.L2):(x=l.LengthSquared(),_=a.LengthSquared()),x*_===0)continue;n.Skew(l,e).Scale(-1/x),n.Skew(a,r).Scale(1/_),n.Negate(e,o),n.Subtract(e,r,s);let y=r,g;this.m_tuning.fixedEffectiveMass?g=u.invEffectiveMass:g=u.invMass1*n.Dot(o,o)+u.invMass2*n.Dot(s,s)+u.invMass3*n.Dot(y,y),g===0&&(g=u.invEffectiveMass);let S=-t*b/g;m.AddScaled(u.invMass1*S,o),p.AddScaled(u.invMass2*S,s),d.AddScaled(u.invMass3*S,y)}}SolveBend_XPBD_Angle(t){let{dp1:e,dp2:r,dp3:o,d1:s,d2:l,Jd1:a,Jd2:c,J1:u,J2:m}=er;for(let p=0;p<this.m_bendCount;++p){let d=this.m_bendConstraints[p],h=this.m_ps[d.i1],f=this.m_ps[d.i2],b=this.m_ps[d.i3];n.Subtract(h,this.m_p0s[d.i1],e),n.Subtract(f,this.m_p0s[d.i2],r),n.Subtract(b,this.m_p0s[d.i3],o),n.Subtract(f,h,s),n.Subtract(b,f,l);let x,_;if(this.m_tuning.isometric?(x=d.L1*d.L1,_=d.L2*d.L2):(x=s.LengthSquared(),_=l.LengthSquared()),x*_===0)continue;let y=n.Cross(s,l),g=n.Dot(s,l),S=Math.atan2(y,g);n.Skew(s,a).Scale(-1/x),n.Skew(l,c).Scale(1/_),n.Negate(a,u),n.Subtract(a,c,m);let w=c,B;if(this.m_tuning.fixedEffectiveMass?B=d.invEffectiveMass:B=d.invMass1*n.Dot(u,u)+d.invMass2*n.Dot(m,m)+d.invMass3*n.Dot(w,w),B===0)continue;let C=1/(d.spring*t*t),A=t*t*d.damper,k=C*A/t,M=S,E=n.Dot(u,e)+n.Dot(m,r)+n.Dot(w,o),L=M+C*d.lambda+k*E,U=(1+k)*B+C,Y=-L/U;h.AddScaled(d.invMass1*Y,u),f.AddScaled(d.invMass2*Y,m),b.AddScaled(d.invMass3*Y,w),d.lambda+=Y}}SolveBend_PBD_Distance(){let t=this.m_tuning.bendStiffness,{d:e}=er;for(let r=0;r<this.m_bendCount;++r){let o=this.m_bendConstraints[r],{i1:s}=o,l=o.i3,a=this.m_ps[s],c=this.m_ps[l];n.Subtract(c,a,e);let u=e.Normalize(),m=o.invMass1+o.invMass3;if(m===0)continue;let p=o.invMass1/m,d=o.invMass3/m;a.SubtractScaled(t*p*(o.L1+o.L2-u),e),c.AddScaled(t*d*(o.L1+o.L2-u),e)}}SolveBend_PBD_Height(){let t=this.m_tuning.bendStiffness,{dHat:e,J1:r,J2:o,J3:s,d:l}=er;for(let a=0;a<this.m_bendCount;++a){let c=this.m_bendConstraints[a],u=this.m_ps[c.i1],m=this.m_ps[c.i2],p=this.m_ps[c.i3];l.x=c.alpha1*u.x+c.alpha2*p.x-m.x,l.y=c.alpha1*u.y+c.alpha2*p.y-m.y;let d=l.Length();if(d===0)continue;n.Scale(1/d,l,e),n.Scale(c.alpha1,e,r),n.Negate(e,o),n.Scale(c.alpha2,e,s);let h=c.invMass1*c.alpha1*c.alpha1+c.invMass2+c.invMass3*c.alpha2*c.alpha2;if(h===0)continue;let f=d,b=1/h,x=-t*b*f;u.AddScaled(c.invMass1*x,r),m.AddScaled(c.invMass2*x,o),p.AddScaled(c.invMass3*x,s)}}SolveBend_PBD_Triangle(){let t=this.m_tuning.bendStiffness,{d:e}=er;for(let r=0;r<this.m_bendCount;++r){let o=this.m_bendConstraints[r],s=this.m_ps[o.i1],l=this.m_ps[o.i2],a=this.m_ps[o.i3],c=o.invMass1,u=o.invMass2,m=o.invMass3,p=c+m+2*u,d=t/p;e.x=l.x-1/3*(s.x+l.x+a.x),e.y=l.y-1/3*(s.y+l.y+a.y),s.AddScaled(2*c*d,e),l.AddScaled(-4*u*d,e),a.AddScaled(2*m*d,e)}}ApplyBendForces(t){let e=2*Math.PI*this.m_tuning.bendHertz,{d1:r,d2:o,Jd1:s,Jd2:l,J1:a,J2:c}=er;for(let u=0;u<this.m_bendCount;++u){let m=this.m_bendConstraints[u],p=this.m_ps[m.i1],d=this.m_ps[m.i2],h=this.m_ps[m.i3],f=this.m_vs[m.i1],b=this.m_vs[m.i2],x=this.m_vs[m.i3];n.Subtract(d,p,r),n.Subtract(h,d,o);let _,y;if(this.m_tuning.isometric?(_=m.L1*m.L1,y=m.L2*m.L2):(_=r.LengthSquared(),y=o.LengthSquared()),_*y===0)continue;let g=n.Cross(r,o),S=n.Dot(r,o),w=Math.atan2(g,S);n.Skew(r,s).Scale(-1/_),n.Skew(o,l).Scale(1/y),n.Negate(s,a),n.Subtract(s,l,c);let B=l,C;if(this.m_tuning.fixedEffectiveMass?C=m.invEffectiveMass:C=m.invMass1*n.Dot(a,a)+m.invMass2*n.Dot(c,c)+m.invMass3*n.Dot(B,B),C===0)continue;let A=1/C,k=A*e*e,M=2*A*this.m_tuning.bendDamping*e,E=w,L=n.Dot(a,f)+n.Dot(c,b)+n.Dot(B,x),U=-t*(k*E+M*L);this.m_vs[m.i1].AddScaled(m.invMass1*U,a),this.m_vs[m.i2].AddScaled(m.invMass2*U,c),this.m_vs[m.i3].AddScaled(m.invMass3*U,B)}}Draw(t){for(let r=0;r<this.m_count-1;++r){t.DrawSegment(this.m_ps[r],this.m_ps[r+1],Q.rope);let o=this.m_invMasses[r]>0?Q.ropePointD:Q.ropePointG;t.DrawPoint(this.m_ps[r],5,o)}let e=this.m_invMasses[this.m_count-1]>0?Q.ropePointD:Q.ropePointG;t.DrawPoint(this.m_ps[this.m_count-1],5,e)}};var p1=new F(.5,.9,.5),Fn=class i{ctx;center=new n;zoom=1;constructor(t){this.ctx=t}Prepare(t,e,r,o=!1){this.center.Set(t,e),this.zoom=r,this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.ctx.translate(.5*this.ctx.canvas.width,.5*this.ctx.canvas.height),o&&this.ctx.scale(1,-1),this.ctx.scale(r,r),this.ctx.lineWidth/=r,this.ctx.translate(-t,-e)}Finish(){this.ctx.restore()}PushTransform(t){this.ctx.save(),this.ctx.translate(t.p.x,t.p.y),this.ctx.rotate(t.q.GetAngle())}PopTransform(t){this.ctx.restore()}DrawPolygon(t,e,r){if(!(e<2)){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let o=1;o<e;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}}DrawSolidPolygon(t,e,r){if(!(e<2)){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let o=1;o<e;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.fillStyle=i.MakeStyleString(r,.5),this.ctx.fill(),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}}DrawCircle(t,e,r){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2,!0),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}DrawSolidCircle(t,e,r,o){let s=t.x,l=t.y;this.ctx.beginPath(),this.ctx.arc(s,l,e,0,Math.PI*2,!0),this.ctx.moveTo(s,l),this.ctx.lineTo(s+r.x*e,l+r.y*e),this.ctx.fillStyle=i.MakeStyleString(o,.5),this.ctx.fill(),this.ctx.strokeStyle=i.MakeStyleString(o,1),this.ctx.stroke()}DrawParticles(t,e,r,o){if(r)for(let s=0;s<o;++s){let l=t[s],a=r[s];this.ctx.fillStyle=i.MakeStyleString(a),this.ctx.beginPath(),this.ctx.arc(l.x,l.y,e,0,Math.PI*2,!0),this.ctx.fill()}else{this.ctx.fillStyle="rgba(255,255,255,0.5)";for(let s=0;s<o;++s){let l=t[s];this.ctx.beginPath(),this.ctx.arc(l.x,l.y,e,0,Math.PI*2,!0),this.ctx.fill()}}}DrawSegment(t,e,r){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}DrawTransform(t){this.PushTransform(t),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(1,0),this.ctx.strokeStyle=i.MakeStyleString(F.RED),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(0,1),this.ctx.strokeStyle=i.MakeStyleString(F.GREEN),this.ctx.stroke(),this.PopTransform(t)}DrawPoint(t,e,r){this.ctx.fillStyle=i.MakeStyleString(r),e/=this.zoom;let o=e/2;this.ctx.fillRect(t.x-o,t.y-o,e,e)}DrawString(t,e,r,o){this.ctx.font="16px Open Sans",this.ctx.textAlign=r,this.ctx.fillStyle=i.MakeStyleString(F.WHITE),this.ctx.fillText(o,t,e)}DrawStringWorld(t,e,r){let o=(t-this.center.x)*this.zoom+.5*this.ctx.canvas.width,s=(e-this.center.y)*-this.zoom+.5*this.ctx.canvas.height;this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.font="15px Open Sans",this.ctx.fillStyle=i.MakeStyleString(p1),this.ctx.fillText(r,o,s),this.ctx.restore()}DrawAABB(t,e){this.ctx.strokeStyle=i.MakeStyleString(e);let{x:r,y:o}=t.lowerBound,s=t.upperBound.x-r,l=t.upperBound.y-o;this.ctx.strokeRect(r,o,s,l)}static MakeStyleString(t,e=t.a){let r=tt(t.r*255,0,255),o=tt(t.g*255,0,255),s=tt(t.b*255,0,255);return e<1?(e=tt(e,0,1),`rgba(${r},${o},${s},${e})`):`rgb(${r},${o},${s})`}};var Su=mt(Ut()),Mx=mt(C0());var St=1e-6,ri=typeof Float32Array<"u"?Float32Array:Array,gd=Math.random;var lF=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var gi={};Of(gi,{add:()=>uB,adjoint:()=>I1,clone:()=>P1,copy:()=>D1,create:()=>T1,determinant:()=>L1,equals:()=>hB,exactEquals:()=>dB,frob:()=>cB,fromQuat:()=>$1,fromQuat2:()=>Z1,fromRotation:()=>X1,fromRotationTranslation:()=>D0,fromRotationTranslationScale:()=>W1,fromRotationTranslationScaleOrigin:()=>K1,fromScaling:()=>z1,fromTranslation:()=>j1,fromValues:()=>M1,fromXRotation:()=>H1,fromYRotation:()=>O1,fromZRotation:()=>N1,frustum:()=>tB,getRotation:()=>q1,getScaling:()=>M0,getTranslation:()=>Q1,identity:()=>T0,invert:()=>F1,lookAt:()=>nB,mul:()=>fB,multiply:()=>P0,multiplyScalar:()=>mB,multiplyScalarAndAdd:()=>pB,ortho:()=>oB,orthoNO:()=>k0,orthoZO:()=>sB,perspective:()=>eB,perspectiveFromFieldOfView:()=>rB,perspectiveNO:()=>R0,perspectiveZO:()=>iB,rotate:()=>E1,rotateX:()=>U1,rotateY:()=>Y1,rotateZ:()=>J1,scale:()=>V1,set:()=>R1,str:()=>aB,sub:()=>bB,subtract:()=>F0,targetTo:()=>lB,translate:()=>G1,transpose:()=>k1});function T1(){var i=new ri(16);return ri!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function P1(i){var t=new ri(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function D1(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function M1(i,t,e,r,o,s,l,a,c,u,m,p,d,h,f,b){var x=new ri(16);return x[0]=i,x[1]=t,x[2]=e,x[3]=r,x[4]=o,x[5]=s,x[6]=l,x[7]=a,x[8]=c,x[9]=u,x[10]=m,x[11]=p,x[12]=d,x[13]=h,x[14]=f,x[15]=b,x}function R1(i,t,e,r,o,s,l,a,c,u,m,p,d,h,f,b,x){return i[0]=t,i[1]=e,i[2]=r,i[3]=o,i[4]=s,i[5]=l,i[6]=a,i[7]=c,i[8]=u,i[9]=m,i[10]=p,i[11]=d,i[12]=h,i[13]=f,i[14]=b,i[15]=x,i}function T0(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function k1(i,t){if(i===t){var e=t[1],r=t[2],o=t[3],s=t[6],l=t[7],a=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=r,i[9]=s,i[11]=t[14],i[12]=o,i[13]=l,i[14]=a}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function F1(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],a=t[5],c=t[6],u=t[7],m=t[8],p=t[9],d=t[10],h=t[11],f=t[12],b=t[13],x=t[14],_=t[15],y=e*a-r*l,g=e*c-o*l,S=e*u-s*l,w=r*c-o*a,B=r*u-s*a,C=o*u-s*c,A=m*b-p*f,k=m*x-d*f,M=m*_-h*f,E=p*x-d*b,L=p*_-h*b,U=d*_-h*x,Y=y*U-g*L+S*E+w*M-B*k+C*A;return Y?(Y=1/Y,i[0]=(a*U-c*L+u*E)*Y,i[1]=(o*L-r*U-s*E)*Y,i[2]=(b*C-x*B+_*w)*Y,i[3]=(d*B-p*C-h*w)*Y,i[4]=(c*M-l*U-u*k)*Y,i[5]=(e*U-o*M+s*k)*Y,i[6]=(x*S-f*C-_*g)*Y,i[7]=(m*C-d*S+h*g)*Y,i[8]=(l*L-a*M+u*A)*Y,i[9]=(r*M-e*L-s*A)*Y,i[10]=(f*B-b*S+_*y)*Y,i[11]=(p*S-m*B-h*y)*Y,i[12]=(a*k-l*E-c*A)*Y,i[13]=(e*E-r*k+o*A)*Y,i[14]=(b*g-f*w-x*y)*Y,i[15]=(m*w-p*g+d*y)*Y,i):null}function I1(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],a=t[5],c=t[6],u=t[7],m=t[8],p=t[9],d=t[10],h=t[11],f=t[12],b=t[13],x=t[14],_=t[15];return i[0]=a*(d*_-h*x)-p*(c*_-u*x)+b*(c*h-u*d),i[1]=-(r*(d*_-h*x)-p*(o*_-s*x)+b*(o*h-s*d)),i[2]=r*(c*_-u*x)-a*(o*_-s*x)+b*(o*u-s*c),i[3]=-(r*(c*h-u*d)-a*(o*h-s*d)+p*(o*u-s*c)),i[4]=-(l*(d*_-h*x)-m*(c*_-u*x)+f*(c*h-u*d)),i[5]=e*(d*_-h*x)-m*(o*_-s*x)+f*(o*h-s*d),i[6]=-(e*(c*_-u*x)-l*(o*_-s*x)+f*(o*u-s*c)),i[7]=e*(c*h-u*d)-l*(o*h-s*d)+m*(o*u-s*c),i[8]=l*(p*_-h*b)-m*(a*_-u*b)+f*(a*h-u*p),i[9]=-(e*(p*_-h*b)-m*(r*_-s*b)+f*(r*h-s*p)),i[10]=e*(a*_-u*b)-l*(r*_-s*b)+f*(r*u-s*a),i[11]=-(e*(a*h-u*p)-l*(r*h-s*p)+m*(r*u-s*a)),i[12]=-(l*(p*x-d*b)-m*(a*x-c*b)+f*(a*d-c*p)),i[13]=e*(p*x-d*b)-m*(r*x-o*b)+f*(r*d-o*p),i[14]=-(e*(a*x-c*b)-l*(r*x-o*b)+f*(r*c-o*a)),i[15]=e*(a*d-c*p)-l*(r*d-o*p)+m*(r*c-o*a),i}function L1(i){var t=i[0],e=i[1],r=i[2],o=i[3],s=i[4],l=i[5],a=i[6],c=i[7],u=i[8],m=i[9],p=i[10],d=i[11],h=i[12],f=i[13],b=i[14],x=i[15],_=t*l-e*s,y=t*a-r*s,g=t*c-o*s,S=e*a-r*l,w=e*c-o*l,B=r*c-o*a,C=u*f-m*h,A=u*b-p*h,k=u*x-d*h,M=m*b-p*f,E=m*x-d*f,L=p*x-d*b;return _*L-y*E+g*M+S*k-w*A+B*C}function P0(i,t,e){var r=t[0],o=t[1],s=t[2],l=t[3],a=t[4],c=t[5],u=t[6],m=t[7],p=t[8],d=t[9],h=t[10],f=t[11],b=t[12],x=t[13],_=t[14],y=t[15],g=e[0],S=e[1],w=e[2],B=e[3];return i[0]=g*r+S*a+w*p+B*b,i[1]=g*o+S*c+w*d+B*x,i[2]=g*s+S*u+w*h+B*_,i[3]=g*l+S*m+w*f+B*y,g=e[4],S=e[5],w=e[6],B=e[7],i[4]=g*r+S*a+w*p+B*b,i[5]=g*o+S*c+w*d+B*x,i[6]=g*s+S*u+w*h+B*_,i[7]=g*l+S*m+w*f+B*y,g=e[8],S=e[9],w=e[10],B=e[11],i[8]=g*r+S*a+w*p+B*b,i[9]=g*o+S*c+w*d+B*x,i[10]=g*s+S*u+w*h+B*_,i[11]=g*l+S*m+w*f+B*y,g=e[12],S=e[13],w=e[14],B=e[15],i[12]=g*r+S*a+w*p+B*b,i[13]=g*o+S*c+w*d+B*x,i[14]=g*s+S*u+w*h+B*_,i[15]=g*l+S*m+w*f+B*y,i}function G1(i,t,e){var r=e[0],o=e[1],s=e[2],l,a,c,u,m,p,d,h,f,b,x,_;return t===i?(i[12]=t[0]*r+t[4]*o+t[8]*s+t[12],i[13]=t[1]*r+t[5]*o+t[9]*s+t[13],i[14]=t[2]*r+t[6]*o+t[10]*s+t[14],i[15]=t[3]*r+t[7]*o+t[11]*s+t[15]):(l=t[0],a=t[1],c=t[2],u=t[3],m=t[4],p=t[5],d=t[6],h=t[7],f=t[8],b=t[9],x=t[10],_=t[11],i[0]=l,i[1]=a,i[2]=c,i[3]=u,i[4]=m,i[5]=p,i[6]=d,i[7]=h,i[8]=f,i[9]=b,i[10]=x,i[11]=_,i[12]=l*r+m*o+f*s+t[12],i[13]=a*r+p*o+b*s+t[13],i[14]=c*r+d*o+x*s+t[14],i[15]=u*r+h*o+_*s+t[15]),i}function V1(i,t,e){var r=e[0],o=e[1],s=e[2];return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*o,i[5]=t[5]*o,i[6]=t[6]*o,i[7]=t[7]*o,i[8]=t[8]*s,i[9]=t[9]*s,i[10]=t[10]*s,i[11]=t[11]*s,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function E1(i,t,e,r){var o=r[0],s=r[1],l=r[2],a=Math.hypot(o,s,l),c,u,m,p,d,h,f,b,x,_,y,g,S,w,B,C,A,k,M,E,L,U,Y,O;return a<St?null:(a=1/a,o*=a,s*=a,l*=a,c=Math.sin(e),u=Math.cos(e),m=1-u,p=t[0],d=t[1],h=t[2],f=t[3],b=t[4],x=t[5],_=t[6],y=t[7],g=t[8],S=t[9],w=t[10],B=t[11],C=o*o*m+u,A=s*o*m+l*c,k=l*o*m-s*c,M=o*s*m-l*c,E=s*s*m+u,L=l*s*m+o*c,U=o*l*m+s*c,Y=s*l*m-o*c,O=l*l*m+u,i[0]=p*C+b*A+g*k,i[1]=d*C+x*A+S*k,i[2]=h*C+_*A+w*k,i[3]=f*C+y*A+B*k,i[4]=p*M+b*E+g*L,i[5]=d*M+x*E+S*L,i[6]=h*M+_*E+w*L,i[7]=f*M+y*E+B*L,i[8]=p*U+b*Y+g*O,i[9]=d*U+x*Y+S*O,i[10]=h*U+_*Y+w*O,i[11]=f*U+y*Y+B*O,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function U1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[4],l=t[5],a=t[6],c=t[7],u=t[8],m=t[9],p=t[10],d=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=s*o+u*r,i[5]=l*o+m*r,i[6]=a*o+p*r,i[7]=c*o+d*r,i[8]=u*o-s*r,i[9]=m*o-l*r,i[10]=p*o-a*r,i[11]=d*o-c*r,i}function Y1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[0],l=t[1],a=t[2],c=t[3],u=t[8],m=t[9],p=t[10],d=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*o-u*r,i[1]=l*o-m*r,i[2]=a*o-p*r,i[3]=c*o-d*r,i[8]=s*r+u*o,i[9]=l*r+m*o,i[10]=a*r+p*o,i[11]=c*r+d*o,i}function J1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[0],l=t[1],a=t[2],c=t[3],u=t[4],m=t[5],p=t[6],d=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*o+u*r,i[1]=l*o+m*r,i[2]=a*o+p*r,i[3]=c*o+d*r,i[4]=u*o-s*r,i[5]=m*o-l*r,i[6]=p*o-a*r,i[7]=d*o-c*r,i}function j1(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function z1(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function X1(i,t,e){var r=e[0],o=e[1],s=e[2],l=Math.hypot(r,o,s),a,c,u;return l<St?null:(l=1/l,r*=l,o*=l,s*=l,a=Math.sin(t),c=Math.cos(t),u=1-c,i[0]=r*r*u+c,i[1]=o*r*u+s*a,i[2]=s*r*u-o*a,i[3]=0,i[4]=r*o*u-s*a,i[5]=o*o*u+c,i[6]=s*o*u+r*a,i[7]=0,i[8]=r*s*u+o*a,i[9]=o*s*u-r*a,i[10]=s*s*u+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function H1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function O1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=r,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function N1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=r,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function D0(i,t,e){var r=t[0],o=t[1],s=t[2],l=t[3],a=r+r,c=o+o,u=s+s,m=r*a,p=r*c,d=r*u,h=o*c,f=o*u,b=s*u,x=l*a,_=l*c,y=l*u;return i[0]=1-(h+b),i[1]=p+y,i[2]=d-_,i[3]=0,i[4]=p-y,i[5]=1-(m+b),i[6]=f+x,i[7]=0,i[8]=d+_,i[9]=f-x,i[10]=1-(m+h),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function Z1(i,t){var e=new ri(3),r=-t[0],o=-t[1],s=-t[2],l=t[3],a=t[4],c=t[5],u=t[6],m=t[7],p=r*r+o*o+s*s+l*l;return p>0?(e[0]=(a*l+m*r+c*s-u*o)*2/p,e[1]=(c*l+m*o+u*r-a*s)*2/p,e[2]=(u*l+m*s+a*o-c*r)*2/p):(e[0]=(a*l+m*r+c*s-u*o)*2,e[1]=(c*l+m*o+u*r-a*s)*2,e[2]=(u*l+m*s+a*o-c*r)*2),D0(i,t,e),i}function Q1(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i}function M0(i,t){var e=t[0],r=t[1],o=t[2],s=t[4],l=t[5],a=t[6],c=t[8],u=t[9],m=t[10];return i[0]=Math.hypot(e,r,o),i[1]=Math.hypot(s,l,a),i[2]=Math.hypot(c,u,m),i}function q1(i,t){var e=new ri(3);M0(e,t);var r=1/e[0],o=1/e[1],s=1/e[2],l=t[0]*r,a=t[1]*o,c=t[2]*s,u=t[4]*r,m=t[5]*o,p=t[6]*s,d=t[8]*r,h=t[9]*o,f=t[10]*s,b=l+m+f,x=0;return b>0?(x=Math.sqrt(b+1)*2,i[3]=.25*x,i[0]=(p-h)/x,i[1]=(d-c)/x,i[2]=(a-u)/x):l>m&&l>f?(x=Math.sqrt(1+l-m-f)*2,i[3]=(p-h)/x,i[0]=.25*x,i[1]=(a+u)/x,i[2]=(d+c)/x):m>f?(x=Math.sqrt(1+m-l-f)*2,i[3]=(d-c)/x,i[0]=(a+u)/x,i[1]=.25*x,i[2]=(p+h)/x):(x=Math.sqrt(1+f-l-m)*2,i[3]=(a-u)/x,i[0]=(d+c)/x,i[1]=(p+h)/x,i[2]=.25*x),i}function W1(i,t,e,r){var o=t[0],s=t[1],l=t[2],a=t[3],c=o+o,u=s+s,m=l+l,p=o*c,d=o*u,h=o*m,f=s*u,b=s*m,x=l*m,_=a*c,y=a*u,g=a*m,S=r[0],w=r[1],B=r[2];return i[0]=(1-(f+x))*S,i[1]=(d+g)*S,i[2]=(h-y)*S,i[3]=0,i[4]=(d-g)*w,i[5]=(1-(p+x))*w,i[6]=(b+_)*w,i[7]=0,i[8]=(h+y)*B,i[9]=(b-_)*B,i[10]=(1-(p+f))*B,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function K1(i,t,e,r,o){var s=t[0],l=t[1],a=t[2],c=t[3],u=s+s,m=l+l,p=a+a,d=s*u,h=s*m,f=s*p,b=l*m,x=l*p,_=a*p,y=c*u,g=c*m,S=c*p,w=r[0],B=r[1],C=r[2],A=o[0],k=o[1],M=o[2],E=(1-(b+_))*w,L=(h+S)*w,U=(f-g)*w,Y=(h-S)*B,O=(1-(d+_))*B,K=(x+y)*B,ut=(f+g)*C,lt=(x-y)*C,Tt=(1-(d+b))*C;return i[0]=E,i[1]=L,i[2]=U,i[3]=0,i[4]=Y,i[5]=O,i[6]=K,i[7]=0,i[8]=ut,i[9]=lt,i[10]=Tt,i[11]=0,i[12]=e[0]+A-(E*A+Y*k+ut*M),i[13]=e[1]+k-(L*A+O*k+lt*M),i[14]=e[2]+M-(U*A+K*k+Tt*M),i[15]=1,i}function $1(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=e+e,a=r+r,c=o+o,u=e*l,m=r*l,p=r*a,d=o*l,h=o*a,f=o*c,b=s*l,x=s*a,_=s*c;return i[0]=1-p-f,i[1]=m+_,i[2]=d-x,i[3]=0,i[4]=m-_,i[5]=1-u-f,i[6]=h+b,i[7]=0,i[8]=d+x,i[9]=h-b,i[10]=1-u-p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function tB(i,t,e,r,o,s,l){var a=1/(e-t),c=1/(o-r),u=1/(s-l);return i[0]=s*2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s*2*c,i[6]=0,i[7]=0,i[8]=(e+t)*a,i[9]=(o+r)*c,i[10]=(l+s)*u,i[11]=-1,i[12]=0,i[13]=0,i[14]=l*s*2*u,i[15]=0,i}function R0(i,t,e,r,o){var s=1/Math.tan(t/2),l;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(l=1/(r-o),i[10]=(o+r)*l,i[14]=2*o*r*l):(i[10]=-1,i[14]=-2*r),i}var eB=R0;function iB(i,t,e,r,o){var s=1/Math.tan(t/2),l;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(l=1/(r-o),i[10]=o*l,i[14]=o*r*l):(i[10]=-1,i[14]=-r),i}function rB(i,t,e,r){var o=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),l=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(l+a),u=2/(o+s);return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=-((l-a)*c*.5),i[9]=(o-s)*u*.5,i[10]=r/(e-r),i[11]=-1,i[12]=0,i[13]=0,i[14]=r*e/(e-r),i[15]=0,i}function k0(i,t,e,r,o,s,l){var a=1/(t-e),c=1/(r-o),u=1/(s-l);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*u,i[11]=0,i[12]=(t+e)*a,i[13]=(o+r)*c,i[14]=(l+s)*u,i[15]=1,i}var oB=k0;function sB(i,t,e,r,o,s,l){var a=1/(t-e),c=1/(r-o),u=1/(s-l);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=u,i[11]=0,i[12]=(t+e)*a,i[13]=(o+r)*c,i[14]=s*u,i[15]=1,i}function nB(i,t,e,r){var o,s,l,a,c,u,m,p,d,h,f=t[0],b=t[1],x=t[2],_=r[0],y=r[1],g=r[2],S=e[0],w=e[1],B=e[2];return Math.abs(f-S)<St&&Math.abs(b-w)<St&&Math.abs(x-B)<St?T0(i):(m=f-S,p=b-w,d=x-B,h=1/Math.hypot(m,p,d),m*=h,p*=h,d*=h,o=y*d-g*p,s=g*m-_*d,l=_*p-y*m,h=Math.hypot(o,s,l),h?(h=1/h,o*=h,s*=h,l*=h):(o=0,s=0,l=0),a=p*l-d*s,c=d*o-m*l,u=m*s-p*o,h=Math.hypot(a,c,u),h?(h=1/h,a*=h,c*=h,u*=h):(a=0,c=0,u=0),i[0]=o,i[1]=a,i[2]=m,i[3]=0,i[4]=s,i[5]=c,i[6]=p,i[7]=0,i[8]=l,i[9]=u,i[10]=d,i[11]=0,i[12]=-(o*f+s*b+l*x),i[13]=-(a*f+c*b+u*x),i[14]=-(m*f+p*b+d*x),i[15]=1,i)}function lB(i,t,e,r){var o=t[0],s=t[1],l=t[2],a=r[0],c=r[1],u=r[2],m=o-e[0],p=s-e[1],d=l-e[2],h=m*m+p*p+d*d;h>0&&(h=1/Math.sqrt(h),m*=h,p*=h,d*=h);var f=c*d-u*p,b=u*m-a*d,x=a*p-c*m;return h=f*f+b*b+x*x,h>0&&(h=1/Math.sqrt(h),f*=h,b*=h,x*=h),i[0]=f,i[1]=b,i[2]=x,i[3]=0,i[4]=p*x-d*b,i[5]=d*f-m*x,i[6]=m*b-p*f,i[7]=0,i[8]=m,i[9]=p,i[10]=d,i[11]=0,i[12]=o,i[13]=s,i[14]=l,i[15]=1,i}function aB(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"}function cB(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}function uB(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i[9]=t[9]+e[9],i[10]=t[10]+e[10],i[11]=t[11]+e[11],i[12]=t[12]+e[12],i[13]=t[13]+e[13],i[14]=t[14]+e[14],i[15]=t[15]+e[15],i}function F0(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i[9]=t[9]-e[9],i[10]=t[10]-e[10],i[11]=t[11]-e[11],i[12]=t[12]-e[12],i[13]=t[13]-e[13],i[14]=t[14]-e[14],i[15]=t[15]-e[15],i}function mB(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12]*e,i[13]=t[13]*e,i[14]=t[14]*e,i[15]=t[15]*e,i}function pB(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i[2]=t[2]+e[2]*r,i[3]=t[3]+e[3]*r,i[4]=t[4]+e[4]*r,i[5]=t[5]+e[5]*r,i[6]=t[6]+e[6]*r,i[7]=t[7]+e[7]*r,i[8]=t[8]+e[8]*r,i[9]=t[9]+e[9]*r,i[10]=t[10]+e[10]*r,i[11]=t[11]+e[11]*r,i[12]=t[12]+e[12]*r,i[13]=t[13]+e[13]*r,i[14]=t[14]+e[14]*r,i[15]=t[15]+e[15]*r,i}function dB(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]}function hB(i,t){var e=i[0],r=i[1],o=i[2],s=i[3],l=i[4],a=i[5],c=i[6],u=i[7],m=i[8],p=i[9],d=i[10],h=i[11],f=i[12],b=i[13],x=i[14],_=i[15],y=t[0],g=t[1],S=t[2],w=t[3],B=t[4],C=t[5],A=t[6],k=t[7],M=t[8],E=t[9],L=t[10],U=t[11],Y=t[12],O=t[13],K=t[14],ut=t[15];return Math.abs(e-y)<=St*Math.max(1,Math.abs(e),Math.abs(y))&&Math.abs(r-g)<=St*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(o-S)<=St*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-w)<=St*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-B)<=St*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(a-C)<=St*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(c-A)<=St*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-k)<=St*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(m-M)<=St*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-E)<=St*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-L)<=St*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(h-U)<=St*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(f-Y)<=St*Math.max(1,Math.abs(f),Math.abs(Y))&&Math.abs(b-O)<=St*Math.max(1,Math.abs(b),Math.abs(O))&&Math.abs(x-K)<=St*Math.max(1,Math.abs(x),Math.abs(K))&&Math.abs(_-ut)<=St*Math.max(1,Math.abs(_),Math.abs(ut))}var fB=P0,bB=F0;var In={};Of(In,{add:()=>SB,angle:()=>zB,bezier:()=>LB,ceil:()=>wB,clone:()=>_B,copy:()=>xB,create:()=>I0,cross:()=>kB,dist:()=>WB,distance:()=>U0,div:()=>qB,divide:()=>E0,dot:()=>j0,equals:()=>NB,exactEquals:()=>OB,floor:()=>vB,forEach:()=>eC,fromValues:()=>yB,hermite:()=>IB,inverse:()=>MB,len:()=>$B,length:()=>L0,lerp:()=>FB,max:()=>CB,min:()=>BB,mul:()=>QB,multiply:()=>V0,negate:()=>DB,normalize:()=>RB,random:()=>GB,rotateX:()=>YB,rotateY:()=>JB,rotateZ:()=>jB,round:()=>AB,scale:()=>TB,scaleAndAdd:()=>PB,set:()=>gB,sqrDist:()=>KB,sqrLen:()=>tC,squaredDistance:()=>Y0,squaredLength:()=>J0,str:()=>HB,sub:()=>ZB,subtract:()=>G0,transformMat3:()=>EB,transformMat4:()=>VB,transformQuat:()=>UB,zero:()=>XB});function I0(){var i=new ri(3);return ri!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _B(i){var t=new ri(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function L0(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function yB(i,t,e){var r=new ri(3);return r[0]=i,r[1]=t,r[2]=e,r}function xB(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function gB(i,t,e,r){return i[0]=t,i[1]=e,i[2]=r,i}function SB(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function G0(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function V0(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function E0(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function wB(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i}function vB(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i}function BB(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.min(t[2],e[2]),i}function CB(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i}function AB(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i}function TB(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function PB(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i[2]=t[2]+e[2]*r,i}function U0(i,t){var e=t[0]-i[0],r=t[1]-i[1],o=t[2]-i[2];return Math.hypot(e,r,o)}function Y0(i,t){var e=t[0]-i[0],r=t[1]-i[1],o=t[2]-i[2];return e*e+r*r+o*o}function J0(i){var t=i[0],e=i[1],r=i[2];return t*t+e*e+r*r}function DB(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function MB(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function RB(i,t){var e=t[0],r=t[1],o=t[2],s=e*e+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i}function j0(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function kB(i,t,e){var r=t[0],o=t[1],s=t[2],l=e[0],a=e[1],c=e[2];return i[0]=o*c-s*a,i[1]=s*l-r*c,i[2]=r*a-o*l,i}function FB(i,t,e,r){var o=t[0],s=t[1],l=t[2];return i[0]=o+r*(e[0]-o),i[1]=s+r*(e[1]-s),i[2]=l+r*(e[2]-l),i}function IB(i,t,e,r,o,s){var l=s*s,a=l*(2*s-3)+1,c=l*(s-2)+s,u=l*(s-1),m=l*(3-2*s);return i[0]=t[0]*a+e[0]*c+r[0]*u+o[0]*m,i[1]=t[1]*a+e[1]*c+r[1]*u+o[1]*m,i[2]=t[2]*a+e[2]*c+r[2]*u+o[2]*m,i}function LB(i,t,e,r,o,s){var l=1-s,a=l*l,c=s*s,u=a*l,m=3*s*a,p=3*c*l,d=c*s;return i[0]=t[0]*u+e[0]*m+r[0]*p+o[0]*d,i[1]=t[1]*u+e[1]*m+r[1]*p+o[1]*d,i[2]=t[2]*u+e[2]*m+r[2]*p+o[2]*d,i}function GB(i,t){t=t||1;var e=gd()*2*Math.PI,r=gd()*2-1,o=Math.sqrt(1-r*r)*t;return i[0]=Math.cos(e)*o,i[1]=Math.sin(e)*o,i[2]=r*t,i}function VB(i,t,e){var r=t[0],o=t[1],s=t[2],l=e[3]*r+e[7]*o+e[11]*s+e[15];return l=l||1,i[0]=(e[0]*r+e[4]*o+e[8]*s+e[12])/l,i[1]=(e[1]*r+e[5]*o+e[9]*s+e[13])/l,i[2]=(e[2]*r+e[6]*o+e[10]*s+e[14])/l,i}function EB(i,t,e){var r=t[0],o=t[1],s=t[2];return i[0]=r*e[0]+o*e[3]+s*e[6],i[1]=r*e[1]+o*e[4]+s*e[7],i[2]=r*e[2]+o*e[5]+s*e[8],i}function UB(i,t,e){var r=e[0],o=e[1],s=e[2],l=e[3],a=t[0],c=t[1],u=t[2],m=o*u-s*c,p=s*a-r*u,d=r*c-o*a,h=o*d-s*p,f=s*m-r*d,b=r*p-o*m,x=l*2;return m*=x,p*=x,d*=x,h*=2,f*=2,b*=2,i[0]=a+m+h,i[1]=c+p+f,i[2]=u+d+b,i}function YB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[0],s[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),s[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function JB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),s[1]=o[1],s[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function jB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),s[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),s[2]=o[2],i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function zB(i,t){var e=i[0],r=i[1],o=i[2],s=t[0],l=t[1],a=t[2],c=Math.sqrt(e*e+r*r+o*o),u=Math.sqrt(s*s+l*l+a*a),m=c*u,p=m&&j0(i,t)/m;return Math.acos(Math.min(Math.max(p,-1),1))}function XB(i){return i[0]=0,i[1]=0,i[2]=0,i}function HB(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"}function OB(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}function NB(i,t){var e=i[0],r=i[1],o=i[2],s=t[0],l=t[1],a=t[2];return Math.abs(e-s)<=St*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(r-l)<=St*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-a)<=St*Math.max(1,Math.abs(o),Math.abs(a))}var ZB=G0,QB=V0,qB=E0,WB=U0,KB=Y0,$B=L0,tC=J0,eC=function(){var i=I0();return function(t,e,r,o,s,l){var a,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,a=r;a<c;a+=e)i[0]=t[a],i[1]=t[a+1],i[2]=t[a+2],s(i,i,l),t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2];return t}}();var iC=[0,-1,0],rC=[0,0,1],oC=In.create(),Sd={x:0,y:0};function z0(i,t,e,r){let o=1/(i*e[3]+t*e[7]+e[15]);r.x=(i*e[0]+t*e[4]+e[12])*o,r.y=(i*e[1]+t*e[5]+e[13])*o}var wd=class{constructor(){this.center=new n(0,20);this.zoom=1;this.projection=gi.create();this.modelView=gi.create();this.combined=gi.create();this.inverse=gi.create();this.width=0;this.height=0}getZoom(){return this.zoom}getCenter(){return this.center}getWidth(){return this.width}getHeight(){return this.height}update(){let t=1/(2*this.zoom),e=this.width*t,r=this.height*t;gi.ortho(this.projection,-e,e,r,-r,0,1e4);let o=[this.center.x,this.center.y,0];gi.lookAt(this.modelView,o,In.add(oC,o,rC),iC),gi.mul(this.combined,this.projection,this.modelView),gi.invert(this.inverse,this.combined)}resize(t,e){this.width=t,this.height=e,this.update()}setPositionAndZoom(t,e,r){this.center.Set(t,e),this.zoom=r,this.update()}setPosition(t,e){this.center.Set(t,e),this.update()}setZoom(t){this.zoom=t,this.update()}project(t,e){return z0(t.x,t.y,this.combined,Sd),e.x=this.width*(Sd.x+1)/2,e.y=this.height-this.height*(Sd.y+1)/2,e}unproject({x:t,y:e},r){return z0(2*t/this.width-1,2*(this.height-e)/this.height-1,this.inverse,r),r}},ot=new wd;function Gr(i,t,e,r=!1){return{key:i,description:t,callback:e,step:r}}function G(i,t,e){return Gr(i,t,r=>{r&&e()})}function Vr(i,t,e){return Gr(i,t,e,!0)}function Er(i,t,e,r){return Gr(i,t,o=>{e[r]=o})}var X0="./marble-OOBBZ3IM.png";var H0="./bg-A6IQEPON.png";var lC={marble:X0,bg:H0};async function aC(i,t){let e={},r=Object.keys(t).map(o=>new Promise(s=>{let l=i.createTexture();i.bindTexture(i.TEXTURE_2D,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR);let a=new Image,c={width:0,height:0,texture:l};a.onload=()=>{c.width=a.width,c.height=a.height,i.bindTexture(i.TEXTURE_2D,l),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,a),s()},a.src=t[o],e[o]=c}));return await Promise.all(r),e}var O0=i=>aC(i,lC);var Ln=mt(ho()),dC=Ln.glsl`
attribute vec2 position;
attribute vec2 uv;
varying vec2 vUV;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vUV = uv;
    gl_Position = uPMatrix * uMVMatrix * vec4(position, 500.0, 1.0);
}
`,hC=Ln.glsl`
precision highp float;
varying vec2 vUV;
uniform float opacity;
uniform sampler2D textureID;
uniform vec2 uvOffset;

void main() {
    gl_FragColor = texture2D(textureID, vUV + uvOffset);
    gl_FragColor.w *= opacity;
}
`;function q0(i){return(0,Ln.createShaderProgram)(i,dC,hC,{position:"vertexAttribPointer",uv:"vertexAttribPointer",uMVMatrix:"uniformMatrix4f",uPMatrix:"uniformMatrix4f",textureID:"uniform1i",opacity:"uniform1f",uvOffset:"uniform2f"})}function W0(i){let t=i.getContext("webgl");return t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE),t.enable(t.BLEND),vd(i,t,i.clientWidth,i.clientHeight),t}function vd(i,t,e,r){i.width=e,i.height=r,t.viewport(0,0,e,r)}function ds(i,t,e,r,o){i.clearColor(t,e,r,o),i.clear(i.COLOR_BUFFER_BIT)}var Si=class{constructor(){this.flags=0;this.position=new n;this.velocity=new n;this.color=new F(0,0,0,0);this.lifetime=0;this.userData=null;this.group=null}};function zc(i,t,e){let s=Math.ceil(Math.sqrt(i/(.01*t))*e);return tt(s,1,8)}var jc=class{constructor(){this.m_index=-1}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}};var et=class{constructor(){this.flags=0;this.groupFlags=0;this.position=new n;this.angle=0;this.linearVelocity=new n;this.angularVelocity=0;this.color=new F;this.strength=1;this.shapeCount=0;this.stride=0;this.particleCount=0;this.lifetime=0;this.userData=null;this.group=null}},Xc=class i{constructor(t){this.m_firstIndex=0;this.m_lastIndex=0;this.m_groupFlags=0;this.m_strength=1;this.m_prev=null;this.m_next=null;this.m_timestamp=-1;this.m_mass=0;this.m_inertia=0;this.m_center=new n;this.m_linearVelocity=new n;this.m_angularVelocity=0;this.m_transform=new T;this.m_userData=null;this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){N(this.m_system.m_flagsBuffer.data!==null);let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(t){t|=this.m_groupFlags&24,this.m_system.SetGroupFlags(this,t)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){let r=i.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(t,this.m_center,r),e)}static{this.GetLinearVelocityFromWorldPoint_s_t0=new n}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){N(!this.m_system.m_world.IsLocked());for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){N(this.m_system.m_positionBuffer.data!==null),N(this.m_system.m_velocityBuffer.data!==null);let t=new n,e=new n;if(this.m_timestamp!==this.m_system.m_timestamp){let r=this.m_system.GetParticleMass();this.m_mass=r*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)this.m_center.AddScaled(r,this.m_system.m_positionBuffer.data[o]),this.m_linearVelocity.AddScaled(r,this.m_system.m_velocityBuffer.data[o]);if(this.m_mass>0){let o=1/this.m_mass;this.m_center.Scale(o),this.m_linearVelocity.Scale(o)}this.m_inertia=0,this.m_angularVelocity=0;for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)n.Subtract(this.m_system.m_positionBuffer.data[o],this.m_center,t),n.Subtract(this.m_system.m_velocityBuffer.data[o],this.m_linearVelocity,e),this.m_inertia+=r*n.Dot(t,t),this.m_angularVelocity+=r*n.Cross(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}};var Hc=class{constructor(t){this.m_buffer=[];this.m_front=0;this.m_back=0;this.m_buffer.fill(null,0,t)}get m_capacity(){return this.m_buffer.length}Push(t){if(this.m_back>=this.m_capacity){for(let e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_buffer[this.m_front]=null,this.m_front++}Empty(){return this.m_front===this.m_back}Front(){let t=this.m_buffer[this.m_front];return N(t!==null),t}};var Oc=class{constructor(t){this.m_generatorCapacity=0;this.m_generatorCount=0;this.m_countX=0;this.m_countY=0;this.m_diagram=[];this.m_generatorBuffer=new Array(t);for(let e=0;e<t;e++)this.m_generatorBuffer[e]=new Bd;this.m_generatorCapacity=t}AddGenerator(t,e,r){let o=this.m_generatorBuffer[this.m_generatorCount++];o.center.Copy(t),o.tag=e,o.necessary=r}Generate(t,e){let r=1/t,o=new n(+$,+$),s=new n(-$,-$),l=0;for(let c=0;c<this.m_generatorCount;c++){let u=this.m_generatorBuffer[c];u.necessary&&(n.Min(o,u.center,o),n.Max(s,u.center,s),++l)}if(l===0){this.m_countX=0,this.m_countY=0;return}o.x-=e,o.y-=e,s.x+=e,s.y+=e,this.m_countX=1+Math.floor(r*(s.x-o.x)),this.m_countY=1+Math.floor(r*(s.y-o.y)),this.m_diagram=[];let a=new Hc(4*this.m_countX*this.m_countY);for(let c=0;c<this.m_generatorCount;c++){let u=this.m_generatorBuffer[c];u.center.Subtract(o).Scale(r);let m=Math.floor(u.center.x),p=Math.floor(u.center.y);m>=0&&p>=0&&m<this.m_countX&&p<this.m_countY&&a.Push(new we(m,p,m+p*this.m_countX,u))}for(;!a.Empty();){let c=a.Front(),u=c.m_x,m=c.m_y,p=c.m_i,d=c.m_generator;a.Pop(),this.m_diagram[p]||(this.m_diagram[p]=d,u>0&&a.Push(new we(u-1,m,p-1,d)),m>0&&a.Push(new we(u,m-1,p-this.m_countX,d)),u<this.m_countX-1&&a.Push(new we(u+1,m,p+1,d)),m<this.m_countY-1&&a.Push(new we(u,m+1,p+this.m_countX,d)))}for(let c=0;c<this.m_countY;c++)for(let u=0;u<this.m_countX-1;u++){let m=u+c*this.m_countX,p=this.m_diagram[m],d=this.m_diagram[m+1];p!==d&&(a.Push(new we(u,c,m,d)),a.Push(new we(u+1,c,m+1,p)))}for(let c=0;c<this.m_countY-1;c++)for(let u=0;u<this.m_countX;u++){let m=u+c*this.m_countX,p=this.m_diagram[m],d=this.m_diagram[m+this.m_countX];p!==d&&(a.Push(new we(u,c,m,d)),a.Push(new we(u,c+1,m+this.m_countX,p)))}for(;!a.Empty();){let c=a.Front(),u=c.m_x,m=c.m_y,p=c.m_i,d=c.m_generator;a.Pop();let h=this.m_diagram[p],f=d;if(h!==f){let b=h.center.x-u,x=h.center.y-m,_=f.center.x-u,y=f.center.y-m,g=b*b+x*x,S=_*_+y*y;g>S&&(this.m_diagram[p]=f,u>0&&a.Push(new we(u-1,m,p-1,f)),m>0&&a.Push(new we(u,m-1,p-this.m_countX,f)),u<this.m_countX-1&&a.Push(new we(u+1,m,p+1,f)),m<this.m_countY-1&&a.Push(new we(u,m+1,p+this.m_countX,f)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let r=0;r<this.m_countX-1;r++){let o=r+e*this.m_countX,s=this.m_diagram[o],l=this.m_diagram[o+1],a=this.m_diagram[o+this.m_countX],c=this.m_diagram[o+1+this.m_countX];l!==a&&(s!==l&&s!==a&&(s.necessary||l.necessary||a.necessary)&&t(s.tag,l.tag,a.tag),c!==l&&c!==a&&(s.necessary||l.necessary||a.necessary)&&t(l.tag,c.tag,a.tag))}}},Bd=class{constructor(){this.center=new n;this.tag=0;this.necessary=!1}},we=class{constructor(t,e,r,o){this.m_x=t,this.m_y=e,this.m_i=r,this.m_generator=o}};var K0=new I,fC=new n,bC=new n,_C=new n,yC=new n,xC=new n,gC=new n,SC=new n,wC=new n,vC=new n,$0=[(i,t,e,r)=>{let o=T.MultiplyVec2(t,i.m_p,vC);return n.Subtract(e,o,r),r.Normalize()-i.m_radius},(i,t,e,r)=>{let o=T.MultiplyVec2(t,i.m_vertex1,xC),s=T.MultiplyVec2(t,i.m_vertex2,gC),l=n.Subtract(e,o,SC),a=n.Subtract(s,o,wC),c=n.Dot(l,a);if(c>0){let u=n.Dot(a,a);c>u?n.Subtract(e,s,l):l.SubtractScaled(c/u,a)}return r.Copy(l),r.Normalize()},(i,t,e,r)=>{let o=T.TransposeMultiplyVec2(t,e,fC),s=-$,l=bC.Copy(o);for(let a=0;a<i.m_count;++a){let c=n.Dot(i.m_normals[a],n.Subtract(o,i.m_vertices[a],n.s_t0));c>s&&(s=c,l.Copy(i.m_normals[a]))}if(s>0){let a=_C.Copy(l),c=s*s;for(let u=0;u<i.m_count;++u){let m=n.Subtract(o,i.m_vertices[u],yC),p=m.LengthSquared();c>p&&(a.Copy(m),c=p)}return D.MultiplyVec2(t.q,a,r),r.Normalize(),Math.sqrt(c)}return D.MultiplyVec2(t.q,l,r),s},(i,t,e,r,o)=>(i.GetChildEdge(K0,o),$0[1](K0,t,e,r,0))],Nc=(i,t,e,r,o)=>{let s=$0[i.GetType()];return s?s(i,t,e,r,o):0};var Zc=class{constructor(t){this.m_system=t}ReportFixture(t){if(t.IsSensor())return!0;let r=t.GetShape().GetChildCount();for(let o=0;o<r;o++){let s=t.GetAABB(o),l=this.m_system.GetInsideBoundsEnumerator(s),a;for(;(a=l.GetNext())>=0;)this.ReportFixtureAndParticle(t,o,a)}return!0}},Qc=class i extends Zc{constructor(){super(...arguments);this.m_contactFilter=null}ShouldCollideFixtureParticle(e,r){return this.m_contactFilter&&this.m_system.GetFlagsBuffer()[r]&65536?this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,r):!0}ReportFixtureAndParticle(e,r,o){let s=i.ReportFixtureAndParticle_s_n,l=i.ReportFixtureAndParticle_s_rp,a=this.m_system.m_positionBuffer.data[o],c=s,u=Nc(e.GetShape(),e.GetBody().GetTransform(),a,c,r);if(u<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,o)){let m=e.GetBody(),p=m.GetWorldCenter(),d=m.GetMass(),h=m.GetInertia()-d*m.GetLocalCenter().LengthSquared(),f=d>0?1/d:0,b=h>0?1/h:0,x=this.m_system.m_flagsBuffer.data[o]&4?0:this.m_system.GetParticleInvMass(),_=n.Subtract(a,p,l),y=n.Cross(_,c),g=x+f+b*y*y,S=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];S.index=o,S.body=m,S.fixture=e,S.weight=1-u*this.m_system.m_inverseDiameter,S.normal.Copy(c.Negate()),S.mass=g>0?1/g:0,this.m_system.DetectStuckParticle(o)}}static{this.ReportFixtureAndParticle_s_n=new n}static{this.ReportFixtureAndParticle_s_rp=new n}},qc=class i extends Zc{constructor(){super(...arguments);this.m_step=null}ReportFixtureAndParticle(e,r,o){let s=i.ReportFixtureAndParticle_s_p1,l=i.ReportFixtureAndParticle_s_output,a=i.ReportFixtureAndParticle_s_input,c=i.ReportFixtureAndParticle_s_p,u=i.ReportFixtureAndParticle_s_v,m=i.ReportFixtureAndParticle_s_f,p=e.GetBody(),d=this.m_system.m_positionBuffer.data[o],h=this.m_system.m_velocityBuffer.data[o],f=l,b=a;if(this.m_system.m_iterationIndex===0){let _=p.GetTransform(),y=T.TransposeMultiplyVec2(p.m_xf0,d,s);e.GetShape().GetType()===0&&(y.Subtract(p.GetLocalCenter()),D.MultiplyVec2(p.m_xf0.q,y,y),D.TransposeMultiplyVec2(_.q,y,y),y.Add(p.GetLocalCenter())),T.MultiplyVec2(_,y,b.p1)}else b.p1.Copy(d);let x=at(this.m_step);if(n.AddScaled(d,x.dt,h,b.p2),b.maxFraction=1,e.RayCast(f,b,r)){let _=f.normal,y=c;y.x=(1-f.fraction)*b.p1.x+f.fraction*b.p2.x+Z*_.x,y.y=(1-f.fraction)*b.p1.y+f.fraction*b.p2.y+Z*_.y;let g=u;g.x=x.inv_dt*(y.x-d.x),g.y=x.inv_dt*(y.y-d.y),this.m_system.m_velocityBuffer.data[o].Copy(g);let S=m;S.x=x.inv_dt*this.m_system.GetParticleMass()*(h.x-g.x),S.y=x.inv_dt*this.m_system.GetParticleMass()*(h.y-g.y),this.m_system.ParticleApplyForce(o,S)}}static{this.ReportFixtureAndParticle_s_p1=new n}static{this.ReportFixtureAndParticle_s_output=new _i}static{this.ReportFixtureAndParticle_s_input=new bi}static{this.ReportFixtureAndParticle_s_p=new n}static{this.ReportFixtureAndParticle_s_v=new n}static{this.ReportFixtureAndParticle_s_f=new n}};function tu(i,t,e){let r=i[t];i[t]=i[e],i[e]=r}function sx(i,t){return i<t}function Wc(i,t=0,e=i.length-t,r=sx){let o=t,s=[],l=0;for(;;){for(;o+1<e;e++){let a=i[o+Math.floor(Math.random()*(e-o))];s[l++]=e;for(let c=o-1;;){for(;r(i[++c],a););for(;r(a,i[--e]););if(c>=e)break;tu(i,c,e)}}if(l===0)break;o=e,e=s[--l]}return i}function ix(i,t=0,e=i.length-t,r=sx){return Wc(i,t,e,r)}function nx(i,t,e=i.length){let r=0;for(let o=0;o<e;++o)if(!t(i[o])){if(o===r){++r;continue}tu(i,r++,o)}return r}function rx(i,t,e,r,o){let s=e-t;for(;s>0;){let l=Math.floor(s/2),a=t+l;o(i[a],r)?(t=++a,s-=l+1):s=l}return t}function ox(i,t,e,r,o){let s=e-t;for(;s>0;){let l=Math.floor(s/2),a=t+l;o(r,i[a])?s=l:(t=++a,s-=l+1)}return t}function Fe(i,t,e,r){let o=e;for(;t!==o;)tu(i,t++,o++),o===r?o=e:t===e&&(e=o)}function TC(i,t,e,r){if(t===e)return e;let o=t;for(;++t!==e;)r(i[o],i[t])||tu(i,++o,t);return++o}var Ur=class{constructor(t){this.data=[];this.count=0;this.capacity=0;this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){let t=this.capacity?2*this.capacity:256;this.Reserve(t)}Free(){this.data.length!==0&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){this.count=nx(this.data,t,this.count)}Unique(t){this.count=TC(this.data,0,this.count,t)}},Oe=class{constructor(){this.m_data=null;this.userSuppliedCapacity=0}get data(){return this.m_data}set data(t){this.m_data=t}},Td=class{constructor(){this.indexA=0;this.indexB=0;this.weight=0;this.normal=new n;this.flags=0}SetIndices(t,e){this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&Math.abs(this.weight-t.weight)<.01&&n.DistanceSquared(this.normal,t.normal)<1e-4}},Pd=class{constructor(){this.index=0;this.weight=0;this.normal=new n;this.mass=0}},Dd=class{constructor(){this.indexA=0;this.indexB=0;this.flags=0;this.strength=0;this.distance=0}},Md=class{constructor(){this.indexA=0;this.indexB=0;this.indexC=0;this.flags=0;this.strength=0;this.pa=new n;this.pb=new n;this.pc=new n;this.ka=0;this.kb=0;this.kc=0;this.s=0}},fo=class i{constructor(){this.strictContactCheck=!1;this.density=1;this.gravityScale=1;this.radius=1;this.maxCount=0;this.pressureStrength=.005;this.dampingStrength=1;this.elasticStrength=.25;this.springStrength=.25;this.viscousStrength=.25;this.surfaceTensionPressureStrength=.2;this.surfaceTensionNormalStrength=.2;this.repulsiveStrength=1;this.powderStrength=.5;this.ejectionStrength=.5;this.staticPressureStrength=.2;this.staticPressureRelaxation=.2;this.staticPressureIterations=8;this.colorMixingStrength=.5;this.destroyByAge=!0;this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return new i().Copy(this)}},ir=class i{constructor(t,e){this.m_paused=!1;this.m_timestamp=0;this.m_allParticleFlags=0;this.m_needsUpdateAllParticleFlags=!1;this.m_allGroupFlags=0;this.m_needsUpdateAllGroupFlags=!1;this.m_hasForce=!1;this.m_iterationIndex=0;this.m_inverseDensity=0;this.m_particleDiameter=0;this.m_inverseDiameter=0;this.m_squaredDiameter=0;this.m_count=0;this.m_internalAllocatedCapacity=0;this.m_handleIndexBuffer=new Oe;this.m_flagsBuffer=new Oe;this.m_positionBuffer=new Oe;this.m_velocityBuffer=new Oe;this.m_forceBuffer=[];this.m_weightBuffer=[];this.m_staticPressureBuffer=[];this.m_accumulationBuffer=[];this.m_accumulation2Buffer=[];this.m_depthBuffer=[];this.m_colorBuffer=new Oe;this.m_groupBuffer=[];this.m_userDataBuffer=new Oe;this.m_stuckThreshold=0;this.m_lastBodyContactStepBuffer=new Oe;this.m_bodyContactCountBuffer=new Oe;this.m_consecutiveContactStepsBuffer=new Oe;this.m_stuckParticleBuffer=new Ur(()=>0);this.m_proxyBuffer=new Ur(()=>new Yr);this.m_contactBuffer=new Ur(()=>new Td);this.m_bodyContactBuffer=new Ur(()=>new Pd);this.m_pairBuffer=new Ur(()=>new Dd);this.m_triadBuffer=new Ur(()=>new Md);this.m_expirationTimeBuffer=new Oe;this.m_indexByExpirationTimeBuffer=new Oe;this.m_timeElapsed=0;this.m_expirationTimeBufferRequiresSorting=!1;this.m_groupCount=0;this.m_groupList=null;this.m_def=new fo;this.m_prev=null;this.m_next=null;this.UpdateBodyContacts_callback=new Qc(this);this.SolveCollision_callback=new qc(this);this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static{this.xTruncBits=12}static{this.yTruncBits=12}static{this.tagBits=8*4}static{this.yOffset=1<<i.yTruncBits-1}static{this.yShift=i.tagBits-i.yTruncBits}static{this.xShift=i.tagBits-i.yTruncBits-i.xTruncBits}static{this.xScale=1<<i.xShift}static{this.xOffset=i.xScale*(1<<i.xTruncBits-1)}static{this.yMask=(1<<i.yTruncBits)-1<<i.yShift}static{this.xMask=~i.yMask}static computeTag(t,e){return(e+i.yOffset>>>0<<i.yShift)+(i.xScale*t+i.xOffset>>>0)>>>0}static computeRelativeTag(t,e,r){return t+(r<<i.yShift)+(e<<i.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer),this.FreeBuffer(this.m_weightBuffer),this.FreeBuffer(this.m_staticPressureBuffer),this.FreeBuffer(this.m_accumulationBuffer),this.FreeBuffer(this.m_accumulation2Buffer),this.FreeBuffer(this.m_depthBuffer),this.FreeBuffer(this.m_groupBuffer)}CreateParticle(t){if(N(!this.m_world.IsLocked()),this.m_count>=this.m_internalAllocatedCapacity){let c=this.m_count?2*this.m_count:256;this.ReallocateInternalAllocatedBuffers(c)}if(this.m_count>=this.m_internalAllocatedCapacity)if(this.m_def.destroyByAge)this.DestroyOldestParticle(0,!1),this.SolveZombie();else return-1;let e=this.m_count++;this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new n).Copy(t.position??n.ZERO),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new n).Copy(t.velocity??n.ZERO),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new n).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);let r=new F().Copy(t.color??F.ZERO);(this.m_colorBuffer.data||!r.IsZero())&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new F).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);let o=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=t.lifetime??0,l=s>0;(this.m_expirationTimeBuffer.data||l)&&(this.SetParticleLifetime(e,l?s:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[e]=e),o.index=e;let a=t.group??null;return this.m_groupBuffer[e]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,e),a.m_lastIndex=e+1):(a.m_firstIndex=e,a.m_lastIndex=e+1)),this.SetParticleFlags(e,t.flags??0),e}GetParticleHandleFromIndex(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||(e=new jc,e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(t,e=!1){let r=2;e&&(r|=512),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|r)}DestroyOldestParticle(t,e=!1){let r=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data[r-(t+1)],s=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[o]>0?o:s,e)}DestroyParticlesInShape(t,e,r=!1){let o=i.DestroyParticlesInShape_s_aabb;N(!this.m_world.IsLocked());let s=o;t.ComputeAABB(s,e,0);let l=0;return this.QueryAABB(s,a=>(t.TestPoint(e,this.m_positionBuffer.data[a])&&(this.DestroyParticle(a,r),l++),!0)),l}static{this.DestroyParticlesInShape_s_aabb=new nt}CreateParticleGroup(t){let e=i.CreateParticleGroup_s_transform;N(!this.m_world.IsLocked());let r=e;r.SetPositionAngle(t.position??n.ZERO,t.angle??0);let o=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,r),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,t.shapeCount??t.shapes.length,t,r),t.positionData){let c=t.particleCount??t.positionData.length;for(let u=0;u<c;u++){let m=t.positionData[u];this.CreateParticleForGroup(t,r,m)}}let s=this.m_count,l=new Xc(this);l.m_firstIndex=o,l.m_lastIndex=s,l.m_strength=t.strength??1,l.m_userData=t.userData,l.m_transform.Copy(r),l.m_prev=null,l.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=l),this.m_groupList=l,++this.m_groupCount;for(let c=o;c<s;c++)this.m_groupBuffer[c]=l;this.SetGroupFlags(l,t.groupFlags??0);let a=new Gn;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(o,s,a),t.group&&(this.JoinParticleGroups(t.group,l),l=t.group),l}static{this.CreateParticleGroup_s_transform=new T}JoinParticleGroups(t,e){N(!this.m_world.IsLocked()),this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);let r=new Ld(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,r);for(let s=e.m_firstIndex;s<e.m_lastIndex;s++)this.m_groupBuffer[s]=t;let o=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,o),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);let e=t.GetParticleCount(),r=new Array(e);for(let s=0;s<e;s++)r[s]=new kd;i.InitializeParticleLists(t,r),this.MergeParticleListsInContact(t,r);let o=i.FindLongestParticleList(t,r);this.MergeZombieParticleListNodes(t,r,o),this.CreateParticleGroupsFromParticleList(t,r,o),this.UpdatePairsAndTriadsWithParticleList(t,r)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&128&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&256&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}GetParticleFlags(t){return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}SetPositionBuffer(t){this.SetUserOverridableBuffer(this.m_positionBuffer,t)}SetVelocityBuffer(t){this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}SetColorBuffer(t){this.SetUserOverridableBuffer(this.m_colorBuffer,t)}SetUserDataBuffer(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){let t=i.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,r=0;for(let o=0;o<this.m_contactBuffer.count;o++){let s=this.m_contactBuffer.data[o],l=s.indexA,a=s.indexB,c=s.normal,u=n.Subtract(e[a],e[l],t),m=n.Dot(u,c);m<0&&(r+=m*m)}return .5*this.GetParticleMass()*r}static{this.ComputeCollisionEnergy_s_v=new n}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){let r=this.m_indexByExpirationTimeBuffer.data===null;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),r){let l=this.GetParticleCount();for(let a=0;a<l;++a)this.m_indexByExpirationTimeBuffer.data[a]=a}let o=e/this.m_def.lifetimeGranularity,s=o>0?this.GetQuantizedTimeElapsed()+o:o;s!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=s,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,r){let o=this.m_velocityBuffer.data,l=(e-t)*this.GetParticleMass(),a=n.Scale(1/l,r,new n);for(let c=t;c<e;c++)o[c].Add(a)}static IsSignificantForce(t){return t.x!==0||t.y!==0}ParticleApplyForce(t,e){i.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].Add(e))}ApplyForce(t,e,r){let o=n.Scale(1/(e-t),r,new n);if(i.IsSignificantForce(o)){this.PrepareForceBuffer();for(let s=t;s<e;s++)this.m_forceBuffer[s].Add(o)}}GetNext(){return this.m_next}QueryAABB(t,e){if(this.m_proxyBuffer.count===0)return;let r=0,o=this.m_proxyBuffer.count,s=rx(this.m_proxyBuffer.data,r,o,i.computeTag(this.m_inverseDiameter*t.lowerBound.x,this.m_inverseDiameter*t.lowerBound.y),Yr.CompareProxyTag),l=ox(this.m_proxyBuffer.data,s,o,i.computeTag(this.m_inverseDiameter*t.upperBound.x,this.m_inverseDiameter*t.upperBound.y),Yr.CompareTagProxy),a=this.m_positionBuffer.data;for(let c=s;c<l;++c){let m=this.m_proxyBuffer.data[c].index,p=a[m];if(t.lowerBound.x<p.x&&p.x<t.upperBound.x&&t.lowerBound.y<p.y&&p.y<t.upperBound.y&&!e(m))break}}QueryShapeAABB(t,e,r,o){let l=i.QueryShapeAABB_s_aabb;t.ComputeAABB(l,e,r),this.QueryAABB(l,o)}static{this.QueryShapeAABB_s_aabb=new nt}QueryPointAABB(t,e,r){let s=i.QueryPointAABB_s_aabb;s.lowerBound.Set(t.x-e,t.y-e),s.upperBound.Set(t.x+e,t.y+e),this.QueryAABB(s,r)}static{this.QueryPointAABB_s_aabb=new nt}RayCast(t,e,r){let o=i.RayCast_s_aabb,s=i.RayCast_s_p,l=i.RayCast_s_v,a=i.RayCast_s_n,c=i.RayCast_s_point;if(this.m_proxyBuffer.count===0)return;let u=this.m_positionBuffer.data,m=o;n.Min(t,e,m.lowerBound),n.Max(t,e,m.upperBound);let p=1,d=n.Subtract(e,t,l),h=n.Dot(d,d),f=this.GetInsideBoundsEnumerator(m),b;for(;(b=f.GetNext())>=0;){let x=n.Subtract(t,u[b],s),_=n.Dot(x,d),y=n.Dot(x,x),g=_*_-h*(y-this.m_squaredDiameter);if(g>=0){let S=Math.sqrt(g),w=(-_-S)/h;if(w>p||w<0&&(w=(-_+S)/h,w<0||w>p))continue;let B=n.AddScaled(x,w,d,a);B.Normalize();let C=r(b,n.AddScaled(t,w,d,c),B,w);if(p=Math.min(p,C),p<=0)break}}}static{this.RayCast_s_aabb=new nt}static{this.RayCast_s_p=new n}static{this.RayCast_s_v=new n}static{this.RayCast_s_n=new n}static{this.RayCast_s_point=new n}ComputeAABB(t){let e=this.GetParticleCount();t.lowerBound.x=+$,t.lowerBound.y=+$,t.upperBound.x=-$,t.upperBound.y=-$;let r=this.m_positionBuffer.data;for(let o=0;o<e;o++){let s=r[o];n.Min(t.lowerBound,s,t.lowerBound),n.Max(t.upperBound,s,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}static{this.k_pairFlags=8}static{this.k_triadFlags=16}static{this.k_noPressureFlags=192}static{this.k_extraDampingFlags=2048}static{this.k_barrierWallFlags=1028}FreeBuffer(t){t!==null&&(t.length=0)}FreeUserOverridableBuffer(t){t.userSuppliedCapacity===0&&this.FreeBuffer(t.data)}ReallocateBuffer3(t,e,r){N(r>e);let o=t?t.slice():[];return o.length=r,o}ReallocateBuffer5(t,e,r,o,s){return N(o>r),N(!e||o<=e),(!s||t)&&!e&&(t=this.ReallocateBuffer3(t,r,o)),t}ReallocateBuffer4(t,e,r,o){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,r,o)}RequestBuffer(t){return t||(this.m_internalAllocatedCapacity===0&&this.ReallocateInternalAllocatedBuffers(256),t=[],t.length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function e(r){return r&&t>r?r:t}if(t=e(this.m_def.maxCount),t=e(this.m_flagsBuffer.userSuppliedCapacity),t=e(this.m_positionBuffer.userSuppliedCapacity),t=e(this.m_velocityBuffer.userSuppliedCapacity),t=e(this.m_colorBuffer.userSuppliedCapacity),t=e(this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);let r=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,r),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,r),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,r),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,r){let o=new Si;o.flags=t.flags??0,T.MultiplyVec2(e,r,o.position),n.Add(t.linearVelocity??n.ZERO,n.CrossScalarVec2(t.angularVelocity??0,n.Subtract(o.position,t.position??n.ZERO,n.s_t0),n.s_t0),o.velocity),o.color.Copy(t.color??F.ZERO),o.lifetime=t.lifetime??0,o.userData=t.userData,this.CreateParticle(o)}CreateParticlesStrokeShapeForGroup(t,e,r){let o=i.CreateParticlesStrokeShapeForGroup_s_edge,s=i.CreateParticlesStrokeShapeForGroup_s_d,l=i.CreateParticlesStrokeShapeForGroup_s_p,a=e.stride??0;a===0&&(a=this.GetParticleStride());let c=0,u=t.GetChildCount();for(let m=0;m<u;m++){let p=null;t.GetType()===1?p=t:(p=o,t.GetChildEdge(p,m));let d=n.Subtract(p.m_vertex2,p.m_vertex1,s),h=d.Length();for(;c<h;){let f=n.AddScaled(p.m_vertex1,c/h,d,l);this.CreateParticleForGroup(e,r,f),c+=a}c-=h}}static{this.CreateParticlesStrokeShapeForGroup_s_edge=new I}static{this.CreateParticlesStrokeShapeForGroup_s_d=new n}static{this.CreateParticlesStrokeShapeForGroup_s_p=new n}CreateParticlesFillShapeForGroup(t,e,r){let o=i.CreateParticlesFillShapeForGroup_s_aabb,s=i.CreateParticlesFillShapeForGroup_s_p,l=e.stride??0;l===0&&(l=this.GetParticleStride());let a=T.IDENTITY,c=o;t.ComputeAABB(c,a,0);for(let u=Math.floor(c.lowerBound.y/l)*l;u<c.upperBound.y;u+=l)for(let m=Math.floor(c.lowerBound.x/l)*l;m<c.upperBound.x;m+=l){let p=s.Set(m,u);t.TestPoint(a,p)&&this.CreateParticleForGroup(e,r,p)}}static{this.CreateParticlesFillShapeForGroup_s_aabb=new nt}static{this.CreateParticlesFillShapeForGroup_s_p=new n}CreateParticlesWithShapeForGroup(t,e,r){switch(t.GetType()){case 1:case 3:this.CreateParticlesStrokeShapeForGroup(t,e,r);break;case 2:case 0:this.CreateParticlesFillShapeForGroup(t,e,r);break;default:break}}CreateParticlesWithShapesForGroup(t,e,r,o){let s=new Gd(t,e);this.CreateParticlesFillShapeForGroup(s,r,o)}CloneParticle(t,e){let r=new Si;r.flags=this.m_flagsBuffer.data[t],r.position.Copy(this.m_positionBuffer.data[t]),r.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&r.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(r.userData=this.m_userDataBuffer.data[t]),r.group=e;let o=this.CreateParticle(r);if(this.m_handleIndexBuffer.data){let s=this.m_handleIndexBuffer.data[t];s&&s.SetIndex(o),this.m_handleIndexBuffer.data[o]=s,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[o]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[o]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[o]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[o].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[o]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[o]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[o]=this.m_expirationTimeBuffer.data[t]),o}DestroyParticlesInGroup(t,e=!1){for(let r=t.m_firstIndex;r<t.m_lastIndex;r++)this.DestroyParticle(r,e)}DestroyParticleGroup(t){this.m_world.GetDestructionListener()?.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let r=t.m_firstIndex;r<t.m_lastIndex;r++)this.m_groupBuffer[r]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(t,e){return(t&28)!==0||e!==null&&(e.GetGroupFlags()&2)!==0}UpdatePairsAndTriads(t,e,r){let o=i.UpdatePairsAndTriads_s_dab,s=i.UpdatePairsAndTriads_s_dbc,l=i.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data,c=0;for(let u=t;u<e;u++)c|=this.m_flagsBuffer.data[u];if(c&i.k_pairFlags)for(let u=0;u<this.m_contactBuffer.count;u++){let m=this.m_contactBuffer.data[u],p=m.indexA,d=m.indexB,h=this.m_flagsBuffer.data[p],f=this.m_flagsBuffer.data[d],b=this.m_groupBuffer[p],x=this.m_groupBuffer[d];if(p>=t&&p<e&&d>=t&&d<e&&!((h|f)&2)&&(h|f)&i.k_pairFlags&&(r.IsNecessary(p)||r.IsNecessary(d))&&i.ParticleCanBeConnected(h,b)&&i.ParticleCanBeConnected(f,x)&&r.ShouldCreatePair(p,d)){let _=this.m_pairBuffer.data[this.m_pairBuffer.Append()];_.indexA=p,_.indexB=d,_.flags=m.flags,_.strength=Math.min(b?b.m_strength:1,x?x.m_strength:1),_.distance=n.Distance(a[p],a[d])}ix(this.m_pairBuffer.data,0,this.m_pairBuffer.count,i.ComparePairIndices),this.m_pairBuffer.Unique(i.MatchPairIndices)}if(c&i.k_triadFlags){let u=new Oc(e-t);for(let p=t;p<e;p++){let d=this.m_flagsBuffer.data[p],h=this.m_groupBuffer[p];!(d&2)&&i.ParticleCanBeConnected(d,h)&&u.AddGenerator(a[p],p,r.IsNecessary(p))}let m=this.GetParticleStride();u.Generate(m/2,m*2),u.GetNodes((p,d,h)=>{let f=this.m_flagsBuffer.data[p],b=this.m_flagsBuffer.data[d],x=this.m_flagsBuffer.data[h];if((f|b|x)&i.k_triadFlags&&r.ShouldCreateTriad(p,d,h)){let _=a[p],y=a[d],g=a[h],S=n.Subtract(_,y,o),w=n.Subtract(y,g,s),B=n.Subtract(g,_,l),C=4*this.m_squaredDiameter;if(n.Dot(S,S)>C||n.Dot(w,w)>C||n.Dot(B,B)>C)return;let A=this.m_groupBuffer[p],k=this.m_groupBuffer[d],M=this.m_groupBuffer[h],E=this.m_triadBuffer.data[this.m_triadBuffer.Append()];E.indexA=p,E.indexB=d,E.indexC=h,E.flags=f|b|x,E.strength=Math.min(Math.min(A?A.m_strength:1,k?k.m_strength:1),M?M.m_strength:1);let L=(_.x+y.x+g.x)/3,U=(_.y+y.y+g.y)/3;E.pa.x=_.x-L,E.pa.y=_.y-U,E.pb.x=y.x-L,E.pb.y=y.y-U,E.pc.x=g.x-L,E.pc.y=g.y-U,E.ka=-n.Dot(B,S),E.kb=-n.Dot(S,w),E.kc=-n.Dot(w,B),E.s=n.Cross(_,y)+n.Cross(y,g)+n.Cross(g,_)}}),ix(this.m_triadBuffer.data,0,this.m_triadBuffer.count,i.CompareTriadIndices),this.m_triadBuffer.Unique(i.MatchTriadIndices)}}static{this.UpdatePairsAndTriads_s_dab=new n}static{this.UpdatePairsAndTriads_s_dbc=new n}static{this.UpdatePairsAndTriads_s_dca=new n}UpdatePairsAndTriadsWithReactiveParticles(){let t=new Vd(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=-4097;this.m_allParticleFlags&=-4097}static ComparePairIndices(t,e){let r=t.indexA-e.indexA;return r!==0?r<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){let r=t.indexA-e.indexA;if(r!==0)return r<0;let o=t.indexB-e.indexB;return o!==0?o<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){let r=t.GetBufferIndex(),o=t.GetParticleCount();for(let s=0;s<o;s++){let l=e[s];l.list=l,l.next=null,l.count=1,l.index=s+r}}MergeParticleListsInContact(t,e){let r=t.GetBufferIndex();for(let o=0;o<this.m_contactBuffer.count;o++){let s=this.m_contactBuffer.data[o],l=s.indexA,a=s.indexB;if(!t.ContainsParticle(l)||!t.ContainsParticle(a))continue;let c=e[l-r].list,u=e[a-r].list;if(c!==u){if(c.count<u.count){let m=c;c=u,u=m}i.MergeParticleLists(c,u)}}}static MergeParticleLists(t,e){for(let r=e;;){r.list=t;let o=r.next;if(o)r=o;else{r.next=t.next;break}}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){let r=t.GetParticleCount(),o=e[0];for(let s=0;s<r;s++){let l=e[s];o.count<l.count&&(o=l)}return o}MergeZombieParticleListNodes(t,e,r){let o=t.GetParticleCount();for(let s=0;s<o;s++){let l=e[s];l!==r&&this.m_flagsBuffer.data[l.index]&2&&i.MergeParticleListAndNode(r,l)}}static MergeParticleListAndNode(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}CreateParticleGroupsFromParticleList(t,e,r){let o=t.GetParticleCount(),s=new et;s.groupFlags=t.GetGroupFlags(),s.userData=t.GetUserData();for(let l=0;l<o;l++){let a=e[l];if(!a.count||a===r)continue;let c=this.CreateParticleGroup(s);for(let u=a;u;u=u.next){let m=u.index,p=this.CloneParticle(m,c);this.m_flagsBuffer.data[m]|=2,u.index=p}}}UpdatePairsAndTriadsWithParticleList(t,e){let r=t.GetBufferIndex();for(let o=0;o<this.m_pairBuffer.count;o++){let s=this.m_pairBuffer.data[o],l=s.indexA,a=s.indexB;t.ContainsParticle(l)&&(s.indexA=e[l-r].index),t.ContainsParticle(a)&&(s.indexB=e[a-r].index)}for(let o=0;o<this.m_triadBuffer.count;o++){let s=this.m_triadBuffer.data[o],l=s.indexA,a=s.indexB,c=s.indexC;t.ContainsParticle(l)&&(s.indexA=e[l-r].index),t.ContainsParticle(a)&&(s.indexB=e[a-r].index),t.ContainsParticle(c)&&(s.indexC=e[c-r].index)}}ComputeDepth(){let t=[],e=0;for(let l=0;l<this.m_contactBuffer.count;l++){let a=this.m_contactBuffer.data[l],c=a.indexA,u=a.indexB,m=this.m_groupBuffer[c],p=this.m_groupBuffer[u];m&&m===p&&m.m_groupFlags&16&&(t[e++]=a)}let r=[],o=0;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&16){r[o++]=l,this.SetGroupFlags(l,l.m_groupFlags&-17);for(let a=l.m_firstIndex;a<l.m_lastIndex;a++)this.m_accumulationBuffer[a]=0}for(let l=0;l<e;l++){let a=t[l],c=a.indexA,u=a.indexB,m=a.weight;this.m_accumulationBuffer[c]+=m,this.m_accumulationBuffer[u]+=m}for(let l=0;l<o;l++){let a=r[l];for(let c=a.m_firstIndex;c<a.m_lastIndex;c++){let u=this.m_accumulationBuffer[c];this.m_depthBuffer[c]=u<.8?0:$}}let s=Math.sqrt(this.m_count)>>0;for(let l=0;l<s;l++){let a=!1;for(let c=0;c<e;c++){let u=t[c],m=u.indexA,p=u.indexB,d=1-u.weight,h=this.m_depthBuffer[m],f=this.m_depthBuffer[p],b=f+d,x=h+d;h>b&&(this.m_depthBuffer[m]=b,a=!0),f>x&&(this.m_depthBuffer[p]=x,a=!0)}if(!a)break}for(let l=0;l<o;l++){let a=r[l];for(let c=a.m_firstIndex;c<a.m_lastIndex;c++)this.m_depthBuffer[c]<$?this.m_depthBuffer[c]*=this.m_particleDiameter:this.m_depthBuffer[c]=0}}GetInsideBoundsEnumerator(t){let e=i.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),r=i.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),o=0,s=this.m_proxyBuffer.count,l=rx(this.m_proxyBuffer.data,o,s,e,Yr.CompareProxyTag),a=ox(this.m_proxyBuffer.data,o,s,r,Yr.CompareTagProxy);return new Rd(this,e,r,l,a)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e){let r=this.m_flagsBuffer.data,o=this.m_positionBuffer.data,s=n.Subtract(o[e],o[t],i.AddContact_s_d),l=n.Dot(s,s);if(l>0&&l<this.m_squaredDiameter){let a=1/Math.sqrt(l),c=this.m_contactBuffer.data[this.m_contactBuffer.Append()];c.indexA=t,c.indexB=e,c.flags=r[t]|r[e],c.weight=1-l*a*this.m_inverseDiameter,c.normal.x=a*s.x,c.normal.y=a*s.y}}static{this.AddContact_s_d=new n}FindContacts_Reference(){let e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let r=0,o=0;r<e;r++){let s=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,0);for(let c=r+1;c<e&&!(s<this.m_proxyBuffer.data[c].tag);c++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[c].index);let l=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,-1,1);for(;o<e&&!(l<=this.m_proxyBuffer.data[o].tag);o++);let a=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,1);for(let c=o;c<e&&!(a<this.m_proxyBuffer.data[c].tag);c++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[c].index)}}FindContacts(){this.FindContacts_Reference()}UpdateProxies_Reference(){let t=this.m_positionBuffer.data,e=this.m_inverseDiameter;for(let r=0;r<this.m_proxyBuffer.count;++r){let o=this.m_proxyBuffer.data[r],s=o.index,l=t[s];o.tag=i.computeTag(e*l.x,e*l.y)}}UpdateProxies(){this.UpdateProxies_Reference()}SortProxies(){Wc(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,Yr.CompareProxyProxy)}FilterContacts(){let t=this.GetParticleContactFilter();t!==null&&this.m_contactBuffer.RemoveIf(e=>(e.flags&131072)!==0&&!t.ShouldCollideParticleParticle(this,e.indexA,e.indexB))}NotifyContactListenerPreContact(t){if(this.GetParticleContactListener()!==null)throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){let e=this.GetParticleContactListener();if(e!==null){for(let r=0;r<this.m_contactBuffer.count;++r){let o=this.m_contactBuffer.data[r],s=-1;s>=0?t.Invalidate(s):e.BeginContactParticleParticle(this,o)}throw new Error}}static b2ParticleContactIsZombie(t){return(t.flags&2)===2}UpdateContacts(t){this.UpdateProxies(),this.SortProxies();let e=new Id;this.NotifyContactListenerPreContact(e),this.FindContacts(),this.FilterContacts(),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(i.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(this.GetFixtureContactListener()!==null)throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){let e=this.GetFixtureContactListener();if(e!==null){for(let r=0;r<this.m_bodyContactBuffer.count;r++){let o=this.m_bodyContactBuffer.data[r],s=-1;s>=0?t.Invalidate(s):e.BeginContactFixtureParticle(this,o)}throw new Error}}UpdateBodyContacts(){let t=i.UpdateBodyContacts_s_aabb,e=new Fd;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){let s=this.GetParticleCount();for(let l=0;l<s;l++)this.m_bodyContactCountBuffer.data[l]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[l]+1&&(this.m_consecutiveContactStepsBuffer.data[l]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);let r=t;this.ComputeAABB(r);let o=this.UpdateBodyContacts_callback;o.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(r,s=>o.ReportFixture(s)),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}static{this.UpdateBodyContacts_s_aabb=new nt}Solve(t){let e=i.Solve_s_subStep;if(this.m_count===0||(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&2&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),this.m_paused))return;let{particleIterations:r}=t.config;for(this.m_iterationIndex=0;this.m_iterationIndex<r;this.m_iterationIndex++){++this.m_timestamp;let o=e.Copy(t);o.dt/=r,o.inv_dt*=r,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&16&&this.ComputeDepth(),this.m_allParticleFlags&4096&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(o),this.m_allParticleFlags&32&&this.SolveViscous(),this.m_allParticleFlags&8192&&this.SolveRepulsive(o),this.m_allParticleFlags&64&&this.SolvePowder(o),this.m_allParticleFlags&128&&this.SolveTensile(o),this.m_allGroupFlags&1&&this.SolveSolid(o),this.m_allParticleFlags&256&&this.SolveColorMixing(),this.SolveGravity(o),this.m_allParticleFlags&2048&&this.SolveStaticPressure(o),this.SolvePressure(o),this.SolveDamping(o),this.m_allParticleFlags&i.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&16&&this.SolveElastic(o),this.m_allParticleFlags&8&&this.SolveSpring(o),this.LimitVelocity(o),this.m_allGroupFlags&2&&this.SolveRigidDamping(),this.m_allParticleFlags&1024&&this.SolveBarrier(o),this.SolveCollision(o),this.m_allGroupFlags&2&&this.SolveRigid(o),this.m_allParticleFlags&4&&this.SolveWall();for(let s=0;s<this.m_count;s++)this.m_positionBuffer.data[s].AddScaled(o.dt,this.m_velocityBuffer.data[s])}}static{this.Solve_s_subStep=Xe.Create()}SolveCollision(t){let e=i.SolveCollision_s_aabb,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=e;s.lowerBound.x=+$,s.lowerBound.y=+$,s.upperBound.x=-$,s.upperBound.y=-$;for(let a=0;a<this.m_count;a++){let c=o[a],u=r[a],m=u.x+t.dt*c.x,p=u.y+t.dt*c.y;s.lowerBound.x=Math.min(s.lowerBound.x,Math.min(u.x,m)),s.lowerBound.y=Math.min(s.lowerBound.y,Math.min(u.y,p)),s.upperBound.x=Math.max(s.upperBound.x,Math.max(u.x,m)),s.upperBound.y=Math.max(s.upperBound.y,Math.max(u.y,p))}let l=this.SolveCollision_callback;l.m_step=t,this.m_world.QueryAABB(s,a=>l.ReportFixture(a))}static{this.SolveCollision_s_aabb=new nt}LimitVelocity(t){let e=this.m_velocityBuffer.data,r=this.GetCriticalVelocitySquared(t);for(let o=0;o<this.m_count;o++){let s=e[o],l=n.Dot(s,s);l>r&&s.Scale(Math.sqrt(r/l))}}SolveGravity(t){let e=i.SolveGravity_s_gravity,r=this.m_velocityBuffer.data,o=n.Scale(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let s=0;s<this.m_count;s++)r[s].Add(o)}static{this.SolveGravity_s_gravity=new n}SolveBarrier(t){let e=i.SolveBarrier_s_aabb,r=i.SolveBarrier_s_va,o=i.SolveBarrier_s_vb,s=i.SolveBarrier_s_pba,l=i.SolveBarrier_s_vba,a=i.SolveBarrier_s_vc,c=i.SolveBarrier_s_pca,u=i.SolveBarrier_s_vca,m=i.SolveBarrier_s_qba,p=i.SolveBarrier_s_qca,d=i.SolveBarrier_s_dv,h=i.SolveBarrier_s_f,f=this.m_positionBuffer.data,b=this.m_velocityBuffer.data;for(let y=0;y<this.m_count;y++)this.m_flagsBuffer.data[y]&i.k_barrierWallFlags&&b[y].SetZero();let x=2.5*t.dt,_=this.GetParticleMass();for(let y=0;y<this.m_pairBuffer.count;y++){let g=this.m_pairBuffer.data[y];if(g.flags&1024){let S=g.indexA,w=g.indexB,B=f[S],C=f[w],A=e;n.Min(B,C,A.lowerBound),n.Max(B,C,A.upperBound);let k=this.m_groupBuffer[S],M=this.m_groupBuffer[w],E=this.GetLinearVelocity(k,S,B,r),L=this.GetLinearVelocity(M,w,C,o),U=n.Subtract(C,B,s),Y=n.Subtract(L,E,l),O=this.GetInsideBoundsEnumerator(A),K;for(;(K=O.GetNext())>=0;){let ut=f[K],lt=this.m_groupBuffer[K];if(k!==lt&&M!==lt){let Tt=this.GetLinearVelocity(lt,K,ut,a),Vt=n.Subtract(ut,B,c),wt=n.Subtract(Tt,E,u),Be=n.Cross(Y,wt),Vi=n.Cross(U,wt)-n.Cross(Vt,Y),ni=n.Cross(U,Vt),Ht,be,Ne=m,xo=p;if(Be===0){if(Vi===0||(be=-ni/Vi,!(be>=0&&be<x))||(n.AddScaled(U,be,Y,Ne),n.AddScaled(Vt,be,wt,xo),Ht=n.Dot(Ne,xo)/n.Dot(Ne,Ne),!(Ht>=0&&Ht<=1)))continue}else{let Cs=Vi*Vi-4*ni*Be;if(Cs<0)continue;let As=Math.sqrt(Cs),rl=(-Vi-As)/(2*Be),ol=(-Vi+As)/(2*Be);if(rl>ol){let zx=rl;rl=ol,ol=zx}if(be=rl,n.AddScaled(U,be,Y,Ne),n.AddScaled(Vt,be,wt,xo),Ht=n.Dot(Ne,xo)/n.Dot(Ne,Ne),!(be>=0&&be<x&&Ht>=0&&Ht<=1)&&(be=ol,!(be>=0&&be<x)||(n.AddScaled(U,be,Y,Ne),n.AddScaled(Vt,be,wt,xo),Ht=n.Dot(Ne,xo)/n.Dot(Ne,Ne),!(Ht>=0&&Ht<=1))))continue}let il=d;il.x=E.x+Ht*Y.x-Tt.x,il.y=E.y+Ht*Y.y-Tt.y;let Bu=n.Scale(_,il,h);if(lt&&this.IsRigidGroup(lt)){let Cs=lt.GetMass(),As=lt.GetInertia();Cs>0&&lt.m_linearVelocity.AddScaled(1/Cs,Bu),As>0&&(lt.m_angularVelocity+=n.Cross(n.Subtract(ut,lt.GetCenter(),n.s_t0),Bu)/As)}else b[K].Add(il);this.ParticleApplyForce(K,Bu.Scale(-t.inv_dt))}}}}}static{this.SolveBarrier_s_aabb=new nt}static{this.SolveBarrier_s_va=new n}static{this.SolveBarrier_s_vb=new n}static{this.SolveBarrier_s_pba=new n}static{this.SolveBarrier_s_vba=new n}static{this.SolveBarrier_s_vc=new n}static{this.SolveBarrier_s_pca=new n}static{this.SolveBarrier_s_vca=new n}static{this.SolveBarrier_s_qba=new n}static{this.SolveBarrier_s_qca=new n}static{this.SolveBarrier_s_dv=new n}static{this.SolveBarrier_s_f=new n}SolveStaticPressure(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);let e=this.GetCriticalPressure(t),r=this.m_def.staticPressureStrength*e,o=.25*e,s=this.m_def.staticPressureRelaxation;for(let l=0;l<this.m_def.staticPressureIterations;l++){for(let a=0;a<this.m_count;a++)this.m_accumulationBuffer[a]=0;for(let a=0;a<this.m_contactBuffer.count;a++){let c=this.m_contactBuffer.data[a];if(c.flags&2048){let u=c.indexA,m=c.indexB,p=c.weight;this.m_accumulationBuffer[u]+=p*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=p*this.m_staticPressureBuffer[u]}}for(let a=0;a<this.m_count;a++){let c=this.m_weightBuffer[a];if(this.m_flagsBuffer.data[a]&2048){let m=(this.m_accumulationBuffer[a]+r*(c-1))/(c+s);this.m_staticPressureBuffer[a]=tt(m,0,o)}else this.m_staticPressureBuffer[a]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t],r=e.index,o=e.weight;this.m_weightBuffer[r]+=o}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t],r=e.indexA,o=e.indexB,s=e.weight;this.m_weightBuffer[r]+=s,this.m_weightBuffer[o]+=s}}SolvePressure(t){let e=i.SolvePressure_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=this.GetCriticalPressure(t),l=this.m_def.pressureStrength*s,a=.25*s;for(let m=0;m<this.m_count;m++){let p=this.m_weightBuffer[m],d=l*Math.max(0,p-1);this.m_accumulationBuffer[m]=Math.min(d,a)}if(this.m_allParticleFlags&i.k_noPressureFlags)for(let m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&i.k_noPressureFlags&&(this.m_accumulationBuffer[m]=0);if(this.m_allParticleFlags&2048)for(let m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&2048&&(this.m_accumulationBuffer[m]+=this.m_staticPressureBuffer[m]);let c=t.dt/(this.m_def.density*this.m_particleDiameter),u=this.GetParticleInvMass();for(let m=0;m<this.m_bodyContactBuffer.count;m++){let p=this.m_bodyContactBuffer.data[m],d=p.index,h=p.body,f=p.weight,b=p.mass,x=p.normal,_=r[d],y=this.m_accumulationBuffer[d]+l*f,g=n.Scale(c*f*b*y,x,e);o[d].SubtractScaled(u,g),h.ApplyLinearImpulse(g,_,!0)}for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m],d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=this.m_accumulationBuffer[d]+this.m_accumulationBuffer[h],_=n.Scale(c*f*x,b,e);o[d].Subtract(_),o[h].Add(_)}}static{this.SolvePressure_s_f=new n}SolveDamping(t){let e=i.SolveDamping_s_v,r=i.SolveDamping_s_f,o=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,l=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),c=this.GetParticleInvMass();for(let u=0;u<this.m_bodyContactBuffer.count;u++){let m=this.m_bodyContactBuffer.data[u],p=m.index,d=m.body,h=m.weight,f=m.mass,b=m.normal,x=o[p],_=n.Subtract(d.GetLinearVelocityFromWorldPoint(x,n.s_t0),s[p],e),y=n.Dot(_,b);if(y<0){let g=Math.max(l*h,Math.min(-a*y,.5)),S=n.Scale(g*f*y,b,r);s[p].AddScaled(c,S),d.ApplyLinearImpulse(S.Negate(),x,!0)}}for(let u=0;u<this.m_contactBuffer.count;u++){let m=this.m_contactBuffer.data[u],p=m.indexA,d=m.indexB,h=m.weight,f=m.normal,b=n.Subtract(s[d],s[p],e),x=n.Dot(b,f);if(x<0){let _=Math.max(l*h,Math.min(-a*x,.5)),y=n.Scale(_*x,f,r);s[p].Add(y),s[d].Subtract(y)}}}static{this.SolveDamping_s_v=new n}static{this.SolveDamping_s_f=new n}SolveRigidDamping(){let t=i.SolveRigidDamping_s_t0,e=i.SolveRigidDamping_s_t1,r=i.SolveRigidDamping_s_p,o=i.SolveRigidDamping_s_v,s=[0],l=[0],a=[0],c=[0],u=[0],m=[0],p=this.m_positionBuffer.data,d=this.m_def.dampingStrength;for(let h=0;h<this.m_bodyContactBuffer.count;h++){let f=this.m_bodyContactBuffer.data[h],b=f.index,x=this.m_groupBuffer[b];if(x&&this.IsRigidGroup(x)){let _=f.body,y=f.normal,g=f.weight,S=p[b],w=n.Subtract(_.GetLinearVelocityFromWorldPoint(S,t),x.GetLinearVelocityFromWorldPoint(S,e),o),B=n.Dot(w,y);if(B<0){this.InitDampingParameterWithRigidGroupOrParticle(s,l,a,!0,x,b,S,y),this.InitDampingParameter(c,u,m,_.GetMass(),_.GetInertia()-_.GetMass()*_.GetLocalCenter().LengthSquared(),_.GetWorldCenter(),S,y);let C=d*Math.min(g,1)*this.ComputeDampingImpulse(s[0],l[0],a[0],c[0],u[0],m[0],B);this.ApplyDamping(s[0],l[0],a[0],!0,x,b,C,y),_.ApplyLinearImpulse(n.Scale(-C,y,n.s_t0),S,!0)}}}for(let h=0;h<this.m_contactBuffer.count;h++){let f=this.m_contactBuffer.data[h],b=f.indexA,x=f.indexB,_=f.normal,y=f.weight,g=this.m_groupBuffer[b],S=this.m_groupBuffer[x],w=this.IsRigidGroup(g),B=this.IsRigidGroup(S);if(g!==S&&(w||B)){let C=n.Mid(p[b],p[x],r),A=n.Subtract(this.GetLinearVelocity(S,x,C,t),this.GetLinearVelocity(g,b,C,e),o),k=n.Dot(A,_);if(k<0){this.InitDampingParameterWithRigidGroupOrParticle(s,l,a,w,g,b,C,_),this.InitDampingParameterWithRigidGroupOrParticle(c,u,m,B,S,x,C,_);let M=d*y*this.ComputeDampingImpulse(s[0],l[0],a[0],c[0],u[0],m[0],k);this.ApplyDamping(s[0],l[0],a[0],w,g,b,M,_),this.ApplyDamping(c[0],u[0],m[0],B,S,x,-M,_)}}}}static{this.SolveRigidDamping_s_t0=new n}static{this.SolveRigidDamping_s_t1=new n}static{this.SolveRigidDamping_s_p=new n}static{this.SolveRigidDamping_s_v=new n}SolveExtraDamping(){let t=i.SolveExtraDamping_s_v,e=i.SolveExtraDamping_s_f,r=this.m_velocityBuffer.data,o=this.m_positionBuffer.data,s=this.GetParticleInvMass();for(let l=0;l<this.m_bodyContactBuffer.count;l++){let a=this.m_bodyContactBuffer.data[l],c=a.index;if(this.m_flagsBuffer.data[c]&i.k_extraDampingFlags){let u=a.body,m=a.mass,p=a.normal,d=o[c],h=n.Subtract(u.GetLinearVelocityFromWorldPoint(d,n.s_t0),r[c],t),f=n.Dot(h,p);if(f<0){let b=n.Scale(.5*m*f,p,e);r[c].AddScaled(s,b),u.ApplyLinearImpulse(b.Negate(),d,!0)}}}}static{this.SolveExtraDamping_s_v=new n}static{this.SolveExtraDamping_s_f=new n}SolveWall(){let t=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&4&&t[e].SetZero()}SolveRigid(t){let e=i.SolveRigid_s_position,r=i.SolveRigid_s_rotation,o=i.SolveRigid_s_transform,s=i.SolveRigid_s_velocityTransform,l=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let c=this.m_groupList;c;c=c.GetNext())if(c.m_groupFlags&2){c.UpdateStatistics();let u=r;u.Set(t.dt*c.m_angularVelocity);let m=n.Add(c.m_center,n.Subtract(n.Scale(t.dt,c.m_linearVelocity,n.s_t0),D.MultiplyVec2(u,c.m_center,n.s_t1),n.s_t0),e),p=o;p.SetPositionRotation(m,u),T.Multiply(p,c.m_transform,c.m_transform);let d=s;d.p.x=t.inv_dt*p.p.x,d.p.y=t.inv_dt*p.p.y,d.q.s=t.inv_dt*p.q.s,d.q.c=t.inv_dt*(p.q.c-1);for(let h=c.m_firstIndex;h<c.m_lastIndex;h++)T.MultiplyVec2(d,l[h],a[h])}}static{this.SolveRigid_s_position=new n}static{this.SolveRigid_s_rotation=new D}static{this.SolveRigid_s_transform=new T}static{this.SolveRigid_s_velocityTransform=new T}SolveElastic(t){let e=i.SolveElastic_s_pa,r=i.SolveElastic_s_pb,o=i.SolveElastic_s_pc,s=i.SolveElastic_s_r,l=i.SolveElastic_s_t0,a=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,u=t.inv_dt*this.m_def.elasticStrength;for(let m=0;m<this.m_triadBuffer.count;m++){let p=this.m_triadBuffer.data[m];if(p.flags&16){let d=p.indexA,h=p.indexB,f=p.indexC,b=p.pa,x=p.pb,_=p.pc,y=e.Copy(a[d]),g=r.Copy(a[h]),S=o.Copy(a[f]),w=c[d],B=c[h],C=c[f];y.AddScaled(t.dt,w),g.AddScaled(t.dt,B),S.AddScaled(t.dt,C);let A=(y.x+g.x+S.x)/3,k=(y.y+g.y+S.y)/3;y.x-=A,y.y-=k,g.x-=A,g.y-=k,S.x-=A,S.y-=k;let M=s;M.s=n.Cross(b,y)+n.Cross(x,g)+n.Cross(_,S),M.c=n.Dot(b,y)+n.Dot(x,g)+n.Dot(_,S);let E=M.s*M.s+M.c*M.c,L=1/Math.sqrt(E);Number.isFinite(L)||(L=198177537e11),M.s*=L,M.c*=L;let U=u*p.strength;D.MultiplyVec2(M,b,l),n.Subtract(l,y,l),n.Scale(U,l,l),w.Add(l),D.MultiplyVec2(M,x,l),n.Subtract(l,g,l),n.Scale(U,l,l),B.Add(l),D.MultiplyVec2(M,_,l),n.Subtract(l,S,l),n.Scale(U,l,l),C.Add(l)}}}static{this.SolveElastic_s_pa=new n}static{this.SolveElastic_s_pb=new n}static{this.SolveElastic_s_pc=new n}static{this.SolveElastic_s_r=new D}static{this.SolveElastic_s_t0=new n}SolveSpring(t){let e=i.SolveSpring_s_pa,r=i.SolveSpring_s_pb,o=i.SolveSpring_s_d,s=i.SolveSpring_s_f,l=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,c=t.inv_dt*this.m_def.springStrength;for(let u=0;u<this.m_pairBuffer.count;u++){let m=this.m_pairBuffer.data[u];if(m.flags&8){let p=m.indexA,d=m.indexB,h=e.Copy(l[p]),f=r.Copy(l[d]),b=a[p],x=a[d];h.AddScaled(t.dt,b),f.AddScaled(t.dt,x);let _=n.Subtract(f,h,o),y=m.distance,g=_.Length(),S=c*m.strength,w=n.Scale(S*(y-g)/g,_,s);b.Subtract(w),x.Add(w)}}}static{this.SolveSpring_s_pa=new n}static{this.SolveSpring_s_pb=new n}static{this.SolveSpring_s_d=new n}static{this.SolveSpring_s_f=new n}SolveTensile(t){let e=i.SolveTensile_s_weightedNormal,r=i.SolveTensile_s_s,o=i.SolveTensile_s_f,s=this.m_velocityBuffer.data;for(let m=0;m<this.m_count;m++)this.m_accumulation2Buffer[m]=new n,this.m_accumulation2Buffer[m].SetZero();for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m];if(p.flags&128){let d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=n.Scale((1-f)*f,b,e);this.m_accumulation2Buffer[d].Subtract(x),this.m_accumulation2Buffer[h].Add(x)}}let l=this.GetCriticalVelocity(t),a=this.m_def.surfaceTensionPressureStrength*l,c=this.m_def.surfaceTensionNormalStrength*l,u=.5*l;for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m];if(p.flags&128){let d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=this.m_weightBuffer[d]+this.m_weightBuffer[h],_=n.Subtract(this.m_accumulation2Buffer[h],this.m_accumulation2Buffer[d],r),y=Math.min(a*(x-2)+c*n.Dot(_,b),u)*f,g=n.Scale(y,b,o);s[d].Subtract(g),s[h].Add(g)}}}static{this.SolveTensile_s_weightedNormal=new n}static{this.SolveTensile_s_s=new n}static{this.SolveTensile_s_f=new n}SolveViscous(){let t=i.SolveViscous_s_v,e=i.SolveViscous_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,{viscousStrength:s}=this.m_def,l=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){let c=this.m_bodyContactBuffer.data[a],u=c.index;if(this.m_flagsBuffer.data[u]&32){let m=c.body,p=c.weight,d=c.mass,h=r[u],f=n.Subtract(m.GetLinearVelocityFromWorldPoint(h,n.s_t0),o[u],t),b=n.Scale(s*d*p,f,e);o[u].AddScaled(l,b),m.ApplyLinearImpulse(b.Negate(),h,!0)}}for(let a=0;a<this.m_contactBuffer.count;a++){let c=this.m_contactBuffer.data[a];if(c.flags&32){let u=c.indexA,m=c.indexB,p=c.weight,d=n.Subtract(o[m],o[u],t),h=n.Scale(s*p,d,e);o[u].Add(h),o[m].Subtract(h)}}}static{this.SolveViscous_s_v=new n}static{this.SolveViscous_s_f=new n}SolveRepulsive(t){let e=i.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,o=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s];if(l.flags&8192){let a=l.indexA,c=l.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[c]){let u=l.weight,m=l.normal,p=n.Scale(o*u,m,e);r[a].Subtract(p),r[c].Add(p)}}}}static{this.SolveRepulsive_s_f=new n}SolvePowder(t){let e=i.SolvePowder_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=this.m_def.powderStrength*this.GetCriticalVelocity(t),l=1-.75,a=this.GetParticleInvMass();for(let c=0;c<this.m_bodyContactBuffer.count;c++){let u=this.m_bodyContactBuffer.data[c],m=u.index;if(this.m_flagsBuffer.data[m]&64){let p=u.weight;if(p>l){let d=u.body,h=u.mass,f=r[m],b=u.normal,x=n.Scale(s*h*(p-l),b,e);o[m].SubtractScaled(a,x),d.ApplyLinearImpulse(x,f,!0)}}}for(let c=0;c<this.m_contactBuffer.count;c++){let u=this.m_contactBuffer.data[c];if(u.flags&64){let m=u.weight;if(m>l){let p=u.indexA,d=u.indexB,h=u.normal,f=n.Scale(s*(m-l),h,e);o[p].Subtract(f),o[d].Add(f)}}}}static{this.SolvePowder_s_f=new n}SolveSolid(t){let e=i.SolveSolid_s_f,r=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);let o=t.inv_dt*this.m_def.ejectionStrength;for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s],a=l.indexA,c=l.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[c]){let u=l.weight,m=l.normal,p=this.m_depthBuffer[a]+this.m_depthBuffer[c],d=n.Scale(o*p*u,m,e);r[a].Subtract(d),r[c].Add(d)}}}static{this.SolveSolid_s_f=new n}SolveForce(t){let e=this.m_velocityBuffer.data,r=t.dt*this.GetParticleInvMass();for(let o=0;o<this.m_count;o++)e[o].AddScaled(r,this.m_forceBuffer[o]);this.m_hasForce=!1}SolveColorMixing(){let t=.5*this.m_def.colorMixingStrength;if(t)for(let e=0;e<this.m_contactBuffer.count;e++){let r=this.m_contactBuffer.data[e],o=r.indexA,s=r.indexB;if(this.m_flagsBuffer.data[o]&this.m_flagsBuffer.data[s]&256){let l=this.m_colorBuffer.data[o],a=this.m_colorBuffer.data[s];F.MixColors(l,a,t)}}}SolveZombie(){let t=0,e=[];for(let l=0;l<this.m_count;l++)e[l]=-1;let r=0,o=this.m_world.GetDestructionListener();for(let l=0;l<this.m_count;l++){let a=this.m_flagsBuffer.data[l];if(a&2){if(a&512&&o?.SayGoodbyeParticle(this,l),this.m_handleIndexBuffer.data){let c=this.m_handleIndexBuffer.data[l];c&&(c.SetIndex(-1),this.m_handleIndexBuffer.data[l]=null)}e[l]=-1}else{if(e[l]=t,l!==t){if(this.m_handleIndexBuffer.data){let c=this.m_handleIndexBuffer.data[l];c&&c.SetIndex(t),this.m_handleIndexBuffer.data[t]=c}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[l],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[l]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[l]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[l]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[l]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[l]),this.m_groupBuffer[t]=this.m_groupBuffer[l],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[l]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[l]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[l]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[l]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[l]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[l])}t++,r|=a}}let s={IsProxyInvalid:l=>l.index<0,IsContactInvalid:l=>l.indexA<0||l.indexB<0,IsBodyContactInvalid:l=>l.index<0,IsPairInvalid:l=>l.indexA<0||l.indexB<0,IsTriadInvalid:l=>l.indexA<0||l.indexB<0||l.indexC<0};for(let l=0;l<this.m_proxyBuffer.count;l++){let a=this.m_proxyBuffer.data[l];a.index=e[a.index]}this.m_proxyBuffer.RemoveIf(s.IsProxyInvalid);for(let l=0;l<this.m_contactBuffer.count;l++){let a=this.m_contactBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB]}this.m_contactBuffer.RemoveIf(s.IsContactInvalid);for(let l=0;l<this.m_bodyContactBuffer.count;l++){let a=this.m_bodyContactBuffer.data[l];a.index=e[a.index]}this.m_bodyContactBuffer.RemoveIf(s.IsBodyContactInvalid);for(let l=0;l<this.m_pairBuffer.count;l++){let a=this.m_pairBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB]}this.m_pairBuffer.RemoveIf(s.IsPairInvalid);for(let l=0;l<this.m_triadBuffer.count;l++){let a=this.m_triadBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB],a.indexC=e[a.indexC]}if(this.m_triadBuffer.RemoveIf(s.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data){let l=0;for(let a=0;a<this.m_count;a++){let c=e[this.m_indexByExpirationTimeBuffer.data[a]];c!==-1&&(this.m_indexByExpirationTimeBuffer.data[l++]=c)}}for(let l=this.m_groupList;l;l=l.GetNext()){let a=t,c=0,u=!1;for(let m=l.m_firstIndex;m<l.m_lastIndex;m++){let p=e[m];p>=0?(a=Math.min(a,p),c=Math.max(c,p+1)):u=!0}a<c?(l.m_firstIndex=a,l.m_lastIndex=c,u&&l.m_groupFlags&1&&this.SetGroupFlags(l,l.m_groupFlags|16)):(l.m_firstIndex=0,l.m_lastIndex=0,l.m_groupFlags&4||this.SetGroupFlags(l,l.m_groupFlags|8))}this.m_count=t,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(let l=this.m_groupList;l;){let a=l.GetNext();l.m_groupFlags&8&&this.DestroyParticleGroup(l),l=a}}SolveLifetimes(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);let e=this.GetQuantizedTimeElapsed(),r=this.m_expirationTimeBuffer.data,o=this.m_indexByExpirationTimeBuffer.data,s=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Wc(o,0,s,(l,a)=>{let c=r[l],u=r[a],m=c<=0,p=u<=0;return m===p?c>u:m}),this.m_expirationTimeBufferRequiresSorting=!1);for(let l=s-1;l>=0;--l){let a=o[l],c=r[a];if(e<c||c<=0)break;this.DestroyParticle(a)}}RotateBuffer(t,e,r){if(t===e||e===r)return;function o(s){return s<t?s:s<e?s+r-e:s<r?s+t-e:s}if(Fe(this.m_flagsBuffer.data,t,e,r),this.m_lastBodyContactStepBuffer.data&&Fe(this.m_lastBodyContactStepBuffer.data,t,e,r),this.m_bodyContactCountBuffer.data&&Fe(this.m_bodyContactCountBuffer.data,t,e,r),this.m_consecutiveContactStepsBuffer.data&&Fe(this.m_consecutiveContactStepsBuffer.data,t,e,r),Fe(this.m_positionBuffer.data,t,e,r),Fe(this.m_velocityBuffer.data,t,e,r),Fe(this.m_groupBuffer,t,e,r),this.m_hasForce&&Fe(this.m_forceBuffer,t,e,r),this.m_staticPressureBuffer&&Fe(this.m_staticPressureBuffer,t,e,r),this.m_depthBuffer&&Fe(this.m_depthBuffer,t,e,r),this.m_colorBuffer.data&&Fe(this.m_colorBuffer.data,t,e,r),this.m_userDataBuffer.data&&Fe(this.m_userDataBuffer.data,t,e,r),this.m_handleIndexBuffer.data){Fe(this.m_handleIndexBuffer.data,t,e,r);for(let s=t;s<r;++s){let l=this.m_handleIndexBuffer.data[s];l&&l.SetIndex(o(l.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Fe(this.m_expirationTimeBuffer.data,t,e,r);let s=this.GetParticleCount(),l=this.m_indexByExpirationTimeBuffer.data;for(let a=0;a<s;++a)l[a]=o(l[a])}for(let s=0;s<this.m_proxyBuffer.count;s++){let l=this.m_proxyBuffer.data[s];l.index=o(l.index)}for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB)}for(let s=0;s<this.m_bodyContactBuffer.count;s++){let l=this.m_bodyContactBuffer.data[s];l.index=o(l.index)}for(let s=0;s<this.m_pairBuffer.count;s++){let l=this.m_pairBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB)}for(let s=0;s<this.m_triadBuffer.count;s++){let l=this.m_triadBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB),l.indexC=o(l.indexC)}for(let s=this.m_groupList;s;s=s.GetNext())s.m_firstIndex=o(s.m_firstIndex),s.m_lastIndex=o(s.m_lastIndex-1)+1}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){let e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return .75*this.m_particleDiameter}GetParticleMass(){let t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){let t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&65536?this.m_world.GetContactManager().m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&131072?this.m_world.GetContactManager().m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&16384?this.m_world.GetContactManager().m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&32768?this.m_world.GetContactManager().m_contactListener:null}SetUserOverridableBuffer(t,e){t.data=e,t.userSuppliedCapacity=e.length}SetGroupFlags(t,e){let r=t.m_groupFlags;(r^e)&1&&(e|=16),r&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&1&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}RemoveSpuriousBodyContacts(){Wc(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,i.BodyContactCompare);let t=i.RemoveSpuriousBodyContacts_s_n,e=i.RemoveSpuriousBodyContacts_s_pos,r=i.RemoveSpuriousBodyContacts_s_normal,o=3,s=-1,l=0,a=c=>{if(c.index!==s&&(l=0,s=c.index),l++>o)return!0;let u=t.Copy(c.normal);u.Scale(this.m_particleDiameter*(1-c.weight));let m=n.Add(this.m_positionBuffer.data[c.index],u,e);if(!c.fixture.TestPoint(m)){let p=c.fixture.GetShape().GetChildCount();for(let d=0;d<p;d++){let h=r;if(Nc(c.fixture.GetShape(),c.fixture.GetBody().GetTransform(),m,h,d)<Z)return!1}return!0}return!1};this.m_bodyContactBuffer.count=nx(this.m_bodyContactBuffer.data,a,this.m_bodyContactBuffer.count)}static{this.RemoveSpuriousBodyContacts_s_n=new n}static{this.RemoveSpuriousBodyContacts_s_pos=new n}static{this.RemoveSpuriousBodyContacts_s_normal=new n}DetectStuckParticle(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],this.m_bodyContactCountBuffer.data[t]===2&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==-1}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(t){return!(t&4)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(t){return t!==null&&(t.m_groupFlags&2)!==0}GetLinearVelocity(t,e,r,o){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(r,o):o.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,r,o,s,l,a,c){t[0]=o>0?1/o:0,e[0]=s>0?1/s:0,r[0]=n.Cross(n.Subtract(a,l,n.s_t0),c)}InitDampingParameterWithRigidGroupOrParticle(t,e,r,o,s,l,a,c){if(s&&o)this.InitDampingParameter(t,e,r,s.GetMass(),s.GetInertia(),s.GetCenter(),a,c);else{let u=this.m_flagsBuffer.data[l];this.InitDampingParameter(t,e,r,u&4?0:this.GetParticleMass(),0,a,a,c)}}ComputeDampingImpulse(t,e,r,o,s,l,a){let c=t+e*r*r+o+s*l*l;return c>0?a/c:0}ApplyDamping(t,e,r,o,s,l,a,c){s&&o?(s.m_linearVelocity.AddScaled(a*t,c),s.m_angularVelocity+=a*r*e):this.m_velocityBuffer.data[l].AddScaled(a*t,c)}},Yr=class{constructor(){this.index=-1;this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}},Rd=class{constructor(t,e,r,o,s){this.m_system=t,this.m_xLower=(e&ir.xMask)>>>0,this.m_xUpper=(r&ir.xMask)>>>0,this.m_yLower=(e&ir.yMask)>>>0,this.m_yUpper=(r&ir.yMask)>>>0,this.m_first=o,this.m_last=s}GetNext(){for(;this.m_first<this.m_last;){let t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&ir.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1}},kd=class{constructor(){this.next=null;this.count=0;this.index=0}},Kc=class{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}};var Fd=class extends Kc{Initialize(t,e){}Find(t){return-1}};var Id=class extends Kc{Initialize(t,e){}Find(t){return-1}},Gn=class{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,r){return!0}},Ld=class extends Gn{constructor(e){super();this.m_threshold=0;this.m_threshold=e}ShouldCreatePair(e,r){return e<this.m_threshold&&this.m_threshold<=r||r<this.m_threshold&&this.m_threshold<=e}ShouldCreateTriad(e,r,o){return(e<this.m_threshold||r<this.m_threshold||o<this.m_threshold)&&(this.m_threshold<=e||this.m_threshold<=r||this.m_threshold<=o)}},Gd=class extends ei{constructor(e,r=e.length){super(-1,0);this.m_shapeCount=0;this.m_shapes=e,this.m_shapeCount=r}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(e,r){for(let o=0;o<this.m_shapeCount;o++)if(this.m_shapes[o].TestPoint(e,r))return!0;return!1}RayCast(e,r,o,s){return!1}ComputeAABB(e,r,o){let s=new nt;e.lowerBound.x=+$,e.lowerBound.y=+$,e.upperBound.x=-$,e.upperBound.y=-$;for(let l=0;l<this.m_shapeCount;l++){let a=this.m_shapes[l].GetChildCount();for(let c=0;c<a;c++){let u=s;this.m_shapes[l].ComputeAABB(u,r,c),e.Combine1(u)}}}ComputeMass(e,r){}SetupDistanceProxy(e,r){}Draw(){}},Vd=class extends Gn{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(t){return(this.m_flagsBuffer.data[t]&4096)!==0}};Fi(He,{Create(i,t){let e=i(t);return e.m_particleSystemList=null,e}});function PC(i){let t=$;for(let e=i.GetParticleSystemList();e!==null;e=e.m_next)t=Math.min(t,e.GetRadius());return t}Object.assign(He.prototype,{CreateParticleSystem(i){N(!this.IsLocked());let t=new ir(i,this);return t.m_prev=null,t.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=t),this.m_particleSystemList=t,t},DestroyParticleSystem(i){N(!this.IsLocked()),i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i===this.m_particleSystemList&&(this.m_particleSystemList=i.m_next)},GetParticleSystemList(){return this.m_particleSystemList},CalculateReasonableParticleIterations(i){return this.m_particleSystemList===null?1:zc(this.GetGravity().Length(),PC(this),i)}});Fi(He.prototype,{CreateBody(i,t={}){let e=i(t);return e.m_xf0=new T,e},Solve(i,t){for(let e=this.m_particleSystemList;e;e=e.m_next)e.Solve(t);for(let e=this.GetBodyList();e;e=e.GetNext())e.m_xf0.Copy(e.GetTransform());i(t)}});Fi(uo.prototype,{SetTransformXY(i,t,e,r){i(t,e,r),this.m_xf0.Copy(this.GetTransform())}});Object.assign(Ii.prototype,{SayGoodbyeParticleGroup(){},SayGoodbyeParticle(){}});Object.assign(Ir.prototype,{SayGoodbyeParticleGroup(){return!0},SayGoodbyeParticle(){return!0}});Object.assign(Lr.prototype,{BeginContactFixtureParticle(){},EndContactFixtureParticle(){},BeginContactParticleParticle(){},EndContactParticleParticle(){}});Fi(Xe,{Create(i){let t=i();return t.config.particleIterations=0,t}});function DC(i,t){let e=t.GetParticleCount();if(e){let r=t.GetRadius(),o=t.GetPositionBuffer();if(t.m_colorBuffer.data){let s=t.GetColorBuffer();i.DrawParticles(o,r,s,e)}else i.DrawParticles(o,r,null,e)}}function lx(i,t){for(let e=t.GetParticleSystemList();e;e=e.m_next)DC(i,e)}var Ie=()=>{},eu=class{constructor(){this.m_testIndex=0;this.m_windowWidth=1600;this.m_windowHeight=900;this.m_hertz=60;this.m_velocityIterations=8;this.m_positionIterations=3;this.m_particleIterations=zc(10,.04,1/this.m_hertz);this.m_drawShapes=!0;this.m_drawParticles=!0;this.m_drawJoints=!0;this.m_drawAABBs=!1;this.m_drawContactPoints=!1;this.m_drawContactNormals=!1;this.m_drawContactImpulse=!1;this.m_drawFrictionImpulse=!1;this.m_drawCOMs=!1;this.m_drawControllers=!0;this.m_drawStats=!1;this.m_drawInputHelp=!0;this.m_drawFpsMeter=!0;this.m_drawProfile=!1;this.m_enableWarmStarting=!0;this.m_enableContinuous=!0;this.m_enableSubStepping=!1;this.m_enableSleep=!0;this.m_pause=!1;this.m_singleStep=!1;this.m_debugDraw={Prepare:Ie,Finish:Ie,PushTransform:Ie,PopTransform:Ie,DrawPolygon:Ie,DrawSolidPolygon:Ie,DrawCircle:Ie,DrawSolidCircle:Ie,DrawSegment:Ie,DrawTransform:Ie,DrawPoint:Ie,DrawParticles:Ie,DrawAABB:Ie,DrawStringWorld:Ie}}};Fi(He,{Create(i,t){let e=i(t);return e.m_controllerList=null,e.m_controllerCount=0,e}});Object.assign(He.prototype,{AddController(i){return i.m_next=this.m_controllerList,i.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=i),this.m_controllerList=i,++this.m_controllerCount,i},RemoveController(i){return i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),this.m_controllerList===i&&(this.m_controllerList=i.m_next),--this.m_controllerCount,i.m_prev=null,i.m_next=null,i}});Fi(He.prototype,{CreateBody(i,t={}){let e=i(t);return e.m_controllerList=null,e.m_controllerCount=0,e},DestroyBody(i,t){let e=t.m_controllerList;for(;e;){let r=e;e=e.nextController,r.controller.RemoveBody(t)}i(t)},Solve(i,t){for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);i(t)}});var Ed=class{constructor(t,e){this.prevBody=null;this.nextBody=null;this.prevController=null;this.nextController=null;this.controller=t,this.body=e}},Jr=class{constructor(){this.m_bodyList=null;this.m_bodyCount=0;this.m_prev=null;this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(t){let e=new Ed(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}RemoveBody(t){N(this.m_bodyCount>0,"Controller is empty");let e=this.m_bodyList;for(;e&&e.body!==t;)e=e.nextBody;N(e!==null,"Body is not attached to the controller"),e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}};var MC=new n,RC=new Re,kC=new n,FC=new n,IC=new n;function LC(i,t,e,r,o){let s=i,l=D.TransposeMultiplyVec2(r.q,t,MC),a=e-n.Dot(t,r.p),c=[],u=0,m=-1,p=-1,d=!1;for(let A=0;A<s.m_count;++A){c[A]=n.Dot(l,s.m_vertices[A])-a;let k=c[A]<-gt;A>0&&(k?d||(m=A-1,u++):d&&(p=A-1,u++)),d=k}switch(u){case 0:if(d){let A=RC;return s.ComputeMass(A,1),T.MultiplyVec2(r,A.center,o),A.mass}return 0;case 1:m===-1?m=s.m_count-1:p=s.m_count-1;break}let h=(m+1)%s.m_count,f=(p+1)%s.m_count,b=(0-c[m])/(c[h]-c[m]),x=(0-c[p])/(c[f]-c[p]),_=kC.Set(s.m_vertices[m].x*(1-b)+s.m_vertices[h].x*b,s.m_vertices[m].y*(1-b)+s.m_vertices[h].y*b),y=FC.Set(s.m_vertices[p].x*(1-x)+s.m_vertices[f].x*x,s.m_vertices[p].y*(1-x)+s.m_vertices[f].y*x),g=0,S=IC.SetZero(),w=s.m_vertices[h],B,C=h;for(;C!==f;){C=(C+1)%s.m_count,C===f?B=y:B=s.m_vertices[C];let A=.5*((w.x-_.x)*(B.y-_.y)-(w.y-_.y)*(B.x-_.x));g+=A,S.x+=A*(_.x+w.x+B.x)/3,S.y+=A*(_.y+w.y+B.y)/3,w=B}return S.Scale(1/g),T.MultiplyVec2(r,S,o),g}function GC(i,t,e,r,o){return o.SetZero(),0}function VC(i,t,e,r,o){return o.SetZero(),0}function EC(i,t,e,r,o){let s=i,l=T.MultiplyVec2(r,s.m_p,new n),a=-(n.Dot(t,l)-e);if(a<-s.m_radius+gt)return 0;if(a>s.m_radius)return o.Copy(l),Math.PI*s.m_radius*s.m_radius;let c=s.m_radius*s.m_radius,u=a*a,m=c*(Math.asin(a/s.m_radius)+Math.PI/2)+a*Math.sqrt(c-u),p=-2/3*(c-u)**1.5/m;return o.x=l.x+t.x*p,o.y=l.y+t.y*p,m}var Vn=[];Vn[0]=EC;Vn[1]=GC;Vn[2]=LC;Vn[3]=VC;function ax(i,t,e,r,o){let s=Vn[i.GetType()];return s?s(i,t,e,r,o):0}var UC={buoyancyForce:new n},hs=class extends Jr{constructor(){super(...arguments);this.normal=new n(0,1);this.offset=0;this.density=0;this.velocity=new n;this.linearDrag=0;this.angularDrag=0;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=new n}Step(e){if(!this.m_bodyList)return;this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());let{buoyancyForce:r}=UC;for(let o=this.m_bodyList;o;o=o.nextBody){let{body:s}=o;if(!s.IsAwake())continue;let l=new n,a=new n,c=0,u=0;for(let p=s.GetFixtureList();p;p=p.GetNext()){let d=new n,h=ax(p.GetShape(),this.normal,this.offset,s.GetTransform(),d);c+=h,l.x+=h*d.x,l.y+=h*d.y;let f=0;this.useDensity?f=p.GetDensity():f=1,u+=h*f,a.x+=h*d.x*f,a.y+=h*d.y*f}if(l.x/=c,l.y/=c,a.x/=u,a.y/=u,c<gt)continue;n.Negate(this.gravity,r),r.Scale(this.density*c),s.ApplyForce(r,a);let m=s.GetLinearVelocityFromWorldPoint(l,new n);m.Subtract(this.velocity),m.Scale(-this.linearDrag*c),s.ApplyForce(m,l),s.ApplyTorque(-s.GetInertia()/s.GetMass()*c*s.GetAngularVelocity()*this.angularDrag)}}};var d3=new n;var w3=new n;var T3=new n;var YC={buoyancyController:new F(0,0,.8)},Ud=new n,Yd=new n,iu=100;function JC(i,t){Ud.x=t.normal.x*t.offset+t.normal.y*iu,Ud.y=t.normal.y*t.offset-t.normal.x*iu,Yd.x=t.normal.x*t.offset-t.normal.y*iu,Yd.y=t.normal.y*t.offset+t.normal.x*iu,i.DrawSegment(Ud,Yd,YC.buoyancyController)}function cx(i,t){for(let e=t.m_controllerList;e;e=e.m_next)e instanceof hs&&JC(i,e)}var jC={aabb:new nt},Jd={Controllers:[],Examples:[],Joints:[],Collision:[],Benchmark:[],Rope:[],Forces:[],Stacking:[],Geometry:[],Solver:[],Bugs:[],Continuous:[],Lights:[],Particles:[]};function P(i,t,e){Jd[i].push({group:i,name:t,TestClass:e})}function ux(){return Object.keys(Jd).sort().map(i=>{let t=Jd[i].sort((e,r)=>e.name<r.name?-1:1);return{name:i,tests:t}})}var jd=class extends Ii{constructor(t){super(),this.test=t}SayGoodbyeJoint(t){this.test.m_mouseJoint===t?this.test.m_mouseJoint=null:this.test.JointDestroyed(t)}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){this.test.ParticleGroupDestroyed(t)}},zd=class{constructor(){this.normal=new n;this.position=new n;this.state=0;this.normalImpulse=0;this.tangentImpulse=0;this.separation=0}},jr=(i,t,e)=>`${i.toFixed(2)} [${t.toFixed(2)}] (${e.toFixed(2)})`,R=class i extends Lr{constructor(e={x:0,y:-10}){super();this.m_bomb=null;this.m_textLines=[];this.m_debugLines=[];this.m_statisticLines=[];this.m_mouseJoint=null;this.m_points=Array.from({length:i.k_maxContactPoints},()=>new zd);this.m_pointCount=0;this.m_bombSpawnPoint=new n;this.m_bombSpawning=!1;this.m_mouseWorld=new n;this.m_mouseTracing=!1;this.m_mouseTracerPosition=new n;this.m_mouseTracerVelocity=new n;this.m_stepCount=0;this.m_maxProfile=new tr;this.m_totalProfile=new tr;this.m_testControlGroups=[];this.m_world=He.Create(e),this.m_destructionListener=new jd(this),this.m_world.SetDestructionListener(this.m_destructionListener),this.m_world.SetContactListener(this),this.m_groundBody=this.m_world.CreateBody()}static{this.k_maxContactPoints=2048}setupControls(){}addTestControlGroup(e,r){this.m_testControlGroups.push({legend:e,controls:r})}getBaseHotkeys(){return[G(" ","Launch Bomb",()=>{this.LaunchBomb()})]}getHotkeys(){return[]}JointDestroyed(e){}ParticleGroupDestroyed(e){}BeginContact(e){}EndContact(e){}static{this.PreSolve_s_state1=[]}static{this.PreSolve_s_state2=[]}static{this.PreSolve_s_worldManifold=new ki}PreSolve(e,r){let o=e.GetManifold();if(o.pointCount===0)return;let s=e.GetFixtureA(),l=e.GetFixtureB(),a=i.PreSolve_s_state1,c=i.PreSolve_s_state2;t0(a,c,r,o);let u=i.PreSolve_s_worldManifold;e.GetWorldManifold(u);for(let m=0;m<o.pointCount&&this.m_pointCount<i.k_maxContactPoints;++m){let p=this.m_points[this.m_pointCount];p.fixtureA=s,p.fixtureB=l,p.position.Copy(u.points[m]),p.normal.Copy(u.normal),p.state=c[m],p.normalImpulse=o.points[m].normalImpulse,p.tangentImpulse=o.points[m].tangentImpulse,p.separation=u.separations[m],++this.m_pointCount}}PostSolve(e,r){}MouseDown(e){this.m_mouseWorld.Copy(e),this.m_mouseTracing=!0,this.m_mouseTracerPosition.Copy(e),this.m_mouseTracerVelocity.SetZero(),this.m_mouseJoint!==null&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null);let r;if(this.m_world.QueryPointAABB(e,o=>o.GetBody().GetType()===2&&o.TestPoint(e)?(r=o,!1):!0),r){let l=r.GetBody(),a=new ic;a.bodyA=this.m_groundBody,a.bodyB=l,a.target.Copy(e),a.maxForce=1e3*l.GetMass(),Ct(a,5,.7,a.bodyA,a.bodyB),this.m_mouseJoint=this.m_world.CreateJoint(a),l.SetAwake(!0)}}SpawnBomb(e){this.m_bombSpawnPoint.Copy(e),this.m_bombSpawning=!0}CompleteBombSpawn(e){if(!this.m_bombSpawning)return;let r=30,o=n.Subtract(this.m_bombSpawnPoint,e,new n);o.Scale(r),this.LaunchBombAt(this.m_bombSpawnPoint,o),this.m_bombSpawning=!1}ShiftMouseDown(e){this.m_mouseWorld.Copy(e),this.m_mouseJoint===null&&this.SpawnBomb(e)}MouseUp(e){this.m_mouseTracing=!1,this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(e)}MouseMove(e,r){this.m_mouseWorld.Copy(e),r&&this.m_mouseJoint&&this.m_mouseJoint.SetTarget(e)}LaunchBomb(){let e=new n(W(-15,15),30),r=n.Scale(-5,e,new n);this.LaunchBombAt(e,r)}LaunchBombAt(e,r){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null),this.m_bomb=this.m_world.CreateBody({type:2,position:e,bullet:!0}),this.m_bomb.SetLinearVelocity(r);let o=new V;o.m_radius=25/this.GetDefaultViewZoom(),this.m_bomb.CreateFixture({shape:o,density:20,restitution:0})}Resize(e,r){}RunStep(e){let r=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&(e.m_singleStep?e.m_singleStep=!1:r=0),this.m_debugLines.length=0,this.m_statisticLines.length=0,this.m_textLines.length=0,e.m_pause&&this.addDebug("Paused",!0),this.Step(e,r)}addText(e){this.m_textLines.push(e)}addDebug(e,r){this.m_debugLines.push([e,`${r}`])}addStatistic(e,r){this.m_statisticLines.push([e,`${r}`])}Step(e,r){this.m_world.SetAllowSleeping(e.m_enableSleep),this.m_world.SetWarmStarting(e.m_enableWarmStarting),this.m_world.SetContinuousPhysics(e.m_enableContinuous),this.m_world.SetSubStepping(e.m_enableSubStepping),this.m_pointCount=0,this.m_world.Step(r,{velocityIterations:e.m_velocityIterations,positionIterations:e.m_positionIterations,particleIterations:e.m_particleIterations});let o=e.m_debugDraw,{aabb:s}=jC;ot.unproject({x:0,y:ot.getHeight()},s.lowerBound),ot.unproject({x:ot.getWidth(),y:0},s.upperBound),e.m_drawShapes&&i0(o,this.m_world,s),e.m_drawParticles&&lx(o,this.m_world),e.m_drawJoints&&r0(o,this.m_world),e.m_drawAABBs&&o0(o,this.m_world),e.m_drawCOMs&&s0(o,this.m_world),e.m_drawControllers&&cx(o,this.m_world),r>0&&++this.m_stepCount,e.m_drawStats&&(this.addStatistic("Bodies",this.m_world.GetBodyCount()),this.addStatistic("Contacts",this.m_world.GetContactCount()),this.addStatistic("Joints",this.m_world.GetJointCount()),this.addStatistic("Proxies",this.m_world.GetProxyCount()),this.addStatistic("Height",this.m_world.GetTreeHeight()),this.addStatistic("Balance",this.m_world.GetTreeBalance()),this.addStatistic("Quality",this.m_world.GetTreeQuality().toFixed(2)));{let l=this.m_world.GetProfile();this.m_maxProfile.step=Math.max(this.m_maxProfile.step,l.step),this.m_maxProfile.collide=Math.max(this.m_maxProfile.collide,l.collide),this.m_maxProfile.solve=Math.max(this.m_maxProfile.solve,l.solve),this.m_maxProfile.solveInit=Math.max(this.m_maxProfile.solveInit,l.solveInit),this.m_maxProfile.solveVelocity=Math.max(this.m_maxProfile.solveVelocity,l.solveVelocity),this.m_maxProfile.solvePosition=Math.max(this.m_maxProfile.solvePosition,l.solvePosition),this.m_maxProfile.solveTOI=Math.max(this.m_maxProfile.solveTOI,l.solveTOI),this.m_maxProfile.broadphase=Math.max(this.m_maxProfile.broadphase,l.broadphase),this.m_totalProfile.step+=l.step,this.m_totalProfile.collide+=l.collide,this.m_totalProfile.solve+=l.solve,this.m_totalProfile.solveInit+=l.solveInit,this.m_totalProfile.solveVelocity+=l.solveVelocity,this.m_totalProfile.solvePosition+=l.solvePosition,this.m_totalProfile.solveTOI+=l.solveTOI,this.m_totalProfile.broadphase+=l.broadphase}if(e.m_drawProfile){let l=this.m_world.GetProfile(),a=new tr;if(this.m_stepCount>0){let c=1/this.m_stepCount;a.step=c*this.m_totalProfile.step,a.collide=c*this.m_totalProfile.collide,a.solve=c*this.m_totalProfile.solve,a.solveInit=c*this.m_totalProfile.solveInit,a.solveVelocity=c*this.m_totalProfile.solveVelocity,a.solvePosition=c*this.m_totalProfile.solvePosition,a.solveTOI=c*this.m_totalProfile.solveTOI,a.broadphase=c*this.m_totalProfile.broadphase}this.addDebug("Step [ave] (max)",jr(l.step,a.step,this.m_maxProfile.step)),this.addDebug("Collide [ave] (max)",jr(l.collide,a.collide,this.m_maxProfile.collide)),this.addDebug("Solve [ave] (max)",jr(l.solve,a.solve,this.m_maxProfile.solve)),this.addDebug("Solve Init [ave] (max)",jr(l.solveInit,a.solveInit,this.m_maxProfile.solveInit)),this.addDebug("Solve Velocity [ave] (max)",jr(l.solveVelocity,a.solveVelocity,this.m_maxProfile.solveVelocity)),this.addDebug("Solve Position [ave] (max)",jr(l.solvePosition,a.solvePosition,this.m_maxProfile.solvePosition)),this.addDebug("Solve TOI [ave] (max)",jr(l.solveTOI,a.solveTOI,this.m_maxProfile.solveTOI)),this.addDebug("Broad-Phase [ave] (max)",jr(l.broadphase,a.broadphase,this.m_maxProfile.broadphase))}if(this.m_mouseTracing&&!this.m_mouseJoint){let a=new n;a.x=2/.1*(1/.1*(this.m_mouseWorld.x-this.m_mouseTracerPosition.x)-this.m_mouseTracerVelocity.x),a.y=2/.1*(1/.1*(this.m_mouseWorld.y-this.m_mouseTracerPosition.y)-this.m_mouseTracerVelocity.y),this.m_mouseTracerVelocity.AddScaled(r,a),this.m_mouseTracerPosition.AddScaled(r,this.m_mouseTracerVelocity)}if(this.m_bombSpawning){let l=new F(0,0,1);o.DrawPoint(this.m_bombSpawnPoint,4,l),l.SetRGB(.8,.8,.8),o.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,l)}if(e.m_drawContactPoints)for(let c=0;c<this.m_pointCount;++c){let u=this.m_points[c];if(u.state===1?o.DrawPoint(u.position,10,new F(.3,.95,.3)):u.state===2&&o.DrawPoint(u.position,5,new F(.3,.3,.95)),e.m_drawContactNormals){let m=u.position,p=n.Add(m,n.Scale(.3,u.normal,n.s_t0),new n);o.DrawSegment(m,p,new F(.9,.9,.9))}else if(e.m_drawContactImpulse){let m=u.position,p=n.AddScaled(m,.1*u.normalImpulse,u.normal,new n);o.DrawSegment(m,p,new F(.9,.9,.3))}if(e.m_drawFrictionImpulse){let m=n.CrossVec2One(u.normal,new n),p=u.position,d=n.AddScaled(p,.1*u.tangentImpulse,m,new n);o.DrawSegment(p,d,new F(.9,.9,.3))}}}GetDefaultViewZoom(){return 25}getCenter(){return n.ZERO}Destroy(){}};var ru=class{constructor(t,e,r){this.index=0;this.lastTime=-1;this.nextUpdate=0;this.calculated={avgFps:0,avgTime:0,minTime:0,maxTime:0,minFps:0,maxFps:0};this.waitTime=t,this.frameTimes=Array.from({length:e},()=>r),this.calculate()}getFps(){return this.calculated}getFrames(){return this.index===0?this.frameTimes:this.frameTimes.slice(this.index).concat(this.frameTimes.slice(0,this.index))}addFrame(){let t=performance.now();if(this.lastTime===-1)return this.lastTime=t,0;let e=t-this.lastTime;return this.lastTime=t,this.frameTimes[this.index]=e,++this.index===this.frameTimes.length&&(this.index=0),this.nextUpdate-=e,this.nextUpdate<=0&&this.calculate(),e}calculate(){this.nextUpdate=this.waitTime;let t=this.frameTimes.reduce((s,l)=>s+l,0),e=Math.max(1,t/this.frameTimes.length),r=Math.min(...this.frameTimes),o=Math.max(...this.frameTimes);this.calculated={avgFps:1e3/e,avgTime:e,minTime:r,maxTime:o,minFps:1e3/o,maxFps:1e3/r}}};var En=mt(Ut());function rr(i,t,e,r){return{type:"select",name:i,options:t,initialValue:e,update:r}}var mx=({control:i})=>En.default.createElement("label",{className:"select"},En.default.createElement("div",{className:"select--wrapper"},En.default.createElement("select",{defaultValue:i.initialValue,className:"select--input"},i.options.map(t=>En.default.createElement("option",{key:t,value:t,onClick:()=>i.update(t)},t)))),i.name.split("#")[0]);var ve={water:0,viscous:32,powder:64,tensile:128,"static pressure":2048},ou={...ve,spring:8,elastic:16,"color mixing":256,wall:4,barrier:1028},su=class{constructor(t){this.restartOnChange=!0;this.types=ou;this.selectedKey="";this.defaultKey="water";this.manager=t}SetValues(t,e){this.types=t,this.defaultKey=e}SetRestartOnChange(t=!0){this.restartOnChange=t}Reset(){this.types=ou,this.selectedKey="",this.defaultKey="water",this.restartOnChange=!0}GetSelectedKey(){return this.selectedKey||this.defaultKey}GetValue(){return this.types[this.GetSelectedKey()]}GetControl(){let t=Object.keys(this.types);return rr("Particle Type",t,this.GetSelectedKey(),e=>{!this.selectedKey&&e===this.defaultKey?this.selectedKey=e:this.selectedKey!==e&&(this.selectedKey=e,this.restartOnChange&&this.manager.scheduleRestart())})}};var nu=class{ParticleCreated(t,e){}},wi=class{constructor(){this.m_particleSystem=null;this.m_callback=null;this.m_origin=new n;this.m_startingVelocity=new n;this.m_speed=0;this.m_halfSize=new n;this.m_emitRate=1;this.m_color=new F;this.m_emitRemainder=0;this.m_flags=0;this.m_group=null}Destroy(){this.SetGroup(null)}SetPosition(t){this.m_origin.Copy(t)}GetPosition(t){return t.Copy(this.m_origin)}SetSize(t){n.Scale(.5,t,this.m_halfSize)}GetSize(t){return n.Scale(2,this.m_halfSize,t)}SetVelocity(t){this.m_startingVelocity.Copy(t)}GetVelocity(t){return t.Copy(this.m_startingVelocity)}SetSpeed(t){this.m_speed=t}GetSpeed(){return this.m_speed}SetParticleFlags(t){this.m_flags=t}GetParticleFlags(){return this.m_flags}SetColor(t){this.m_color.Copy(t)}GetColor(t){return t.Copy(this.m_color)}SetEmitRate(t){this.m_emitRate=t}GetEmitRate(){return this.m_emitRate}SetParticleSystem(t){this.m_particleSystem=t}GetParticleSystem(){return this.m_particleSystem}SetCallback(t){this.m_callback=t}GetCallback(){return this.m_callback}SetGroup(t){this.m_group&&this.m_group.SetGroupFlags(this.m_group.GetGroupFlags()&-5),this.m_group=t,this.m_group&&this.m_group.SetGroupFlags(this.m_group.GetGroupFlags()|4)}GetGroup(){return this.m_group}Step(t,e,r=e?e.length:0){N(this.m_particleSystem!==null);let o=0;this.m_emitRemainder+=this.m_emitRate*t;let s=new Si;for(s.color.Copy(this.m_color),s.flags=this.m_flags,s.group=this.m_group;this.m_emitRemainder>1;){this.m_emitRemainder-=1;let l=Math.random()*2*Math.PI,a=Math.random(),c=new n(Math.sin(l),Math.cos(l));s.position.Set(this.m_origin.x+c.x*a*this.m_halfSize.x,this.m_origin.y+c.y*a*this.m_halfSize.y),s.velocity.Copy(this.m_startingVelocity),this.m_speed!==0&&s.velocity.AddScaled(this.m_speed,c);let u=this.m_particleSystem.CreateParticle(s);this.m_callback&&this.m_callback.ParticleCreated(this.m_particleSystem,u),e&&o<r&&(e[o]=u),++o}return o}};var lu=mt(Ut());function jt(i,t,e){return{type:"checkbox",name:i,initialValue:t,update:e}}var px=({control:i})=>lu.default.createElement("label",{className:"checkbox"},lu.default.createElement("input",{type:"checkbox",className:"checkbox--input",onClick:t=>i.update(t.currentTarget.checked),defaultChecked:i.initialValue}),lu.default.createElement("span",null,i.name.split("#")[0]));var Li=[new F().SetByteRGBA(255,0,0,255),new F().SetByteRGBA(0,255,0,255),new F().SetByteRGBA(0,0,255,255),new F().SetByteRGBA(255,140,0,255),new F().SetByteRGBA(0,206,209,255),new F().SetByteRGBA(255,0,255,255),new F().SetByteRGBA(255,215,0,255),new F().SetByteRGBA(0,255,255,255)],Qt=class i extends R{static{this.m_strictContacts=!1}constructor(t={x:0,y:-10}){super(t);let e=new fo;this.m_particleSystem=this.m_world.CreateParticleSystem(e),this.m_particleSystem.SetGravityScale(.4),this.m_particleSystem.SetDensity(1.2)}setupControls(){this.addTestControlGroup("Particles",[this.createStrictContactsCheckbox()])}createStrictContactsCheckbox(){return jt("Strict Particle/Body Contacts",i.m_strictContacts,t=>{i.m_strictContacts=t})}Step(t,e){if(super.Step(t,e),this.m_particleSystem.SetStrictContactCheck(i.m_strictContacts),t.m_drawStats&&(this.addStatistic("Particles",this.m_particleSystem.GetParticleCount()),this.addStatistic("Groups",this.m_particleSystem.GetParticleGroupCount()),this.addStatistic("Pairs",this.m_particleSystem.GetPairCount()),this.addStatistic("Triads",this.m_particleSystem.GetTriadCount())),this.m_mouseTracing&&!this.m_mouseJoint){let r=new V;r.m_p.Copy(this.m_mouseTracerPosition),r.m_radius=this.getParticleSelectionRadius();let o=new nt,s=new T;s.SetIdentity(),r.ComputeAABB(o,s,0),this.m_particleSystem.QueryAABB(o,l=>{let a=this.m_particleSystem.GetPositionBuffer()[l];return r.TestPoint(T.IDENTITY,a)&&this.m_particleSystem.GetVelocityBuffer()[l].Copy(this.m_mouseTracerVelocity),!0})}}ColorParticleGroup(t,e){let r=this.m_particleSystem.GetColorBuffer(),o=t.GetParticleCount(),s=t.GetBufferIndex(),l=o+s,a=Li.length;e||(e=Math.floor(o/a),e||(e=1));for(let c=s;c<l;c++)r[c]=Li[Math.floor(c/e)%a].Clone()}getParticleSelectionRadius(){return 40/this.GetDefaultViewZoom()}},ht=class extends Qt{constructor(t,e={x:0,y:-10}){super(e),this.particleParameter=t}setupControls(){this.addTestControlGroup("Particles",[this.createStrictContactsCheckbox(),this.particleParameter.GetControl()])}};var zC={water:0,powder:64,tensile:128,viscous:32,"tensile powder":192,"viscous powder":96,"viscous tensile powder":224,"tensile viscous water":160},it=class{static{this.k_maxPumps=5}static{this.k_maxEmitters=5}static{this.k_flipTime=6}static{this.k_tileRadius=2}static{this.k_tileDiameter=4}static{this.k_pumpRadius=2-.05}static{this.k_playfieldLeftEdge=-20}static{this.k_playfieldRightEdge=20}static{this.k_playfieldBottomEdge=40}static{this.k_tileWidth=10}static{this.k_tileHeight=11}static{this.k_defaultEmitterRate=30}static{this.k_defaultEmitterSize=3}static{this.k_particleExitSpeedY=-9.8}static{this.k_pumpForce=600}static{this.k_numberOfSpecialParticles=256}},Xd=class extends Ii{constructor(e,r){super();this.m_particles=[];this.m_colorOscillationTime=0;this.m_colorOscillationPeriod=2;this.m_world=e,this.m_particleSystem=r,this.m_world.SetDestructionListener(this)}Destroy(){this.m_world.SetDestructionListener(null)}Add(e,r){for(let o=0;o<r&&this.m_particles.length<it.k_numberOfSpecialParticles;++o){let s=e[o];this.m_particleSystem.SetParticleFlags(s,this.m_particleSystem.GetFlagsBuffer()[s]|512),this.m_particles.push(this.m_particleSystem.GetParticleHandleFromIndex(s))}}Step(e){function r(l,a){return l-Math.floor(l/a)*a}this.m_colorOscillationTime=r(this.m_colorOscillationTime+e,this.m_colorOscillationPeriod);let o=2*Math.abs(this.m_colorOscillationTime/this.m_colorOscillationPeriod-.5),s=new F().SetByteRGBA(128+128*(1-o),128+256*Math.abs(.5-o),128+128*o,255);for(let l of this.m_particles)this.m_particleSystem.GetColorBuffer()[l.GetIndex()].Copy(s)}SayGoodbyeJoint(e){}SayGoodbyeFixture(e){}SayGoodbyeParticleGroup(e){}SayGoodbyeParticle(e,r){e===this.m_particleSystem&&(this.m_particles=this.m_particles.filter(o=>o.GetIndex()!==r))}},Hd=class extends ht{constructor({particleParameter:e}){super(e,{x:0,y:-20});this.m_faucetEmitterIndex=0;this.m_pumpIndex=0;this.m_pumpTimer=0;this.m_pumpForce=new n;this.m_pumps=[];this.m_emitters=[];let r=this.m_world.CreateBody();for(let s=0;s<it.k_maxEmitters;s++)this.m_emitters[s]=null;for(let s=0;s<it.k_maxPumps;s++)this.m_pumps[s]=null;{let s=new v,l=[new n(-40,-10),new n(40,-10),new n(40,0),new n(-40,0)];s.Set(l,4),r.CreateFixture({shape:s})}{let s=new v,l=[new n(it.k_playfieldLeftEdge-20,-1),new n(it.k_playfieldLeftEdge,-1),new n(it.k_playfieldLeftEdge,50),new n(it.k_playfieldLeftEdge-20,50)];s.Set(l,4),r.CreateFixture({shape:s})}{let s=new v,l=[new n(it.k_playfieldRightEdge,-1),new n(it.k_playfieldRightEdge+20,-1),new n(it.k_playfieldRightEdge+20,50),new n(it.k_playfieldRightEdge,50)];s.Set(l,4),r.CreateFixture({shape:s})}this.m_particleSystem.SetRadius(.25),this.m_specialTracker=new Xd(this.m_world,this.m_particleSystem),this.m_pumpTimer=0,this.SetupMaze(),this.m_killFieldShape=new v,this.m_killFieldShape.SetAsBox(it.k_playfieldRightEdge-it.k_playfieldLeftEdge,1),this.m_killFieldTransform=new T;let o=new n(-20,1);this.m_killFieldTransform.SetPositionAngle(o,0),e.SetValues(zC,"water"),e.SetRestartOnChange(!1)}Destroy(){for(let e=0;e<this.m_faucetEmitterIndex;e++)this.m_emitters[e]=null}SetupMaze(){let e="# r#g #r##  /#  #  # ###     pA  #  /##### # /#  C  /# #   # ### # / # ## p /#   #  ####  A        /#####KK###";this.m_faucetEmitterIndex=0,this.m_pumpIndex=0;let r=new v;r.SetAsBox(it.k_tileRadius,it.k_tileRadius);let o=H(3,n);o[0].Set(-it.k_tileRadius,-it.k_tileRadius),o[1].Set(it.k_tileRadius,it.k_tileRadius),o[2].Set(it.k_tileRadius,-it.k_tileRadius);let s=new v;s.Set(o,3),o[1].Set(-it.k_tileRadius,it.k_tileRadius);let l=new v;l.Set(o,3);let a=new V;a.m_radius=it.k_tileRadius*.7;let c=new F().SetByteRGBA(255,128,128,255),u=new F().SetByteRGBA(128,255,128,255),m=new F().SetByteRGBA(128,128,255,255);this.m_pumpForce.Set(it.k_pumpForce,0);for(let p=0;p<it.k_tileWidth;p++)for(let d=0;d<it.k_tileHeight;d++){let h=e[d*it.k_tileWidth+p],f=new n(it.k_playfieldLeftEdge+it.k_tileRadius*2*p+it.k_tileRadius,it.k_playfieldBottomEdge-it.k_tileRadius*2*d+it.k_tileRadius);switch(h){case"#":this.CreateBody(f,r,0);break;case"A":this.CreateBody(f,l,0);break;case"/":this.CreateBody(f,s,0);break;case"C":this.CreateBody(f,a,2);break;case"p":this.AddPump(f);break;case"b":this.AddFaucetEmitter(f,m);break;case"r":this.AddFaucetEmitter(f,c);break;case"g":this.AddFaucetEmitter(f,u);break;default:break}}}CreateBody(e,r,o){this.m_world.CreateBody({type:o,position:e}).CreateFixture({shape:r,density:10})}AddPump(e){let r=new v;r.SetAsBox(it.k_pumpRadius,it.k_pumpRadius);let o=this.m_world.CreateBody({position:e,type:2,angle:0});o.CreateFixture({shape:r,density:5});let s=new Zt;s.bodyA=this.m_groundBody,s.bodyB=o,s.collideConnected=!1,s.localAxisA.Set(1,0),s.localAnchorA.Copy(e),this.m_world.CreateJoint(s),this.m_pumps[this.m_pumpIndex]=o,this.m_pumpIndex++}AddFaucetEmitter(e,r){let o=new n(0,it.k_particleExitSpeedY),s=new wi;s.SetParticleSystem(this.m_particleSystem),s.SetPosition(e),s.SetVelocity(o),s.SetSize(new n(it.k_defaultEmitterSize,0)),s.SetEmitRate(it.k_defaultEmitterRate),s.SetColor(r),this.m_emitters[this.m_faucetEmitterIndex]=s,this.m_faucetEmitterIndex++}JointDestroyed(e){super.JointDestroyed(e)}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e)}BeginContact(e){super.BeginContact(e)}EndContact(e){super.EndContact(e)}PreSolve(e,r){super.PreSolve(e,r)}PostSolve(e,r){super.PostSolve(e,r)}getCenter(){return{x:0,y:20}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r);let s=this.particleParameter.GetValue();for(let l=0;l<this.m_faucetEmitterIndex;l++){let a=[],c=this.m_emitters[l];if(c){c.SetParticleFlags(s);let u=c.Step(o,a,it.k_numberOfSpecialParticles);this.m_specialTracker.Add(a,u)}}this.m_specialTracker.Step(o),this.m_particleSystem.DestroyParticlesInShape(this.m_killFieldShape,this.m_killFieldTransform);for(let l=0;l<this.m_pumpIndex;l++){let a=this.m_pumps[l];a&&a.ApplyForceToCenter(this.m_pumpForce,!0),this.m_pumpTimer+=o,this.m_pumpTimer>it.k_flipTime&&(this.m_pumpTimer-=it.k_flipTime,this.m_pumpForce.x*=-1)}}};P("Particles","Sandbox",Hd);var Od=class{constructor(t,e,r,o,s,l){this.m_initialLifetime=0;this.m_remainingLifetime=0;this.m_halfLifetime=0;this.m_origColor=new F;let a=new V;a.m_p.Copy(e),a.m_radius=r;let c=new et;c.flags=l,c.shape=a;function u(f,b,x){return x<0&&(x+=1),x>1&&(x-=1),x<1/6?f+(b-f)*6*x:x<1/2?b:x<2/3?f+(b-f)*(2/3-x)*6:f}function m(f,b,x,_=1){let y,g,S;if(b===0)y=g=S=x;else{let w=x<.5?x*(1+b):x+b-x*b,B=2*x-w;y=u(B,w,f+1/3),g=u(B,w,f),S=u(B,w,f-1/3)}return{r:y,g,b:S,a:_}}this.m_origColor.Copy(m(Math.random(),1,.5)),c.color.Copy(this.m_origColor),this.m_particleSystem=t,this.m_pg=this.m_particleSystem.CreateParticleGroup(c),this.m_initialLifetime=this.m_remainingLifetime=s,this.m_halfLifetime=this.m_initialLifetime*.5;let p=this.m_pg.GetBufferIndex(),d=this.m_particleSystem.GetPositionBuffer(),h=this.m_particleSystem.GetVelocityBuffer();for(let f=p;f<p+this.m_pg.GetParticleCount();f++)n.Subtract(d[f],e,h[f]),h[f].Scale(o)}Drop(){this.m_pg.DestroyParticles(!1)}ColorCoeff(){return this.m_remainingLifetime>=this.m_halfLifetime?1:1-(this.m_halfLifetime-this.m_remainingLifetime)/this.m_halfLifetime}Step(t){if(t>0&&this.m_remainingLifetime>0){this.m_remainingLifetime=Math.max(this.m_remainingLifetime-t,0);let e=this.ColorCoeff(),r=this.m_particleSystem.GetColorBuffer(),o=this.m_pg.GetBufferIndex();for(let s=o;s<o+this.m_pg.GetParticleCount();s++){let l=r[s];l.a*=e}}}IsDone(){return this.m_remainingLifetime<=0}},Nd=class i extends ht{constructor({particleParameter:e}){super(e);this.m_VFXIndex=0;this.m_VFX=[];this.m_contact=!1;this.m_contactPoint=new n;this.m_VFXIndex=0;for(let r=0;r<i.c_maxVFX;r++)this.m_VFX[r]=null;this.CreateWalls(),this.m_particleSystem.SetRadius(.25*2);for(let r=0;r<i.c_maxCircles;r++){let o=this.m_world.CreateBody({type:2}),s=new V;s.m_p.Set(3*W(-1,1),i.SHAPE_HEIGHT_OFFSET+i.SHAPE_OFFSET*r),s.m_radius=2,o.CreateFixture({shape:s,density:.5,userData:{sparky:!0}})}e.SetValues(ve,"powder"),e.SetRestartOnChange(!1)}static{this.c_maxCircles=3}static{this.c_maxVFX=20}static{this.SHAPE_HEIGHT_OFFSET=7}static{this.SHAPE_OFFSET=4.5}BeginContact(e){super.BeginContact(e);let r=e.GetFixtureA().GetUserData(),o=e.GetFixtureB().GetUserData();if(r.sparky||o.sparky){let s=new ki;e.GetWorldManifold(s),this.m_contactPoint.Copy(s.points[0]),this.m_contact=!0}}Step(e,r){let o=this.particleParameter.GetValue(),s=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(s=0),super.Step(e,r),this.m_contact&&(this.AddVFX(this.m_contactPoint,o),this.m_contact=!1);for(let l=0;l<i.c_maxVFX;l++){let a=this.m_VFX[l];a!==null&&(a.Step(s),a.IsDone()&&(a.Drop(),this.m_VFX[l]=null))}}AddVFX(e,r){let o=this.m_VFX[this.m_VFXIndex];o!==null&&(o.Drop(),this.m_VFX[this.m_VFXIndex]=null),this.m_VFX[this.m_VFXIndex]=new Od(this.m_particleSystem,e,W(1,2),W(10,20),W(.5,1),r),++this.m_VFXIndex>=i.c_maxVFX&&(this.m_VFXIndex=0)}getCenter(){return{x:0,y:20}}CreateWalls(){let e=this.m_world.CreateBody();{let r=new v,o=[new n(-40,-10),new n(40,-10),new n(40,0),new n(-40,0)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(-40,40),new n(40,40),new n(40,50),new n(-40,50)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(-40,-10),new n(-20,-10),new n(-20,50),new n(-40,50)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(20,-10),new n(40,-10),new n(40,50),new n(20,50)];r.Set(o,4),e.CreateFixture({shape:r})}}};P("Particles","Sparky",Nd);var Zd=class extends ht{constructor({particleParameter:t}){super(t);{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-2,0),new n(2,0),new n(2,4),new n(-2,4)];r.CreateLoop(o,4),e.CreateFixture({shape:r})}this.m_particleSystem.SetRadius(.025*2),this.m_particleSystem.SetDamping(.2);{let e=new v;e.SetAsBox(.8,1,new n(-1.2,1.01),0);let r=new et;r.flags=t.GetValue(),r.shape=e;let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","DamBreak",Zd);var XC={"tensile + viscous":160,...ve},Qd=class extends ht{constructor({particleParameter:t}){super(t),t.SetValues(XC,"tensile + viscous");{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-2,0),new n(2,0),new n(2,4),new n(-2,4)];r.CreateLoop(o,4),e.CreateFixture({shape:r})}this.m_particleSystem.SetRadius(.025);{let e=new v;e.SetAsBox(2,.4,new n(0,3.6),0);let r=new et;r.flags=t.GetValue(),r.shape=e;let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-2,3.2),new n(-1.2,3.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.1,3.2),new n(2,3.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.2,3.2),new n(-1.2,2.8)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.1,3.2),new n(-1.1,2.8)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.6,2.4),new n(.8,2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(1.6,1.6),new n(-.8,1.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.2,.8),new n(-1.2,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-.4,.8),new n(-.4,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(.4,.8),new n(.4,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(1.2,.8),new n(1.2,0)),e.CreateFixture({shape:r,density:.1})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Liquid Timer",Qd);var qd=class extends ht{constructor({particleParameter:e}){super(e);this.m_time=0;e.SetValues(ve,"water");let r=this.m_world.CreateBody();{let s=this.m_world.CreateBody({type:2,allowSleep:!1,position:{x:0,y:1}}),l=new v;l.SetAsBox(.05,1,new n(2,0),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(.05,1,new n(-2,0),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(2,.05,new n(0,1),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(2,.05,new n(0,-1),0),s.CreateFixture({shape:l,density:5});let a=new q;a.bodyA=r,a.bodyB=s,a.localAnchorA.Set(0,1),a.localAnchorB.Set(0,0),a.referenceAngle=0,a.motorSpeed=.05*Math.PI,a.maxMotorTorque=1e7,a.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(a)}this.m_particleSystem.SetRadius(.025*2);let o=e.GetValue();this.m_particleSystem.SetDamping(.2);{let s=new et;s.flags=o;let l=new v;l.SetAsBox(.9,.9,new n(0,1),0),s.shape=l;let a=this.m_particleSystem.CreateParticleGroup(s);s.flags&256&&this.ColorParticleGroup(a,0)}this.m_time=0}Step(e,r){super.Step(e,r),e.m_hertz>0&&(this.m_time+=1/e.m_hertz),this.m_joint.SetMotorSpeed(.05*Math.cos(this.m_time)*Math.PI)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Wave Machine",qd);var Wd=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody();{let o=new v,s=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,3)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(2,-.1),new n(4,-.1),new n(4,3),new n(2,2)];o.Set(s,4),r.CreateFixture({shape:o})}}this.m_particleSystem.SetRadius(.035*2);let e=t.GetValue();this.m_particleSystem.SetDamping(.2);{let r=new V;r.m_p.Set(0,3),r.m_radius=2;let o=new et;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}{let r=this.m_world.CreateBody({type:2}),o=new V;o.m_p.Set(0,8),o.m_radius=.5,r.CreateFixture({shape:o,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Particles",Wd);var HC={...ve,"color mixing":256},Kd=class extends nu{constructor(e,r){super();this.m_minLifetime=0;this.m_maxLifetime=0;this.m_minLifetime=e,this.m_maxLifetime=r}ParticleCreated(e,r){e.SetParticleLifetime(r,Math.random()*(this.m_maxLifetime-this.m_minLifetime)+this.m_minLifetime)}},$d=class i extends ht{constructor({particleParameter:e}){super(e);this.m_particleColorOffset=0;this.m_emitter=new wi,this.m_lifetimeRandomizer=new Kd(i.k_particleLifetimeMin,i.k_particleLifetimeMax),this.m_particleSystem.SetRadius(.035),this.m_particleSystem.SetMaxParticleCount(i.k_maxParticleCount),this.m_particleSystem.SetDestructionByAge(!0);let r=this.m_world.CreateBody();{let o=new v,s=i.k_containerHeight+i.k_containerThickness;o.SetAsBox(i.k_containerWidth-i.k_containerThickness,i.k_containerThickness,new n,0),r.CreateFixture({shape:o}),o.SetAsBox(i.k_containerThickness,s,new n(-i.k_containerWidth,i.k_containerHeight),0),r.CreateFixture({shape:o}),o.SetAsBox(i.k_containerThickness,s,new n(i.k_containerWidth,i.k_containerHeight),0),r.CreateFixture({shape:o})}{let o=new v;o.SetAsBox(i.k_containerWidth*5,i.k_containerThickness,new n(0,i.k_containerThickness*-2),0),r.CreateFixture({shape:o})}{let o=new v,s=this.m_particleSystem.GetRadius()*2,a=i.k_faucetLength*s*i.k_spoutLength,c=i.k_containerWidth*i.k_faucetWidth*i.k_spoutWidth,u=i.k_containerHeight*i.k_faucetHeight+a*.5;o.SetAsBox(s,a,new n(-c,u),0),r.CreateFixture({shape:o}),o.SetAsBox(s,a,new n(c,u),0),r.CreateFixture({shape:o}),o.SetAsBox(c-s,s,new n(0,u+a-s),0),r.CreateFixture({shape:o})}{let o=this.m_particleSystem.GetRadius()*2*i.k_faucetLength;this.m_emitter.SetParticleSystem(this.m_particleSystem),this.m_emitter.SetCallback(this.m_lifetimeRandomizer),this.m_emitter.SetPosition(new n(i.k_containerWidth*i.k_faucetWidth,i.k_containerHeight*i.k_faucetHeight+o*.5)),this.m_emitter.SetVelocity(new n),this.m_emitter.SetSize(new n(0,o)),this.m_emitter.SetColor(new F(1,1,1,1)),this.m_emitter.SetEmitRate(120),this.m_emitter.SetParticleFlags(e.GetValue())}e.SetRestartOnChange(!1),e.SetValues(HC,"water")}static{this.k_particleLifetimeMin=30}static{this.k_particleLifetimeMax=50}static{this.k_containerHeight=.2}static{this.k_containerWidth=1}static{this.k_containerThickness=.05}static{this.k_faucetWidth=.1}static{this.k_faucetHeight=15}static{this.k_faucetLength=2}static{this.k_spoutLength=2}static{this.k_spoutWidth=1.1}static{this.k_maxParticleCount=1e3}static{this.k_emitRateChangeFactor=1.05}static{this.k_emitRateMin=1}static{this.k_emitRateMax=240}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.m_particleColorOffset+=o,this.m_particleColorOffset>=Li.length&&(this.m_particleColorOffset-=Li.length),this.m_emitter.SetParticleFlags(this.particleParameter.GetValue()),this.m_emitter.GetParticleFlags()&256?this.m_emitter.SetColor(Li[Math.floor(this.m_particleColorOffset)%Li.length]):this.m_emitter.SetColor(new F(1,1,1,1)),this.m_emitter.Step(o)}getHotkeys(){return[G("m","Increase Flow",()=>this.m_emitter.SetEmitRate(Math.max(i.k_emitRateMin,this.m_emitter.GetEmitRate()*i.k_emitRateChangeFactor))),G("n","Decrease Flow",()=>this.m_emitter.SetEmitRate(Math.min(i.k_emitRateMax,this.m_emitter.GetEmitRate()/i.k_emitRateChangeFactor)))]}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Faucet",$d);var OC={...ou,erase:2,rigid:0,"rigid barrier":1024,"elastic barrier":1040,"spring barrier":1032,"repulsive wall":8196},NC={elastic:1,rigid:3,spring:1,wall:1,"rigid barrier":2,"elastic barrier":1,"spring barrier":1,"repulsive wall":1},ZC=28,th=class extends ht{constructor({particleParameter:e}){super(e);this.m_colorIndex=0;{let r=this.m_world.CreateBody();{let o=new v,s=[new n(-4,-2),new n(4,-2),new n(4,0),new n(-4,0)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,-2),new n(-2,-2),new n(-2,6),new n(-4,6)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(2,-2),new n(4,-2),new n(4,6),new n(2,6)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,4),new n(4,4),new n(4,6),new n(-4,6)];o.Set(s,4),r.CreateFixture({shape:o})}}this.m_colorIndex=0,this.m_particleSystem.SetRadius(.05*2),this.m_lastGroup=null,e.SetValues(OC,"water"),e.SetRestartOnChange(!1)}getGroupFlags(){return NC[this.particleParameter.GetSelectedKey()]??0}MouseMove(e,r){if(super.MouseMove(e,r),r){let o=this.particleParameter.GetValue(),s=new V;s.m_p.Copy(e),s.m_radius=.2,this.m_particleSystem.DestroyParticlesInShape(s,T.IDENTITY);let l=this.getGroupFlags();this.m_lastGroup&&l===this.m_lastGroup.GetGroupFlags()||(this.m_colorIndex=(this.m_colorIndex+1)%Li.length);let c=new et;c.shape=s,c.flags=o,o&ZC&&(c.flags|=4096),c.groupFlags=l,c.color.Copy(Li[this.m_colorIndex]),c.group=this.m_lastGroup,this.m_lastGroup=this.m_particleSystem.CreateParticleGroup(c),this.m_mouseTracing=!1}}MouseUp(e){super.MouseUp(e),this.m_lastGroup=null}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e),e===this.m_lastGroup&&(this.m_lastGroup=null)}SplitParticleGroups(){for(let e=this.m_particleSystem.GetParticleGroupList();e;e=e.GetNext())e!==this.m_lastGroup&&e.GetGroupFlags()&2&&e.GetAllParticleFlags()&2&&this.m_particleSystem.SplitParticleGroup(e)}Step(e,r){this.m_particleSystem.GetAllParticleFlags()&2&&this.SplitParticleGroups(),super.Step(e,r)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Particle Drawing",th);var QC={...ve,"color mixing":256},Un=class extends ht{constructor({particleParameter:t}){super(t),t.SetValues(QC,"water"),this.m_ground=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,3)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,3),new n(2,2)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}this.m_particleSystem.SetRadius(.035*2);{let e=new v;e.SetAsBox(2,1,new n(0,1),0);let r=new et;r.shape=e,r.flags=t.GetValue();let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}{let e=this.m_world.CreateBody({type:2}),r=new V;r.m_p.Set(0,.5),r.m_radius=.1,e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new v;r.SetAsBox(.1,.1,new n(-1,.5),0),e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new v;r.SetAsBox(.1,.1,new n(1,.5),.5),e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(0,2),new n(.1,2.1)),e.CreateFixture({shape:r,density:1});let o=new Re;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(.3,2),new n(.4,2.1)),e.CreateFixture({shape:r,density:1});let o=new Re;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(-.3,2.1),new n(-.2,2)),e.CreateFixture({shape:r,density:1});let o=new Re;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Soup",Un);var eh=class extends Qt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,2),t.m_radius=.5;let e=new et;e.flags=384,e.shape=t,e.color.SetRGBA(1,0,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,2),t.m_radius=.5;let e=new et;e.flags=384,e.shape=t,e.color.SetRGBA(0,1,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v,e=[new n(0,3),new n(2,3),new n(2,3.5),new n(0,3.5)];t.Set(e,4);let r=new et;r.flags=384,r.shape=t,r.color.SetRGBA(0,0,1,1),this.m_particleSystem.CreateParticleGroup(r)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Surface Tension",eh);var ih=class extends Qt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,3),t.m_radius=.5;let e=new et;e.flags=8,e.groupFlags=1,e.shape=t,e.color.SetRGBA(1,0,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,3),t.m_radius=.5;let e=new et;e.flags=16,e.groupFlags=1,e.shape=t,e.color.SetRGBA(0,1,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v;t.SetAsBox(1,.5);let e=new et;e.flags=16,e.groupFlags=1,e.position.Set(1,4),e.angle=-.5,e.angularVelocity=2,e.shape=t,e.color.SetRGBA(0,0,1,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}getParticleSelectionRadius(){return .4}};P("Particles","Elastic Particles",ih);var rh=class extends Qt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,3),t.m_radius=.5;let e=new et;e.groupFlags=3,e.shape=t,e.color.SetByteRGBA(255,0,0,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,3),t.m_radius=.5;let e=new et;e.groupFlags=3,e.shape=t,e.color.SetByteRGBA(0,255,0,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v;t.SetAsBox(1,.5);let e=new et;e.groupFlags=3,e.position.Set(1,4),e.angle=-.5,e.angularVelocity=2,e.shape=t,e.color.SetByteRGBA(0,0,255,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}getParticleSelectionRadius(){return .4}};P("Particles","Rigid Particles",rh);var oh=class i extends Qt{static{this.k_maxParticleCount=500}static{this.k_dynamicBoxSize=new n(.5,.5)}static{this.k_boxMass=1}static{this.k_emitRate=100}static{this.k_emitterPosition=new n(-5,4)}static{this.k_emitterVelocity=new n(7,-4)}static{this.k_emitterSize=new n(1,1)}static{this.k_leftEmitterColor=new F().SetByteRGBA(34,51,255,255)}static{this.k_rightEmitterColor=new F().SetByteRGBA(255,34,17,255)}constructor(){super(),this.m_emitters=[new wi,new wi],this.m_particleSystem.SetRadius(.05),this.m_particleSystem.SetMaxParticleCount(i.k_maxParticleCount),this.m_particleSystem.SetDestructionByAge(!0);let t=new fo;t.radius=this.m_particleSystem.GetRadius(),t.destroyByAge=!0,this.m_particleSystem2=this.m_world.CreateParticleSystem(t),this.m_particleSystem2.SetMaxParticleCount(i.k_maxParticleCount);{let e=this.m_world.CreateBody(),r=new v;r.SetAsBox(5,.1),e.CreateFixture({shape:r})}{let e=this.m_world.CreateBody({type:2}),r=new v,o=new n(0,1.2);r.SetAsBox(i.k_dynamicBoxSize.x,i.k_dynamicBoxSize.y,o,0),e.CreateFixture({shape:r});let s=new Re;s.mass=i.k_boxMass,s.center.Copy(o),s.I=0,e.SetMassData(s)}for(let e=0;e<this.m_emitters.length;++e){let r=e&1?-1:1,o=this.m_emitters[e];o.SetPosition(new n(i.k_emitterPosition.x*r,i.k_emitterPosition.y)),o.SetSize(i.k_emitterSize),o.SetVelocity(new n(i.k_emitterVelocity.x*r,i.k_emitterVelocity.y)),o.SetEmitRate(i.k_emitRate),o.SetColor(e&1?i.k_rightEmitterColor:i.k_leftEmitterColor),o.SetParticleSystem(e&1?this.m_particleSystem2:this.m_particleSystem)}}Step(t,e){let r=t.m_hertz>0?1/t.m_hertz:0;t.m_pause&&!t.m_singleStep&&(r=0),this.m_particleSystem2.SetStrictContactCheck(Qt.m_strictContacts),super.Step(t,e);for(let o of this.m_emitters)o.Step(r)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Multiple Systems",oh);var sh=class i extends ht{constructor({particleParameter:e}){super(e);this.m_useLinearImpulse=!1;{let r=this.m_world.CreateBody(),o=[new n(i.kBoxLeft,i.kBoxBottom),new n(i.kBoxRight,i.kBoxBottom),new n(i.kBoxRight,i.kBoxTop),new n(i.kBoxLeft,i.kBoxTop)],s=new dt;s.CreateLoop(o,o.length),r.CreateFixture({shape:s})}this.m_particleSystem.SetRadius(.025*2),this.m_particleSystem.SetDamping(.2);{let r=new v;r.SetAsBox(.8,1,new n(0,1.01),0);let o=new et;o.flags=e.GetValue(),o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}static{this.kBoxLeft=-2}static{this.kBoxRight=2}static{this.kBoxBottom=0}static{this.kBoxTop=4}MouseUp(e){if(super.MouseUp(e),i.kBoxLeft<=e.x&&e.x<=i.kBoxRight&&i.kBoxBottom<=e.y&&e.y<=i.kBoxTop){let o=new n(.5*(i.kBoxLeft+i.kBoxRight),.5*(i.kBoxBottom+i.kBoxTop)),s=n.Subtract(e,o,new n);s.Normalize(),this.ApplyImpulseOrForce(s)}}getHotkeys(){return[G("l","Use Linear Impulse",()=>{this.m_useLinearImpulse=!0}),G("f","Use Force",()=>{this.m_useLinearImpulse=!1})]}ApplyImpulseOrForce(e){let r=this.m_world.GetParticleSystemList();N(r!==null);let o=r.GetParticleGroupList();N(o!==null);let s=o.GetParticleCount();if(this.m_useLinearImpulse){let a=n.Scale(.005*s,e,new n);o.ApplyLinearImpulse(a)}else{let a=n.Scale(1*s,e,new n);o.ApplyForce(a)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Impulse",sh);var nh=class extends Un{constructor(e){super(e);this.m_joint=null;this.m_oscillationOffset=0;this.m_particleSystem.SetDamping(1);let r=new V;r.m_p.Set(0,.7),r.m_radius=.4,this.m_stirrer=this.m_world.CreateBody({type:2}),this.m_stirrer.CreateFixture({shape:r,density:1});let o=new T;o.SetIdentity(),this.m_particleSystem.DestroyParticlesInShape(r,o),this.CreateJoint()}CreateJoint(){let e=new Zt;e.bodyA=this.m_groundBody,e.bodyB=this.m_stirrer,e.collideConnected=!0,e.localAxisA.Set(1,0),e.localAnchorA.Copy(this.m_stirrer.GetPosition()),this.m_joint=this.m_world.CreateJoint(e)}ToggleJoint(){this.m_joint?(this.m_world.DestroyJoint(this.m_joint),this.m_joint=null):this.CreateJoint()}getHotkeys(){return[G("t","Toggle Joint",()=>this.ToggleJoint())]}MouseUp(e){super.MouseUp(e),this.InSoup(e)&&this.ToggleJoint()}InSoup(e){return e.y>-1&&e.y<2&&e.x>-3&&e.x<3}Step(e,r){this.m_oscillationOffset+=1/e.m_hertz,this.m_oscillationOffset>5&&(this.m_oscillationOffset-=5);let c=this.m_oscillationOffset*.2*2*Math.PI,u=new n(Math.sin(c),Math.cos(c)).Scale(10);this.InSoup(this.m_stirrer.GetPosition())&&this.m_stirrer.GetLinearVelocity().Length()<2&&this.m_stirrer.ApplyForceToCenter(u,!0),super.Step(e,r)}};P("Particles","Soup Stirrer",nh);var lh=class{constructor(){this.m_emitterLifetime=[]}Destroy(){for(let t of this.m_emitterLifetime)t.emitter.Destroy()}Add(t,e){this.m_emitterLifetime.push({emitter:t,lifetime:e})}Step(t){let e=[];for(let r of this.m_emitterLifetime){let o=r.lifetime-t;o<=0&&e.push(r.emitter),r.lifetime=o,r.emitter.Step(t)}for(let r of e)r.Destroy(),this.m_emitterLifetime=this.m_emitterLifetime.filter(o=>o.emitter!==r)}},ah=class extends Ii{constructor(){super(...arguments);this.m_particleGroups=[]}SayGoodbyeParticleGroup(e){this.RemoveParticleGroup(e)}AddParticleGroup(e){this.m_particleGroups.push(e)}RemoveParticleGroup(e){this.m_particleGroups.splice(this.m_particleGroups.indexOf(e),1)}GetParticleGroups(){return this.m_particleGroups}},z=class i{static{this.k_worldWidthTiles=24}static{this.k_worldHeightTiles=16}static{this.k_worldTiles=i.k_worldWidthTiles*i.k_worldHeightTiles}static{this.k_worldCenterX=0}static{this.k_worldCenterY=2}static{this.k_tileWidth=.2}static{this.k_tileHeight=.2}static{this.k_tileHalfWidth=i.k_tileWidth*.5}static{this.k_tileHalfHeight=i.k_tileHeight*.5}static{this.k_worldHalfWidth=i.k_worldWidthTiles*i.k_tileWidth*.5}static{this.k_worldHalfHeight=i.k_worldHeightTiles*i.k_tileHeight*.5}static{this.k_playerColor=new F(1,1,1)}static{this.k_playerFrackColor=new F(1,.5,.5)}static{this.k_wellColor=new F(.5,.5,.5)}static{this.k_oilColor=new F(1,0,0)}static{this.k_waterColor=new F(0,.2,1)}static{this.k_frackingFluidColor=new F(.8,.4,0)}static{this.k_density=.1}static{this.k_particleRadius=(i.k_tileWidth+i.k_tileHeight)*.5*.2}static{this.k_dirtProbability=80}static{this.k_emptyProbability=10}static{this.k_oilProbability=7}static{this.k_waterProbability=3}static{this.k_frackingFluidEmitterLifetime=5}static{this.k_wellSuckSpeedInside=i.k_tileHeight*5}static{this.k_wellSuckSpeedOutside=i.k_tileWidth*1}static{this.k_frackingFluidChargeTime=1}static{this.k_scorePerOilParticle=1}static{this.k_scorePerWaterParticle=-1}static{this.k_scorePerFrackingParticle=0}static{this.k_scorePerFrackingDeployment=-10}},ch=class extends ah{constructor(e){super();this.m_score=0;this.m_oil=0;this.m_previousListener=null;this.m_world=e,this.m_previousListener=e.GetDestructionListener(),this.m_world.SetDestructionListener(this)}Destroy(){this.m_world&&this.m_world.SetDestructionListener(this.m_previousListener)}AddScore(e){this.m_score+=e}GetScore(){return this.m_score}AddOil(e){this.m_oil+=e}GetOil(){return this.m_oil}SayGoodbyeParticle(e,r){let o=e.GetUserDataBuffer()[r];if(o)switch(o){case 3:this.AddScore(z.k_scorePerOilParticle),this.AddOil(-1);break;case 4:this.AddScore(z.k_scorePerWaterParticle);break;default:break}}},uh=class i extends Qt{constructor(){super();this.m_wellX=z.k_worldWidthTiles-z.k_worldWidthTiles/4;this.m_wellTop=z.k_worldHeightTiles-1;this.m_wellBottom=z.k_worldHeightTiles/8;this.m_tracker=new lh;this.m_allowInput=!1;this.m_frackingFluidChargeTime=-1;this.m_material=[];this.m_bodies=[];this.m_listener=new ch(this.m_world);this.m_particleSystem.SetRadius(z.k_particleRadius),this.InitializeLayout(),this.CreateGround(),this.CreateWell(),this.CreateGeo(),this.CreatePlayer()}Destroy(){this.m_listener.Destroy()}InitializeLayout(){for(let e=0;e<z.k_worldTiles;++e)this.m_material[e]=0,this.m_bodies[e]=null}GetMaterial(e,r){return this.m_material[i.TileToArrayOffset(e,r)]}SetMaterial(e,r,o){this.m_material[i.TileToArrayOffset(e,r)]=o}GetBody(e,r){return this.m_bodies[i.TileToArrayOffset(e,r)]}SetBody(e,r,o){let s=this.m_bodies[i.TileToArrayOffset(e,r)];s&&this.m_world.DestroyBody(s),this.m_bodies[i.TileToArrayOffset(e,r)]=o}CreatePlayer(){this.m_player=this.m_world.CreateBody({type:1});let e=new v;e.SetAsBox(z.k_tileHalfWidth,z.k_tileHalfHeight,new n(z.k_tileHalfWidth,z.k_tileHalfHeight),0),this.m_player.CreateFixture({shape:e,density:z.k_density}),this.m_player.SetTransformVec(i.TileToWorld(z.k_worldWidthTiles/2,z.k_worldHeightTiles/2),0)}CreateGeo(){for(let e=0;e<z.k_worldWidthTiles;e++)for(let r=0;r<z.k_worldHeightTiles;r++){if(this.GetMaterial(e,r)!==0)continue;let o=Math.random()*100;o<z.k_dirtProbability||r===0?this.CreateDirtBlock(e,r):o<z.k_dirtProbability+z.k_emptyProbability?this.SetMaterial(e,r,0):o<z.k_dirtProbability+z.k_emptyProbability+z.k_oilProbability?this.CreateReservoirBlock(e,r,3):this.CreateReservoirBlock(e,r,4)}}CreateGround(){let e=this.m_world.CreateBody(),r=new dt,o=new n,s=new n;i.GetExtents(o,s);let l=[new n(o.x,o.y),new n(s.x,o.y),new n(s.x,s.y),new n(o.x,s.y)];r.CreateLoop(l,4),e.CreateFixture({shape:r})}CreateDirtBlock(e,r){let o=i.TileToWorld(e,r),s=this.m_world.CreateBody(),l=new v;l.SetAsBox(z.k_tileHalfWidth,z.k_tileHalfHeight,i.CenteredPosition(o),0),s.CreateFixture({shape:l,density:z.k_density}),this.SetBody(e,r,s),this.SetMaterial(e,r,1)}CreateReservoirBlock(e,r,o){let s=i.TileToWorld(e,r),l=new v;this.SetMaterial(e,r,o),l.SetAsBox(z.k_tileHalfWidth,z.k_tileHalfHeight,i.CenteredPosition(s),0);let a=new et;a.flags=672,a.shape=l,a.color.Copy(o===3?z.k_oilColor:z.k_waterColor);let c=this.m_particleSystem.CreateParticleGroup(a);this.m_listener.AddParticleGroup(c);let u=c.GetParticleCount(),m=this.m_particleSystem.GetUserDataBuffer(),p=c.GetBufferIndex();for(let d=0;d<u;++d)m[p+d]=this.m_material[i.TileToArrayOffset(e,r)];o===3&&this.m_listener.AddOil(u)}CreateWell(){for(let e=this.m_wellBottom;e<=this.m_wellTop;e++)this.SetMaterial(this.m_wellX,e,5)}CreateFrackingFluidEmitter(e){let r=new et,o=this.m_particleSystem.CreateParticleGroup(r);this.m_listener.AddParticleGroup(o);let s=new wi;s.SetGroup(o),s.SetParticleSystem(this.m_particleSystem),s.SetPosition(i.CenteredPosition(e)),s.SetVelocity(new n(0,-z.k_tileHalfHeight)),s.SetSpeed(z.k_tileHalfWidth*.1),s.SetSize(new n(z.k_tileHalfWidth,z.k_tileHalfHeight)),s.SetEmitRate(20),s.SetColor(z.k_frackingFluidColor),s.SetParticleFlags(160),this.m_tracker.Add(s,z.k_frackingFluidEmitterLifetime),this.m_listener.AddScore(z.k_scorePerFrackingDeployment)}SetPlayerPosition(e,r){let o=this.m_player.GetTransform().p,s=[0],l=[0];i.WorldToTile(o,s,l),e=tt(e,0,z.k_worldWidthTiles-1),r=tt(r,0,z.k_worldHeightTiles-1),this.GetMaterial(e,r)!==5&&(s[0]!==e||l[0]!==r)&&(this.DeployFrackingFluid(),this.m_player.SetTransformVec(i.TileToWorld(e,r),0))}DeployFrackingFluid(){let e=!1,r=this.m_player.GetTransform().p;return this.m_frackingFluidChargeTime>z.k_frackingFluidChargeTime&&(this.CreateFrackingFluidEmitter(r),e=!0),this.m_frackingFluidChargeTime=-1,e}DestroyParticlesInTiles(e,r,o,s){let l=new v,a=o-e+1,c=s-r+1,u=e+a/2,m=r+c/2;l.SetAsBox(z.k_tileHalfWidth*a,z.k_tileHalfHeight*c);let p=new T;p.SetPositionAngle(i.CenteredPosition(i.TileToWorld(u,m)),0),this.m_particleSystem.DestroyParticlesInShape(l,p)}JointDestroyed(e){super.JointDestroyed(e)}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e)}BeginContact(e){super.BeginContact(e)}EndContact(e){super.EndContact(e)}PreSolve(e,r){super.PreSolve(e,r)}PostSolve(e,r){super.PostSolve(e,r)}getHotkeys(){return[G("a","Left",()=>this.AdjustPlayerPosition(-1,0)),G("d","Right",()=>this.AdjustPlayerPosition(1,0)),G("w","Up",()=>this.AdjustPlayerPosition(0,1)),G("s","Down",()=>this.AdjustPlayerPosition(0,-1)),G("e","Deploy Fracking",()=>{this.m_frackingFluidChargeTime<0?this.m_frackingFluidChargeTime=0:this.DeployFrackingFluid()})]}AdjustPlayerPosition(e,r){if(!this.m_allowInput)return;let o=this.m_player.GetTransform().p,s=[0],l=[0];i.WorldToTile(o,s,l),this.SetPlayerPosition(s[0]+e,l[0]+r),this.m_allowInput=!1}MouseDown(e){super.MouseDown(e),this.m_frackingFluidChargeTime=0}MouseUp(e){if(super.MouseUp(e),!!this.m_allowInput){if(!this.DeployFrackingFluid()){let r=this.m_player.GetTransform().p,o=[0],s=[0];i.WorldToTile(r,o,s);let l=n.Subtract(e,i.CenteredPosition(r),new n),a=Math.abs(l.x),c=Math.abs(l.y);a>c&&a>=z.k_tileHalfWidth?o[0]+=l.x>0?1:-1:c>=z.k_tileHalfWidth&&(s[0]+=l.y>0?1:-1),this.SetPlayerPosition(o[0],s[0])}this.m_allowInput=!1}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.m_tracker.Step(o),this.m_allowInput=!0,this.m_frackingFluidChargeTime>=0&&(this.m_frackingFluidChargeTime+=o);let s=this.m_player.GetTransform().p,l=[0],a=[0];i.WorldToTile(s,l,a),this.GetMaterial(l[0],a[0])===1&&(this.SetMaterial(l[0],a[0],0),this.SetBody(l[0],a[0],null)),this.DestroyParticlesInTiles(this.m_wellX,this.m_wellTop,this.m_wellX,this.m_wellTop);let c=this.m_listener.GetParticleGroups();for(let m of c){let p=m.GetBufferIndex(),d=this.m_particleSystem.GetPositionBuffer(),h=this.m_particleSystem.GetVelocityBuffer(),f=m.GetParticleCount();for(let b=0;b<f;++b){let x=i.CenteredPosition(i.TileToWorld(this.m_wellX,this.m_wellBottom-2)),_=d[p+b],y=n.Subtract(_,x,new n),g=Math.abs(y.x);if(g<z.k_tileWidth&&y.y>z.k_tileWidth*-2&&y.y<0){let S=n.Subtract(x,_,new n);S.Normalize(),h[p+b].Copy(S.Scale(z.k_wellSuckSpeedOutside))}else if(g<=z.k_tileHalfWidth&&y.y>0){let S=Math.random()*z.k_tileHalfWidth-y.x,w=new n(S,z.k_tileHeight);w.Normalize(),h[p+b].Copy(w.Scale(z.k_wellSuckSpeedInside))}}}let u=e.m_debugDraw;this.DrawPlayer(u),this.DrawWell(u),this.DrawScore()}DrawWell(e){for(let r=this.m_wellBottom;r<=this.m_wellTop;++r)this.DrawQuad(e,i.TileToWorld(this.m_wellX,r),z.k_wellColor)}DrawPlayer(e){this.DrawQuad(e,this.m_player.GetTransform().p,i.LerpColor(z.k_playerColor,z.k_playerFrackColor,Math.max(this.m_frackingFluidChargeTime/z.k_frackingFluidChargeTime,0)),!0)}DrawScore(){this.addDebug("Score",this.m_listener.GetScore()),this.addDebug("Remaining Oil",this.m_listener.GetOil())}DrawQuad(e,r,o,s=!1){let l=H(4,n),a=r.x+z.k_tileWidth,c=r.y+z.k_tileHeight;l[0].Set(r.x,c),l[1].Set(r.x,r.y),l[2].Set(a,r.y),l[3].Set(a,c),s?e.DrawPolygon(l,4,o):e.DrawSolidPolygon(l,4,o)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}static GetBottomLeft(e){e.Set(z.k_worldCenterX-z.k_worldHalfWidth,z.k_worldCenterY-z.k_worldHalfHeight)}static GetExtents(e,r){i.GetBottomLeft(e),r.Set(z.k_worldCenterX+z.k_worldHalfWidth,z.k_worldCenterY+z.k_worldHalfHeight)}static WorldToTile(e,r,o){let s=new n;i.GetBottomLeft(s),r[0]=Math.floor((e.x-s.x)/z.k_tileWidth+z.k_tileHalfWidth),o[0]=Math.floor((e.y-s.y)/z.k_tileHeight+z.k_tileHalfHeight)}static TileToWorld(e,r,o=new n){let s=new n;return i.GetBottomLeft(s),o.Set(e*z.k_tileWidth+s.x,r*z.k_tileHeight+s.y)}static TileToArrayOffset(e,r){return e+r*z.k_worldWidthTiles}static CenteredPosition(e,r=new n){return r.Set(e.x+z.k_tileHalfWidth,e.y+z.k_tileHalfHeight)}static LerpColor(e,r,o){return new F(i.Lerp(e.r,r.r,o),i.Lerp(e.g,r.g,o),i.Lerp(e.b,r.b,o))}static Lerp(e,r,o){return e*(1-o)+r*o}};P("Particles","Fracker",uh);var mh=class i extends Qt{constructor(){super(n.ZERO);this.m_density=i.k_densityDefault;this.m_position=i.k_containerHalfHeight;this.m_temperature=i.k_temperatureDefault;this.m_barrierBody=null;this.m_particleGroup=null;{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-i.k_containerHalfWidth,0),new n(i.k_containerHalfWidth,0),new n(i.k_containerHalfWidth,i.k_containerHeight),new n(-i.k_containerHalfWidth,i.k_containerHeight)];r.CreateLoop(o,4),e.CreateFixture({shape:r,density:0,restitution:1})}this.EnableBarrier(),this.ResetParticles()}static{this.k_containerWidth=2}static{this.k_containerHeight=4}static{this.k_containerHalfWidth=i.k_containerWidth/2}static{this.k_containerHalfHeight=i.k_containerHeight/2}static{this.k_barrierHeight=i.k_containerHalfHeight/100}static{this.k_barrierMovementIncrement=i.k_containerHalfHeight*.1}static{this.k_densityStep=1.25}static{this.k_densityMin=.01}static{this.k_densityMax=.8}static{this.k_densityDefault=.25}static{this.k_temperatureStep=.2}static{this.k_temperatureMin=.4}static{this.k_temperatureMax=10}static{this.k_temperatureDefault=5}DisableBarrier(){this.m_barrierBody&&(this.m_world.DestroyBody(this.m_barrierBody),this.m_barrierBody=null)}EnableBarrier(){if(!this.m_barrierBody){this.m_barrierBody=this.m_world.CreateBody();let e=new v;e.SetAsBox(i.k_containerHalfWidth,i.k_barrierHeight,new n(0,this.m_position),0),this.m_barrierBody.CreateFixture({shape:e,density:0,restitution:1})}}ToggleBarrier(){this.m_barrierBody?this.DisableBarrier():this.EnableBarrier()}ResetParticles(){this.m_particleGroup!==null&&(this.m_particleGroup.DestroyParticles(!1),this.m_particleGroup=null),this.m_particleSystem.SetRadius(i.k_containerHalfWidth/20);{let e=new v;e.SetAsBox(this.m_density*i.k_containerHalfWidth,this.m_density*i.k_containerHalfHeight,new n(0,i.k_containerHalfHeight),0);let r=new et;r.flags=64,r.shape=e,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(r);let o=this.m_particleSystem.GetVelocityBuffer(),s=this.m_particleGroup.GetBufferIndex();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=o[s+l];a.Set(W(-1,1)+1,W(-1,1)+1),a.Normalize(),a.Scale(this.m_temperature)}}}getHotkeys(){return[G("a","Toggle Barrier",()=>this.ToggleBarrier()),G("m","Increase the Particle Density",()=>{this.m_density=Math.min(this.m_density*i.k_densityStep,i.k_densityMax),this.Reset()}),G("n","Reduce the Particle Density",()=>{this.m_density=Math.max(this.m_density/i.k_densityStep,i.k_densityMin),this.Reset()}),G("w","Move the location of the divider up",()=>this.MoveDivider(this.m_position+i.k_barrierMovementIncrement)),G("s","Move the location of the divider down",()=>this.MoveDivider(this.m_position-i.k_barrierMovementIncrement)),G("h","Reduce the temperature (velocity of particles)",()=>{this.m_temperature=Math.max(this.m_temperature-i.k_temperatureStep,i.k_temperatureMin),this.Reset()}),G("j","Increase the temperature (velocity of particles)",()=>{this.m_temperature=Math.min(this.m_temperature+i.k_temperatureStep,i.k_temperatureMax),this.Reset()})]}InContainer(e){return e.x>=-i.k_containerHalfWidth&&e.x<=i.k_containerHalfWidth&&e.y>=0&&e.y<=i.k_containerHalfHeight*2}MouseDown(e){this.InContainer(e)||super.MouseDown(e)}MouseUp(e){this.InContainer(e)?this.ToggleBarrier():(this.MoveDivider(e.y),super.MouseUp(e))}Step(e,r){super.Step(e,r);let o=0,s=0;if(this.m_particleGroup){let c=this.m_particleGroup.GetBufferIndex(),u=this.m_particleSystem.GetVelocityBuffer(),m=this.m_particleSystem.GetPositionBuffer();for(let p=0;p<this.m_particleGroup.GetParticleCount();p++){let d=u[c+p];d.Normalize(),d.Scale(this.m_temperature),m[c+p].y>this.m_position?o++:s++}}let l=o/(i.k_containerHeight-this.m_position),a=s/this.m_position;this.addDebug("Score",l>0?a/l-1:0)}Reset(){this.DisableBarrier(),this.ResetParticles(),this.EnableBarrier()}MoveDivider(e){this.m_position=tt(e,i.k_barrierMovementIncrement,i.k_containerHeight-i.k_barrierMovementIncrement),this.Reset()}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Maxwell",mh);var ph=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody(),o=5,s=5;for(let l=30;l>0;l-=s){let a=new v,c=[new n(-25,l),new n(-25,l-s),new n(0,15)];a.Set(c,3),r.CreateFixture({shape:a})}for(let l=-25;l<25;l+=o){let a=new v,c=[new n(l,0),new n(l+o,0),new n(0,15)];a.Set(c,3),r.CreateFixture({shape:a})}}this.m_particleSystem.SetRadius(.25);let e=t.GetValue();e===0&&this.m_particleSystem.SetDamping(.2);{let r=new V;r.m_p.Set(-20,33),r.m_radius=3;let o=new et;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}getCenter(){return{x:0,y:10}}};P("Particles","Ramp",ph);var dh=class extends ht{constructor({particleParameter:e}){super(e);this.m_killfieldShape=new v;this.m_killfieldTransform=new T;e.SetValues(ve,"water");{let s=this.m_world.CreateBody(),l=1;for(let a=-10;a<10;a+=l){let c=new v,u=[new n(a,-10),new n(a+l,-10),new n(0,25)];c.Set(u,3),s.CreateFixture({shape:c})}}this.m_particleSystem.SetRadius(.25*2),e.GetValue()===0&&this.m_particleSystem.SetDamping(.2),this.m_killfieldShape=new v,this.m_killfieldShape.SetAsBox(50,1),this.m_killfieldTransform=new T;let o=new n(-25,1);this.m_killfieldTransform.SetPositionAngle(o,0)}Step(e,r){super.Step(e,r);let o=this.particleParameter.GetValue(),s=new Si;if(s.position.Set(0,33),s.velocity.Set(0,-1),s.flags=o,o&24){let l=this.m_particleSystem.GetParticleCount();s.velocity.Set(l&1?-1:1,-5),s.flags|=4096}this.m_particleSystem.CreateParticle(s),this.m_particleSystem.DestroyParticlesInShape(this.m_killfieldShape,this.m_killfieldTransform)}getCenter(){return{x:0,y:20}}};P("Particles","Pointy",dh);var hh=class extends ht{constructor({particleParameter:e}){super(e);this.m_particlesToCreate=300;{let o=this.m_world.CreateBody(),s=1;for(let l=-10;l<10;l+=s){let a=new v,c=[new n(l,-10),new n(l+s,-10),new n(0,15)];a.Set(c,3),o.CreateFixture({shape:a})}for(let l=-10;l<35;l+=s){let a=new v,c=[new n(-10,l),new n(-10,l+s),new n(0,15)];a.Set(c,3),o.CreateFixture({shape:a});let u=[new n(10,l),new n(10,l+s),new n(0,15)];a.Set(u,3),o.CreateFixture({shape:a})}}this.m_particlesToCreate=300,this.m_particleSystem.SetRadius(.25*2),e.GetValue()===0&&this.m_particleSystem.SetDamping(.2),e.SetValues(ve,"water")}Step(e,r){if(super.Step(e,r),this.m_particlesToCreate<=0)return;--this.m_particlesToCreate;let o=this.particleParameter.GetValue(),s=new Si;if(s.position.Set(0,40),s.velocity.Set(0,-1),s.flags=o,o&24){let l=this.m_particleSystem.GetParticleCount();s.velocity.Set(l&1?-1:1,-5),s.flags|=4096}this.m_particleSystem.CreateParticle(s)}getCenter(){return{x:0,y:20}}};P("Particles","AntiPointy",hh);var fh=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody();{let c=new v,u=[new n(-20,30),new n(-20,0),new n(-25,0),new n(-25,30)];c.Set(u),r.CreateFixture({shape:c})}let o=30,s=o/10,l=20,a=l/2;{let c=new v,u=[new n(-25,0),new n(20,15),new n(25,0)];c.Set(u),r.CreateFixture({shape:c})}for(let c=-l;c<l;c+=a){let u=new v,m=[new n(-25,0),new n(c,15),new n(c+a,15)];u.Set(m),r.CreateFixture({shape:u})}for(let c=0;c<o;c+=s){let u=new v,m=[new n(25,c),new n(25,c+s),new n(20,15)];u.Set(m),r.CreateFixture({shape:u})}}this.m_particleSystem.SetRadius(1);let e=t.GetValue();{let r=new V;r.m_p.Set(0,35),r.m_radius=12;let o=new et;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}getCenter(){return{x:0,y:20}}};P("Particles","Corner Case",fh);var bh=class extends Ir{constructor(){super(...arguments);this.m_enableFixtureParticleCollisions=!0;this.m_enableParticleParticleCollisions=!0}ShouldCollideFixtureParticle(){return this.m_enableFixtureParticleCollisions}ShouldCollideParticleParticle(){return this.m_enableParticleParticleCollisions}},_h=class i extends Qt{constructor(){super(n.ZERO);this.m_contactDisabler=new bh;this.m_world.SetContactFilter(this.m_contactDisabler);{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-i.kBoxSize,-i.kBoxSize+i.kOffset),new n(i.kBoxSize,-i.kBoxSize+i.kOffset),new n(i.kBoxSize,i.kBoxSize+i.kOffset),new n(-i.kBoxSize,i.kBoxSize+i.kOffset)];r.CreateLoop(o),e.CreateFixture({shape:r,density:0,restitution:1})}this.m_particleSystem.SetRadius(.5);{let e=new v;e.SetAsBox(1.5,1.5,new n(i.kBoxSizeHalf,i.kBoxSizeHalf+i.kOffset),0);let r=new et;r.shape=e,r.flags=196672,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(r);let o=this.m_particleSystem.GetVelocityBuffer(),s=this.m_particleGroup.GetBufferIndex();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=o[s+l];a.Set(W(-1,1),W(-1,1)),a.Normalize(),a.Scale(i.kSpeedup)}}}Step(e,r){super.Step(e,r);let o=this.m_particleGroup.GetBufferIndex(),s=this.m_particleSystem.GetVelocityBuffer();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=s[o+l];a.Normalize(),a.Scale(i.kSpeedup)}}getCenter(){return{x:0,y:20}}getHotkeys(){return[G("a","Toggle Fixture Collisions",()=>this.ToggleFixtureCollisions()),G("s","Toggle Particle Collisions",()=>this.ToggleParticleCollisions())]}ToggleFixtureCollisions(){this.m_contactDisabler.m_enableFixtureParticleCollisions=!this.m_contactDisabler.m_enableFixtureParticleCollisions}ToggleParticleCollisions(){this.m_contactDisabler.m_enableParticleParticleCollisions=!this.m_contactDisabler.m_enableParticleParticleCollisions}static{this.kBoxSize=10}static{this.kBoxSizeHalf=i.kBoxSize/2}static{this.kOffset=20}static{this.kParticlesContainerSize=i.kOffset+.5}static{this.kSpeedup=8}};P("Particles","Particle Collisions",_h);var yh=class extends Qt{constructor(){super(),this.m_particleSystem.SetDamping(.2),this.m_particleSystem.SetRadius(.3*2),this.m_particleSystem.SetGravityScale(.4),this.m_particleSystem.SetDensity(1.2);let t=this.m_world.CreateBody(),e=this.m_world.CreateBody({type:0,allowSleep:!1}),r=new v;r.SetAsBox(.5,10,new n(20,0),0),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,10,new n(-20,0),0),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,20,new n(0,10),Math.PI/2),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,20,new n(0,-10),Math.PI/2),e.CreateFixture({shape:r,density:5}),this.m_mover=this.m_world.CreateBody({type:2}),r.SetAsBox(1,5,new n(0,2),0),this.m_mover.CreateFixture({shape:r,density:5});let o=new q;o.bodyA=t,o.bodyB=this.m_mover,o.localAnchorA.Set(0,0),o.localAnchorB.Set(0,5),o.referenceAngle=0,o.motorSpeed=0,o.maxMotorTorque=1e7,o.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(o);let s=new et;s.flags=0;let l=new v;l.SetAsBox(9,9,new n,0),s.shape=l,this.m_particleSystem.CreateParticleGroup(s)}Step(t,e){let r=new Date().getTime();this.m_joint.SetMotorSpeed(.7*Math.cos(r/1e3)),super.Step(t,e)}};P("Particles","Eye Candy",yh);var zr=class{constructor(t,e,r){this.gl=t,this.default_sfactor=e,this.default_dfactor=r,this.sfactor=e,this.dfactor=r}set(t,e){this.sfactor=t,this.dfactor=e}reset(){this.sfactor=this.default_sfactor,this.dfactor=this.default_dfactor}apply(){this.gl.blendFunc(this.sfactor,this.dfactor)}};var Xr=class{constructor(t=0,e=0,r=0,o=1){this.r=t,this.g=e,this.b=r,this.a=o}set(t,e,r,o=1){this.r=t,this.g=e,this.b=r,this.a=o}copy(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}toFloatBits(){return Math.round(255*this.a)<<24|Math.round(255*this.b)<<16|Math.round(255*this.g)<<8|Math.round(255*this.r)}};var Yn=class{constructor(t,e,r){this.gl=t,this.width=e,this.height=r,this.texture=this.createTexture(),this.framebufferHandle=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebufferHandle),this.bindTexture(),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture,0),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.bindTexture();let o=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),o!==this.gl.FRAMEBUFFER_COMPLETE)throw this.dispose(),o===this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?new Error("Frame buffer couldn't be constructed: incomplete attachment"):o===this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?new Error("Frame buffer couldn't be constructed: incomplete dimensions"):o===this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?new Error("Frame buffer couldn't be constructed: missing attachment"):o===this.gl.FRAMEBUFFER_UNSUPPORTED?new Error("Frame buffer couldn't be constructed: unsupported combination of formats"):new Error(`Frame buffer couldn't be constructed: unknown error ${o}`)}bindTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}createTexture(){let t=this.gl.RGBA,e=this.gl.UNSIGNED_BYTE,r=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,t,this.width,this.height,0,t,e,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),r}dispose(){this.gl.deleteTexture(this.texture),this.gl.deleteFramebuffer(this.framebufferHandle)}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebufferHandle)}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}begin(){this.bind(),this.lastViewport=this.gl.getParameter(this.gl.VIEWPORT),this.gl.viewport(0,0,this.width,this.height)}endSimple(){this.end(this.lastViewport[0],this.lastViewport[1],this.lastViewport[2],this.lastViewport[3])}end(t,e,r,o){this.unbind(),this.gl.viewport(t,e,r,o)}};var si=class{constructor(t,e,r){this.gl=t,this.buffer=t.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}setData(t,e=!0){e&&this.bind(),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,t),e&&this.unbind()}bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer)}unbind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}dispose(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.deleteBuffer(this.buffer)}};var Jn=class i{constructor(t,e){this.vertexNum=0;this.lightMapDrawingDisabled=!1;this.gl=t,this.setVertexNum(e)}static{this.MIN_VERTS=4}setVertexNum(t){t<i.MIN_VERTS&&(t=i.MIN_VERTS),this.vertexNum<t&&(this.vertexNum=t,this.vertices=new Float32Array(this.vertexNum*4),this.colors=new Int32Array(this.vertexNum*2),this.colorScales=new Float32Array(this.vertexNum*2),this.vertBuffer&&this.vertBuffer.dispose(),this.vertBuffer=new si(this.gl,this.gl.DYNAMIC_DRAW,this.vertices),this.colorBuffer&&this.colorBuffer.dispose(),this.colorBuffer=new si(this.gl,this.gl.DYNAMIC_DRAW,this.colors),this.sBuffer&&this.sBuffer.dispose(),this.sBuffer=new si(this.gl,this.gl.DYNAMIC_DRAW,this.colorScales))}getVertices(){return this.vertices}getColors(){return this.colors}getColorScales(){return this.colorScales}render(t,e,r){this.vertBuffer.bind(),t.a_position.enable(),t.a_position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.colorBuffer.bind(),t.quad_colors.enable(),t.quad_colors.set(4,this.gl.UNSIGNED_BYTE,!0,0,0),this.colorBuffer.unbind(),this.sBuffer.bind(),t.s.enable(),t.s.set(1,this.gl.FLOAT,!1,0,0),this.sBuffer.unbind(),this.gl.drawArrays(e,0,r),t.a_position.disable(),t.quad_colors.disable(),t.s.disable()}update(){this.vertBuffer.setData(this.vertices),this.colorBuffer.setData(this.colors),this.sBuffer.setData(this.colorScales)}dispose(){this.vertBuffer.dispose(),this.colorBuffer.dispose(),this.sBuffer.dispose()}};var bo=class{constructor(){this.data=[1,0,0,0,1,0,0,0,1]}mulVec2(t){let e=t.x*this.data[0]+t.y*this.data[3]+this.data[6],r=t.x*this.data[1]+t.y*this.data[4]+this.data[7];return t.x=e,t.y=r,t}setToTranslation(t){let e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t.x,e[7]=t.y,e[8]=1,this}setToRotationRad(t){let e=Math.cos(t),r=Math.sin(t),o=this.data;return o[0]=e,o[1]=r,o[2]=0,o[3]=-r,o[4]=e,o[5]=0,o[6]=0,o[7]=0,o[8]=1,this}det(){let t=this.data;return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}set(t,e,r,o,s,l,a,c,u){return this.data[0]=t,this.data[1]=e,this.data[2]=r,this.data[3]=o,this.data[4]=s,this.data[5]=l,this.data[6]=a,this.data[7]=c,this.data[8]=u,this}inv(){let t=this.det();if(t===0)throw new Error("Can't invert a singular matrix");let e=1/t,r=this.data;return this.set(e*(r[4]*r[8]-r[5]*r[7]),e*(r[2]*r[7]-r[1]*r[8]),e*(r[1]*r[5]-r[2]*r[4]),e*(r[5]*r[6]-r[3]*r[8]),e*(r[0]*r[8]-r[2]*r[6]),e*(r[2]*r[3]-r[0]*r[5]),e*(r[3]*r[7]-r[4]*r[6]),e*(r[1]*r[6]-r[0]*r[7]),e*(r[0]*r[4]-r[1]*r[3]))}rotateRad(t){if(t===0)return this;let e=Math.cos(t),r=Math.sin(t);return this.mul(qC.set(e,r,0,-r,e,0,0,0,1))}mul(t){let e=this.data,r=t.data;return this.set(e[0]*r[0]+e[3]*r[1]+e[6]*r[2],e[1]*r[0]+e[4]*r[1]+e[7]*r[2],e[2]*r[0]+e[5]*r[1]+e[8]*r[2],e[0]*r[3]+e[3]*r[4]+e[6]*r[5],e[1]*r[3]+e[4]*r[4]+e[7]*r[5],e[2]*r[3]+e[5]*r[4]+e[8]*r[5],e[0]*r[6]+e[3]*r[7]+e[6]*r[8],e[1]*r[6]+e[4]*r[7]+e[7]*r[8],e[2]*r[6]+e[5]*r[7]+e[8]*r[8])}},qC=new bo;var fs=Math.PI/180,au=180/Math.PI;function bs(i){return Math.sin(fs*i)}function _s(i){return Math.cos(fs*i)}function Le(i,t=0){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}var jn=class{constructor(){this.x=0;this.y=0;this.width=0;this.height=0}set(t,e,r,o){return this.x=t,this.y=e,this.width=r,this.height=o,this}contains(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}};var or=class i{static{this.COSINE_THRESHOLD=.001}constructor(t=0,e=0){this.real=t,this.complex=e}setAngle(t){return t/=2,this.set(Math.cos(t),Math.sin(t))}copy(t){return this.set(t.real,t.complex),this}set(t,e){return this.real=t,this.complex=e,this}scale(t){return this.real*=t,this.complex*=t,this}invert(){return this.complex=-this.complex,this.scale(this.len2()),this}add(t){return this.real+=t.real,this.complex+=t.complex,this}addAngle(t){return t/=2,this.real+=Math.cos(t),this.complex+=Math.sin(t),this}sub(t){return this.real-=t.real,this.complex-=t.complex,this}subAngle(t){return t/=2,this.real-=Math.cos(t),this.complex-=Math.sin(t),this}len(){return Math.sqrt(this.real*this.real+this.complex*this.complex)}len2(){return this.real*this.real+this.complex*this.complex}mul(t){return this.set(this.real*t.real-this.complex*t.complex,this.real*t.complex+this.complex*t.real),this}nor(){let t=this.len();return this.real/=t,this.complex/=t,this}angle(){return Math.atan2(this.complex,this.real)*2}lerp(t,e,r){return this.scale(1-e),r.copy(t).scale(e),this.add(r),this.nor(),this}slerp(t,e){let r,o,s,l,a,c,u;return l=this.real*t.real+this.complex*t.complex,l<0?(l=-l,o=-t.complex,r=-t.real):(o=t.complex,r=t.real),1-l>i.COSINE_THRESHOLD?(s=Math.acos(l),a=Math.sin(s),c=Math.sin((1-e)*s)/a,u=Math.sin(e*s)/a):(c=1-e,u=e),this.complex=c*this.complex+u*o,this.real=c*this.real+u*r,this}toString(){let t=this.angle();return`radians: ${t}, degrees: ${t*au*t}`}};var Xt=class i{constructor(){this.x=0;this.y=0}set(t,e){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.length();if(t>0){let e=1/t;this.x*=e,this.y*=e}return this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,e){return this.x+=t,this.y+=e,this}subXY(t,e){return this.x-=t,this.y-=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}scale(t){return this.x*=t,this.y*=t,this}rotate(t){let e=Math.cos(t),r=Math.sin(t),{x:o}=this;return this.x=e*o-r*this.y,this.y=r*o+e*this.y,this}rotate90(t){let{x:e}=this;return t>=0?(this.x=-this.y,this.y=e):(this.x=this.y,this.y=-e),this}getAngle(){return Math.atan2(this.y,this.x)}static MakeArray(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=new i;return e}};var fe={isDiffuse:!1,gammaCorrection:1};function zn(i,t){let e=i.indexOf(t);e>=0&&i.splice(e,1)}var Gt=class i{constructor(t,e,r,o,s){this.color=new Xr;this.tmpPosition=new Xt;this.active=!0;this.soft=!0;this.xray=!1;this.staticLight=!1;this.culled=!1;this.dirty=!0;this.ignoreBody=!1;this.rayNum=0;this.vertexNum=0;this.distance=0;this.direction=0;this.colorF=0;this.softShadowLength=2.5;this.softShadowMesh=null;this.mx=[];this.my=[];this.f=[];this.m_index=0;this.contactFilter=null;this.rayCast=t.createRayCastCallback(this),t.lightList.push(this),this.rayHandler=t,this.gl=t.gl,this.setRayNum(e,!1),this.setColorC(r),this.setDistance(o),this.setSoftnessLength(Number.isFinite(o)?o*.1:this.softShadowLength),this.setDirection(s),this.lightMesh=new Jn(this.gl,this.vertexNum),this.setupSoftShadowMesh()}static{this.DefaultColor=new Xr(.75,.75,.5,.75)}static{this.DebugColor=new Xr(1,1,0)}static{this.MIN_RAYS=3}static{this.globalContactFilter=null}setupSoftShadowMesh(){let t=this.soft&&!this.xray;this.softShadowMesh&&!t?(this.softShadowMesh.dispose(),this.softShadowMesh=null):this.softShadowMesh=new Jn(this.gl,this.getSoftShadowVertexCount())}getSoftShadowVertexCount(){return this.vertexNum}getPosition(){return this.tmpPosition}setColorC(t){this.color.copy(t),this.colorF=this.color.toFloatBits(),this.staticLight&&(this.dirty=!0)}setColor(t,e,r,o){this.color.set(t,e,r,o),this.colorF=this.color.toFloatBits(),this.staticLight&&(this.dirty=!0)}add(t){this.rayHandler=t,this.active?t.lightList.push(this):t.disabledLights.push(this)}remove(t=!0){this.rayHandler.removeLight(this),t&&this.dispose()}dispose(){this.lightMesh.dispose(),this.softShadowMesh?.dispose()}isActive(){return this.active}setActive(t){t!==this.active&&(this.active=t,t?(this.rayHandler.lightList.push(this),zn(this.rayHandler.disabledLights,this)):(this.rayHandler.disabledLights.push(this),zn(this.rayHandler.lightList,this)))}isXray(){return this.xray}setXray(t){this.xray=t,this.staticLight&&(this.dirty=!0),this.setupSoftShadowMesh()}isStaticLight(){return this.staticLight}setStaticLight(t){this.staticLight=t,t&&(this.dirty=!0)}isSoft(){return this.soft}setSoft(t){this.soft=t,this.staticLight&&(this.dirty=!0),this.setupSoftShadowMesh()}getSoftShadowLength(){return this.softShadowLength}setSoftnessLength(t){this.softShadowLength=t,this.staticLight&&(this.dirty=!0)}getColor(){return this.color}getDistance(){return this.distance/fe.gammaCorrection}getDirection(){return this.direction}contains(t,e){return!1}setIgnoreAttachedBody(t){this.ignoreBody=t}getIgnoreAttachedBody(){return this.ignoreBody}setRayNum(t,e=!0){t<i.MIN_RAYS&&(t=i.MIN_RAYS),this.rayNum=t,this.vertexNum=t+1,e&&(this.lightMesh.setVertexNum(this.vertexNum),this.softShadowMesh?.setVertexNum(this.getSoftShadowVertexCount())),this.mx=Le(this.vertexNum),this.my=Le(this.vertexNum),this.f=Le(this.vertexNum)}getRayNum(){return this.rayNum}setContactFilter(t){this.contactFilter=t}getContactFilter(){return this.contactFilter}setContactFilterBits(t,e,r){this.contactFilter={categoryBits:t,groupIndex:e,maskBits:r}}static setGlobalContactFilter(t){this.globalContactFilter=t}static setGlobalContactFilterBits(t,e,r){this.globalContactFilter={categoryBits:t,groupIndex:e,maskBits:r}}static getGlobalContactFilter(){return this.globalContactFilter}reportFixture(t,e,r,o){let s=i.getGlobalContactFilter();if(s&&!this.runContactFilter(s,t))return-1;let l=this.getContactFilter();return l&&!this.runContactFilter(l,t)||this.ignoreBody&&this.getBody()===e?-1:(this.mx[this.m_index]=r.x,this.my[this.m_index]=r.y,this.f[this.m_index]=o,o)}runContactFilter(t,e){return t.groupIndex!==0&&t.groupIndex===e.groupIndex?t.groupIndex>0:(t.maskBits&e.categoryBits)!==0&&(t.categoryBits&e.maskBits)!==0}};var WC={v1:new Xt,v2:new Xt,vSegmentStart:new Xt,vDirection:new Xt,vRayOffset:new Xt,previousAngle:new or,currentAngle:new or,nextAngle:new or,startAngle:new or,endAngle:new or,rayAngle:new or},cu=class i extends Gt{constructor(e,r,o,s,l,a){super(e,r,o,s,0);this.chain=[];this.bodyAngle=0;this.bodyAngleOffset=0;this.body=null;this.segmentAngles=[];this.segmentLengths=[];this.startX=[];this.startY=[];this.endX=[];this.endY=[];this.bodyPosition=new Xt;this.tmpEnd=new Xt;this.tmpStart=new Xt;this.tmpPerp=new Xt;this.tmpVec=new Xt;this.zeroPosition=new bo;this.rotateAroundZero=new bo;this.restorePosition=new bo;this.chainLightBounds=new jn;this.rayHandlerBounds=new jn;this.rayStartOffset=i.defaultRayStartOffset,this.rayDirection=l,this.vertexNum=(this.vertexNum-1)*2,this.endX=Le(r),this.endY=Le(r),this.startX=Le(r),this.startY=Le(r),this.chain=a?a.slice():[],this.setMesh()}static{this.defaultRayStartOffset=.001}update(){this.dirty?(this.updateChain(),this.applyAttachment()):this.updateBody(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}render(){this.rayHandler.culling&&this.culled||(this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum))}debugRender(e){let r=[];for(let o=0;o<this.rayNum;o++)r.push({x:this.mx[o],y:this.my[o]});for(let o=this.rayNum-1;o>-1;o--)r.push({x:this.startX[o],y:this.startY[o]});e(r,r.length,Gt.DebugColor)}attachToBody(e,r=0){this.body=e,this.bodyPosition.copy(this.rayHandler.getBodyPosition(this.body)),this.bodyAngleOffset=fs*r,this.bodyAngle=this.rayHandler.getBodyAngle(e),this.applyAttachment(),this.staticLight&&(this.dirty=!0)}getBody(){return this.body}getX(){return this.tmpPosition.x}getY(){return this.tmpPosition.y}setPosition(e,r){this.tmpPosition.set(e,r),this.staticLight&&(this.dirty=!0)}setPositionV(e){this.tmpPosition.copy(e),this.staticLight&&(this.dirty=!0)}contains(e,r){if(!this.chainLightBounds.contains(e,r))return!1;let o=[];for(let a=0;a<this.rayNum;a++)o.push(this.mx[a],this.my[a]);for(let a=this.rayNum-1;a>-1;a--)o.push(this.startX[a],this.startY[a]);let s=0;for(let a=0;a<o.length;a+=2){let c=o[a],u=o[a+1],m=o[(a+2)%o.length],p=o[(a+3)%o.length];(u<=r&&r<p||p<=r&&r<u)&&e<(m-c)/(p-u)*(r-u)+c&&s++}return(s&1)===1}setDistance(e){e*=fe.gammaCorrection,this.distance=e<.01?.01:e,this.dirty=!0}setDirection(e){}updateChain(){let{v1:e,v2:r,vSegmentStart:o,vDirection:s,vRayOffset:l,previousAngle:a,currentAngle:c,nextAngle:u,startAngle:m,endAngle:p,rayAngle:d}=WC,h=Math.round(this.chain.length/2)-1;this.segmentAngles.length=0,this.segmentLengths.length=0;let f=0;for(let _=0,y=0;_<this.chain.length-2;_+=2,y++)e.set(this.chain[_+2],this.chain[_+3]).subXY(this.chain[_],this.chain[_+1]),this.segmentLengths.push(e.length()),this.segmentAngles.push(e.rotate90(this.rayDirection).getAngle()),f+=this.segmentLengths[y];let b=0,x=this.rayNum;for(let _=0;_<h;_++){a.setAngle(_===0?this.segmentAngles[_]:this.segmentAngles[_-1]),c.setAngle(this.segmentAngles[_]),u.setAngle(_===this.segmentAngles.length-1?this.segmentAngles[_]:this.segmentAngles[_+1]),m.copy(a).slerp(c,.5),p.copy(c).slerp(u,.5);let y=_*2;o.set(this.chain[y],this.chain[y+1]),s.set(this.chain[y+2],this.chain[y+3]).sub(o).normalize();let g=f/x,S=_===h-1?x:Math.round(this.segmentLengths[_]/f*x);for(let w=0;w<S;w++){let B=w*g;d.copy(m).slerp(p,B/this.segmentLengths[_]);let C=d.angle();l.set(this.rayStartOffset,0).rotate(C),e.copy(s).scale(B).add(o).add(l),this.startX[b]=e.x,this.startY[b]=e.y,r.set(this.distance,0).rotate(C).add(e),this.endX[b]=r.x,this.endY[b]=r.y,b++}x-=S,f-=this.segmentLengths[_]}}applyAttachment(){if(!(!this.body||this.staticLight)){this.restorePosition.setToTranslation(this.bodyPosition),this.rotateAroundZero.setToRotationRad(this.bodyAngle+this.bodyAngleOffset);for(let e=0;e<this.rayNum;e++)this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.tmpVec.set(this.startX[e],this.startY[e]))),this.startX[e]=this.tmpVec.x,this.startY[e]=this.tmpVec.y,this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.tmpVec.set(this.endX[e],this.endY[e]))),this.endX[e]=this.tmpVec.x,this.endY[e]=this.tmpVec.y}}cull(){return this.rayHandler.culling?(this.updateBoundingRects(),this.culled=this.chainLightBounds.width>0&&this.chainLightBounds.height>0&&!this.chainLightBounds.overlaps(this.rayHandlerBounds)):this.culled=!1,this.culled}updateBody(){if(!this.body||this.staticLight)return;let e=this.rayHandler.getBodyPosition(this.body),r=this.rayHandler.getBodyAngle(this.body);this.tmpVec.set(0,0).sub(this.bodyPosition),this.bodyPosition.copy(e),this.zeroPosition.setToTranslation(this.tmpVec),this.restorePosition.setToTranslation(this.bodyPosition),this.rotateAroundZero.setToRotationRad(this.bodyAngle).inv().rotateRad(r),this.bodyAngle=r;for(let o=0;o<this.rayNum;o++)this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.zeroPosition.mulVec2(this.tmpVec.set(this.startX[o],this.startY[o])))),this.startX[o]=this.tmpVec.x,this.startY[o]=this.tmpVec.y,this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.zeroPosition.mulVec2(this.tmpVec.set(this.endX[o],this.endY[o])))),this.endX[o]=this.tmpVec.x,this.endY[o]=this.tmpVec.y}updateMesh(){for(let e=0;e<this.rayNum;e++)this.m_index=e,this.f[e]=1,this.tmpEnd.x=this.endX[e],this.mx[e]=this.tmpEnd.x,this.tmpEnd.y=this.endY[e],this.my[e]=this.tmpEnd.y,this.tmpStart.x=this.startX[e],this.tmpStart.y=this.startY[e],this.xray||this.rayCast(this.tmpStart,this.tmpEnd);this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;for(let c=0;c<this.rayNum;c++)e[r++]=this.startX[c],e[r++]=this.startY[c],o[s++]=this.colorF,l[a++]=1,e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1-this.f[c];if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++){c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF;let b=1-this.f[f];d[h++]=b,this.tmpPerp.set(this.mx[f],this.my[f]).subXY(this.startX[f],this.startY[f]).normalize().scale(this.softShadowLength*b).addXY(this.mx[f],this.my[f]),c[u++]=this.tmpPerp.x,c[u++]=this.tmpPerp.y,m[p++]=0,d[h++]=0}this.softShadowMesh.update()}}updateBoundingRects(){let e=this.startX[0],r=this.startX[0],o=this.startY[0],s=this.startY[0];for(let l=0;l<this.rayNum;l++)e=e>this.startX[l]?e:this.startX[l],e=e>this.mx[l]?e:this.mx[l],r=r<this.startX[l]?r:this.startX[l],r=r<this.mx[l]?r:this.mx[l],o=o>this.startY[l]?o:this.startY[l],o=o>this.my[l]?o:this.my[l],s=s<this.startY[l]?s:this.startY[l],s=s<this.my[l]?s:this.my[l];this.chainLightBounds.set(r,s,e-r,o-s),this.rayHandlerBounds.set(this.rayHandler.x1,this.rayHandler.y1,this.rayHandler.x2-this.rayHandler.x1,this.rayHandler.y2-this.rayHandler.y1)}};var ys=class extends Gt{constructor(e,r,o,s,l,a,c){super(e,r,o,s,c);this.tmpEnd=new Xt;this.start=new Xt;this.body=null;this.bodyOffsetX=0;this.bodyOffsetY=0;this.bodyAngleOffset=0;this.sin=[];this.cos=[];this.endX=[];this.endY=[];this.start.x=l,this.start.y=a,this.setMesh()}getSoftShadowVertexCount(){return this.vertexNum*2}update(){this.updateBody(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}render(){this.rayHandler.culling&&this.culled||(this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_FAN,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.getSoftShadowVertexCount()-2))}debugRender(e){let r=[this.start];for(let o=0;o<this.rayNum;o++)r.push({x:this.mx[o],y:this.my[o]});e(r,r.length,Gt.DebugColor)}attachToBody(e,r=0,o=0,s=0){this.body=e,this.bodyOffsetX=r,this.bodyOffsetY=o,this.bodyAngleOffset=s,this.staticLight&&(this.dirty=!0)}getPosition(){return this.tmpPosition.copy(this.start)}getBody(){return this.body}getX(){return this.start.x}getY(){return this.start.y}setPosition(e,r){this.start.set(e,r),this.staticLight&&(this.dirty=!0)}setPositionV(e){this.start.copy(e),this.staticLight&&(this.dirty=!0)}contains(e,r){let o=this.start.x-e,s=this.start.y-r,l=o*o+s*s;if(this.distance*this.distance<=l)return!1;let a=!1,c=this.mx[this.rayNum]=this.start.x,u=this.my[this.rayNum]=this.start.y,m=0,p=0;for(let d=0;d<=this.rayNum;c=m,u=p,++d)m=this.mx[d],p=this.my[d],(p<r&&u>=r||p>=r&&u<r)&&(r-p)/(u-p)*(c-m)<e-m&&(a=!a);return a}setRayNum(e,r=!0){super.setRayNum(e,r),this.sin=Le(e),this.cos=Le(e),this.endX=Le(e),this.endY=Le(e)}cull(){return this.culled=this.rayHandler.culling&&!this.rayHandler.intersect(this.start.x,this.start.y,this.distance+this.softShadowLength),this.culled}updateBody(){if(!this.body||this.staticLight)return;let e=this.rayHandler.getBodyPosition(this.body),r=this.rayHandler.getBodyAngle(this.body),o=Math.cos(r),s=Math.sin(r),l=this.bodyOffsetX*o-this.bodyOffsetY*s,a=this.bodyOffsetX*s+this.bodyOffsetY*o;this.start.x=e.x+l,this.start.y=e.y+a,this.setDirection(this.bodyAngleOffset+au*r)}updateMesh(){for(let e=0;e<this.rayNum;e++)this.m_index=e,this.f[e]=1,this.tmpEnd.x=this.endX[e]+this.start.x,this.mx[e]=this.tmpEnd.x,this.tmpEnd.y=this.endY[e]+this.start.y,this.my[e]=this.tmpEnd.y,this.xray||this.rayCast(this.start,this.tmpEnd);this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;e[r++]=this.start.x,e[r++]=this.start.y,o[s++]=this.colorF,l[a++]=1;for(let c=0;c<this.rayNum;c++)e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1-this.f[c];if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++){c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF;let b=1-this.f[f];d[h++]=b,c[u++]=this.mx[f]+b*this.softShadowLength*this.cos[f],c[u++]=this.my[f]+b*this.softShadowLength*this.sin[f],m[p++]=0,d[h++]=0}this.softShadowMesh.update()}}getBodyOffsetX(){return this.bodyOffsetX}getBodyOffsetY(){return this.bodyOffsetY}getBodyAngleOffset(){return this.bodyAngleOffset}setBodyOffsetX(e){this.bodyOffsetX=e}setBodyOffsetY(e){this.bodyOffsetY=e}setBodyAngleOffset(e){this.bodyAngleOffset=e}};var uu=class extends ys{constructor(t,e,r,o,s,l,a,c){super(t,e,r,o,s,l,a),this.setConeDegree(c)}update(){this.updateBody(),this.dirty&&this.setEndPoints(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}setDirection(t){this.direction=t,this.dirty=!0}getConeDegree(){return this.coneDegree}setConeDegree(t){this.coneDegree=Math.max(0,Math.min(180,t)),this.dirty=!0}setDistance(t){t*=fe.gammaCorrection,this.distance=t<.01?.01:t,this.dirty=!0}setEndPoints(){for(let t=0;t<this.rayNum;t++){let e=this.direction+this.coneDegree-2*this.coneDegree*t/(this.rayNum-1),r=this.sin[t]=bs(e),o=this.cos[t]=_s(e);this.endX[t]=this.distance*o,this.endY[t]=this.distance*r}}};var mu=class extends Gt{constructor(e,r,o,s){super(e,r,o,1/0,s);this.sin=0;this.cos=0;this.body=null;this.vertexNum=(this.vertexNum-1)*2,this.start=Xt.MakeArray(this.rayNum),this.end=Xt.MakeArray(this.rayNum),this.setMesh()}setDirection(e){this.direction=e,this.sin=bs(e),this.cos=_s(e),this.staticLight&&(this.dirty=!0)}update(){this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh())}updateMesh(){let e=this.rayHandler.x2-this.rayHandler.x1,r=this.rayHandler.y2-this.rayHandler.y1,o=e>r?e:r,s=o*this.cos,l=o*this.sin;s*s<.1&&l*l<.1&&(s=1,l=1);let a=o*-this.sin,c=o*this.cos,u=(this.rayHandler.x1+this.rayHandler.x2)*.5-a,m=(this.rayHandler.y1+this.rayHandler.y2)*.5-c,p=2*a/(this.rayNum-1);u=Math.floor(u/(p*2))*p*2;let d=2*c/(this.rayNum-1);m=Math.ceil(m/(d*2))*d*2;for(let h=0;h<this.rayNum;h++){let f=h*p+u,b=h*d+m;this.m_index=h,this.start[h].x=f-s,this.start[h].y=b-l,this.mx[h]=this.end[h].x=f+s,this.my[h]=this.end[h].y=b+l,this.xray||this.rayCast(this.start[h],this.end[h])}this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;for(let c=0;c<this.rayNum;c++)e[r++]=this.start[c].x,e[r++]=this.start[c].y,o[s++]=this.colorF,l[a++]=1,e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1;if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++)c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF,d[h++]=1,c[u++]=this.mx[f]+this.softShadowLength*this.cos,c[u++]=this.my[f]+this.softShadowLength*this.sin,m[p++]=0,d[h++]=1;this.softShadowMesh.update()}}render(){this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum)}debugRender(e){let r=[];for(let o=0;o<this.rayNum;o++)r.push(this.start[o],{x:this.mx[o],y:this.my[o]});e(r,r.length,Gt.DebugColor)}contains(e,r){let o=!1,s=this.mx[this.rayNum]=this.start[0].x,l=this.my[this.rayNum]=this.start[0].y,a,c;for(let u=0;u<=this.rayNum;s=a,l=c,++u)a=this.mx[u],c=this.my[u],(c<r&&l>=r||c>=r&&l<r)&&(r-c)/(l-c)*(s-a)<e-a&&(o=!o);for(let u=0;u<this.rayNum;s=a,l=c,++u)a=this.start[u].x,c=this.start[u].y,(c<r&&l>=r||c>=r&&l<r)&&(r-c)/(l-c)*(s-a)<e-a&&(o=!o);return o}attachToBody(e){}setPosition(e,r){}getBody(){return this.body}getX(){return 0}getY(){return 0}setPositionV(e){}setDistance(e){}setIgnoreAttachedBody(e){}getIgnoreAttachedBody(){return!1}setIgnoreBody(e){this.body=e,this.ignoreBody=!!e}};var xs=class extends ys{constructor(t,e,r=Gt.DefaultColor,o=15,s=0,l=0){super(t,e,r,o,s,l,0)}update(){this.updateBody(),this.dirty&&this.setEndPoints(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}setDistance(t){t*=fe.gammaCorrection,this.distance=t<.01?.01:t,this.dirty=!0}setEndPoints(){let t=360/(this.rayNum-1);for(let e=0;e<this.rayNum;e++){let r=t*e;this.sin[e]=bs(r),this.cos[e]=_s(r),this.endX[e]=this.distance*this.cos[e],this.endY[e]=this.distance*this.sin[e]}}setDirection(t){}};var Xn=mt(ho()),KC=Xn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,$C=Xn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;
uniform  vec4 ambient;

void main() {
    gl_FragColor.rgb = (ambient.rgb + texture2D(u_texture, v_texCoords).rgb);
    gl_FragColor.a = 1.0;
}
`;function dx(i){return(0,Xn.createShaderProgram)(i,KC,$C,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var Hn=mt(ho()),tA=(i,t)=>Hn.glsl`
attribute vec4 a_position;
uniform vec2  dir;
attribute vec2 a_texCoord;
varying vec2 v_texCoords0;
varying vec2 v_texCoords1;
varying vec2 v_texCoords2;
varying vec2 v_texCoords3;
varying vec2 v_texCoords4;

const vec2 futher = vec2(3.2307692308 / ${i}, 3.2307692308 / ${t} );
const vec2 closer = vec2(1.3846153846 / ${i}, 1.3846153846 / ${t} );

void main() {
    vec2 f = futher * dir;
    vec2 c = closer * dir;
    v_texCoords0 = a_texCoord - f;
    v_texCoords1 = a_texCoord - c;
    v_texCoords2 = a_texCoord;
    v_texCoords3 = a_texCoord + c;
    v_texCoords4 = a_texCoord + f;
    gl_Position = a_position;
}
`,eA=i=>Hn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

uniform sampler2D u_texture;
varying MED vec2 v_texCoords0;
varying MED vec2 v_texCoords1;
varying MED vec2 v_texCoords2;
varying MED vec2 v_texCoords3;
varying MED vec2 v_texCoords4;
const float center = 0.2270270270;
const float close  = 0.3162162162;
const float far    = 0.0702702703;

void main() {	 
    gl_FragColor${i} = far    * texture2D(u_texture, v_texCoords0)${i}
	      		+ close  * texture2D(u_texture, v_texCoords1)${i}
				+ center * texture2D(u_texture, v_texCoords2)${i}
				+ close  * texture2D(u_texture, v_texCoords3)${i}
				+ far    * texture2D(u_texture, v_texCoords4)${i};
}
`;function hx(i,t,e,r){let o=tA(t.toFixed(1),e.toFixed(1)),s=eA(r?".rgb":"");return(0,Hn.createShaderProgram)(i,o,s,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",dir:"uniform2f"})}var On=mt(ho()),iA=On.glsl`
attribute vec4 a_position;
attribute vec4 quad_colors;
attribute float s;
uniform mat4 u_projTrans;
varying vec4 v_color;

void main() {
    v_color = s * quad_colors;
    gl_Position =  u_projTrans * a_position;
}
`,rA=i=>On.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying vec4 v_color;

void main() {
    gl_FragColor = ${i}(v_color);
}
`;function fx(i,t){let e=rA(t?"sqrt":"");return(0,On.createShaderProgram)(i,iA,e,{a_position:"vertexAttribPointer",quad_colors:"vertexAttribPointer",s:"vertexAttribPointer",u_projTrans:"uniformMatrix4f"})}var Nn=mt(ho()),oA=Nn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,sA=Nn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec4 ambient;

void main() {
    vec4 c = texture2D(u_texture, v_texCoords);
    gl_FragColor.rgb = c.rgb * c.a + ambient.rgb;
    gl_FragColor.a = ambient.a - c.a;
}
`;function bx(i){return(0,Nn.createShaderProgram)(i,oA,sA,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var Zn=mt(ho()),nA=Zn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,lA=Zn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;function _x(i){return(0,Zn.createShaderProgram)(i,nA,lA,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var pu=class{constructor(t,e,r){this.lightMapDrawingDisabled=!1;this.rayHandler=t,this.gl=t.gl,this.vertBuffer=new si(this.gl,this.gl.STATIC_DRAW,this.createVertices()),this.uvBuffer=new si(this.gl,this.gl.STATIC_DRAW,this.createUvCoords()),e<=0&&(e=1),r<=0&&(r=1),this.frameBuffer=new Yn(this.gl,e,r),this.pingPongBuffer=new Yn(this.gl,e,r),this.shadowShader=bx(this.gl),this.diffuseShader=dx(this.gl),this.withoutShadowShader=_x(this.gl),this.blurShader=hx(this.gl,e,r,fe.isDiffuse)}render(){let t=this.rayHandler.lightRenderedLastFrame>0;if(!this.lightMapDrawingDisabled){if(this.frameBuffer.bindTexture(),this.rayHandler.shadows){let e=this.rayHandler.ambientLight,r=this.shadowShader;fe.isDiffuse?(r=this.diffuseShader,r.use(),this.rayHandler.diffuseBlendFunc.apply(),r.ambient.set(e.r,e.g,e.b,e.a)):(r.use(),this.rayHandler.shadowBlendFunc.apply(),r.ambient.set(e.r*e.a,e.g*e.a,e.b*e.a,1-e.a)),this.renderTriangleFan(r)}else t&&(this.rayHandler.simpleBlendFunc.apply(),this.withoutShadowShader.use(),this.renderTriangleFan(this.withoutShadowShader));this.gl.disable(this.gl.BLEND)}}renderTriangleFan(t){this.vertBuffer.bind(),t.a_position.enable(),t.a_position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.uvBuffer.bind(),t.a_texCoord.enable(),t.a_texCoord.set(2,this.gl.FLOAT,!1,0,0),this.uvBuffer.unbind(),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),t.a_position.disable(),t.a_texCoord.disable()}gaussianBlur(){this.gl.disable(this.gl.BLEND);for(let t=0;t<this.rayHandler.blurNum;t++)this.frameBuffer.bindTexture(),this.pingPongBuffer.begin(),this.blurShader.use(),this.blurShader.dir.set(1,0),this.renderTriangleFan(this.blurShader),this.pingPongBuffer.endSimple(),this.pingPongBuffer.bindTexture(),this.frameBuffer.begin(),this.blurShader.use(),this.blurShader.dir.set(0,1),this.renderTriangleFan(this.blurShader),this.rayHandler.customViewport?this.frameBuffer.end(this.rayHandler.viewportX,this.rayHandler.viewportY,this.rayHandler.viewportWidth,this.rayHandler.viewportHeight):this.frameBuffer.endSimple();this.gl.enable(this.gl.BLEND)}dispose(){this.shadowShader.dispose(),this.blurShader.dispose(),this.vertBuffer.dispose(),this.uvBuffer.dispose(),this.frameBuffer.dispose(),this.pingPongBuffer.dispose()}createVertices(){return new Float32Array([-1,-1,1,-1,1,1,-1,1])}createUvCoords(){return new Float32Array([0,0,1,0,1,1,0,1])}};var du=class{constructor(t,e,r,o,s){this.combined=new Float32Array(16);this.ambientLight=new Xr;this.lightList=[];this.disabledLights=[];this.customLightShader=null;this.culling=!0;this.shadows=!0;this.blur=!0;this.blurNum=1;this.customViewport=!1;this.viewportX=0;this.viewportY=0;this.lightRenderedLastFrame=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;this.gl=t,this.diffuseBlendFunc=new zr(t,t.DST_COLOR,t.ZERO),this.shadowBlendFunc=new zr(t,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.simpleBlendFunc=new zr(t,t.SRC_ALPHA,t.ONE),this.viewportWidth=o,this.viewportHeight=s,this.resizeFBO(e,r),this.lightShader=fx(t,fe.gammaCorrection!==1)}resizeFBO(t,e){this.lightMap?.dispose(),this.lightMap=new pu(this,t,e)}setCombinedMatrix(t,e,r,o,s){this.combined.set(t);let l=o*.5;this.x1=e-l,this.x2=e+l;let a=s*.5;this.y1=r-a,this.y2=r+a}intersect(t,e,r){return this.x1<t+r&&this.x2>t-r&&this.y1<e+r&&this.y2>e-r}updateAndRender(){this.update(),this.render()}update(){for(let t of this.lightList)t.update()}prepareRender(){this.lightRenderedLastFrame=0,this.gl.depthMask(!1),this.gl.enable(this.gl.BLEND),this.simpleBlendFunc.apply();let t=this.shadows||this.blur;t&&(this.lightMap.frameBuffer.begin(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT));let e=this.customLightShader??this.lightShader;e.use(),e.u_projTrans.set(!1,this.combined),this.customLightShader&&this.updateLightShader();for(let r of this.lightList)this.customLightShader&&this.updateLightShaderPerLight(r),r.render();t&&(this.customViewport?this.lightMap.frameBuffer.end(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight):this.lightMap.frameBuffer.endSimple(),this.lightRenderedLastFrame>0&&this.blur&&this.lightMap.gaussianBlur())}render(){this.prepareRender(),this.lightMap.render()}renderOnly(){this.lightMap.render()}updateLightShader(){}updateLightShaderPerLight(t){}pointAtLight(t,e){return this.lightList.some(r=>r.contains(t,e))}pointAtShadow(t,e){return!this.lightList.some(r=>r.contains(t,e))}dispose(){this.removeAll(),this.lightMap&&this.lightMap.dispose(),this.lightShader&&this.lightShader.dispose()}removeAll(){this.lightList.forEach(t=>t.dispose()),this.lightList.length=0,this.disabledLights.forEach(t=>t.dispose()),this.disabledLights.length=0}removeLight(t){let e=t.isActive()?this.lightList:this.disabledLights;zn(e,t)}setLightShader(t){this.customLightShader=t}setCulling(t){this.culling=t}setBlur(t){this.blur=t}setBlurNum(t){this.blurNum=t}setShadows(t){this.shadows=t}setAmbientLightBrightness(t){this.ambientLight.a=Math.max(0,Math.min(1,t))}setAmbientLight(t,e,r,o){this.ambientLight.set(t,e,r,o)}setAmbientLightC(t){this.ambientLight.copy(t)}useCustomViewport(t,e,r,o){this.customViewport=!0,this.viewportX=t,this.viewportY=e,this.viewportWidth=r,this.viewportHeight=o}useDefaultViewport(){this.customViewport=!1}setLightMapRendering(t){this.lightMap.lightMapDrawingDisabled=!t}getLightMapBuffer(){return this.lightMap.frameBuffer}};function _o(i){i.setColor(Math.random(),Math.random(),Math.random(),1)}var yx=[{x1:0,x2:1.625,y1:-14.0615415625,y2:-11.9990415625},{x1:2.5,x2:4.75,y1:-11.1240415625,y2:-8.6865415625},{x1:5.75,x2:7.875,y1:-7.9365415625,y2:-6.0615415625},{x1:8.6875,x2:10.5625,y1:-5.3115415625,y2:-3.5615415624999986},{x1:11.1875,x2:12.625,y1:-2.4365415624999986,y2:-.24904156249999865},{x1:13.1875,x2:14,y1:1.2509584375000014,y2:3.6259584375000014},{x1:14.1875,x2:13.875,y1:4.813458437500001,y2:7.3759584375000005},{x1:13.25,x2:11.75,y1:8.6884584375,y2:10.4384584375},{x1:10.625,x2:8.8125,y1:11.3759584375,y2:11.8759584375},{x1:7.508101249999999,x2:5.239583124999999,y1:11.9990415625,y2:11.9527453125},{x1:4.54513875,x2:2.6932868749999983,y1:11.8138565625,y2:10.8879309375},{x1:1.9988424999999985,x2:.9340274999999991,y1:10.5638565625,y2:9.4064490625},{x1:.33217562499999964,x2:.008101249999999283,y1:8.6194121875,y2:6.9990415625},{x1:0,x2:-1.625,y1:-14.0615415625,y2:-11.9990415625},{x1:-2.5,x2:-4.75,y1:-11.1240415625,y2:-8.6865415625},{x1:-5.75,x2:-7.875,y1:-7.9365415625,y2:-6.0615415625},{x1:-8.6875,x2:-10.5625,y1:-5.3115415625,y2:-3.5615415624999986},{x1:-11.1875,x2:-12.625,y1:-2.4365415624999986,y2:-.24904156249999865},{x1:-13.1875,x2:-14,y1:1.2509584375000014,y2:3.6259584375000014},{x1:-14.1875,x2:-13.875,y1:4.813458437500001,y2:7.3759584375000005},{x1:-13.25,x2:-11.75,y1:8.6884584375,y2:10.4384584375},{x1:-10.625,x2:-8.8125,y1:11.3759584375,y2:11.8759584375},{x1:-7.508101249999999,x2:-5.239583124999999,y1:11.9990415625,y2:11.9527453125},{x1:-4.54513875,x2:-2.6932868749999983,y1:11.8138565625,y2:10.8879309375},{x1:-1.9988424999999985,x2:-.9340274999999991,y1:10.5638565625,y2:9.4064490625},{x1:-.33217562499999964,x2:-.008101249999999283,y1:8.6194121875,y2:6.9990415625}];var hu=class extends du{constructor(t,e,r,o,s,l){super(e,r,o,s,l),this.world=t}createRayCastCallback(t){return(e,r)=>this.world.RayCast(e,r,(o,s,l,a)=>t.reportFixture(o.GetFilterData(),o.GetBody(),s,a))}getBodyPosition(t){return t.GetPosition()}getBodyAngle(t){return t.GetAngle()}};var gs=class extends R{constructor(e){super({x:0,y:0});this.gl=e;this.drawDebugLight=!1;this.soft=!0;this.mode="Default";this.blendFunc=new zr(e,e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),fe.gammaCorrection=.625,fe.isDiffuse=!0;let r=this.getViewportSize();this.rayHandler=new hu(this.m_world,e,ot.getWidth()/4,ot.getHeight()/4,r.x,r.y),this.rayHandler.setAmbientLight(0,0,0,.5),this.rayHandler.setBlurNum(3)}setupControls(){this.addTestControlGroup("Light",this.getLightControls())}getLightControls(){return[rr("Blend Mode",["Default","Over-Burn","Some Other"],this.mode,e=>{this.setBlending(e)}),jt("Debug Light Shapes",this.drawDebugLight,e=>{this.drawDebugLight=e}),jt("Soft Shadows",this.soft,e=>{this.soft=e,this.setSoft(e)})]}Resize(e,r){this.rayHandler.resizeFBO(e/4,r/4)}Destroy(){super.Destroy(),this.rayHandler.dispose(),Gt.setGlobalContactFilter(null)}setBlending(e){this.mode=e,e==="Over-Burn"?this.rayHandler.diffuseBlendFunc.set(this.gl.DST_COLOR,this.gl.SRC_COLOR):e==="Some Other"?this.rayHandler.diffuseBlendFunc.set(this.gl.SRC_COLOR,this.gl.DST_COLOR):this.rayHandler.diffuseBlendFunc.reset()}Step(e,r){return super.Step(e,r),this.clearGlCanvas(),this.blendFunc.apply(),r}clearGlCanvas(){ds(this.gl,0,0,0,1)}renderLights(e,r){let o=this.getViewportSize();if(this.rayHandler.setCombinedMatrix(ot.combined,o.x/2,o.y/2,o.x,o.y),r>0&&this.rayHandler.update(),this.rayHandler.render(),this.drawDebugLight){let s=e.m_debugDraw,l=s.DrawPolygon.bind(s);for(let a of this.rayHandler.lightList)a.debugRender(l)}}};var mA=512,pA=32,xh=class extends gs{constructor({gl:e,shader:r,textures:o}){super(e);this.lights=[];this.currentEdgeFixture=null;this.currentEdgeBody=null;this.dragStart=new n;this.gl=e,this.shader=r,this.textures=o,this.mouseLight=this.createLight(),this.mouseLight.setColor(1,0,0,1);let s=this.m_world.CreateBody();for(let l of yx){let a=new I;a.SetTwoSided({x:l.x1,y:l.y1},{x:l.x2,y:l.y2}),s.CreateFixture({shape:a,density:0,restitution:0})}}getViewportSize(){return{x:ot.getWidth(),y:ot.getHeight()}}setSoft(e){this.mouseLight.setSoft(e);for(let r of this.lights)r.setSoft(e)}createLight(){let e=new xs(this.rayHandler,mA,Gt.DefaultColor,pA,0,0);return _o(e),e.setPositionV(this.m_mouseWorld),e.setSoft(this.soft),e}GetDefaultViewZoom(){return 30}getHotkeys(){return[G("a","Place current light",()=>{this.lights.push(this.mouseLight),this.mouseLight=this.createLight()})]}MouseDown(e){super.MouseDown(e),this.dragStart.Copy(e)}MouseUp(e){super.MouseUp(e),this.currentEdgeFixture=null,this.currentEdgeBody=null}MouseMove(e,r){if(super.MouseMove(e,r),r){if(!this.currentEdgeBody){let s=1/ot.getZoom();this.currentEdgeBody=this.m_world.CreateBody({position:{x:-s,y:s}})}this.currentEdgeFixture&&this.currentEdgeBody.DestroyFixture(this.currentEdgeFixture);let o=new I;o.SetTwoSided(this.dragStart,e),this.currentEdgeFixture=this.currentEdgeBody.CreateFixture({shape:o,density:0,restitution:0})}}Step(e,r){super.Step(e,r),this.addText("Left drag to draw lines"),this.mouseLight.setPositionV(this.m_mouseWorld);let o=ot.getCenter();return this.rayHandler.setCombinedMatrix(ot.combined,o.x,o.y,ot.getWidth(),ot.getHeight()),this.renderLights(e,r),r}clearGlCanvas(){ds(this.gl,1,1,1,1)}};P("Lights","Draw World",xh);function xx(i,t,e,r,o){let s=t+r,l=e+o;return i.set([t,l,t,e,s,l,s,l,t,e,s,e]),i}function gx(i,t,e,r,o){return i.set([o,r,o,t,e,r,e,r,o,t,e,t]),i}function Sx(i,t,e,r,o,s,l,a,c=1){let u=t+l,m=e+a,p=-l*c,d=-a*c,h=(r-l)*c,f=(o-a)*c,b=s*fs,x=Math.cos(b),_=Math.sin(b),y=x*p-_*f+u,g=_*p+x*f+m,S=x*p-_*d+u,w=_*p+x*d+m,B=x*h-_*f+u,C=_*h+x*f+m,A=S+(B-y),k=C-(g-w);return i.set([y,g,S,w,B,C,B,C,S,w,A,k]),i}var fu=new Float32Array(12),Qn=class{constructor(t,e,r){this.uvOffsetX=0;this.uvOffsetY=0;this.gl=t,this.shader=e,this.texture=r,this.vertBuffer=new si(t,t.DYNAMIC_DRAW,fu),this.uvBuffer=new si(t,t.STATIC_DRAW,gx(fu,0,1,1,0))}setUvOffset(t,e){this.uvOffsetX=t,this.uvOffsetY=e}destroy(){this.vertBuffer.dispose(),this.uvBuffer.dispose()}isDone(){return!0}setRect(t,e,r,o){this.vertBuffer.setData(xx(fu,t,e,r,o))}setRotatedRect(t,e,r,o,s,l,a,c=1){this.vertBuffer.setData(Sx(fu,t,e,r,o,s,l,a,c))}render(){this.vertBuffer.bind(),this.shader.position.enable(),this.shader.position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.uvBuffer.bind(),this.shader.uv.enable(),this.shader.uv.set(2,this.gl.FLOAT,!1,0,0),this.uvBuffer.unbind(),this.shader.opacity.set(1),this.shader.uvOffset.set(this.uvOffsetX,this.uvOffsetY),this.shader.textureID.set(0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}};var gh=i=>1<<i,Hr={WORLD:gh(1),MARBLE:gh(2),LIGHT:gh(3)},Sh={WORLD:Hr.MARBLE,MARBLE:Hr.MARBLE|Hr.WORLD|Hr.LIGHT,LIGHT:Hr.MARBLE},Gi=1,wx=Gi*2,bu=128,qn=16,Wn=48,Kn=33,wh=class{constructor(t,e){this.sprite=t;this.body=e}render(){let t=this.body.GetPosition();this.sprite.setRotatedRect(t.x-Gi,t.y-Gi,wx,wx,O2(this.body.GetAngle()),Gi,Gi),this.sprite.render()}};function $n(i,t){return i+Math.random()*(t-i)}var vh=class extends gs{constructor({gl:e,shader:r,textures:o}){super(e);this.sunDirection=-90;this.lightsType="Point";this.directionalLight=null;this.gl=e,this.shader=r,this.textures=o,this.bg=new Qn(e,r,o.bg.texture),this.createBoundary();let l={restitution:.9,friction:.01,shape:new V(Gi),density:1},a=()=>{let c=this.m_world.CreateBody({type:2,position:{x:4+Math.random()*40,y:4+Math.random()*25}});return c.CreateFixture(l).SetFilterData({categoryBits:Hr.MARBLE,maskBits:Sh.MARBLE}),new wh(new Qn(e,r,o.marble.texture),c)};this.marbles=Array.from({length:5},a),this.bg.setRect(0,0,Wn,Kn),Gt.setGlobalContactFilterBits(Hr.LIGHT,0,Sh.LIGHT),this.setLightsType(this.lightsType)}getLightControls(){return[rr("Lights Type",["Point","Cone","Chain","Directional"],this.lightsType,e=>{this.setLightsType(e)}),...super.getLightControls()]}getViewportSize(){return{x:Wn,y:Kn}}setSoft(e){this.directionalLight?.setSoft(e);for(let r of this.marbles)r.light?.setSoft(e)}GetDefaultViewZoom(){return 20}getCenter(){return{x:Wn/2,y:Kn/2}}Destroy(){this.bg.destroy();for(let e of this.marbles)e.light.dispose(),e.sprite.destroy();super.Destroy()}setLightsType(e){switch(e){case"Point":this.initPointLights();break;case"Cone":this.initConeLights();break;case"Chain":this.initChainLights();break;case"Directional":this.initDirectionalLight();break}this.lightsType=e}getHotkeys(){return[G("c","Random Light Colors",()=>{for(let e of this.marbles)_o(e.light)}),G("d","Random Light Distance",()=>{for(let e of this.marbles)e.light.setDistance($n(qn*.5,qn*2))})]}Step(e,r){super.Step(e,r),this.bg.render();for(let o of this.marbles)o.render();return this.directionalLight&&(this.sunDirection+=r*.008,this.directionalLight.setDirection(this.sunDirection)),this.renderLights(e,r),r}createBoundary(){let e=new dt;e.CreateLoop([new n,new n(0,Kn),new n(Wn,Kn),new n(Wn,0)]),this.groundBody=this.m_world.CreateBody({type:0}),this.groundBody.CreateFixture({shape:e,density:0}).SetFilterData({categoryBits:Hr.WORLD,maskBits:Sh.WORLD})}clearLights(){this.directionalLight&&(this.directionalLight.remove(),this.directionalLight=null);for(let e of this.marbles)e.light?.remove()}initPointLights(){this.clearLights();for(let e of this.marbles){let r=new xs(this.rayHandler,bu,Gt.DefaultColor,qn,0,0);r.attachToBody(e.body,Gi/2,Gi/2),_o(r),e.light=r,r.setSoft(this.soft)}}initConeLights(){this.clearLights();for(let e of this.marbles){let r=new uu(this.rayHandler,bu,Gt.DefaultColor,qn,0,0,0,$n(15,40));r.attachToBody(e.body,Gi/2,Gi/2,$n(0,360)),_o(r),e.light=r,r.setSoft(this.soft)}}initChainLights(){this.clearLights();for(let e of this.marbles){let r=new cu(this.rayHandler,bu,Gt.DefaultColor,qn,1,[-5,0,0,3,5,0]);r.attachToBody(e.body,$n(0,360)),_o(r),e.light=r,r.setSoft(this.soft)}}initDirectionalLight(){this.clearLights(),this.sunDirection=$n(0,360),this.directionalLight=new mu(this.rayHandler,4*bu,Gt.DefaultColor,this.sunDirection),this.directionalLight.setSoftnessLength(5),this.directionalLight.setSoft(this.soft)}};P("Lights","Official Demo",vh);var Bh=class extends R{constructor(){super(),this.m_bodies=[];let t=new hs;this.m_controller=t,t.normal.Set(0,1),t.offset=20,t.density=2,t.linearDrag=5,t.angularDrag=2;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r}),r.SetTwoSided(new n(-40,0),new n(-40,25)),e.CreateFixture({shape:r}),r.SetTwoSided(new n(40,0),new n(40,25)),e.CreateFixture({shape:r})}for(let r=0;r<5;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI}),s=new v;s.SetAsBox(Math.random()*.5+1,Math.random()*.5+1),o.CreateFixture({density:1,friction:.3,restitution:.1,shape:s}),this.m_bodies.push(o)}for(let r=0;r<5;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI});o.CreateFixture({density:1,friction:.3,restitution:.1,shape:new V(Math.random()*.5+1)}),this.m_bodies.push(o)}for(let r=0;r<15;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI}),s=new v;if(Math.random()>.66)s.Set([new n(-1-Math.random()*1,1+Math.random()*1),new n(-.5-Math.random()*1,-1-Math.random()*1),new n(.5+Math.random()*1,-1-Math.random()*1),new n(1+Math.random()*1,1+Math.random()*1)]);else if(Math.random()>.5){let l=[];l[0]=new n(0,1+Math.random()*1),l[2]=new n(-.5-Math.random()*1,-1-Math.random()*1),l[3]=new n(.5+Math.random()*1,-1-Math.random()*1),l[1]=new n(l[0].x+l[2].x,l[0].y+l[2].y),l[1].Scale(Math.random()/2+.8),l[4]=new n(l[3].x+l[0].x,l[3].y+l[0].y),l[4].Scale(Math.random()/2+.8),s.Set(l)}else s.Set([new n(0,1+Math.random()*1),new n(-.5-Math.random()*1,-1-Math.random()*1),new n(.5+Math.random()*1,-1-Math.random()*1)]);o.CreateFixture({density:1,friction:.3,restitution:.1,shape:s}),this.m_bodies.push(o)}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:40},angle:0}),o=new v;o.SetAsBox(4,1),r.CreateFixture({density:3,shape:o}),this.m_bodies.push(r)}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:30}}),o=new V(.7),s={density:2,shape:o};o.m_p.Set(3,0),r.CreateFixture(s),o.m_p.Set(-3,0),r.CreateFixture(s),o.m_p.Set(0,3),r.CreateFixture(s),o.m_p.Set(0,-3),r.CreateFixture(s),s.density=2;let l=new v;s.shape=l,l.SetAsBox(3,.2),r.CreateFixture(s),l.SetAsBox(.2,3),r.CreateFixture(s),this.m_bodies.push(r)}for(let r of this.m_bodies)this.m_controller.AddBody(r);this.m_world.AddController(this.m_controller)}getCenter(){return{x:0,y:10}}};P("Controllers","Boyancy Test",Bh);var _u=class{constructor(){this.gainP=1;this.gainI=1;this.gainD=1;this.currentError=0;this.previousError=0;this.integral=0;this.output=0}step(t){this.integral=t*(this.integral+this.currentError);let e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError}},Ch=class i extends R{constructor(){super({x:0,y:-30});this.targetPosition=10;this.targetPositionInterval=0;this.posAvg=0;this.angleController=new _u;this.positionController=new _u;this.angleController.gainP=1e3,this.angleController.gainI=0,this.angleController.gainD=250,this.positionController.gainP=.5,this.positionController.gainI=0,this.positionController.gainD=1.5,this.pendulumBody=this.m_world.CreateBody({type:2,position:{x:0,y:2+.5*i.PENDULUM_LENGTH}});let e=new v;e.SetAsBox(.5,.5*i.PENDULUM_LENGTH);let r={shape:e,density:1/(1*i.PENDULUM_LENGTH)};this.pendulumBody.CreateFixture(r),this.wheelBody=this.m_world.CreateBody({type:2,position:n.UNITY});let o=new V;o.m_radius=.6,r.shape=o,r.density=1/(Math.PI*.6*.6),r.friction=10,this.wheelBody.CreateFixture(r);let s=new q;s.Initialize(this.wheelBody,this.pendulumBody,{x:0,y:0}),s.localAnchorA.Set(0,0),s.localAnchorB.Set(0,-.5*i.PENDULUM_LENGTH),s.collideConnected=!1,s.enableMotor=!0,s.maxMotorTorque=40,this.wheelJoint=this.m_world.CreateJoint(s),this.groundBody=this.m_world.CreateBody({type:0,position:n.ZERO});let l=new I;l.SetTwoSided({x:-100,y:0},{x:100,y:0}),r.shape=l,r.friction=10,this.groundBody.CreateFixture(r)}static{this.PENDULUM_LENGTH=10}getCenter(){return{x:0,y:5}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.targetPositionInterval+=o,this.targetPositionInterval>=8&&(this.targetPositionInterval=0,this.targetPosition=this.targetPosition===10?-10:10);let s=0;{this.posAvg=(1-.4)*this.posAvg+.4*this.pendulumBody.GetPosition().x,this.positionController.currentError=this.targetPosition-this.posAvg,this.positionController.step(o);let m=this.positionController.output;m=tt(m,-10,10),s=m/this.m_world.GetGravity().y,s=tt(s,pt(-15),pt(15))}let l=this.pendulumBody.GetAngle();l=dA(l),this.angleController.currentError=s-l,this.angleController.step(o);let a=this.angleController.output;Math.abs(a)>1e3&&(a=0);let c=a/(2*Math.PI*.6);this.wheelJoint.SetMotorSpeed(c)}};function dA(i){for(;i>pt(180);)i-=pt(360);for(;i<pt(-180);)i+=pt(360);return i}P("Controllers","Segway",Ch);var Ah=class extends R{constructor(){super(n.ZERO);{let t=new V;t.m_p.SetZero(),t.m_radius=.1;let e=-6,r=0,o=4,s=6;for(let l=0;l<400;++l)this.m_world.CreateBody({type:2,position:{x:W(e,r),y:W(o,s)}}).CreateFixture({shape:t,density:.01})}{let t=new v;t.SetAsBox(1.5,1.5);let e=this.m_world.CreateBody({type:2,position:{x:-40,y:5},bullet:!0});e.CreateFixture({shape:t,density:1}),e.SetLinearVelocity(new n(10,0))}}GetDefaultViewZoom(){return 65}getCenter(){return{x:0,y:5}}};P("Benchmark","Add Pair Stress Test",Ah);var Th=class extends R{constructor(){super(n.ZERO);this.positiveForce=!1;this.negativeForce=!1;this.cwTorque=!1;this.ccwTorque=!1;let e=.4,r=this.m_world.CreateBody({position:{x:0,y:20}});{let o=new I,s={shape:o,density:0,restitution:e};o.SetTwoSided(new n(-20,-20),new n(-20,20)),r.CreateFixture(s),o.SetTwoSided(new n(20,-20),new n(20,20)),r.CreateFixture(s),o.SetTwoSided(new n(-20,20),new n(20,20)),r.CreateFixture(s),o.SetTwoSided(new n(-20,-20),new n(20,-20)),r.CreateFixture(s)}{let o=new T;o.q.Set(.3524*Math.PI),o.q.GetXAxis(o.p);let s=[];s[0]=T.MultiplyVec2(o,new n(-1,0),new n),s[1]=T.MultiplyVec2(o,new n(1,0),new n),s[2]=T.MultiplyVec2(o,new n(0,.5),new n);let l=new v;l.Set(s,3);let a=new T;a.q.Set(-.3524*Math.PI),a.q.GetXAxis(a.p).Negate(),a.p.Copy(D.MultiplyVec2(a.q,new n(-1,0),new n)),s[0]=T.MultiplyVec2(a,new n(-1,0),new n),s[1]=T.MultiplyVec2(a,new n(1,0),new n),s[2]=T.MultiplyVec2(a,new n(0,.5),new n);let c=new v;c.Set(s,3),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:3},angle:Math.PI,allowSleep:!1}),this.m_body.CreateFixture({shape:l,density:2}),this.m_body.CreateFixture({shape:c,density:2});let u=10,m=this.m_body.GetInertia(),p=this.m_body.GetMass(),d=Math.sqrt(2*m/p),h=new Dn;h.bodyA=r,h.bodyB=this.m_body,h.localAnchorA.SetZero(),h.localAnchorB.Copy(this.m_body.GetLocalCenter()),h.collideConnected=!0,h.maxForce=.5*p*u,h.maxTorque=.2*p*d*u,this.m_world.CreateJoint(h)}{let o=new v;o.SetAsBox(.5,.5);let s={shape:o,density:1,friction:.3};for(let l=0;l<10;++l){let a=this.m_world.CreateBody({type:2,position:{x:0,y:7+1.54*l}});a.CreateFixture(s);let c=10,u=a.GetInertia(),m=a.GetMass(),p=Math.sqrt(2*u/m),d=new Dn;d.localAnchorA.SetZero(),d.localAnchorB.SetZero(),d.bodyA=r,d.bodyB=a,d.collideConnected=!0,d.maxForce=m*c,d.maxTorque=.1*m*p*c,this.m_world.CreateJoint(d)}}}getHotkeys(){return[Vr("w","Apply Force",()=>this.ApplyForce(-50)),Vr("s","Apply Backward Force",()=>this.ApplyForce(50)),Vr("a","Apply Torque Counter-Clockwise",()=>this.m_body.ApplyTorque(10)),Vr("d","Apply Torque Clockwise",()=>this.m_body.ApplyTorque(-10))]}ApplyForce(e){let r=this.m_body.GetWorldVector(new n(0,e),new n),o=this.m_body.GetWorldPoint(new n(0,3),new n);this.m_body.ApplyForce(r,o)}getCenter(){return{x:0,y:15}}};P("Forces","Apply Force",Th);var Ph=class extends R{constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:17}});{let e=t;{let r=new v;r.SetAsBox(4,1);let o=this.m_world.CreateBody({type:2,position:{x:-8,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(-12,20)),this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(8,1);let o=this.m_world.CreateBody({type:2,position:{x:4,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(-4,20)),this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(3,3);let o=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:12,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(12,20)),this.m_world.CreateJoint(s);let l=new Zt;l.Initialize(t,o,new n(12,17),new n(1,0)),this.m_world.CreateJoint(l)}}}getCenter(){return{x:0,y:15}}};P("Examples","Slider Crank 1",Ph);var Dh=class extends R{constructor(){super();this.m_speed=0;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{this.m_attachment=this.m_world.CreateBody({type:2,position:{x:0,y:3}});let r=new v;r.SetAsBox(.5,2),this.m_attachment.CreateFixture({shape:r,density:2})}{this.m_platform=this.m_world.CreateBody({type:2,position:{x:-4,y:5}});let r=new v;r.SetAsBox(.5,4,new n(4,0),.5*Math.PI),this.m_platform.CreateFixture({shape:r,friction:.6,density:2});let o=new q;o.Initialize(this.m_attachment,this.m_platform,new n(0,5)),o.maxMotorTorque=50,o.enableMotor=!0,this.m_world.CreateJoint(o);let s=new Zt;s.Initialize(e,this.m_platform,new n(0,5),new n(1,0)),s.maxMotorForce=1e3,s.enableMotor=!0,s.lowerTranslation=-10,s.upperTranslation=10,s.enableLimit=!0,this.m_world.CreateJoint(s),this.m_speed=3}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:8}}),o=new v;o.SetAsBox(.75,.75),r.CreateFixture({shape:o,friction:.6,density:2})}}getHotkeys(){return[G("d","Set Dynamic Body",()=>this.m_platform.SetType(2)),G("s","Set Static Body",()=>this.m_platform.SetType(0)),G("k","Set Kinematic Body",()=>{this.m_platform.SetType(1),this.m_platform.SetLinearVelocity(new n(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)})]}Step(e,r){if(this.m_platform.GetType()===1){let{p:o}=this.m_platform.GetTransform(),s=this.m_platform.GetLinearVelocity();(o.x<-10&&s.x<0||o.x>10&&s.x>0)&&this.m_platform.SetLinearVelocity(new n(-s.x,s.y))}super.Step(e,r)}};P("Examples","Body Types",Dh);var Mh=class extends R{constructor(){super();this.m_velocity=new n;this.m_angularVelocity=0;this.m_shape1=new v;this.m_shape2=new v;this.m_broke=!1;this.m_break=!1;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}this.m_body1=this.m_world.CreateBody({type:2,position:{x:0,y:40},angle:.25*Math.PI}),this.m_shape1=new v,this.m_shape1.SetAsBox(.5,.5,new n(-.5,0),0),this.m_piece1=this.m_body1.CreateFixture({shape:this.m_shape1,density:1}),this.m_shape2=new v,this.m_shape2.SetAsBox(.5,.5,new n(.5,0),0),this.m_piece2=this.m_body1.CreateFixture({shape:this.m_shape2,density:1})}static{this.e_count=7}PostSolve(e,r){if(this.m_broke)return;let o=e.GetManifold().pointCount,s=0;for(let l=0;l<o;++l)s=Math.max(s,r.normalImpulses[l]);s>40&&(this.m_break=!0)}Break(){let e=this.m_piece1.GetBody(),r=e.GetWorldCenter();e.DestroyFixture(this.m_piece2);let o=this.m_world.CreateBody({type:2,position:e.GetPosition(),angle:e.GetAngle()});this.m_piece2=o.CreateFixture({shape:this.m_shape2,density:1});let s=e.GetWorldCenter(),l=o.GetWorldCenter(),a=n.AddCrossScalarVec2(this.m_velocity,this.m_angularVelocity,n.Subtract(s,r,n.s_t0),new n),c=n.AddCrossScalarVec2(this.m_velocity,this.m_angularVelocity,n.Subtract(l,r,n.s_t0),new n);e.SetAngularVelocity(this.m_angularVelocity),e.SetLinearVelocity(a),o.SetAngularVelocity(this.m_angularVelocity),o.SetLinearVelocity(c)}Step(e,r){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),this.m_broke||(this.m_velocity.Copy(this.m_body1.GetLinearVelocity()),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),super.Step(e,r)}};P("Examples","Breakable",Mh);var Rh=class i extends R{static{this.e_count=30}constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20,friction:.2},o=new q,s=t;for(let a=0;a<i.e_count;++a){let c=this.m_world.CreateBody({type:2,position:{x:-14.5+1*a,y:5}});c.CreateFixture(r);let u=new n(-15+1*a,5);o.Initialize(s,c,u),this.m_world.CreateJoint(o),a===i.e_count>>1&&(this.m_middle=c),s=c}let l=new n(-15+1*i.e_count,5);o.Initialize(s,t,l),this.m_world.CreateJoint(o)}for(let e=0;e<2;++e){let r=[];r[0]=new n(-.5,0),r[1]=new n(.5,0),r[2]=new n(0,1.5);let o=new v;o.Set(r),this.m_world.CreateBody({type:2,position:{x:-8+8*e,y:12}}).CreateFixture({shape:o,density:1})}for(let e=0;e<3;++e){let r=new V;r.m_radius=.5,this.m_world.CreateBody({type:2,position:{x:-6+6*e,y:10}}).CreateFixture({shape:r,density:1})}}};P("Joints","Bridge",Rh);function vx(i,t,e){return`${i.toFixed(0)} [${t.toFixed(1)}] (${e.toFixed(0)})`}var kh=class extends R{constructor(){super();this.m_x=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-10,0),new n(10,0)),e.CreateFixture({shape:r});let o=new v;o.SetAsBox(.2,1,new n(.5,1),0),e.CreateFixture({shape:o})}{let e=new v;e.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:4}}),this.m_body.CreateFixture({shape:e,density:1}),e.SetAsBox(.25,.25),this.m_x=.20352793,this.m_bullet=this.m_world.CreateBody({type:2,bullet:!0,position:{x:this.m_x,y:10}}),this.m_bullet.CreateFixture({shape:e,density:100}),this.m_bullet.SetLinearVelocity(new n(0,-50))}}Launch(){this.m_body.SetTransformVec(new n(0,4),0),this.m_body.SetLinearVelocity(n.ZERO),this.m_body.SetAngularVelocity(0),this.m_x=W(-1,1),this.m_bullet.SetTransformVec(new n(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new n(0,-50)),this.m_bullet.SetAngularVelocity(0),$t.reset(),rt.reset()}GetDefaultViewZoom(){return 50}Step(e,r){super.Step(e,r),this.addDebug("GJK Calls [ave Iters] (max Iters)",$t.calls>0&&vx($t.calls,$t.iters/$t.calls,$t.maxIters)),this.addDebug("Toi Calls [ave Iters] (max Iters)",rt.calls>0&&vx(rt.calls,rt.iters/rt.calls,rt.maxIters)),this.addDebug("Root Toi [ave Iters] (max Iters)",rt.calls>0&&`[${(rt.rootIters/rt.calls).toFixed(1)}] (${rt.maxRootIters})`),this.m_stepCount%60===0&&this.Launch()}};P("Continuous","Bullet Test",kh);var Fh=class i extends R{static{this.e_count=8}constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new po,s=t;for(let l=0;l<i.e_count;++l){let a=this.m_world.CreateBody({type:2,position:{x:-14.5+1*l,y:5}});a.CreateFixture(r);let c=new n(-15+1*l,5);o.Initialize(s,a,c),this.m_world.CreateJoint(o),s=a}}{let e=new v;e.SetAsBox(1,.125);let r={shape:e,density:20},o=new po,s=5,l=.7,a=t;for(let c=0;c<3;++c){let u=this.m_world.CreateBody({type:2,position:{x:-14+2*c,y:15}});u.CreateFixture(r);let m=new n(-15+2*c,15);o.Initialize(a,u,m),ld(o,s,l,o.bodyA,o.bodyB),this.m_world.CreateJoint(o),a=u}}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new po,s=t;for(let l=0;l<i.e_count;++l){let a=this.m_world.CreateBody({type:2,position:{x:-4.5+1*l,y:5}});if(a.CreateFixture(r),l>0){let c=new n(-5+1*l,5);o.Initialize(s,a,c),this.m_world.CreateJoint(o)}s=a}}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new po,s=8,l=.7,a=t;for(let c=0;c<i.e_count;++c){let u=this.m_world.CreateBody({type:2,position:{x:5.5+1*c,y:10}});if(u.CreateFixture(r),c>0){let m=new n(5+1*c,10);o.Initialize(a,u,m),ld(o,s,l,o.bodyA,o.bodyB),this.m_world.CreateJoint(o)}a=u}}for(let e=0;e<2;++e){let r=[];r[0]=new n(-.5,0),r[1]=new n(.5,0),r[2]=new n(0,1.5);let o=new v;o.Set(r),this.m_world.CreateBody({type:2,position:{x:-8+8*e,y:12}}).CreateFixture({shape:o,density:1})}for(let e=0;e<2;++e){let r=new V;r.m_radius=.5,this.m_world.CreateBody({type:2,position:{x:-6+6*e,y:10}}).CreateFixture({shape:r,density:1})}}};P("Joints","Cantilever",Fh);var Ih=class extends R{constructor(){super();this.m_speed=0;this.m_speed=50;let e;{e=this.m_world.CreateBody();let r=new I,o={shape:r,density:0,friction:.6};r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture(o);let s=[.25,1,4,0,0,-1,-2,-2,-1.25,0],l=20,a=0,c=5;for(let u=0;u<10;++u){let m=s[u];r.SetTwoSided(new n(l,a),new n(l+c,m)),e.CreateFixture(o),a=m,l+=c}for(let u=0;u<10;++u){let m=s[u];r.SetTwoSided(new n(l,a),new n(l+c,m)),e.CreateFixture(o),a=m,l+=c}r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=80,r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=40,r.SetTwoSided(new n(l,0),new n(l+10,5)),e.CreateFixture(o),l+=20,r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=40,r.SetTwoSided(new n(l,0),new n(l,20)),e.CreateFixture(o)}{let r=this.m_world.CreateBody({type:2,position:{x:140,y:1}}),o=new v;o.SetAsBox(10,.25),r.CreateFixture({shape:o,density:1});let s=new q;s.Initialize(e,r,r.GetPosition()),s.lowerAngle=-8*Math.PI/180,s.upperAngle=8*Math.PI/180,s.enableLimit=!0,this.m_world.CreateJoint(s),r.ApplyAngularImpulse(100)}{let o=new v;o.SetAsBox(1,.125);let s={shape:o,density:1,friction:.6},l=new q,a=e;for(let u=0;u<20;++u){let m=this.m_world.CreateBody({type:2,position:{x:161+2*u,y:-.125}});m.CreateFixture(s);let p=new n(160+2*u,-.125);l.Initialize(a,m,p),this.m_world.CreateJoint(l),a=m}let c=new n(160+2*20,-.125);l.Initialize(a,e,c),this.m_world.CreateJoint(l)}{let r=new v;r.SetAsBox(.5,.5);let o,s=new n,l={type:2,position:s};s.Set(230,.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,1.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,2.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,3.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,4.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5})}{let r=new v,o=H(8,n);o[0].Set(-1.5,-.5),o[1].Set(1.5,-.5),o[2].Set(1.5,0),o[3].Set(0,.9),o[4].Set(-1.15,.9),o[5].Set(-1.5,.2),r.Set(o,6);let s=new V;s.m_radius=.4;let l=new n,a={type:2,position:l};l.Set(0,1),this.m_car=this.m_world.CreateBody(a),this.m_car.CreateFixture({shape:r,density:1});let c={shape:s,density:1,friction:.9};l.Set(-1,.35),this.m_wheel1=this.m_world.CreateBody(a),this.m_wheel1.CreateFixture(c),l.Set(1,.4),this.m_wheel2=this.m_world.CreateBody(a),this.m_wheel2.CreateFixture(c);let u=new cs,m=new n(0,1),p=this.m_wheel1.GetMass(),d=this.m_wheel2.GetMass(),h=4,f=.7,b=2*Math.PI*h;u.Initialize(this.m_car,this.m_wheel1,this.m_wheel1.GetPosition(),m),u.motorSpeed=0,u.maxMotorTorque=20,u.enableMotor=!0,u.stiffness=p*b*b,u.damping=2*p*f*b,u.lowerTranslation=-.25,u.upperTranslation=.25,u.enableLimit=!0,this.m_spring1=this.m_world.CreateJoint(u),u.Initialize(this.m_car,this.m_wheel2,this.m_wheel2.GetPosition(),m),u.motorSpeed=0,u.maxMotorTorque=10,u.enableMotor=!1,u.stiffness=d*b*b,u.damping=2*d*f*b,u.lowerTranslation=-.25,u.upperTranslation=.25,u.enableLimit=!0,this.m_spring2=this.m_world.CreateJoint(u)}}getHotkeys(){return[Gr("a","Decelerate",e=>this.m_spring1.SetMotorSpeed(e?this.m_speed:0)),Gr("d","Accelerate",e=>this.m_spring1.SetMotorSpeed(e?-this.m_speed:0))]}Step(e,r){let o=ot.getCenter();ot.setPosition(this.m_car.GetPosition().x,o.y),super.Step(e,r)}};P("Examples","Car",Ih);var Lh=class extends R{constructor(){super();this.m_angularVelocity=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-10,0),new n(10,0)),e.CreateFixture({shape:r});let o=new v;o.SetAsBox(.2,1,new n(.5,1),0),e.CreateFixture({shape:o})}{let e=new v;e.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:20}}),this.m_body.CreateFixture({shape:e,density:1}),this.m_angularVelocity=W(-50,50),this.m_body.SetLinearVelocity(new n(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}$t.reset(),rt.reset()}Launch(){$t.reset(),rt.reset(),this.m_body.SetTransformVec(new n(0,20),0),this.m_angularVelocity=W(-50,50),this.m_body.SetLinearVelocity(new n(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}Step(e,r){super.Step(e,r),this.addDebug("GJK Calls [ave Iters] (max Iters)",$t.calls>0&&`${$t.calls.toFixed(0)} [${($t.iters/$t.calls).toFixed(1)}] (${$t.maxIters.toFixed(0)})`),this.addDebug("Toi Calls [ave Iters] (max Iters)",rt.calls>0&&`${rt.calls} [${(rt.iters/rt.calls).toFixed(1)}] (${rt.maxIters})`),this.addDebug("Toi Root [ave Iters] (max Iters)",rt.calls>0&&`${rt.calls} [${(rt.rootIters/rt.calls).toFixed(1)}] (${rt.maxRootIters})`),this.addDebug("Toi Time in ms [ave] (max)",rt.calls>0&&`[${(1e3*rt.time/rt.calls).toFixed(1)}] (${(1e3*rt.maxTime).toFixed(1)})`),this.m_stepCount%60===0&&this.Launch()}GetDefaultViewZoom(){return 50}};P("Continuous","Continuous Test",Lh);var hA=!1,Gh=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.6,.125);let r={shape:e,density:20,friction:.2},o=new q;o.collideConnected=!1;let s=25,l=t;for(let a=0;a<30;++a){let c=this.m_world.CreateBody({type:2,position:{x:.5+a,y:s}});hA&&(a===10?r.density=0:r.density=20),c.CreateFixture(r);let u=new n(a,s);o.Initialize(l,c,u),this.m_world.CreateJoint(o),l=c}}}};P("Joints","Chain",Gh);var Vh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-8,1),new n(-6,1)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-6,1),new n(-4,1)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-4,1),new n(-2,1)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody({angle:.25*Math.PI}),e=H(4,n);e[0].Set(5,7),e[1].Set(8,7),e[2].Set(7,8),e[3].Set(6,8);let r=new dt;r.CreateLoop(e,4),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody(),e=new v;e.SetAsBox(1,1,new n(4,3),0),t.CreateFixture({shape:e}),e.SetAsBox(1,1,new n(6,3),0),t.CreateFixture({shape:e}),e.SetAsBox(1,1,new n(8,3),0),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody(),e=H(4,n);e[0].Set(-1,3),e[1].Set(1,3),e[2].Set(1,5),e[3].Set(-1,5);let r=new dt;r.CreateLoop(e,4),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody({position:{x:-10,y:4}}),e=H(10,n);e[0].Set(0,0),e[1].Set(6,0),e[2].Set(6,2),e[3].Set(4,1),e[4].Set(2,2),e[5].Set(0,2),e[6].Set(-2,2),e[7].Set(-4,3),e[8].Set(-6,2),e[9].Set(-6,0);let r=new dt;r.CreateLoop(e,10),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody({position:{x:-3,y:8},type:2,fixedRotation:!0,allowSleep:!1}),e=new v;e.SetAsBox(.5,.5),t.CreateFixture({shape:e,density:20})}{let t=this.m_world.CreateBody({position:{x:-5,y:5},type:2,fixedRotation:!0,allowSleep:!1}),e=new v;e.SetAsBox(.25,.25),t.CreateFixture({shape:e,density:20})}{let t=this.m_world.CreateBody({position:{x:-5,y:8},type:2,fixedRotation:!0,allowSleep:!1}),e=0,r=Math.PI/3,o=H(6,n);for(let l=0;l<6;++l)o[l].Set(.5*Math.cos(e),.5*Math.sin(e)),e+=r;let s=new v;s.Set(o,6),t.CreateFixture({shape:s,density:20})}{let t=this.m_world.CreateBody({position:{x:3,y:5},type:2,fixedRotation:!0,allowSleep:!1}),e=new V;e.m_radius=.5,t.CreateFixture({shape:e,density:20})}{this.m_character=this.m_world.CreateBody({position:{x:-7,y:6},type:2,allowSleep:!1});let t=new V;t.m_radius=.25,this.m_character.CreateFixture({shape:t,density:20,friction:1})}}GetDefaultViewZoom(){return 30}getCenter(){return{x:-2,y:0}}Step(t,e){let r=this.m_character.GetLinearVelocity();this.m_character.SetLinearVelocity({x:-5,y:r.y}),super.Step(t,e),this.addText("This tests various character collision shapes"),this.addText("Limitation: square and hexagon can snag on aligned boxes."),this.addText("Feature: edge chains have smooth collision inside and out.")}};P("Examples","Character Collision",Vh);var Eh=class i extends R{static{this.k_smallGroup=1}static{this.k_largeGroup=-1}static{this.k_triangleCategory=2}static{this.k_boxCategory=4}static{this.k_circleCategory=8}static{this.k_triangleMask=65535}static{this.k_boxMask=65535^i.k_triangleCategory}static{this.k_circleMask=65535}constructor(){super();{let x=new I;x.SetTwoSided(new n(-40,0),new n(40,0)),this.m_world.CreateBody().CreateFixture({shape:x,friction:.3})}let t=[];t[0]=new n(-1,0),t[1]=new n(1,0),t[2]=new n(0,2);let e=new v;e.Set(t,3);let r={groupIndex:i.k_smallGroup,categoryBits:i.k_triangleCategory,maskBits:i.k_triangleMask},o={shape:e,density:1,filter:r};this.m_world.CreateBody({type:2,position:{x:-5,y:2}}).CreateFixture(o),t[0].Scale(2),t[1].Scale(2),t[2].Scale(2),e.Set(t,3),r.groupIndex=i.k_largeGroup;let l=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:-5,y:6}});l.CreateFixture(o);{let x=this.m_world.CreateBody({type:2,position:{x:-5,y:10}}),_=new v;_.SetAsBox(.5,1),x.CreateFixture({shape:_,density:1});let y=new Zt;y.bodyA=l,y.bodyB=x,y.enableLimit=!0,y.localAnchorA.Set(0,4),y.localAnchorB.SetZero(),y.localAxisA.Set(0,1),y.lowerTranslation=-1,y.upperTranslation=1,this.m_world.CreateJoint(y)}e.SetAsBox(1,.5);let a={groupIndex:i.k_smallGroup,categoryBits:i.k_boxCategory,maskBits:i.k_boxMask},c={shape:e,density:1,restitution:.1,filter:a};this.m_world.CreateBody({type:2,position:{x:0,y:2}}).CreateFixture(c),e.SetAsBox(2,1),a.groupIndex=i.k_largeGroup,this.m_world.CreateBody({type:2,position:{x:0,y:6}}).CreateFixture(c);let p=new V;p.m_radius=1;let d={groupIndex:i.k_smallGroup,categoryBits:i.k_circleCategory,maskBits:i.k_circleMask},h={shape:p,density:1,filter:d};this.m_world.CreateBody({type:2,position:{x:5,y:2}}).CreateFixture(h),p.m_radius*=2,d.groupIndex=i.k_largeGroup,this.m_world.CreateBody({type:2,position:{x:5,y:6}}).CreateFixture(h)}};P("Examples","Collision Filtering",Eh);var Uh=class extends R{constructor(){super();{let _=new I;_.SetTwoSided(new n(-50,0),new n(50,0)),this.m_world.CreateBody().CreateFixture({shape:_})}let t=-5,e=5,r=2,o=35,s=[new n(-1,0),new n(1,0),new n(0,2)],l=new v;l.Set(s,3);let a={shape:l,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(a),s[0].Scale(2),s[1].Scale(2),s[2].Scale(2),l.Set(s,3),this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(a),l.SetAsBox(1,.5);let m={shape:l,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(m),l.SetAsBox(2,1),this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(m);let h=new V;h.m_radius=1;let f={shape:h,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(f),h.m_radius*=2,this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(f)}Step(t,e){super.Step(t,e);let r=6,o=new Array(r),s=0;for(let l=0;l<this.m_pointCount;++l){let a=this.m_points[l],c=a.fixtureA.GetBody(),u=a.fixtureB.GetBody(),m=c.GetMass(),p=u.GetMass();if(m>0&&p>0&&(p>m?o[s++]=c:o[s++]=u,s===r))break}for(let l=0;l<s;l++){let a=o[l];o.indexOf(a)===l&&a!==this.m_bomb&&this.m_world.DestroyBody(a)}}};P("Examples","Collision Processing",Uh);var Yh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(50,0),new n(-50,0)),t.CreateFixture({shape:e})}{this.m_table1=this.m_world.CreateBody({type:2,position:new n(-15,1)});let t=new v;t.SetAsBox(3,.5,new n(0,3.5),0);let e=new v;e.SetAsBox(.5,1.5,new n(-2.5,1.5),0);let r=new v;r.SetAsBox(.5,1.5,new n(2.5,1.5),0),this.m_table1.CreateFixture({shape:t,density:2}),this.m_table1.CreateFixture({shape:e,density:2}),this.m_table1.CreateFixture({shape:r,density:2})}{this.m_table2=this.m_world.CreateBody({type:2,position:new n(-5,1)});let t=new v;t.SetAsBox(3,.5,new n(0,3.5),0);let e=new v;e.SetAsBox(.5,2,new n(-2.5,2),0);let r=new v;r.SetAsBox(.5,2,new n(2.5,2),0),this.m_table2.CreateFixture({shape:t,density:2}),this.m_table2.CreateFixture({shape:e,density:2}),this.m_table2.CreateFixture({shape:r,density:2})}{this.m_ship1=this.m_world.CreateBody({type:2,position:new n(5,1)});let t=[],e=new v;t[0]=new n(-2,0),t[1]=new n(0,4/3),t[2]=new n(0,4),e.Set(t,3);let r=new v;t[0]=new n(2,0),t[1]=new n(0,4/3),t[2]=new n(0,4),r.Set(t,3),this.m_ship1.CreateFixture({shape:e,density:2}),this.m_ship1.CreateFixture({shape:r,density:2})}{this.m_ship2=this.m_world.CreateBody({type:2,position:new n(15,1)});let t=[],e=new v;t[0]=new n(-2,0),t[1]=new n(1,2),t[2]=new n(0,4),e.Set(t,3);let r=new v;t[0]=new n(2,0),t[1]=new n(-1,2),t[2]=new n(0,4),r.Set(t,3),this.m_ship2.CreateFixture({shape:e,density:2}),this.m_ship2.CreateFixture({shape:r,density:2})}}Spawn(){{let t=this.m_world.CreateBody({type:2,position:this.m_table1.GetPosition(),angle:this.m_table1.GetAngle()}),e=new v;e.SetAsBox(4,.1,new n(0,3),0),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_table2.GetPosition(),angle:this.m_table2.GetAngle()}),e=new v;e.SetAsBox(4,.1,new n(0,3),0),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_ship1.GetPosition(),angle:this.m_ship1.GetAngle(),gravityScale:0}),e=new V(.5);e.m_p.Set(0,2),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_ship2.GetPosition(),angle:this.m_ship2.GetAngle(),gravityScale:0}),e=new V(.5);e.m_p.Set(0,2),t.CreateFixture({shape:e,density:2})}}getHotkeys(){return[G("s","Spawn Items",()=>{this.Spawn()})]}getCenter(){return{x:0,y:5}}};P("Examples","Compound Shapes",Yh);var Jh=class i extends R{static{this.e_columnCount=0}static{this.e_rowCount=0}constructor(){super(n.ZERO);{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-10,0),new n(10,0)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-10,0),new n(-10,20)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(10,0),new n(10,20)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-10,20),new n(10,20)),o.CreateFixture({shape:s})}let t=.5,e=new V;e.m_p.SetZero(),e.m_radius=t;let r={shape:e,density:1,friction:.1};for(let o=0;o<i.e_columnCount;++o)for(let s=0;s<i.e_rowCount;++s)this.m_world.CreateBody({type:2,position:{x:-10+(2.1*o+1+.01*s)*t,y:(2*s+1)*t}}).CreateFixture(r)}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:10}}CreateCircle(){let e=new V;e.m_p.SetZero(),e.m_radius=2,this.m_world.CreateBody({type:2,position:{x:vn(),y:3+vn()}}).CreateFixture({shape:e,density:1,friction:0})}getHotkeys(){return[G("c","Create Circle",()=>this.CreateCircle())]}Step(t,e){for(let r=this.m_world.GetBodyList();r;r=r.GetNext())r.GetType(),2;this.m_stepCount===180&&(this.m_stepCount+=0),super.Step(t,e);for(let r=this.m_world.GetBodyList();r;r=r.GetNext())r.GetType(),2}};P("Solver","Confined",Jh);var jh=class i extends R{constructor(){super();this.m_test_points=[];this.m_count=0;this.m_generation=0;this.m_bulk=!1;this.m_auto=!1;this.Generate()}static{this.e_count=Kt}GetDefaultViewZoom(){return 50}Generate(){let e=Math.PI*vn(),r=new D(e);for(let o=0;o<i.e_count;++o){let s=W(-10,10),l=W(-10,10);s=tt(s,-4,4),l=tt(l,-4,4),this.m_test_points[o]=D.MultiplyVec2(r,new n(s,l),new n)}this.m_count=i.e_count,this.m_generation+=1}getHotkeys(){return[G("a","Toggle Autogeneration",()=>{this.m_auto=!this.m_auto}),G("b","Toggle Bulk",()=>{this.m_bulk=!this.m_bulk}),G("g","Generate a new random convex hull",()=>this.Generate())]}Step(e,r){super.Step(e,r);let o,s=!1;if(this.m_bulk){for(let a=0;a<1e4;++a)if(this.Generate(),o=An(this.m_test_points,this.m_count),o.length!==0&&(s=Tn(o,o.length),s===!1)){this.m_bulk=!1;break}}else this.m_auto&&this.Generate(),o=An(this.m_test_points,this.m_count),o.length>0&&(s=Tn(o,o.length),s===!1&&(this.m_auto=!1));let l=e.m_debugDraw;s===!1?this.addText(`generation = ${this.m_generation}, FAILED`):this.addText(`generation = ${this.m_generation}, count = ${o.length}`),l.DrawPolygon(o,o.length,new F(.9,.9,.9));for(let a=0;a<this.m_count;++a){let c=this.m_test_points[a];l.DrawPoint(c,5,new F(.3,.3,.9)),l.DrawStringWorld(c.x+.1,c.y+.1,a.toFixed(0))}for(let a of o)l.DrawPoint(a,6,new F(.3,.7,.3))}};P("Geometry","Convex Hull",jh);var zh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody({position:{x:-5,y:5}}),e=new v;e.SetAsBox(10,.5),this.m_platform=t.CreateFixture({shape:e,friction:.8})}for(let t=0;t<5;++t){let e=this.m_world.CreateBody({type:2,position:{x:-10+2*t,y:7}}),r=new v;r.SetAsBox(.5,.5),e.CreateFixture({shape:r,density:20})}}GetDefaultViewZoom(){return 40}PreSolve(t,e){super.PreSolve(t,e);let r=t.GetFixtureA(),o=t.GetFixtureB();r===this.m_platform&&t.SetTangentSpeed(5),o===this.m_platform&&t.SetTangentSpeed(-5)}};P("Examples","Conveyor Belt",zh);var Xh=class extends R{constructor(){super();this.m_positionB=new n;this.m_angleB=0;this.m_transformA=new T;this.m_transformB=new T;this.m_polygonA=new v;this.m_polygonB=new v;this.m_transformA.SetIdentity(),this.m_transformA.p.Set(0,-.2),this.m_polygonA.SetAsBox(10,.2),this.m_positionB.Set(12.017401,.13678508),this.m_angleB=-.0109265,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB),this.m_polygonB.SetAsBox(2,.1)}GetDefaultViewZoom(){return 200}getCenter(){return{x:10,y:-.5}}getHotkeys(){return[G("a","Move Left",()=>this.Adjust(-.1,0,0)),G("d","Move Right",()=>this.Adjust(.1,0,0)),G("s","Move Down",()=>this.Adjust(0,-.1,0)),G("w","Move Up",()=>this.Adjust(0,.1,0)),G("q","Turn Left",()=>this.Adjust(0,0,.1*Math.PI)),G("e","Turn Right",()=>this.Adjust(0,0,-.1*Math.PI))]}Adjust(e,r,o){this.m_positionB.x+=e,this.m_positionB.y+=r,this.m_angleB+=o,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}Step(e,r){super.Step(e,r);let o=new Mi;o.proxyA.SetShape(this.m_polygonA,0),o.proxyB.SetShape(this.m_polygonB,0),o.transformA.Copy(this.m_transformA),o.transformB.Copy(this.m_transformB),o.useRadii=!0;let s=new Di;s.count=0;let l=new Ri;Mr(l,s,o),this.addDebug("Distance",l.distance.toFixed(2)),this.addDebug("Iterations",l.iterations);let a=e.m_debugDraw;{let d=new F(.9,.9,.9),h=[];for(let f=0;f<this.m_polygonA.m_count;++f)h[f]=T.MultiplyVec2(this.m_transformA,this.m_polygonA.m_vertices[f],new n);a.DrawPolygon(h,this.m_polygonA.m_count,d);for(let f=0;f<this.m_polygonB.m_count;++f)h[f]=T.MultiplyVec2(this.m_transformB,this.m_polygonB.m_vertices[f],new n);a.DrawPolygon(h,this.m_polygonB.m_count,d)}let c=l.pointA,u=l.pointB,m=new F(1,0,0);a.DrawPoint(c,4,m);let p=new F(1,1,0);a.DrawPoint(u,4,p)}};P("Examples","Distance Test",Xh);var Hh=class extends R{constructor(){super();let t=null;{let d=new I;d.SetTwoSided(new n(-40,0),new n(40,0)),t=this.m_world.CreateBody(),t.CreateFixture({shape:d})}{let d=new v;d.SetAsBox(6,.25),this.m_world.CreateBody({position:{x:-1.5,y:10}}).CreateFixture({shape:d})}{let d=new v;d.SetAsBox(.1,1);let h={shape:d,density:20,friction:.1};for(let f=0;f<10;++f)this.m_world.CreateBody({type:2,position:{x:-6+1*f,y:11.25}}).CreateFixture(h)}{let d=new v;d.SetAsBox(7,.25,n.ZERO,.3),this.m_world.CreateBody({position:{x:1,y:6}}).CreateFixture({shape:d})}let e=null;{let d=new v;d.SetAsBox(.25,1.5),e=this.m_world.CreateBody({position:{x:-7,y:4}}),e.CreateFixture({shape:d})}let r=null;{let d=new v;d.SetAsBox(6,.125),r=this.m_world.CreateBody({type:2,angle:-.15,position:{x:-.9,y:1}}),r.CreateFixture({shape:d,density:10})}let o=new q,s=new n;s.Set(-2,1),o.Initialize(t,r,s),o.collideConnected=!0,this.m_world.CreateJoint(o);let l=null;{let d=new v;d.SetAsBox(.25,.25),l=this.m_world.CreateBody({type:2,position:{x:-10,y:15}}),l.CreateFixture({shape:d,density:10})}s.Set(-7,15),o.Initialize(e,l,s),this.m_world.CreateJoint(o);let a=null;{a=this.m_world.CreateBody({type:2,position:{x:6.5,y:3}});let d=new v,h={shape:d,density:10,friction:.1};d.SetAsBox(1,.1,new n(0,-.9),0),a.CreateFixture(h),d.SetAsBox(.1,1,new n(-.9,0),0),a.CreateFixture(h),d.SetAsBox(.1,1,new n(.9,0),0),a.CreateFixture(h)}s.Set(6,2),o.Initialize(t,a,s),this.m_world.CreateJoint(o);let c=null;{let d=new v;d.SetAsBox(1,.1),c=this.m_world.CreateBody({type:2,position:{x:6.5,y:4.1}}),c.CreateFixture({shape:d,density:30})}s.Set(7.5,4),o.Initialize(a,c,s),this.m_world.CreateJoint(o);let u=null;{let d=new v;d.SetAsBox(.1,1),u=this.m_world.CreateBody({type:2,position:{x:7.4,y:1}}),u.CreateFixture({shape:d,density:10})}let m=new ke;m.bodyA=r,m.bodyB=u,m.localAnchorA.Set(6,0),m.localAnchorB.Set(0,-1);let p=n.Subtract(m.bodyB.GetWorldPoint(m.localAnchorB,new n),m.bodyA.GetWorldPoint(m.localAnchorA,new n),new n);m.length=p.Length(),Ct(m,1,1,m.bodyA,m.bodyB),this.m_world.CreateJoint(m);{let h=new V;h.m_radius=.2;for(let f=0;f<4;++f)this.m_world.CreateBody({type:2,position:{x:5.9+.4*f,y:2.4}}).CreateFixture({shape:h,density:10})}}GetDefaultViewZoom(){return 50}getCenter(){return{x:0,y:5}}};P("Examples","Dominos",Hh);var Oh=class extends R{constructor(){super(n.ZERO);let t=new Array(4),e=new Array(2);t[0]=this.m_world.CreateBody({type:0,angle:0,angularVelocity:0,linearDamping:0,angularDamping:0,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,0),r.m_vertex2.Set(44.5217399597168,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,16.69565200805664),r.m_vertex2.Set(44.5217399597168,16.69565200805664),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,16.69565200805664),r.m_vertex2.Set(0,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(44.5217399597168,16.69565200805664),r.m_vertex2.Set(44.5217399597168,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[1]=this.m_world.CreateBody({type:2,position:{x:.847826063632965,y:2.5},angle:0,angularVelocity:0,linearDamping:.5,angularDamping:.5,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new v,o=H(8,n);o[0].Set(6.907599925994873,.327199995517731),o[1].Set(-.322800010442734,.282599985599518),o[2].Set(-.322800010442734,-.295700013637543),o[3].Set(6.885900020599365,-.364100009202957),r.Set(o,4),t[1].CreateFixture({friction:1,restitution:.5,density:10,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[2]=this.m_world.CreateBody({type:2,position:{x:13.04347801208496,y:2.5},angle:0,angularVelocity:0,linearDamping:.5,angularDamping:.5,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new v,o=H(8,n);o[0].Set(.200000002980232,-.300000011920929),o[1].Set(.200000002980232,.200000002980232),o[2].Set(-6.900000095367432,.200000002980232),o[3].Set(-6.900000095367432,-.300000011920929),r.Set(o,4),t[2].CreateFixture({friction:1,restitution:.5,density:10,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[3]=this.m_world.CreateBody({type:0,angle:0,angularVelocity:0,linearDamping:0,angularDamping:0,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new q;r.bodyA=t[1],r.bodyB=t[0],r.collideConnected=!1,r.localAnchorA.Set(0,0),r.localAnchorB.Set(.847826063632965,2.5),r.referenceAngle=0,r.enableLimit=!1,r.lowerAngle=0,r.upperAngle=0,r.enableMotor=!1,r.motorSpeed=0,r.maxMotorTorque=0,e[0]=this.m_world.CreateJoint(r)}{let r=new Zt;r.bodyA=t[1],r.bodyB=t[2],r.collideConnected=!1,r.localAnchorA.Set(0,0),r.localAnchorB.Set(-12.19565200805664,0),r.localAxisA.Set(-1,0),r.referenceAngle=0,r.enableLimit=!0,r.lowerTranslation=-20,r.upperTranslation=0,r.enableMotor=!0,r.motorSpeed=0,r.maxMotorForce=10,e[1]=this.m_world.CreateJoint(r)}}getCenter(){return{x:15,y:5}}};P("Examples","Dump Shell",Oh);var fA={aabb0:new nt,c0:new n,c1:new n},Nh=class{constructor(){this.aabb=new nt;this.fraction=0;this.overlap=!1;this.proxyId=null}},Zh=class i extends R{constructor(){super();this.m_worldExtent=0;this.m_proxyExtent=0;this.m_tree=new es;this.m_queryAABB=new nt;this.m_rayCastInput=new bi;this.m_rayCastOutput=new _i;this.m_rayActor=null;this.m_actors=Array.from({length:i.e_actorCount},()=>new Nh);this.m_stepCount=0;this.m_automated=!1;this.m_worldExtent=15,this.m_proxyExtent=.5;for(let r=0;r<i.e_actorCount;++r){let o=this.m_actors[r];this.GetRandomAABB(o.aabb),o.proxyId=this.m_tree.CreateProxy(o.aabb,o)}this.m_stepCount=0;let e=this.m_worldExtent;this.m_queryAABB.lowerBound.Set(-3,-4+e),this.m_queryAABB.upperBound.Set(5,6+e),this.m_rayCastInput.p1.Set(-5,5+e),this.m_rayCastInput.p2.Set(7,-4+e),this.m_rayCastInput.maxFraction=1,this.m_automated=!1}static{this.e_actorCount=128}getCenter(){return{x:0,y:10}}Step(e,r){if(super.Step(e,r),this.Reset(),this.m_automated){let c=Math.max(1,i.e_actorCount>>2);for(let u=0;u<c;++u)this.Action()}this.Query(),this.RayCast();let o=e.m_debugDraw;for(let c=0;c<i.e_actorCount;++c){let u=this.m_actors[c];if(u.proxyId===null)continue;let m=new F(.9,.9,.9);u===this.m_rayActor&&u.overlap?m.SetRGB(.9,.6,.6):u===this.m_rayActor?m.SetRGB(.6,.9,.6):u.overlap&&m.SetRGB(.6,.6,.9),o.DrawAABB(u.aabb,m)}let s=new F(.7,.7,.7);o.DrawAABB(this.m_queryAABB,s),o.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,s);let l=new F(.2,.9,.2),a=new F(.9,.2,.2);if(o.DrawPoint(this.m_rayCastInput.p1,6,l),o.DrawPoint(this.m_rayCastInput.p2,6,a),this.m_rayActor){let c=new F(.2,.2,.9),u=n.Add(this.m_rayCastInput.p1,n.Scale(this.m_rayActor.fraction,n.Subtract(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new n),new n),new n);o.DrawPoint(u,6,c)}this.addDebug("Dynamic Tree Height",this.m_tree.GetHeight()),++this.m_stepCount}getHotkeys(){return[G("a","Toggle Automated",()=>{this.m_automated=!this.m_automated}),G("c","Create Proxy",()=>this.CreateProxy()),G("d","Destroy Proxy",()=>this.DestroyProxy()),G("m","Move Proxy",()=>this.MoveProxy())]}GetRandomAABB(e){let r=new n;r.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),e.lowerBound.x=W(-this.m_worldExtent,this.m_worldExtent),e.lowerBound.y=W(0,2*this.m_worldExtent),e.upperBound.Copy(e.lowerBound),e.upperBound.Add(r)}MoveAABB(e){let r=new n;r.x=W(-.5,.5),r.y=W(-.5,.5),e.lowerBound.Add(r),e.upperBound.Add(r);let o=n.Mid(e.lowerBound,e.upperBound,new n),s=new n(-this.m_worldExtent,0),l=new n(this.m_worldExtent,2*this.m_worldExtent),a=n.Clamp(o,s,l,new n);e.lowerBound.Add(n.Subtract(a,o,new n)),e.upperBound.Add(n.Subtract(a,o,new n))}CreateProxy(){for(let e=0;e<i.e_actorCount;++e){let r=Fa(0,i.e_actorCount-1),o=this.m_actors[r];if(o.proxyId===null){this.GetRandomAABB(o.aabb),o.proxyId=this.m_tree.CreateProxy(o.aabb,o);return}}}DestroyProxy(){for(let e=0;e<i.e_actorCount;++e){let r=Fa(0,i.e_actorCount-1),o=this.m_actors[r];if(o.proxyId!==null){this.m_tree.DestroyProxy(o.proxyId),o.proxyId=null;return}}}MoveProxy(){let{aabb0:e,c0:r,c1:o}=fA;for(let s=0;s<i.e_actorCount;++s){let l=Fa(0,i.e_actorCount-1),a=this.m_actors[l];if(a.proxyId===null)continue;e.Copy(a.aabb),this.MoveAABB(a.aabb);let c=n.Subtract(a.aabb.GetCenter(o),e.GetCenter(r),new n);this.m_tree.MoveProxy(a.proxyId,a.aabb,c);return}}Reset(){this.m_rayActor=null;for(let e=0;e<i.e_actorCount;++e)this.m_actors[e].fraction=1,this.m_actors[e].overlap=!1}Action(){switch(Math.floor(W(0,19))){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}}Query(){this.m_tree.Query(this.m_queryAABB,e=>{let r=at(e.userData);return r.overlap=this.m_queryAABB.TestOverlap(r.aabb),!0});for(let e=0;e<i.e_actorCount;++e)if(this.m_actors[e].proxyId!==null){let r=this.m_queryAABB.TestOverlap(this.m_actors[e].aabb);N(r===this.m_actors[e].overlap)}}RayCast(){this.m_rayActor=null;let e=new bi().Copy(this.m_rayCastInput);this.m_tree.RayCast(e,(s,l)=>{let a=at(l.userData),c=new _i;return a.aabb.RayCast(c,s)?(this.m_rayCastOutput=c,this.m_rayActor=a,this.m_rayActor.fraction=c.fraction,c.fraction):s.maxFraction});let r=null,o=new _i;for(let s=0;s<i.e_actorCount;++s){if(this.m_actors[s].proxyId===null)continue;let l=new _i;this.m_actors[s].aabb.RayCast(l,e)&&(r=this.m_actors[s],o.Copy(l),e.maxFraction=l.fraction)}}};P("Collision","Dynamic Tree",Zh);var Qh=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_circle=new V;this.m_angle=0;this.m_bodies=new Array(i.e_maxBodies),this.m_polygons=new Array(4);for(let e=0;e<4;++e)this.m_polygons[e]=new v;{let e=this.m_world.CreateBody(),r=-20,o=2*Math.cos(r/10*Math.PI);for(let s=0;s<80;++s){let l=r+.5,a=2*Math.cos(l/10*Math.PI),c=new I;c.SetTwoSided(new n(r,o),new n(l,a)),e.CreateFixture({shape:c}),r=l,o=a}}{let e=new Array(3);e[0]=new n(-.5,0),e[1]=new n(.5,0),e[2]=new n(0,1.5),this.m_polygons[0].Set(e,3)}{let e=new Array(3);e[0]=new n(-.1,0),e[1]=new n(.1,0),e[2]=new n(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=new Array(8);s[0]=new n(.5*o,0),s[1]=new n(.5*1,r),s[2]=new n(.5*1,r+o),s[3]=new n(.5*o,1),s[4]=new n(-.5*o,1),s[5]=new n(-.5*1,r+o),s[6]=new n(-.5*1,r),s[7]=new n(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r!==null&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null);let o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({position:{x:W(-10,10),y:W(10,20)},angle:W(-Math.PI,Math.PI),type:2,angularDamping:e===4?.02:0});e<4?o.CreateFixture({shape:this.m_polygons[e],friction:.3,density:20}):o.CreateFixture({shape:this.m_circle,friction:.3,density:20}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r!==null){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){let o=!e.m_pause||e.m_singleStep;super.Step(e,r);let s=25,l=new n(0,10),a=new n(s*Math.cos(this.m_angle),-s*Math.abs(Math.sin(this.m_angle))),c=n.Add(l,a,new n),u=null,m=new n,p=new n;this.m_world.RayCast(l,c,(h,f,b,x)=>(u=h,m.Copy(f),p.Copy(b),x));let d=e.m_debugDraw;if(u){d.DrawPoint(m,5,new F(.4,.9,.4)),d.DrawSegment(l,m,new F(.8,.8,.8));let h=n.Add(m,n.Scale(.5,p,n.s_t0),new n);d.DrawSegment(m,h,new F(.9,.9,.4))}else d.DrawSegment(l,c,new F(.8,.8,.8));o&&(this.m_angle+=.25*Math.PI/180)}};P("Geometry","Edge Shapes",Qh);var Ss=mt(Ut());function yu(i,t,e,r){return{type:"radio",name:i,options:t,initialValue:e,update:r}}var Bx=({control:i})=>Ss.default.createElement(Ss.default.Fragment,null,i.options.map(t=>Ss.default.createElement("label",{className:"radio",key:t},Ss.default.createElement("input",{name:i.name,type:"radio",className:"radio--input",value:t,onClick:()=>i.update(t),defaultChecked:i.initialValue===t}),Ss.default.createElement("span",null,t)))," ");var qh=class extends R{constructor(){super();this.m_offset1=new n;this.m_offset2=new n;this.m_body1=null;this.m_body2=null;let e=[new n(10,-4),new n(10,0),new n(6,0),new n(4,2),new n(2,0),new n(-2,0),new n(-6,0),new n(-8,-3),new n(-10,0),new n(-10,-4)];this.m_offset1.Set(0,8),this.m_offset2.Set(0,16);{let r=e[0].Clone().Add(this.m_offset1),o=e[1].Clone().Add(this.m_offset1),s=e[2].Clone().Add(this.m_offset1),l=e[3].Clone().Add(this.m_offset1),a=e[4].Clone().Add(this.m_offset1),c=e[5].Clone().Add(this.m_offset1),u=e[6].Clone().Add(this.m_offset1),m=e[7].Clone().Add(this.m_offset1),p=e[8].Clone().Add(this.m_offset1),d=e[9].Clone().Add(this.m_offset1),h=this.m_world.CreateBody(),f=new I;f.SetOneSided(d,r,o,s),h.CreateFixture({shape:f}),f.SetOneSided(r,o,s,l),h.CreateFixture({shape:f}),f.SetOneSided(o,s,l,a),h.CreateFixture({shape:f}),f.SetOneSided(s,l,a,c),h.CreateFixture({shape:f}),f.SetOneSided(l,a,c,u),h.CreateFixture({shape:f}),f.SetOneSided(a,c,u,m),h.CreateFixture({shape:f}),f.SetOneSided(c,u,m,p),h.CreateFixture({shape:f}),f.SetOneSided(u,m,p,d),h.CreateFixture({shape:f}),f.SetOneSided(m,p,d,r),h.CreateFixture({shape:f}),f.SetOneSided(p,d,r,o),h.CreateFixture({shape:f})}{let r=e[0].Clone().Add(this.m_offset2),o=e[1].Clone().Add(this.m_offset2),s=e[2].Clone().Add(this.m_offset2),l=e[3].Clone().Add(this.m_offset2),a=e[4].Clone().Add(this.m_offset2),c=e[5].Clone().Add(this.m_offset2),u=e[6].Clone().Add(this.m_offset2),m=e[7].Clone().Add(this.m_offset2),p=e[8].Clone().Add(this.m_offset2),d=e[9].Clone().Add(this.m_offset2),h=this.m_world.CreateBody(),f=new I;f.SetTwoSided(r,o),h.CreateFixture({shape:f}),f.SetTwoSided(o,s),h.CreateFixture({shape:f}),f.SetTwoSided(s,l),h.CreateFixture({shape:f}),f.SetTwoSided(l,a),h.CreateFixture({shape:f}),f.SetTwoSided(a,c),h.CreateFixture({shape:f}),f.SetTwoSided(c,u),h.CreateFixture({shape:f}),f.SetTwoSided(u,m),h.CreateFixture({shape:f}),f.SetTwoSided(m,p),h.CreateFixture({shape:f}),f.SetTwoSided(p,d),h.CreateFixture({shape:f}),f.SetTwoSided(d,r),h.CreateFixture({shape:f})}this.m_body1=null,this.m_body2=null,this.CreateBoxes()}setupControls(){this.addTestControlGroup("Custom",[yu("Type",["Boxes","Circles"],"Boxes",e=>{e==="Boxes"?this.CreateBoxes():this.CreateCircles()})])}CreateBoxes(){this.m_body1&&(this.m_world.DestroyBody(this.m_body1),this.m_body1=null),this.m_body2&&(this.m_world.DestroyBody(this.m_body2),this.m_body2=null);{this.m_body1=this.m_world.CreateBody({type:2,position:{x:8+this.m_offset1.x,y:2.6+this.m_offset1.y},allowSleep:!1});let e=new v;e.SetAsBox(.5,1),this.m_body1.CreateFixture({shape:e,density:1})}{this.m_body2=this.m_world.CreateBody({type:2,position:{x:8+this.m_offset2.x,y:2.6+this.m_offset2.y},allowSleep:!1});let e=new v;e.SetAsBox(.5,1),this.m_body2.CreateFixture({shape:e,density:1})}}CreateCircles(){this.m_body1&&(this.m_world.DestroyBody(this.m_body1),this.m_body1=null),this.m_body2&&(this.m_world.DestroyBody(this.m_body2),this.m_body2=null);{this.m_body1=this.m_world.CreateBody({type:2,position:{x:this.m_offset1.x-.5,y:this.m_offset1.y+.6},allowSleep:!1});let e=new V(.5);this.m_body1.CreateFixture({shape:e,density:1})}{this.m_body2=this.m_world.CreateBody({type:2,position:{x:this.m_offset2.x-.5,y:this.m_offset2.y+.6},allowSleep:!1});let e=new V(.5);this.m_body2.CreateFixture({shape:e,density:1})}}getHotkeys(){return[Vr("a","Apply Force Left",()=>{this.m_body1?.ApplyForceToCenter(new n(-10,0),!0),this.m_body2?.ApplyForceToCenter(new n(-10,0),!0)}),Vr("d","Apply Force Right",()=>{this.m_body1?.ApplyForceToCenter(new n(10,0),!0),this.m_body2?.ApplyForceToCenter(new n(10,0),!0)})]}};P("Geometry","Edge Test",qh);var Wh=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-50,0),new n(50,0)),t.CreateFixture({shape:e})}{let e=new V;e.m_radius=1;let r=new v;r.SetAsBox(.5,5);let o=new V;o.m_radius=2;let s={x:10,y:9},l=this.m_world.CreateBody({type:0,position:s});l.CreateFixture({shape:e,density:5});let a=this.m_world.CreateBody({type:2,position:{x:10,y:8}});a.CreateFixture({shape:r,density:5});let c={x:10,y:6},u=this.m_world.CreateBody({type:2,position:c});u.CreateFixture({shape:o,density:5});let m=new q;m.Initialize(a,l,s);let p=this.m_world.CreateJoint(m),d=new q;d.Initialize(a,u,c);let h=this.m_world.CreateJoint(d),f=new ns;f.bodyA=l,f.bodyB=u,f.joint1=p,f.joint2=h,f.ratio=o.m_radius/e.m_radius,this.m_world.CreateJoint(f)}{let e=new V;e.m_radius=1;let r=new V;r.m_radius=2;let o=new v;o.SetAsBox(.5,5);let s={x:-3,y:12},l=this.m_world.CreateBody({type:2,position:s});l.CreateFixture({shape:e,density:5});let a=new q;a.bodyA=t,a.bodyB=l,t.GetLocalPoint(s,a.localAnchorA),l.GetLocalPoint(s,a.localAnchorB),a.referenceAngle=l.GetAngle()-t.GetAngle(),this.m_joint1=this.m_world.CreateJoint(a);let c={x:0,y:12},u=this.m_world.CreateBody({type:2,position:c});u.CreateFixture({shape:r,density:5});let m=new q;m.Initialize(t,u,c),this.m_joint2=this.m_world.CreateJoint(m);let p={x:2.5,y:12},d=this.m_world.CreateBody({type:2,position:p});d.CreateFixture({shape:o,density:5});let h=new Zt;h.Initialize(t,d,p,new n(0,1)),h.lowerTranslation=-5,h.upperTranslation=5,h.enableLimit=!0,this.m_joint3=this.m_world.CreateJoint(h);let f=new ns;f.bodyA=l,f.bodyB=u,f.joint1=this.m_joint1,f.joint2=this.m_joint2,f.ratio=r.m_radius/e.m_radius,this.m_joint4=this.m_world.CreateJoint(f);let b=new ns;b.bodyA=u,b.bodyB=d,b.joint1=this.m_joint2,b.joint2=this.m_joint3,b.ratio=-1/r.m_radius,this.m_joint5=this.m_world.CreateJoint(b)}}};P("Joints","Gear",Wh);var Kh=class extends R{constructor(){super();{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o})}let t=this.m_world.CreateBody({type:2,position:{x:0,y:.5}}),e=new V;e.m_radius=.5,t.CreateFixture({shape:e,density:10}),t=this.m_world.CreateBody({type:2,position:{x:0,y:6}}),e.m_radius=5,t.CreateFixture({shape:e,density:10})}};P("Solver","Heavy 1",Kh);var $h=class extends R{constructor(){super();this.m_heavy=null;{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-40,0),new n(40,0)),o.CreateFixture({shape:s})}let e=this.m_world.CreateBody({type:2,position:{x:0,y:2.5}}),r=new V;r.m_radius=.5,e.CreateFixture({shape:r,density:10}),e=this.m_world.CreateBody({type:2,position:{x:0,y:3.5}}),e.CreateFixture({shape:r,density:10})}ToggleHeavy(){if(this.m_heavy!==null)this.m_world.DestroyBody(this.m_heavy),this.m_heavy=null;else{this.m_heavy=this.m_world.CreateBody({type:2,position:{x:0,y:9}});let e=new V;e.m_radius=5,this.m_heavy.CreateFixture({shape:e,density:10})}}getHotkeys(){return[G("h","Toggle Heavy",()=>this.ToggleHeavy())]}};P("Solver","Heavy 2",$h);var tf=class i extends R{static{this.e_depth=4}constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:20}}),e=.5,r=new n(0,e),o=this.AddNode(t,n.ZERO,0,3,e),s=new q;s.bodyA=t,s.bodyB=o,s.localAnchorA.SetZero(),s.localAnchorB.Copy(r),this.m_world.CreateJoint(s)}GetDefaultViewZoom(){return 60}getCenter(){return{x:0,y:15}}AddNode(t,e,r,o,s){let a=new n(0,s),c=this.m_world.CreateBody({type:2,position:t.GetPosition().Clone().Add(e).Subtract(a)}),u=new v;if(u.SetAsBox(.25*s,s),c.CreateFixture({shape:u,density:20}),r===i.e_depth)return c;let m=new n(o,-s),p=new n(-o,-s),d=this.AddNode(c,m,r+1,.5*o,s),h=this.AddNode(c,p,r+1,.5*o,s),f=new q;return f.bodyA=c,f.localAnchorB.Copy(a),f.localAnchorA.Copy(m),f.bodyB=d,this.m_world.CreateJoint(f),f.localAnchorA.Copy(p),f.bodyB=h,this.m_world.CreateJoint(f),c}};P("Solver","Mobile Unbalanced",tf);var ef=class i extends R{static{this.e_depth=4}constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:20}}),e=.5,r=new n(0,e),o=this.AddNode(t,n.ZERO,0,3,e),s=new q;s.bodyA=t,s.bodyB=o,s.localAnchorA.SetZero(),s.localAnchorB.Copy(r),this.m_world.CreateJoint(s)}GetDefaultViewZoom(){return 60}getCenter(){return{x:0,y:15}}AddNode(t,e,r,o,s){let a=new n(0,s),c=t.GetPosition().Clone().Add(e).Subtract(a),u=this.m_world.CreateBody({type:2,position:c}),m=new v;if(m.SetAsBox(.25*s,s),u.CreateFixture({shape:m,density:20}),r===i.e_depth)return u;m.SetAsBox(o,.25*s,new n(0,-s),0),u.CreateFixture({shape:m,density:20});let p=new n(o,-s),d=new n(-o,-s),h=this.AddNode(u,p,r+1,.5*o,s),f=this.AddNode(u,d,r+1,.5*o,s),b=new q;return b.bodyA=u,b.localAnchorB.Copy(a),b.localAnchorA.Copy(p),b.bodyB=h,this.m_world.CreateJoint(b),b.localAnchorA.Copy(d),b.bodyB=f,this.m_world.CreateJoint(b),u}};P("Solver","Mobile Balanced",ef);var rf=class extends R{constructor(){super();this.m_time=0;this.m_go=!1;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:8}}),o=new v;o.SetAsBox(2,.5),r.CreateFixture({shape:o,friction:.6,density:2});let s=new ls;s.Initialize(e,r),s.maxForce=1e3,s.maxTorque=1e3,this.m_joint=this.m_world.CreateJoint(s)}this.m_go=!1,this.m_time=0}getHotkeys(){return[G("s","Start/Stop",()=>{this.m_go=!this.m_go})]}Step(e,r){this.m_go&&e.m_hertz>0&&(this.m_time+=1/e.m_hertz);let o=new n;o.x=6*Math.sin(2*this.m_time),o.y=8+4*Math.sin(1*this.m_time);let s=4*this.m_time;this.m_joint.SetLinearOffset(o),this.m_joint.SetAngularOffset(s),e.m_debugDraw.DrawPoint(o,4,new F(.9,.9,.9)),super.Step(e,r)}};P("Joints","Motor Joint",rf);var of=class extends R{constructor(){super();this.m_radius=0;this.m_top=0;this.m_bottom=0;this.m_state=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{let e=this.m_world.CreateBody({position:{x:0,y:10}}),r=new v;r.SetAsBox(3,.5),this.m_platform=e.CreateFixture({shape:r}),this.m_bottom=10-.5,this.m_top=10+.5}{let e=this.m_world.CreateBody({type:2,position:{x:0,y:12}});this.m_radius=.5;let r=new V;r.m_radius=this.m_radius,this.m_character=e.CreateFixture({shape:r,density:20}),e.SetLinearVelocity(new n(0,-50)),this.m_state=0}}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:5}}PreSolve(e,r){super.PreSolve(e,r);let o=e.GetFixtureA(),s=e.GetFixtureB();if(o!==this.m_platform&&o!==this.m_character||s!==this.m_platform&&s!==this.m_character)return;this.m_character.GetBody().GetPosition().y<this.m_top+this.m_radius-3*Z&&e.SetEnabled(!1)}};P("Examples","Platformer",of);var sf=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=H(5,n);e[0].Set(-8,6),e[1].Set(-8,20),e[2].Set(8,20),e[3].Set(8,6),e[4].Set(0,-2);let r=new dt;r.CreateLoop(e,5),t.CreateFixture({shape:r,density:0})}{let e=new n(-2,0),r=new n(2,0),o=this.m_world.CreateBody({type:2,position:e}),s=this.m_world.CreateBody({type:2,position:r}),l=new v;l.SetAsBox(1.75,.1);let a={shape:l,density:1};o.CreateFixture(a),s.CreateFixture(a);let c=new q;c.bodyA=t,c.localAnchorB.SetZero(),c.enableMotor=!0,c.maxMotorTorque=1e3,c.enableLimit=!0,c.motorSpeed=-10,c.localAnchorA.Copy(e),c.bodyB=o,c.lowerAngle=-30*Math.PI/180,c.upperAngle=5*Math.PI/180,this.m_leftJoint=this.m_world.CreateJoint(c),c.motorSpeed=10,c.localAnchorA.Copy(r),c.bodyB=s,c.lowerAngle=-5*Math.PI/180,c.upperAngle=30*Math.PI/180,this.m_rightJoint=this.m_world.CreateJoint(c)}{this.m_ball=this.m_world.CreateBody({position:{x:1,y:15},type:2,bullet:!0});let e=new V;e.m_radius=.2;let r={shape:e,density:1};this.m_ball.CreateFixture(r)}}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:5}}getHotkeys(){return[Gr("a","Hold Flipper",t=>{t?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10))})]}};P("Examples","Pinball",sf);var nf=class extends R{constructor(){super();this.m_polygonA=new v;this.m_polygonB=new v;this.m_transformA=new T;this.m_transformB=new T;this.m_positionB=new n;this.m_angleB=0;this.m_polygonA.SetAsBox(.2,.4),this.m_transformA.SetPositionAngle(new n,0),this.m_polygonB.SetAsBox(.5,.5),this.m_positionB.Set(1,1),this.m_angleB=1.9160721,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}GetDefaultViewZoom(){return 100}getHotkeys(){return[G("a","Move Left",()=>this.Adjust(-.1,0,0)),G("d","Move Right",()=>this.Adjust(.1,0,0)),G("s","Move Down",()=>this.Adjust(0,-.1,0)),G("w","Move Up",()=>this.Adjust(0,.1,0)),G("q","Turn Left",()=>this.Adjust(0,0,.1*Math.PI)),G("e","Turn Right",()=>this.Adjust(0,0,-.1*Math.PI))]}Adjust(e,r,o){this.m_positionB.x+=e,this.m_positionB.y+=r,this.m_angleB+=o,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}Step(e,r){super.Step(e,r);let o=new co;Xa(o,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);let s=new ki;s.Initialize(o,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),this.addDebug("Point Count",o.pointCount);let l=e.m_debugDraw;{let a=new F(.9,.9,.9),c=[];for(let u=0;u<this.m_polygonA.m_count;++u)c[u]=T.MultiplyVec2(this.m_transformA,this.m_polygonA.m_vertices[u],new n);l.DrawPolygon(c,this.m_polygonA.m_count,a);for(let u=0;u<this.m_polygonB.m_count;++u)c[u]=T.MultiplyVec2(this.m_transformB,this.m_polygonB.m_vertices[u],new n);l.DrawPolygon(c,this.m_polygonB.m_count,a)}for(let a=0;a<o.pointCount;++a)l.DrawPoint(s.points[a],4,new F(.9,.3,.3))}};P("Geometry","Polygon Collision",nf);var bA=4,_A={Step:{circle:new V,transform:new T}},lf=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_bodies=Array.from({length:i.e_maxBodies},()=>null);this.m_polygons=Array.from({length:4},()=>new v);this.m_circle=new V;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=new Array(3);e[0]=new n(-.5,0),e[1]=new n(.5,0),e[2]=new n(0,1.5),this.m_polygons[0].Set(e,3)}{let e=new Array(3);e[0]=new n(-.1,0),e[1]=new n(.1,0),e[2]=new n(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=new Array(8);s[0]=new n(.5*o,0),s[1]=new n(.5*1,r),s[2]=new n(.5*1,r+o),s[3]=new n(.5*o,1),s[4]=new n(-.5*o,1),s[5]=new n(-.5*1,r+o),s[6]=new n(-.5*1,r),s[7]=new n(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null),r=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({type:2,position:{x:W(-2,2),y:10},angle:W(-Math.PI,Math.PI),angularDamping:e===4?.02:0}),e<4?r.CreateFixture({shape:this.m_polygons[e],density:1,friction:.3}):r.CreateFixture({shape:this.m_circle,density:1,friction:.3}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("a","Toggle Enabled of Even Bodies",()=>{for(let e=0;e<i.e_maxBodies;e+=2){let r=this.m_bodies[e];r&&r.SetEnabled(!r.IsEnabled())}}),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){super.Step(e,r);let o=e.m_debugDraw,s=0,{circle:l,transform:a}=_A.Step;l.m_radius=2,l.m_p.Set(0,1.1),a.SetIdentity();let c=new nt;l.ComputeAABB(c,a,0),this.m_world.QueryAABB(c,m=>{if(s===bA)return!1;let p=m.GetBody(),d=m.GetShape();if(ts(d,0,l,0,p.GetTransform(),a)){let f=new F(.95,.95,.6),b=p.GetWorldCenter();o.DrawPoint(b,5,f),++s}return!0});let u=new F(.4,.7,.8);o.DrawCircle(l.m_p,l.m_radius,u)}};P("Geometry","Polygon Shapes",lf);var yo=mt(Ut());function _t(i,t,e,r,o,s){return{type:"slider",name:i,min:t,max:e,step:r,initialValue:o,update:s}}function Cx({control:i}){let[t,e]=(0,yo.useState)(i.initialValue);return yo.default.createElement("label",{className:"slider"},yo.default.createElement("div",{className:"slider--input"},yo.default.createElement("input",{type:"range",min:i.min,max:i.max,step:i.step,defaultValue:t,onChange:r=>{let o=parseFloat(r.currentTarget.value);e(o),i.update(o)}}),yo.default.createElement("span",null,t)),i.name.split("#")[0])}var af=class extends R{constructor(){super();this.m_motorSpeed=10;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(1,1);let o={x:0,y:10},s=this.m_world.CreateBody({type:2,position:o,angle:.5*Math.PI,allowSleep:!1});s.CreateFixture({shape:r,density:5});let l=new Zt;l.Initialize(e,s,o,new n(1,0)),l.motorSpeed=this.m_motorSpeed,l.maxMotorForce=1e4,l.enableMotor=this.m_enableMotor,l.lowerTranslation=-10,l.upperTranslation=10,l.enableLimit=this.m_enableLimit,this.m_joint=this.m_world.CreateJoint(l)}}setupControls(){this.addTestControlGroup("Joint",[jt("Limit",this.m_enableLimit,e=>{this.m_enableLimit=this.m_joint.EnableLimit(e)}),jt("Motor",this.m_enableMotor,e=>{this.m_enableMotor=this.m_joint.EnableMotor(e)}),_t("Speed",-100,100,1,this.m_motorSpeed,e=>{this.m_motorSpeed=this.m_joint.SetMotorSpeed(e)})])}getHotkeys(){return[G("l","Toggle Limit",()=>this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled())),G("m","Start/Stop",()=>this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())),G("s","Reverse Direction",()=>this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed()))]}Step(e,r){super.Step(e,r);let o=this.m_joint.GetMotorForce(e.m_hertz);this.addDebug("Motor Force",o.toFixed())}};P("Joints","Prismatic",af);var cf=class extends R{constructor(){super();let t=16,e=12,r=1,o=2,s=null;{s=this.m_world.CreateBody();let l=new V;l.m_radius=2,l.m_p.Set(-10,t+o+e),s.CreateFixture({shape:l}),l.m_p.Set(10,t+o+e),s.CreateFixture({shape:l})}{let l=new v;l.SetAsBox(r,o);let a=this.m_world.CreateBody({type:2,position:{x:-10,y:t}});a.CreateFixture({shape:l,density:5});let c=this.m_world.CreateBody({type:2,position:{x:10,y:t}});c.CreateFixture({shape:l,density:5});let u=new sc,m=new n(-10,t+o),p=new n(10,t+o),d=new n(-10,t+o+e),h=new n(10,t+o+e);u.Initialize(a,c,d,h,m,p,1.5),this.m_joint1=this.m_world.CreateJoint(u)}}getCenter(){return{x:0,y:15}}Step(t,e){super.Step(t,e),this.addDebug("Ratio",this.m_joint1.GetRatio().toFixed(2)),this.addDebug("Length A",this.m_joint1.GetCurrentLengthA().toFixed(2)),this.addDebug("Length B",this.m_joint1.GetCurrentLengthB().toFixed(2))}};P("Joints","Pulley",cf);var uf=class i extends R{static{this.e_count=20}constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.5);let r=new n(-7,.75),o=new n,s=new n(.5625,1.25),l=new n(1.125,0);for(let a=0;a<i.e_count;++a){o.Copy(r);for(let c=a;c<i.e_count;++c)this.m_world.CreateBody({type:2,position:o}).CreateFixture({shape:e,density:5}),o.Add(l);r.Add(s)}}}};P("Stacking","Pyramid",uf);var mf=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_bodies=[];this.m_polygons=H(4,v);this.m_circle=new V;this.m_edge=new I;this.m_degrees=0;this.m_mode="Closest";{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=H(3,n);e[0].Set(-.5,0),e[1].Set(.5,0),e[2].Set(0,1.5),this.m_polygons[0].Set(e,3)}{let e=H(3,n);e[0].Set(-.1,0),e[1].Set(.1,0),e[2].Set(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=H(8,n);s[0].Set(.5*o,0),s[1].Set(.5*1,r),s[2].Set(.5*1,r+o),s[3].Set(.5*o,1),s[4].Set(-.5*o,1),s[5].Set(-.5*1,r+o),s[6].Set(-.5*1,r),s[7].Set(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5,this.m_edge.SetTwoSided(new n(-1,0),new n(1,0)),this.m_bodyIndex=0;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}setupControls(){this.addTestControlGroup("Ray-cast",[yu("Mode",["Any","Closest","Multiple"],this.m_mode,e=>{this.m_mode=e}),_t("Angle",0,360,1,this.m_degrees,e=>{this.m_degrees=e})])}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r!==null&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null);let o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({position:{x:W(-10,10),y:W(0,20)},angle:W(-Math.PI,Math.PI),angularDamping:e===4?.02:0,userData:{rayCastBodyIndex:e}});e<4?o.CreateFixture({shape:this.m_polygons[e],friction:.3}):e<5?o.CreateFixture({shape:this.m_circle,friction:.3}):o.CreateFixture({shape:this.m_edge,friction:.3}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r!==null){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("6","Create Edge",()=>this.CreateBody(5)),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){super.Step(e,r);let o=pt(this.m_degrees),s=11,l=new n(0,10),a=new n(s*Math.cos(o),s*Math.sin(o)),c=n.Add(l,a,new n);switch(this.addText("Shape 1 is intentionally ignored by the ray"),this.m_mode){case"Closest":this.addDebug("Ray-Cast Mode","Find closest fixture along the ray"),this.rayCastClosest(l,c,e);break;case"Any":this.addDebug("Ray-Cast Mode","Check for obstruction"),this.rayCastAny(l,c,e);break;case"Multiple":this.addDebug("Ray-Cast Mode","Gather multiple fixtures"),this.rayCastMultiple(l,c,e);break}}rayCastClosest(e,r,o){let s=!1,l=new n,a=new n;this.m_world.RayCast(e,r,(u,m,p,d)=>{let{rayCastBodyIndex:h}=u.GetBody().GetUserData();return h===0?-1:(s=!0,l.Copy(m),a.Copy(p),d)});let c=o.m_debugDraw;if(s){c.DrawPoint(l,5,new F(.4,.9,.4)),c.DrawSegment(e,l,new F(.8,.8,.8));let u=n.Add(l,n.Scale(.5,a,n.s_t0),new n);c.DrawSegment(l,u,new F(.9,.9,.4))}else c.DrawSegment(e,r,new F(.8,.8,.8))}rayCastAny(e,r,o){let s=!1,l=new n,a=new n;this.m_world.RayCast(e,r,(u,m,p,d)=>{let{rayCastBodyIndex:h}=u.GetBody().GetUserData();return h===0?-1:(s=!0,l.Copy(m),a.Copy(p),0)});let c=o.m_debugDraw;if(s){c.DrawPoint(l,5,new F(.4,.9,.4)),c.DrawSegment(e,l,new F(.8,.8,.8));let u=n.Add(l,n.Scale(.5,a,n.s_t0),new n);c.DrawSegment(l,u,new F(.9,.9,.4))}else c.DrawSegment(e,r,new F(.8,.8,.8))}rayCastMultiple(e,r,o){let l=H(3,n),a=H(3,n),c=0;this.m_world.RayCast(e,r,(m,p,d)=>{let{rayCastBodyIndex:h}=m.GetBody().GetUserData();return h===0?-1:(l[c].Copy(p),a[c].Copy(d),++c,c===3?0:1)});let u=o.m_debugDraw;u.DrawSegment(e,r,new F(.8,.8,.8));for(let m=0;m<c;++m){let p=l[m],d=a[m];u.DrawPoint(p,5,new F(.4,.9,.4)),u.DrawSegment(e,p,new F(.8,.8,.8));let h=n.Add(p,n.Scale(.5,d,n.s_t0),new n);u.DrawSegment(p,h,new F(.9,.9,.4))}}};P("Collision","Ray Cast",mf);var pf=class extends R{constructor(){super();this.m_motorSpeed=1;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(.25,3,new n(0,3),0);let o=this.m_world.CreateBody({type:2,position:new n(-10,20)});o.CreateFixture({shape:r,density:5});let s=new q;s.Initialize(e,o,new n(-10,20.5)),s.motorSpeed=this.m_motorSpeed,s.maxMotorTorque=1e4,s.enableMotor=this.m_enableMotor,s.lowerAngle=-.25*Math.PI,s.upperAngle=.5*Math.PI,s.enableLimit=this.m_enableLimit,this.m_joint1=this.m_world.CreateJoint(s)}{let r=new V(2);this.m_ball=this.m_world.CreateBody({type:2,position:new n(5,30)}),this.m_ball.CreateFixture({density:5,filter:{maskBits:1},shape:r});let o=new v;o.SetAsBox(10,.5,new n(-10,0),0);let s=this.m_world.CreateBody({position:new n(20,10),type:2,bullet:!0});s.CreateFixture({shape:o,density:2});let l=new q;l.Initialize(e,s,new n(19,10)),l.lowerAngle=-.25*Math.PI,l.upperAngle=0*Math.PI,l.enableLimit=!0,l.enableMotor=!0,l.motorSpeed=0,l.maxMotorTorque=1e4,this.m_joint2=this.m_world.CreateJoint(l)}this.addTestControlGroup("Joint Controls",[jt("Limit",this.m_enableLimit,r=>{this.m_enableLimit=this.m_joint1.EnableLimit(r)}),jt("Motor",this.m_enableMotor,r=>{this.m_enableMotor=this.m_joint1.EnableMotor(r)}),_t("Speed",-20,20,1,this.m_motorSpeed,r=>{this.m_motorSpeed=this.m_joint1.SetMotorSpeed(r)})])}getCenter(){return{x:0,y:5}}Step(e,r){super.Step(e,r);let o=this.m_joint1.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque 1",o.toFixed(0));let s=this.m_joint2.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque 2",s.toFixed(0))}};P("Joints","Revolute",pf);var df=class i extends R{constructor(){super();this.m_bodies=new Array(i.e_count);this.m_force=100;this.m_touching=X2(i.e_count);let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new V;r.m_radius=5,r.m_p.Set(0,10),this.m_sensor=e.CreateFixture({shape:r,isSensor:!0})}{let r=new V;r.m_radius=1;for(let o=0;o<i.e_count;++o)this.m_touching[o]=!1,this.m_bodies[o]=this.m_world.CreateBody({type:2,position:{x:-10+3*o,y:20},userData:{sensor:o}}),this.m_bodies[o].CreateFixture({shape:r,density:1})}}static{this.e_count=7}setupControls(){this.addTestControlGroup("Sensor",[_t("Force",0,2e3,1,this.m_force,e=>{this.m_force=e})])}getCenter(){return{x:0,y:5}}BeginContact(e){let r=e.GetFixtureA(),o=e.GetFixtureB();if(r===this.m_sensor){let{sensor:s}=o.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!0)}if(o===this.m_sensor){let{sensor:s}=r.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!0)}}EndContact(e){let r=e.GetFixtureA(),o=e.GetFixtureB();if(r===this.m_sensor){let{sensor:s}=o.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!1)}if(o===this.m_sensor){let{sensor:s}=r.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!1)}}Step(e,r){super.Step(e,r);for(let o=0;o<i.e_count;++o){if(!this.m_touching[o])continue;let s=this.m_bodies[o],l=this.m_sensor.GetBody(),a=this.m_sensor.GetShape(),c=l.GetWorldPoint(a.m_p,new n),u=s.GetPosition(),m=n.Subtract(c,u,new n);if(m.LengthSquared()<Dr)continue;m.Normalize();let p=n.Scale(this.m_force,m,new n);s.ApplyForce(p,u)}}};P("Collision","Sensor Test",df);var Ax=new F(.9,.9,.9),Tx=new F(.5,.9,.5),Px=new F(.5,.7,.9),Dx=new F(.9,.3,.3),hf=class extends R{constructor(){super();this.m_vAs=H(Kt,n);this.m_countA=0;this.m_radiusA=0;this.m_vBs=H(Kt,n);this.m_countB=0;this.m_radiusB=0;this.m_transformA=new T;this.m_transformB=new T;this.m_translationB=new n;this.m_vAs[0].Set(-.5,1),this.m_vAs[1].Set(.5,1),this.m_vAs[2].Set(0,0),this.m_countA=3,this.m_radiusA=Me,this.m_vBs[0].Set(-.5,-.5),this.m_vBs[1].Set(.5,-.5),this.m_vBs[2].Set(.5,.5),this.m_vBs[3].Set(-.5,.5),this.m_countB=4,this.m_radiusB=Me,this.m_transformA.p.Set(0,.25),this.m_transformA.q.SetIdentity(),this.m_transformB.p.Set(-4,0),this.m_transformB.q.SetIdentity(),this.m_translationB.Set(8,0)}static{this.e_vertexCount=8}Step(e,r){super.Step(e,r);let o=new Ia;o.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),o.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),o.transformA.Copy(this.m_transformA),o.transformB.Copy(this.m_transformB),o.translationB.Copy(this.m_translationB);let s=new La,l=Q2(s,o),a=new T;a.q.Copy(this.m_transformB.q),a.p.Copy(this.m_transformB.p).AddScaled(s.lambda,o.translationB);let c=new Mi;c.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),c.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),c.transformA.Copy(this.m_transformA),c.transformB.Copy(a),c.useRadii=!1;let u=new Di;u.count=0;let m=new Ri;Mr(m,u,c),this.addDebug("Hit",l),this.addDebug("Iters",s.iterations),this.addDebug("Lambda",s.lambda.toFixed(6)),this.addDebug("Distance",m.distance.toFixed(6));let p=H(Kt,n);for(let h=0;h<this.m_countA;++h)T.MultiplyVec2(this.m_transformA,this.m_vAs[h],p[h]);let d=e.m_debugDraw;this.m_countA===1?d.DrawCircle(p[0],this.m_radiusA,Ax):d.DrawPolygon(p,this.m_countA,Ax);for(let h=0;h<this.m_countB;++h)T.MultiplyVec2(this.m_transformB,this.m_vBs[h],p[h]);this.m_countB===1?d.DrawCircle(p[0],this.m_radiusB,Tx):d.DrawPolygon(p,this.m_countB,Tx);for(let h=0;h<this.m_countB;++h)T.MultiplyVec2(a,this.m_vBs[h],p[h]);if(this.m_countB===1?d.DrawCircle(p[0],this.m_radiusB,Px):d.DrawPolygon(p,this.m_countB,Px),l){let h=s.point;d.DrawPoint(h,10,Dx);let f=n.Add(h,s.normal,n.s_t0);d.DrawSegment(h,f,Dx)}}};P("Collision","Shape Cast",hf);var ff=class extends R{constructor(){super();this.m_fixture2=null;this.m_sensor=!1;{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o})}this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:10}});let e=new v;e.SetAsBox(4,4,new n,0),this.m_fixture1=this.m_body.CreateFixture({shape:e,density:10})}getHotkeys(){return[G("c","Create a Shape",()=>{if(this.m_fixture2===null){let e=new V;e.m_radius=3,e.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture({shape:e,density:10}),this.m_body.SetAwake(!0)}}),G("d","Destroy a Shape",()=>{this.m_fixture2!==null&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0))}),G("s","Toggle Sensor",()=>{this.m_fixture2!==null&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))})]}Step(e,r){super.Step(e,r),this.addDebug("Sensor",this.m_sensor)}};P("Examples","Shape Editing",ff);var bf=class extends R{constructor(){super();let t=this.m_world.CreateBody(),e=8,r=-30,o=10,s=2,l=.2,a=-r*Math.PI/180,c=a-o*Math.PI/180;this.m_platform_width=e;let u=new n(-e,0),m=new n,p=new n(s*Math.cos(a),-s*Math.sin(a)),d=new n(p.x+s*Math.cos(c),p.y-s*Math.sin(c)),f=[new n(d.x,d.y-1),d,p,m,u],b=new dt;b.CreateLoop(f),t.CreateFixture({shape:b,density:0,friction:l});{let B=this.m_world.CreateBody({type:2,position:{x:-this.m_platform_width/2,y:1.55}}),C=new v,A=H(4,n);A[0].Set(-3/2-.3,-2.5/2),A[1].Set(-3/2,-2.5/2-.3),A[2].Set(3/2,-2.5/2-.3),A[3].Set(3/2+.3,-2.5/2),C.Set(A),B.CreateFixture({density:1,friction:0,restitution:.15,shape:C}),B.SetLinearVelocity(new n(.5,0)),this.m_skier=B}ot.setPositionAndZoom(this.m_platform_width/2,0,.4),this.m_fixed_camera=!0}GetDefaultViewZoom(){return 50}getHotkeys(){return[G("c","Switch Camera Fixed/Tracking",()=>{this.m_fixed_camera=!this.m_fixed_camera,this.m_fixed_camera&&ot.setPosition(this.m_platform_width/2,0)})]}Step(t,e){if(!this.m_fixed_camera){let r=this.m_skier.GetPosition();ot.setPosition(r.x,r.y)}super.Step(t,e)}};P("Bugs","Skier",bf);var _f=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=t;{let r=new v;r.SetAsBox(.5,2);let o=this.m_world.CreateBody({type:2,position:{x:0,y:7}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,5)),s.motorSpeed=1*Math.PI,s.maxMotorTorque=1e4,s.enableMotor=!0,this.m_joint1=this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(.5,4);let o=this.m_world.CreateBody({type:2,position:{x:0,y:13}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,9)),s.enableMotor=!1,this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(1.5,1.5);let o=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:0,y:17}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,17)),this.m_world.CreateJoint(s);let l=new Zt;l.Initialize(t,o,new n(0,17),new n(0,1)),l.maxMotorForce=1e3,l.enableMotor=!0,this.m_joint2=this.m_world.CreateJoint(l)}{let r=new v;r.SetAsBox(1.5,1.5),this.m_world.CreateBody({type:2,position:{x:0,y:23}}).CreateFixture({shape:r,density:2})}}}getHotkeys(){return[G("f","Toggle Friction",()=>{this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0)}),G("m","Toggle Motor",()=>{this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)})]}Step(t,e){super.Step(t,e);let r=this.m_joint1.GetMotorTorque(t.m_hertz);this.addDebug("Motor Torque",r.toFixed(0))}};P("Examples","Slider Crank 2",_f);var yf=class i extends R{constructor(){super();this.m_bodies=[];{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=new V;e.m_radius=1;for(let r=0;r<i.e_count;++r)this.m_bodies[r]=this.m_world.CreateBody({type:2,position:{x:0,y:4+3*r}}),this.m_bodies[r].CreateFixture({shape:e,density:1}),this.m_bodies[r].SetLinearVelocity(new n(0,-50))}}static{this.e_count=10}};P("Stacking","Circle Stack",yf);var xf=class extends R{constructor(){super();this.m_offset=new n;this.m_motorOn=!0;this.m_motorSpeed=2;this.m_offset.Set(0,8);let e=new n(0,.8);{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-50,0),new n(50,0)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-50,0),new n(-50,10)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(50,0),new n(50,10)),o.CreateFixture({shape:s})}for(let o=0;o<40;++o){let s=new V;s.m_radius=.25,this.m_world.CreateBody({type:2,position:{x:-40+2*o,y:.5}}).CreateFixture({shape:s,density:1})}{let o=new v;o.SetAsBox(2.5,1),this.m_chassis=this.m_world.CreateBody({type:2,position:{x:e.x+this.m_offset.x,y:e.y+this.m_offset.y}}),this.m_chassis.CreateFixture({density:1,shape:o,filter:{groupIndex:-1}})}{let o=new V;o.m_radius=1.6,this.m_wheel=this.m_world.CreateBody({type:2,position:{x:e.x+this.m_offset.x,y:e.y+this.m_offset.y}}),this.m_wheel.CreateFixture({density:1,shape:o,filter:{groupIndex:-1}})}{let o=new q;o.Initialize(this.m_wheel,this.m_chassis,n.Add(e,this.m_offset,new n)),o.collideConnected=!1,o.motorSpeed=this.m_motorSpeed,o.maxMotorTorque=400,o.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(o)}let r=n.Add(e,new n(0,-.8),new n);this.CreateLeg(-1,r),this.CreateLeg(1,r),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),120*Math.PI/180),this.CreateLeg(-1,r),this.CreateLeg(1,r),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),-120*Math.PI/180),this.CreateLeg(-1,r),this.CreateLeg(1,r)}CreateLeg(e,r){let o=new n(5.4*e,-6.1),s=new n(7.2*e,-1.2),l=new n(4.3*e,-1.9),a=new n(3.1*e,.8),c=new n(6*e,1.5),u=new n(2.5*e,3.7),m=new v,p=new v;if(e>0){let f=[];f[0]=o,f[1]=s,f[2]=l,m.Set(f),f[0]=n.ZERO,f[1]=n.Subtract(c,a,new n),f[2]=n.Subtract(u,a,new n),p.Set(f)}else{let f=[];f[0]=o,f[1]=l,f[2]=s,m.Set(f),f[0]=n.ZERO,f[1]=n.Subtract(u,a,new n),f[2]=n.Subtract(c,a,new n),p.Set(f)}let d=this.m_world.CreateBody({type:2,position:this.m_offset,angularDamping:10}),h=this.m_world.CreateBody({type:2,position:n.Add(a,this.m_offset,new n),angularDamping:10});d.CreateFixture({filter:{groupIndex:-1},shape:m,density:1}),h.CreateFixture({filter:{groupIndex:-1},density:1,shape:p});{let f=new ke,b=.5,x=10;f.Initialize(d,h,n.Add(s,this.m_offset,new n),n.Add(c,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(d,h,n.Add(l,this.m_offset,new n),n.Add(a,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(d,this.m_wheel,n.Add(l,this.m_offset,new n),n.Add(r,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(h,this.m_wheel,n.Add(u,this.m_offset,new n),n.Add(r,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f)}{let f=new q;f.Initialize(h,this.m_chassis,n.Add(a,this.m_offset,new n)),this.m_world.CreateJoint(f)}}getHotkeys(){return[G("a","Left",()=>this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed)),G("s","Brake",()=>this.m_motorJoint.SetMotorSpeed(0)),G("d","Right",()=>this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed)),G("m","Toggle Enabled",()=>this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled()))]}};P("Examples","Theo Jansen's Walker",xf);var gf=class i extends R{constructor(){super();this.m_fixtureCount=0;this.m_createTime=0;this.m_fixtureCount=0;let e=new ii;{let o=this.m_world.CreateBody({position:{x:0,y:-.5}});{let a=new n;a.y=0;for(let c=0;c<10;++c){a.x=-200*.5;for(let u=0;u<200;++u){let m=new v;m.SetAsBox(.5,.5,a,0),o.CreateFixture({shape:m}),++this.m_fixtureCount,a.x+=2*.5}a.y-=2*.5}}}{let o=new v;o.SetAsBox(.5,.5);let s=new n(-7,.75),l=new n,a=new n(.5625,1.25),c=new n(1.125,0);for(let u=0;u<i.e_count;++u){l.Copy(s);for(let m=u;m<i.e_count;++m)this.m_world.CreateBody({type:2,position:l}).CreateFixture({shape:o,density:5}),++this.m_fixtureCount,l.Add(c);s.Add(a)}}this.m_createTime=e.GetMilliseconds()}static{this.e_count=20}Step(e,r){let o=this.m_world.GetContactManager(),s=o.m_broadPhase.GetTreeHeight(),a=2*o.m_broadPhase.GetProxyCount()-1,c=Math.ceil(Math.log(a)/Math.log(2));this.addDebug("Dynamic Tree Height",s),this.addDebug("Min Height",c),super.Step(e,r),this.addDebug("Create Time",`${this.m_createTime.toFixed(2)} ms`),this.addDebug("Fixture Count",this.m_fixtureCount)}};P("Benchmark","Tiles",gf);var Sf=class extends R{constructor(){super();this.m_shapeA=new v;this.m_shapeB=new v;this.m_shapeA.SetAsBox(25,5),this.m_shapeB.SetAsBox(2.5,2.5)}Step(e,r){super.Step(e,r);let o=new ie;o.c0.Set(0,20+8*Math.cos(Date.now()/1e3)),o.a0=2.95,o.c.Copy(o.c0),o.a=o.a0,o.localCenter.SetZero();let s=new ie;s.c0.Set(20,40),s.a0=.1,s.c.Set(-20,0),s.a=3.1,s.localCenter.SetZero();let l=new rs;l.proxyA.SetShape(this.m_shapeA,0),l.proxyB.SetShape(this.m_shapeB,0),l.sweepA.Copy(o),l.sweepB.Copy(s),l.tMax=1;let a=new os;za(a,l),this.addDebug("Toi",a.t.toFixed(3)),this.addDebug("Max Toi Iters",rt.maxIters),this.addDebug("Max Root Iters",rt.maxRootIters);let c=[],u=new T;o.GetTransform(u,0);for(let d=0;d<this.m_shapeA.m_count;++d)c[d]=T.MultiplyVec2(u,this.m_shapeA.m_vertices[d],new n);let m=e.m_debugDraw;m.DrawPolygon(c,this.m_shapeA.m_count,new F(.9,.9,.9));let p=new T;s.GetTransform(p,0);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.9,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${0 .toFixed(1)}`),s.GetTransform(p,a.t);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.7,.9)),m.DrawStringWorld(p.p.x,p.p.y,`${a.t.toFixed(3)}`),s.GetTransform(p,1);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.9,.5,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${1 .toFixed(1)}`);for(let d=0;d<1;d+=.1){s.GetTransform(p,d);for(let h=0;h<this.m_shapeB.m_count;++h)c[h]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[h],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.5,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${d.toFixed(1)}`)}}GetDefaultViewZoom(){return 20}getCenter(){return{x:0,y:10}}};P("Collision","Time of Impact",Sf);var wf=class i extends R{constructor(){super();this.m_count=0;let e=this.m_world.CreateBody();{let r=this.m_world.CreateBody({type:2,allowSleep:!1,position:{x:0,y:10}}),o=new v;o.SetAsBox(.5,10,new n(10,0),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(.5,10,new n(-10,0),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(10,.5,new n(0,10),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(10,.5,new n(0,-10),0),r.CreateFixture({shape:o,density:5});let s=new q;s.bodyA=e,s.bodyB=r,s.localAnchorA.Set(0,10),s.localAnchorB.Set(0,0),s.referenceAngle=0,s.motorSpeed=.05*Math.PI,s.maxMotorTorque=1e8,s.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(s)}this.m_count=0}static{this.e_count=800}getCenter(){return{x:0,y:5}}Step(e,r){if(super.Step(e,r),this.m_count<i.e_count){let o=this.m_world.CreateBody({type:2,position:{x:0,y:10}}),s=new v;s.SetAsBox(.125,.125),o.CreateFixture({shape:s,density:1}),++this.m_count}}};P("Benchmark","Tumbler",wf);var vf=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:-4,y:22},angle:-.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.25,1),this.m_world.CreateBody({position:{x:10.5,y:19}}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:4,y:14},angle:.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.25,1),this.m_world.CreateBody({position:{x:-10.5,y:11}}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:-4,y:6},angle:-.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.5,.5);let e={shape:t,density:25},r=[.75,.5,.35,.1,0];for(let o=0;o<5;++o){let s=this.m_world.CreateBody({type:2,position:{x:-15+4*o,y:28}});e.friction=r[o],s.CreateFixture(e)}}}getCenter(){return{x:0,y:10}}};P("Forces","Friction",vf);var Bf=class extends R{constructor(){super();let t=10;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,restitutionThreshold:t})}{let e=new V;e.m_radius=1;let r={shape:e,density:1,restitutionThreshold:t},o=[0,.1,.3,.5,.75,.9,1];for(let s=0;s<7;++s){let l=this.m_world.CreateBody({type:2,position:{x:-10+3*s,y:20}});r.restitution=o[s],l.CreateFixture(r)}}}};P("Forces","Restitution",Bf);var Cf=class i extends R{constructor(){super();this.m_bullet=null;this.m_bodies=new Array(i.e_rowCount*i.e_columnCount);this.m_indices=je(i.e_rowCount*i.e_columnCount);{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o}),o.SetTwoSided(new n(20,0),new n(20,20)),r.CreateFixture({shape:o})}let e=[0,-10,-5,5,10];for(let r=0;r<i.e_columnCount;++r){let o=new v;o.SetAsBox(.5,.5);let s={shape:o,density:1,friction:.3};for(let l=0;l<i.e_rowCount;++l){let a=r*i.e_rowCount+l;this.m_indices[a]=a;let u=this.m_world.CreateBody({type:2,position:{x:e[r]+0,y:.55+1.1*l}});this.m_bodies[a]=u,u.CreateFixture(s)}}}static{this.e_columnCount=1}static{this.e_rowCount=15}getHotkeys(){return[G("Enter","Launch a bullet",()=>this.LaunchBullet()),G("b","Toggle Block solving",()=>Pc(!Dc()))]}Destroy(){Pc(!0)}LaunchBullet(){this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);{let e=new V;e.m_radius=.25;let r={shape:e,density:20,restitution:.05};this.m_bullet=this.m_world.CreateBody({type:2,bullet:!0,position:{x:-31,y:5}}),this.m_bullet.CreateFixture(r),this.m_bullet.SetLinearVelocity(new n(400,0))}}Step(e,r){super.Step(e,r),this.addDebug("Blocksolve",Dc())}};P("Stacking","Box Stack",Cf);var Af=class extends R{constructor(){super();this.m_bodies=new Array(4);this.m_joints=new Array(8);let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(.5,.5);let o=this.m_bodies[0]=this.m_world.CreateBody({type:2,position:{x:-5,y:5}});o.CreateFixture({shape:r,density:5});let s=this.m_bodies[1]=this.m_world.CreateBody({type:2,position:{x:5,y:5}});s.CreateFixture({shape:r,density:5});let l=this.m_bodies[2]=this.m_world.CreateBody({type:2,position:{x:5,y:15}});l.CreateFixture({shape:r,density:5});let a=this.m_bodies[3]=this.m_world.CreateBody({type:2,position:{x:-5,y:15}});a.CreateFixture({shape:r,density:5});let c=new ke,u,m,p,d=2,h=0;c.bodyA=e,c.bodyB=o,c.localAnchorA.Set(-10,0),c.localAnchorB.Set(-.5,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[0]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=s,c.localAnchorA.Set(10,0),c.localAnchorB.Set(.5,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[1]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=l,c.localAnchorA.Set(10,20),c.localAnchorB.Set(.5,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[2]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=a,c.localAnchorA.Set(-10,20),c.localAnchorB.Set(-.5,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[3]=this.m_world.CreateJoint(c),c.bodyA=o,c.bodyB=s,c.localAnchorA.Set(.5,0),c.localAnchorB.Set(-.5,0),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[4]=this.m_world.CreateJoint(c),c.bodyA=s,c.bodyB=l,c.localAnchorA.Set(0,.5),c.localAnchorB.Set(0,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[5]=this.m_world.CreateJoint(c),c.bodyA=l,c.bodyB=a,c.localAnchorA.Set(-.5,0),c.localAnchorB.Set(.5,0),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[6]=this.m_world.CreateJoint(c),c.bodyA=a,c.bodyB=o,c.localAnchorA.Set(0,-.5),c.localAnchorB.Set(0,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[7]=this.m_world.CreateJoint(c)}}JointDestroyed(e){for(let r=0;r<8;++r)if(this.m_joints[r]===e){this.m_joints[r]=null;break}}getHotkeys(){return[G("b","Delete a Body",()=>{for(let e=0;e<4;++e){let r=this.m_bodies[e];if(r){this.m_world.DestroyBody(r),this.m_bodies[e]=null;break}}}),G("j","Delete a Joint",()=>{for(let e=0;e<8;++e){let r=this.m_joints[e];if(r){this.m_world.DestroyJoint(r),this.m_joints[e]=null;break}}})]}Step(e,r){super.Step(e,r),this.addText("This demonstrates a soft distance joint.")}};P("Examples","Web",Af);var Tf=["Spring","PBD Ang","XPBD Ang","PBD Dist","PBD Height","PBD Triangle"],Pf=["PBD","XPBD"],Df=class extends R{constructor(){super();this.m_tuning1=new us;this.m_tuning2=new us;this.m_iterations=[8,8];this.m_position1=new n;this.m_position2=new n;this.m_speed=10;this.m_moveLeft=!1;this.m_moveRight=!1;let e=20,r=.5,o=H(e,n),s=je(e);for(let a=0;a<e;++a)o[a].Set(0,r*(e-a)),s[a]=1;s[0]=0,s[1]=0,this.m_tuning1.bendHertz=30,this.m_tuning1.bendDamping=4,this.m_tuning1.bendStiffness=1,this.m_tuning1.bendingModel=5,this.m_tuning1.isometric=!0,this.m_tuning1.stretchHertz=30,this.m_tuning1.stretchDamping=4,this.m_tuning1.stretchStiffness=1,this.m_tuning1.stretchingModel=0,this.m_tuning2.bendHertz=30,this.m_tuning2.bendDamping=.7,this.m_tuning2.bendStiffness=1,this.m_tuning2.bendingModel=4,this.m_tuning2.isometric=!0,this.m_tuning2.stretchHertz=30,this.m_tuning2.stretchDamping=1,this.m_tuning2.stretchStiffness=1,this.m_tuning2.stretchingModel=0,this.m_position1.Set(-5,15),this.m_position2.Set(5,15);let l={position:this.m_position1,vertices:o,masses:s,gravity:{x:0,y:-10},tuning:this.m_tuning1};this.m_rope1=new kn(l),l.position=this.m_position2,l.tuning=this.m_tuning2,this.m_rope2=new kn(l)}setupControls(){this.addTestControlGroup("Rope 1",this.ropeControls(0,this.m_tuning1)),this.addTestControlGroup("Rope 2",this.ropeControls(1,this.m_tuning2)),this.addTestControlGroup("Speed",[_t("",10,100,1,this.m_speed,e=>{this.m_speed=e})])}ropeControls(e,r){return[rr("Bend Model#",Tf,Tf[r.bendingModel],o=>{r.bendingModel=Tf.indexOf(o)}),_t("Damping#b",0,4,.1,r.bendDamping,o=>{r.bendDamping=o}),_t("Hertz#b",0,60,1,r.bendHertz,o=>{r.bendHertz=o}),_t("Stiffness#b",0,1,.1,r.bendStiffness,o=>{r.bendStiffness=o}),jt("Isometric",r.isometric,o=>{r.isometric=o}),jt("Fixed Mass",r.fixedEffectiveMass,o=>{r.fixedEffectiveMass=o}),jt("Warm Start",r.warmStart,o=>{r.warmStart=o}),rr("Stretch Model",Pf,Pf[r.stretchingModel],o=>{r.stretchingModel=Pf.indexOf(o)}),_t("Damping#s",0,4,.1,r.stretchDamping,o=>{r.stretchDamping=o}),_t("Hertz#s",0,60,1,r.stretchHertz,o=>{r.stretchHertz=o}),_t("Stiffness#s",0,1,.1,r.stretchStiffness,o=>{r.stretchStiffness=o}),_t("Iterations",0,100,1,this.m_iterations[e],o=>{this.m_iterations[e]=o})]}GetDefaultViewZoom(){return 45}getCenter(){return{x:0,y:20}}getHotkeys(){return[Er("a","Move Left",this,"m_moveLeft"),Er("d","Move Right",this,"m_moveRight"),G("s","Reset Ropes",()=>{this.m_position1.Set(-5,15),this.m_position2.Set(5,15),this.m_rope1.Reset(this.m_position1),this.m_rope2.Reset(this.m_position2)})]}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause===!0&&e.m_singleStep===!1&&(o=0);let s=0;this.m_moveLeft&&(s-=1),this.m_moveRight&&(s+=1),s&&(this.m_position1.x+=s*this.m_speed*o,this.m_position2.x+=s*this.m_speed*o),this.m_rope1.SetTuning(this.m_tuning1),this.m_rope2.SetTuning(this.m_tuning2),this.m_rope1.Step(o,this.m_iterations[0],this.m_position1),this.m_rope2.Step(o,this.m_iterations[1],this.m_position2),super.Step(e,r);let l=e.m_debugDraw;this.m_rope1.Draw(l),this.m_rope2.Draw(l)}};P("Rope","Bending",Df);var Mf=class extends R{constructor(){super();let t;{t=this.m_world.CreateBody();let o=new I;o.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:o})}let e;{e=this.m_world.CreateBody({type:2,position:{x:0,y:4}});let o=new V;o.m_radius=1,e.CreateFixture({shape:o,friction:.6,density:2})}let r;{r=this.m_world.CreateBody({type:2,position:{x:4,y:8}});let o=new V;o.m_radius=1,r.CreateFixture({shape:o,friction:.6,density:2})}{let o=new ls;o.Initialize(e,r),o.maxForce=1e3,o.maxTorque=1e3,this.m_joint=this.m_world.CreateJoint(o)}}};P("Bugs","Motor Joint (Bug #487)",Mf);var Rf=class extends R{constructor(){super();let t=this.m_world.CreateBody();{let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-40,0),new n(-40,25)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(40,0),new n(40,25)),t.CreateFixture({shape:e})}{let e=new qa,r=0,o=10,s=5,l=5,a=20,c=.5;for(let p=0;p<a;++p){let d=p*2*Math.PI/a,h=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:r+s*Math.cos(d),y:o+l*Math.sin(d)}});h.CreateFixture({shape:new V(c),density:1}),e.AddBody(h)}Ct(e,10,1,e.bodyA,e.bodyB),this.m_world.CreateJoint(e)}}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:5}}};P("Examples","Blob Test",Rf);var kf=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new dt;e.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),t.CreateFixture({shape:e})}this.m_world.SetContinuousPhysics(!0);{let t=this.m_world.CreateBody({type:2,bullet:!0,position:{x:15,y:5}}),e=new v;e.SetAsBox(4.5,.45);let r={density:4,restitution:1.4,shape:e};t.CreateFixture(r);let o=new v;o.SetAsBox(.45,8.1,new n(-4.35,7.05),.2),r.shape=o,t.CreateFixture(r);let s=new v;s.SetAsBox(.45,8.1,new n(4.35,7.05),-.2),r.shape=s,t.CreateFixture(r)}for(let t=0;t<5;t++){let e=new V(Math.random()*1+.5);this.m_world.CreateBody({type:2,bullet:!0,position:{x:Math.random()*30-25,y:Math.random()*32+2}}).CreateFixture({shape:e,friction:.3,density:1,restitution:1.1})}}GetDefaultViewZoom(){return 20}getCenter(){return{x:0,y:15}}};P("Continuous","Continuous Collision",kf);var Ff=class extends R{constructor(){super();{let l=this.m_world.CreateBody(),a=new dt;a.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),l.CreateFixture({shape:a})}let t=new n,e={position:t},r=new q;for(let l=0;l<2;++l){let a=-20+Math.random()*2+40*l,c=30+Math.random()*5;e.type=2;let u={shape:new V(1.25),density:1,friction:.4,restitution:.3};t.Set(a,c);let m=this.m_world.CreateBody(e);m.CreateFixture(u),m.ApplyLinearImpulse(new n(Math.random()*1e3-500,Math.random()*1e3-500),m.GetWorldCenter());let p=new v;u.shape=p,p.SetAsBox(1.5,1),u.density=1,u.friction=.4,u.restitution=.1,t.Set(a,c-2.8);let d=this.m_world.CreateBody(e);d.CreateFixture(u),p.SetAsBox(1.5,1),t.Set(a,c-4.3);let h=this.m_world.CreateBody(e);h.CreateFixture(u),p.SetAsBox(1.5,1),t.Set(a,c-5.8);let f=this.m_world.CreateBody(e);f.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(1.8,.65),t.Set(a-3,c-2);let b=this.m_world.CreateBody(e);b.CreateFixture(u),p.SetAsBox(1.8,.65),t.Set(a+3,c-2);let x=this.m_world.CreateBody(e);x.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(1.7,.6),t.Set(a-5.7,c-2);let _=this.m_world.CreateBody(e);_.CreateFixture(u),p.SetAsBox(1.7,.6),t.Set(a+5.7,c-2);let y=this.m_world.CreateBody(e);y.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(.75,2.2),t.Set(a-.8,c-8.5);let g=this.m_world.CreateBody(e);g.CreateFixture(u),p.SetAsBox(.75,2.2),t.Set(a+.8,c-8.5);let S=this.m_world.CreateBody(e);S.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(.6,2),t.Set(a-.8,c-12);let w=this.m_world.CreateBody(e);w.CreateFixture(u),p.SetAsBox(.6,2),t.Set(a+.8,c-12);let B=this.m_world.CreateBody(e);B.CreateFixture(u),r.enableLimit=!0,r.lowerAngle=pt(-40),r.upperAngle=pt(40),r.Initialize(d,m,new n(a,c-1.5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-85),r.upperAngle=pt(130),r.Initialize(d,b,new n(a-1.8,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-130),r.upperAngle=pt(85),r.Initialize(d,x,new n(a+1.8,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-130),r.upperAngle=pt(10),r.Initialize(b,_,new n(a-4.5,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-10),r.upperAngle=pt(130),r.Initialize(x,y,new n(a+4.5,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-15),r.upperAngle=pt(15),r.Initialize(d,h,new n(a,c-3.5)),this.m_world.CreateJoint(r),r.Initialize(h,f,new n(a,c-5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-25),r.upperAngle=pt(45),r.Initialize(f,g,new n(a-.8,c-7.2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-45),r.upperAngle=pt(25),r.Initialize(f,S,new n(a+.8,c-7.2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-25),r.upperAngle=pt(115),r.Initialize(g,w,new n(a-.8,c-10.5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-115),r.upperAngle=pt(25),r.Initialize(S,B,new n(a+.8,c-10.5)),this.m_world.CreateJoint(r)}e.type=0;let o=new v,s={shape:o,density:0,friction:.4,restitution:.3};for(let l=1;l<=10;++l)o.SetAsBox(1*l,1),t.Set(1*l-30,21-2*l),this.m_world.CreateBody(e).CreateFixture(s);for(let l=1;l<=10;++l)o.SetAsBox(1*l,1),t.Set(30-1*l,21-2*l),this.m_world.CreateBody(e).CreateFixture(s);o.SetAsBox(3,4),t.Set(0,4),this.m_world.CreateBody(e).CreateFixture(s)}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:15}}};P("Examples","Ragdolls",Ff);var If=class extends R{constructor(){super();{let l=this.m_world.CreateBody(),a=new dt;a.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),l.CreateFixture({shape:a})}let t=new n,e={type:2,position:t},r=new v,o={shape:r,density:1,friction:.5,restitution:.1};r.SetAsBox(1,1);for(let l=0;l<10;++l)t.Set(0+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);for(let l=0;l<10;++l)t.Set(10+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);for(let l=0;l<10;++l)t.Set(20+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);e.type=0,t.Set(0,0);let s=[new n(-30,0),new n(-10,0),new n(-30,10)];r.Set(s,s.length),o.density=0,this.m_world.CreateBody(e).CreateFixture(o),e.type=2,t.Set(-25,20),o.shape=new V(4),o.density=2,o.restitution=.2,o.friction=.5,this.m_world.CreateBody(e).CreateFixture(o)}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:15}}};P("Stacking","Stacked Boxes",If);var Lf=class extends R{constructor(){super();let t=4,e=30,r=(c,u,m)=>{let d=c.CreateBody({type:2,position:u}),h=new v;m?h.SetAsBox(.5*e,.5*t):h.SetAsBox(.5*t,.5*e),d.CreateFixture({shape:h,density:1/(t*e),friction:.6,restitution:0})},o=this.m_world,s=o.CreateBody(),l=new I;l.SetTwoSided(new n(-600,-240),new n(600,-240)),s.CreateFixture({shape:l,friction:1,restitution:1});let a=12;for(let c=0;c<a;c++)for(let u=0;u<a-c;u++){let m=new n((u-(a-1-c)*.5)*1.5*e,(c+.5)*(e+2*t)-t-240);r(o,m,!1),r(o,n.Add(m,new n(0,(e+t)/2),new n),!0),u===0&&r(o,n.Add(m,new n(.5*(t-e),e+t),new n),!1),u!==a-c-1?r(o,n.Add(m,new n(e*.75,(e+3*t)/2),new n),!0):r(o,n.Add(m,new n(.5*(e-t),e+t),new n),!1)}}GetDefaultViewZoom(){return 1.5}getCenter(){return{x:0,y:1}}};P("Stacking","Pyramid Topple",Lf);var Gf=class extends R{constructor(){super();let t=.2,e=.1,r=1,o=25,s,l=this.m_world;function a(c,u,m){let p=new v;p.SetAsBox(.5*t,.5*r),l.CreateBody({type:2,position:{x:c,y:u},angle:m?Math.PI/2:0}).CreateFixture({shape:p,density:s,friction:e,restitution:.65})}{let c=new v;c.SetAsBox(50,10),l.CreateBody({position:{x:0,y:-10}}).CreateFixture({shape:c,density:0})}{s=10;let c=new v;c.SetAsBox(.7,.7);let u={density:35,shape:c,friction:0,restitution:.85},m=l.CreateBody({type:2,bullet:!0,position:{x:30,y:5}});m.CreateFixture(u),m.SetLinearVelocity(new n(-25,-25)),m.SetAngularVelocity(6.7),u.density=25,m=l.CreateBody({type:2,bullet:!0,position:{x:-30,y:25}}),m.CreateFixture(u),m.SetLinearVelocity(new n(35,-10)),m.SetAngularVelocity(-8.3)}{let c;for(let u=0;u<o;++u)c=u*1.5*r-1.5*r*o/2,a(c,r/2,!1),a(c,r+t/2,!0);c=o*1.5*r-1.5*r*o/2;for(let u=1;u<o;++u){u>3&&(s*=.8);let m=r*.5+(r+2*t)*.99*u;for(let p=0;p<o-u;++p)c=p*1.5*r-1.5*r*(o-u)/2,s*=2.5,p===0&&a(c-1.25*r+.5*t,m-t,!1),p===o-u-1&&a(c+1.25*r-.5*t,m-t,!1),s/=2.5,a(c,m,!1),a(c,m+.5*(t+r),!0),a(c,m-.5*(t+r),!0)}}}};P("Benchmark","Domino Tower",Gf);var xu=.017453292519943295,gu=class{constructor(t,e){this.frictionModifier=t,this.outOfCourse=e}},ws=class{constructor(t){this.m_groundAreas=[];this.m_currentTraction=1;this.m_maxForwardSpeed=0;this.m_maxBackwardSpeed=0;this.m_maxDriveForce=0;this.m_maxLateralImpulse=0;this.m_body=t.CreateBody({type:2,userData:{tire:this}});let e=new v;e.SetAsBox(.5,1.25),this.m_body.CreateFixture({shape:e,density:1,userData:{tire:!0}})}setCharacteristics(t,e,r,o){this.m_maxForwardSpeed=t,this.m_maxBackwardSpeed=e,this.m_maxDriveForce=r,this.m_maxLateralImpulse=o}addGroundArea(t){this.m_groundAreas.push(t),this.updateTraction()}removeGroundArea(t){this.m_groundAreas.splice(this.m_groundAreas.indexOf(t)),this.updateTraction()}updateTraction(){this.m_groundAreas.length===0?this.m_currentTraction=1:(this.m_currentTraction=0,this.m_groundAreas.forEach(t=>{t.frictionModifier>this.m_currentTraction&&(this.m_currentTraction=t.frictionModifier)}))}getLateralVelocity(){let t=this.m_body.GetWorldVector(new n(1,0),new n);return t.Scale(n.Dot(t,this.m_body.GetLinearVelocity()))}getForwardVelocity(){let t=this.m_body.GetWorldVector(new n(0,1),new n);return t.Scale(n.Dot(t,this.m_body.GetLinearVelocity()))}updateFriction(){let t=this.getLateralVelocity().Scale(-1*this.m_body.GetMass());t.Length()>this.m_maxLateralImpulse&&t.Scale(this.m_maxLateralImpulse/t.Length()),this.m_body.ApplyLinearImpulse(t.Scale(this.m_currentTraction),this.m_body.GetWorldCenter()),this.m_body.ApplyAngularImpulse(this.m_currentTraction*.1*this.m_body.GetInertia()*-this.m_body.GetAngularVelocity());let e=this.getForwardVelocity(),o=-2*e.Normalize();this.m_body.ApplyForce(e.Scale(this.m_currentTraction*o),this.m_body.GetWorldCenter())}updateDrive(t){if(t.up===t.down)return;let e=0;t.up?e=this.m_maxForwardSpeed:t.down&&(e=this.m_maxBackwardSpeed);let r=this.m_body.GetWorldVector(new n(0,1),new n),o=n.Dot(this.getForwardVelocity(),r),s=0;if(e>o)s=this.m_maxDriveForce;else if(e<o)s=-this.m_maxDriveForce;else return;this.m_body.ApplyForce(r.Scale(this.m_currentTraction*s),this.m_body.GetWorldCenter())}updateTurn(t){let e=0;t.left&&(e+=15),t.right&&(e-=15),this.m_body.ApplyTorque(e)}},Vf=class{constructor(t){this.m_tires=[],this.m_body=t.CreateBody({type:2}),this.m_body.SetAngularDamping(3);let e=[];e[0]=new n(1.5,0),e[1]=new n(3,2.5),e[2]=new n(2.8,5.5),e[3]=new n(1,10),e[4]=new n(-1,10),e[5]=new n(-2.8,5.5),e[6]=new n(-3,2.5),e[7]=new n(-1.5,0);let r=new v;r.Set(e,8),this.m_body.CreateFixture({shape:r,density:.1});let o=new q;o.bodyA=this.m_body,o.enableLimit=!0,o.lowerAngle=0,o.upperAngle=0,o.localAnchorB.SetZero();let s=250,l=-40,a=300,c=500,u=8.5,m=7.5,p=new ws(t);p.setCharacteristics(s,l,a,u),o.bodyB=p.m_body,o.localAnchorA.Set(-3,.75),t.CreateJoint(o),this.m_tires.push(p),p=new ws(t),p.setCharacteristics(s,l,a,u),o.bodyB=p.m_body,o.localAnchorA.Set(3,.75),t.CreateJoint(o),this.m_tires.push(p),p=new ws(t),p.setCharacteristics(s,l,c,m),o.bodyB=p.m_body,o.localAnchorA.Set(-3,8.5),this.flJoint=t.CreateJoint(o),this.m_tires.push(p),p=new ws(t),p.setCharacteristics(s,l,c,m),o.bodyB=p.m_body,o.localAnchorA.Set(3,8.5),this.frJoint=t.CreateJoint(o),this.m_tires.push(p)}update(t){this.m_tires.forEach(u=>{u.updateFriction()}),this.m_tires.forEach(u=>{u.updateDrive(t)});let e=35*xu,o=160*xu/60,s=0;t.left&&(s+=e),t.right&&(s-=e);let l=this.flJoint.GetJointAngle(),a=s-l;a=tt(a,-o,o);let c=l+a;this.flJoint.SetLimits(c,c),this.frJoint.SetLimits(c,c)}},Ef=class i extends R{constructor(){super(n.ZERO);this.m_controlState={left:!1,right:!1,up:!1,down:!1};{this.m_groundBody=this.m_world.CreateBody();let e=new v,r={shape:e,isSensor:!0,userData:{groundArea:new gu(.5,!1)}};e.SetAsBox(9,7,new n(-10,15),20*xu),this.m_groundBody.CreateFixture(r),e.SetAsBox(9,5,new n(5,20),-40*xu),r.userData={groundArea:new gu(.2,!1)},this.m_groundBody.CreateFixture(r)}this.m_car=new Vf(this.m_world)}getHotkeys(){return[Er("a","Turn Left",this.m_controlState,"left"),Er("d","Turn Right",this.m_controlState,"right"),Er("w","Move Forward",this.m_controlState,"up"),Er("s","Move Backward",this.m_controlState,"down")]}static handleContact(e,r){let o=e.GetFixtureA(),s=e.GetFixtureB(),l=o.GetUserData(),a=s.GetUserData();l.tire||a.groundArea?i.tire_vs_groundArea(o,s,r):(l.groundArea||a.tire)&&i.tire_vs_groundArea(s,o,r)}BeginContact(e){i.handleContact(e,!0)}EndContact(e){i.handleContact(e,!1)}static tire_vs_groundArea(e,r,o){let{tire:s}=e.GetBody().GetUserData(),{groundArea:l}=r.GetUserData();s&&l&&(o?s.addGroundArea(l):s.removeGroundArea(l))}Step(e,r){this.m_car.update(this.m_controlState),super.Step(e,r)}};P("Examples","TopDown Car",Ef);var Uf=class extends R{constructor(){super();let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e});let r={x:0,y:5},o=this.m_world.CreateBody({type:2,angularDamping:.1,position:r}),s=new v;s.SetAsBox(.5,.5),o.CreateFixture({shape:s,density:5}),this.m_hertz=1,this.m_dampingRatio=.7;let l=new ke;l.Initialize(t,o,new n(0,15),r),l.collideConnected=!0,this.m_length=l.length,this.m_minLength=this.m_length,this.m_maxLength=this.m_length,Ct(l,this.m_hertz,this.m_dampingRatio,l.bodyA,l.bodyB),this.m_joint=this.m_world.CreateJoint(l)}setupControls(){this.addTestControlGroup("Joint",[_t("Length",0,20,1,this.m_length,t=>{this.m_length=this.m_joint.SetLength(t)}),_t("Min Length",0,20,1,this.m_minLength,t=>{this.m_minLength=this.m_joint.SetMinLength(t)}),_t("Max Length",0,20,1,this.m_maxLength,t=>{this.m_maxLength=this.m_joint.SetMaxLength(t)}),_t("Hertz",0,10,.1,this.m_hertz,t=>{this.m_hertz=t,this.UpdateStiffness()}),_t("Damping Ratio",0,2,.1,this.m_dampingRatio,t=>{this.m_dampingRatio=t,this.UpdateStiffness()})])}UpdateStiffness(){let t={stiffness:0,damping:0};Ct(t,this.m_hertz,this.m_dampingRatio,this.m_joint.GetBodyA(),this.m_joint.GetBodyB()),this.m_joint.SetStiffness(t.stiffness),this.m_joint.SetDamping(t.damping)}};P("Joints","Distance Joint",Uf);var Yf=class extends R{constructor(){super();this.m_motorSpeed=10;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,density:0})}{let r=new V(2),o=new n(0,10),s=this.m_world.CreateBody({type:2,position:o,allowSleep:!1});s.CreateFixture({shape:r,density:5});let l=new cs;l.Initialize(e,s,o,new n(0,1)),l.motorSpeed=this.m_motorSpeed,l.maxMotorTorque=1e4,l.enableMotor=this.m_enableMotor,l.lowerTranslation=-3,l.upperTranslation=3,l.enableLimit=this.m_enableLimit,Ct(l,1,.7,e,s),this.m_joint=this.m_world.CreateJoint(l)}this.addTestControlGroup("Joint",[jt("Limit",this.m_enableLimit,r=>{this.m_enableLimit=this.m_joint.EnableLimit(r)}),jt("Motor",this.m_enableMotor,r=>{this.m_enableMotor=this.m_joint.EnableMotor(r)}),_t("Speed",-100,100,1,this.m_motorSpeed,r=>{this.m_motorSpeed=this.m_joint.SetMotorSpeed(r)})])}Step(e,r){super.Step(e,r);let o=this.m_joint.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque",o);let s=this.m_joint.GetReactionForce(e.m_hertz,new n);this.addDebug("Reaction Force",`(${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}};P("Joints","Wheel",Yf);var Jf=class extends R{constructor(){super();this.m_distanceJointDef=new ke;this.m_stabilize=!1;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,density:0})}{let r=new v;r.SetAsBox(.5,.125);let o={shape:r,density:20,friction:.2,filter:{categoryBits:1,maskBits:65533}},s=new q;s.collideConnected=!1;let l=10,a=15;this.m_distanceJointDef.localAnchorA.Set(0,a);let c=e;for(let m=0;m<l;++m){let p=new n(.5+1*m,a),d={type:2,position:p};m===l-1&&(p.Set(1*m,a),d.angularDamping=.4);let h=this.m_world.CreateBody(d);if(m===l-1){let b=new V(1.5);h.CreateFixture({shape:b,density:100,filter:{categoryBits:2}})}else h.CreateFixture(o);let f=new n(m,a);s.Initialize(c,h,f),this.m_world.CreateJoint(s),c=h}this.m_distanceJointDef.localAnchorB.SetZero();let u=.01;this.m_distanceJointDef.minLength=0,this.m_distanceJointDef.maxLength=l-1+u,this.m_distanceJointDef.bodyB=c}this.m_distanceJointDef.bodyA=e,this.m_distanceJoint=this.m_world.CreateJoint(this.m_distanceJointDef),this.m_stabilize=!0}setupControls(){this.addTestControlGroup("Wrecking Ball",[jt("Stabilize",this.m_stabilize,e=>{this.m_stabilize=e,e&&this.m_distanceJoint===null?this.m_distanceJoint=this.m_world.CreateJoint(this.m_distanceJointDef):!e&&this.m_distanceJoint!==null&&(this.m_world.DestroyJoint(this.m_distanceJoint),this.m_distanceJoint=null)})])}Step(e,r){super.Step(e,r),this.addDebug("Distance Joint",this.m_distanceJoint?"ON":"OFF")}};P("Examples","Wrecking Ball",Jf);var jf=class extends R{constructor(){super();let t=new n(0,-10);this.m_world.SetGravity(t);let e=[];e[0]=this.m_world.CreateBody({type:0});{let r=new n(0,1),o=new n(0,0),s=new n(4,0),l=new I;l.SetTwoSided(r,o),e[0].CreateFixture({shape:l}),l.SetTwoSided(o,s),e[0].CreateFixture({shape:l})}e[1]=this.m_world.CreateBody({type:2,position:new n(1,3)});{let r=new v,o=H(8,n);o[0].Set(.5,-3),o[1].Set(.5,3),o[2].Set(-.5,3),o[3].Set(-.5,-3),r.Set(o,4),e[1].CreateFixture({shape:r,friction:.2,density:10})}}};P("Bugs","Chain Problem",jf);var zf=class extends R{constructor(){super();let t=25,e=this.m_world.CreateBody();{let m=new v;m.SetAsBox(.5,2),e.CreateFixture({shape:m}),e=this.m_world.CreateBody({angle:.5*Math.PI,position:{x:t,y:2*t}}),m.SetAsBox(2*t,1.2),e.CreateFixture({shape:m}),e=this.m_world.CreateBody({angle:.5*Math.PI,position:{x:-t,y:2*t}}),e.CreateFixture({shape:m})}let r=26,s=.5*2,l=s*r/2,a=s/2,c=new v;c.SetAsBox(.5,.5);let u=5*r;for(let m=0;m<r;++m){let p=m*s-l;for(let d=0;d<u;++d){let h=d*s+a+2;this.m_world.CreateBody({type:2,position:{x:p,y:h}}).CreateFixture({shape:c,density:1,friction:.5})}}}GetDefaultViewZoom(){return 10}getCenter(){return{x:0,y:50}}};P("Benchmark","Boxes",zf);function yA(i){return i.key===" "?"Space":i.key}var Xf=class{constructor(){this.m_fpsCalculator=new ru(200,200,16);this.m_settings=new eu;this.m_test=null;this.m_lMouseDown=!1;this.m_rMouseDown=!1;this.m_max_demo_time=1e3*10;this.m_ctx=null;this.m_mouse=new n;this.testBaseHotKeys=[];this.testHotKeys=[];this.allHotKeys=[];this.stepHotKeys=[];this.groupedTests=ux();this.flatTests=[];this.testConstructor=null;this.testTitle="Unset";this.onPauseChanged=new Mx.Signal;this.m_hoveringCanvas=!1;this.shouldRestart=!1;this.m_keyMap={};this.gl=null;this.textures=null;this.defaultShader=null;this.activateTest=()=>{};this.setLeftTable=()=>{};this.setRightTable=()=>{};this.setTestControlGroups=()=>{};this.particleParameter=new su(this);for(let{tests:t}of this.groupedTests)this.flatTests.push(...t);this.ownHotKeys=[G("0","Reset Camera",()=>this.HomeCamera()),G("+","Zoom In",()=>this.ZoomCamera(1.1)),G("-","Zoom Out",()=>this.ZoomCamera(.9)),G("r","Reload Test",()=>this.LoadTest()),G("o","Single Step",()=>this.SingleStep()),G("p","Pause/Continue",()=>this.SetPause(!this.m_settings.m_pause)),G("PageUp","Previous Test",()=>this.DecrementTest()),G("PageDown","Next Test",()=>this.IncrementTest())]}init(t,e,r,o,s,l,a){this.setLeftTable=s,this.setRightTable=l,this.activateTest=o,this.setTestControlGroups=a,e.addEventListener("mousedown",u=>this.HandleMouseDown(u)),e.addEventListener("mouseup",u=>this.HandleMouseUp(u)),e.addEventListener("mousemove",u=>this.HandleMouseMove(u)),e.addEventListener("wheel",u=>this.HandleMouseWheel(u)),e.addEventListener("mouseenter",()=>{this.m_hoveringCanvas=!0}),e.addEventListener("mouseleave",()=>{this.m_hoveringCanvas=!1});let c=()=>{let{clientWidth:u,clientHeight:m}=r;(e.width!==u||e.height!==m)&&(e.width=t.width=u,e.height=t.height=m,ot.resize(u,m),this.m_test?.Resize(u,m),this.gl&&vd(t,this.gl,u,r.clientHeight))};if(window.addEventListener("resize",c),window.addEventListener("orientationchange",c),c(),this.m_ctx=e.getContext("2d"),!this.m_ctx)throw new Error("Could not create 2d context for debug-draw");this.m_settings.m_debugDraw=new Fn(this.m_ctx),window.addEventListener("contextmenu",u=>{u.target instanceof HTMLElement&&u.target.closest("main")&&u.preventDefault()},!0),window.addEventListener("keydown",u=>this.HandleKey(u,!0)),window.addEventListener("keyup",u=>this.HandleKey(u,!1)),this.LoadTest(),this.prepareGl(t)}async prepareGl(t){this.gl=W0(t),this.textures=await O0(this.gl),this.defaultShader=q0(this.gl),this.LoadTest()}setTest(t,e){this.testTitle=t,this.testConstructor=e,this.LoadTest()}HomeCamera(){let t=this.m_test?this.m_test.GetDefaultViewZoom():25,e=this.m_test?this.m_test.getCenter():n.ZERO;ot.setPositionAndZoom(e.x,e.y,t)}ZoomCamera(t){ot.setZoom(tt(ot.getZoom()*t,.5,500))}HandleMouseMove(t){let e=new n(t.offsetX,t.offsetY),r=ot.unproject(e,new n);if(this.m_mouse.Copy(e),this.m_test?.MouseMove(r,this.m_lMouseDown),this.m_rMouseDown){let{x:o,y:s}=ot.getCenter(),l=1/ot.getZoom();ot.setPosition(o-t.movementX*l,s+t.movementY*l)}}HandleMouseDown(t){let e=new n(t.offsetX,t.offsetY),r=ot.unproject(e,new n);switch(t.button){case 0:this.m_lMouseDown=!0,t.shiftKey?this.m_test?.ShiftMouseDown(r):this.m_test?.MouseDown(r);break;case 2:this.m_rMouseDown=!0;break}}HandleMouseUp(t){let e=new n(t.offsetX,t.offsetY),r=ot.unproject(e,new n);switch(t.button){case 0:this.m_lMouseDown=!1,this.m_test?.MouseUp(r);break;case 2:this.m_rMouseDown=!1;break}}HandleMouseWheel(t){this.m_hoveringCanvas&&(t.deltaY<0?this.ZoomCamera(1.1):t.deltaY>0&&this.ZoomCamera(1/1.1),t.preventDefault())}HandleKey(t,e){if(this.m_hoveringCanvas||!e){let{key:r}=t,o=this.allHotKeys.find(s=>s.key===r);o&&(!!this.m_keyMap[r]!==e&&(o.step||o.callback(e),this.m_keyMap[r]=e),this.m_hoveringCanvas&&t.preventDefault())}}DecrementTest(){let t=this.flatTests.findIndex(e=>e.name===this.testTitle)-1;t<0?this.activateTest(this.flatTests[this.flatTests.length-1]):t>=0&&this.activateTest(this.flatTests[t])}IncrementTest(){let t=this.flatTests.findIndex(e=>e.name===this.testTitle)+1;t>=this.flatTests.length?this.activateTest(this.flatTests[0]):t>0&&this.activateTest(this.flatTests[t])}LoadTest(t=!1){let e=this.testConstructor;if(!(!e||!this.m_ctx||!this.gl||!this.defaultShader||!this.textures||!this.m_settings.m_debugDraw)){t||this.particleParameter.Reset(),this.m_test?.Destroy(),this.m_test=new e({gl:this.gl,shader:this.defaultShader,textures:this.textures,particleParameter:this.particleParameter}),this.m_test.setupControls(),this.testBaseHotKeys=this.m_test.getBaseHotkeys(),this.testHotKeys=this.m_test.getHotkeys(),this.allHotKeys=[...this.ownHotKeys,...this.testBaseHotKeys,...this.testHotKeys],this.stepHotKeys=this.allHotKeys.filter(r=>r.step);for(let r of this.allHotKeys){let o=this.allHotKeys.find(s=>r.key===s.key);o&&r!==o&&console.error(`Conflicting keys "${r.description}" and "${o.description}"`)}t||this.HomeCamera(),this.setTestControlGroups(this.m_test.m_testControlGroups.slice())}}SetPause(t){this.m_settings.m_pause=t,this.onPauseChanged.emit(t)}SingleStep(){this.m_settings.m_pause||(this.m_settings.m_pause=!0,this.onPauseChanged.emit(!0)),this.m_settings.m_singleStep=!0}scheduleRestart(){this.shouldRestart=!0}SimulationLoop(){let t=this.m_settings.m_debugDraw;if(this.m_fpsCalculator.addFrame()<=0||!this.gl||!this.defaultShader||!this.m_ctx||!t)return;ds(this.gl,0,0,0,0),this.gl.enable(this.gl.BLEND),this.defaultShader.use(),this.defaultShader.uMVMatrix.set(!1,ot.modelView),this.defaultShader.uPMatrix.set(!1,ot.projection);let e=ot.getCenter(),r=ot.getZoom();if(t.Prepare(e.x,e.y,r,!0),this.m_test?.RunStep(this.m_settings),this.m_hoveringCanvas)for(let o of this.stepHotKeys)this.m_keyMap[o.key]&&o.callback(!0);t.Finish(),this.m_settings.m_drawFpsMeter&&this.DrawFpsMeter(this.m_ctx),this.UpdateText(),this.shouldRestart&&(this.shouldRestart=!1,this.LoadTest(!0))}DrawFpsMeter(t){t.save(),t.translate(0,ot.getHeight()),t.scale(1,-1),t.fillStyle=Fn.MakeStyleString(F.GREEN);let e=5;for(let r of this.m_fpsCalculator.getFrames())t.fillRect(e,5,1,r),e++;t.restore()}UpdateText(){let t=[],e=this.m_fpsCalculator.getFps(),r=[["Performance:","!"],["Avg. FPS",e.avgFps.toFixed(1)],["Max. Time in ms",e.maxTime.toFixed(1)],["Min. Time in ms",e.minTime.toFixed(1)],["",""]];this.m_test&&(this.m_test.m_textLines.length&&t.push(["Description:","!"],...this.m_test.m_textLines.map(o=>[o,"-"]),["",""]),this.m_settings.m_drawInputHelp&&(t.push(["Mouse:","!"],["Right Drag","Move Camera"],["Left Drag","Grab Objects"],["Wheel","Zoom"],["",""]),t.push(["Keyboard:","!"],...this.allHotKeys.map(o=>[yA(o),o.description]),["",""])),this.m_test.m_debugLines.length&&r.push(["Debug Info:","!"],...this.m_test.m_debugLines,["",""]),this.m_test.m_statisticLines.length&&r.push(["Statistics:","!"],...this.m_test.m_statisticLines,["",""])),this.setLeftTable(t),this.setRightTable(r)}},xA=(0,Su.createContext)(new Xf),tl=()=>(0,Su.useContext)(xA);var Rx=/[^a-z0-9-]+/gi,sr=({group:i,name:t})=>`/${i.replace(Rx,"_")}#${t.replace(Rx,"_")}`;function kx(i,t){return JSON.stringify(i)!==JSON.stringify(t)?t:i}var gA=({label:i,value:t})=>t==="!"?ft.default.createElement("tr",null,ft.default.createElement("th",{colSpan:2},i)):t==="-"?ft.default.createElement("tr",null,ft.default.createElement("td",{colSpan:2},i)):ft.default.createElement("tr",null,ft.default.createElement("td",null,t),ft.default.createElement("td",null,i)),Fx=({id:i,table:t})=>ft.default.createElement("div",{id:i},ft.default.createElement("table",null,ft.default.createElement("tbody",null,t.map(([e,r],o)=>ft.default.createElement(gA,{key:o,label:e,value:r}))))),SA=({entry:{name:i,TestClass:t},setTestControlGroups:e})=>{let[r,o]=(0,ft.useReducer)(kx,[]),[s,l]=(0,ft.useReducer)(kx,[]),a=(0,ft.useRef)(null),c=(0,ft.useRef)(null),u=(0,ft.useRef)(null),m=tl(),p=Zi(),d=Ix();return(0,ft.useEffect)(()=>{let h=a.current,f=c.current,b=u.current;if(h&&f&&b){let x=()=>{try{m.SimulationLoop(),window.requestAnimationFrame(x)}catch(y){console.error("Error during simulation loop",y)}},_=()=>{let y=g=>{p.history.push(sr(g))};m.init(h,f,b,y,o,l,e),window.requestAnimationFrame(x)};window.requestAnimationFrame(_)}},[c.current,a.current,u.current,m]),(0,ft.useEffect)(()=>{m.setTest(i,t)},[m,t]),ft.default.createElement("main",{ref:u},ft.default.createElement("canvas",{ref:a}),ft.default.createElement("canvas",{ref:c}),ft.default.createElement(Fx,{id:"left_overlay",table:r}),ft.default.createElement("div",{id:"title_overlay"},d?.name??""),ft.default.createElement(Fx,{id:"right_overlay",table:s}))};function Ix(){let i=Zi(),t=decodeURIComponent(i.path);return tl().flatTests.find(r=>sr(r)===t)}var Lx=({setTestControlGroups:i})=>{let t=Ix();return t?ft.default.createElement(SA,{entry:t,setTestControlGroups:i}):ft.default.createElement("main",null,"Select a test from the right sidebar")};var At=mt(Ut());var Or=mt(Ut());var Gx=mt(Ut());var Vx=()=>Gx.default.createElement("div",{className:"separator"});var vs=mt(Ut());var wu=({className:i,legend:t,legendClassName:e,children:r,defaultOpen:o=!1})=>{let[s,l]=(0,vs.useState)(o),a=[];return e&&a.push(e),s&&a.push("open-legend"),vs.default.createElement("fieldset",{className:`section ${i??""}`},vs.default.createElement("legend",{onClick:()=>l(!s),tabIndex:0,className:a.join(" ")},t),vs.default.createElement("div",{className:s?"section-content":"section-content section-content-hidden"},r))};var wA=({control:i})=>{switch(i.type){case"slider":return Or.default.createElement(Cx,{control:i});case"checkbox":return Or.default.createElement(px,{control:i});case"radio":return Or.default.createElement(Bx,{control:i});case"select":return Or.default.createElement(mx,{control:i});case"separator":return Or.default.createElement(Vx,null)}return null},Bs=({legend:i,controls:t,defaultOpen:e})=>Or.default.createElement(wu,{legend:i,defaultOpen:e,className:"settings-section"},t.map(r=>Or.default.createElement(wA,{key:r.name,control:r})));function re(i,t,e){let r=i[t];return jt(e,r,o=>{i[t]=o})}function el(i,t,e,r,o,s){let l=i[t];return _t(e,r,o,s,l,a=>{i[t]=a})}var Ex=mt(Ut());var vu=({label:i,onClick:t})=>Ex.default.createElement("button",{className:"button",onClick:t},i);var Hf=mt(Ut());var Ux=({name:i,link:t,tests:e})=>{let r=e.some(o=>t===sr(o));return Hf.default.createElement(wu,{legend:i,legendClassName:r?"active-legend":""},e.map(o=>Hf.default.createElement(I2,{href:sr(o),key:o.name,className:t===sr(o)?"active-link":""},o.name)))};var Yx=({testControlGroups:i})=>{let[t,e]=(0,At.useState)("controls"),[r,o]=(0,At.useState)(!1),s=tl(),l=Zi(),a=decodeURIComponent(l.path),c=(0,At.useMemo)(()=>s.groupedTests.some(f=>f.tests.some(b=>a===sr(b))),[s,a]);(0,At.useEffect)(()=>{let f=s.onPauseChanged.connect(o);return()=>{f.disconnect()}}),(0,At.useEffect)(()=>{!c&&t!=="tests"&&e("tests")},[c,t]);let u=s.m_settings,m=[el(u,"m_velocityIterations","Velocity Iters",0,50,1),el(u,"m_positionIterations","Position Iters",0,50,1),el(u,"m_particleIterations","Particle Iters",0,50,1),el(u,"m_hertz","Hertz",5,120,1)],p=[re(u,"m_enableSleep","Sleep"),re(u,"m_enableWarmStarting","Warm Starting"),re(u,"m_enableContinuous","Time of Impact"),re(u,"m_enableSubStepping","Sub-Stepping")],d=[re(u,"m_drawShapes","Shapes"),re(u,"m_drawParticles","Particles"),re(u,"m_drawJoints","Joints"),re(u,"m_drawAABBs","AABBs"),re(u,"m_drawContactPoints","Contact Points"),re(u,"m_drawContactNormals","Contact Normals"),re(u,"m_drawContactImpulse","Contact Impulses"),re(u,"m_drawFrictionImpulse","Friction Impulses"),re(u,"m_drawCOMs","Center of Masses")],h=[re(u,"m_drawStats","Statistics"),re(u,"m_drawInputHelp","Input Help"),re(u,"m_drawProfile","Profile"),re(u,"m_drawFpsMeter","FPS Meter")];return At.default.createElement("div",{className:"sidebar"},At.default.createElement("div",{className:"sidebar--tabs"},At.default.createElement("div",{onClick:()=>e("controls"),className:t==="controls"?"active-tab":""},"Controls"),At.default.createElement("div",{onClick:()=>e("tests"),className:t==="tests"?"active-tab":""},"Tests")),At.default.createElement("div",{className:t==="controls"?"tab-content":"tab-content tab-content-hidden"},At.default.createElement(Bs,{legend:"Iterations",controls:m}),At.default.createElement(Bs,{legend:"General",controls:p}),At.default.createElement(Bs,{legend:"Draw",controls:d}),At.default.createElement(Bs,{legend:"Overlay",controls:h}),i.groups.map((f,b)=>At.default.createElement(Bs,{defaultOpen:!0,legend:`[Test] ${f.legend}`,key:`${i.key}-${b}`,controls:f.controls}))),At.default.createElement("div",{className:t==="tests"?"tab-content":"tab-content tab-content-hidden"},s.groupedTests.map(({name:f,tests:b})=>At.default.createElement(Ux,{key:f,name:f,tests:b,link:a}))),t==="controls"&&At.default.createElement("div",{className:"sidebar--buttons"},At.default.createElement(vu,{label:r?"Continue (P)":"Pause (P)",onClick:()=>s.SetPause(!r)}),At.default.createElement(vu,{label:"Single Step (O)",onClick:()=>s.SingleStep()}),At.default.createElement(vu,{label:"Restart (R)",onClick:()=>s.LoadTest(!0)})))};var Jx={name:"@box2d/testbed",version:"0.10.0",private:!0,description:"A Testbed for all @box2d packages",homepage:"https://lusito.github.io/box2d.ts/",bugs:{url:"https://github.com/lusito/box2d.ts/issues"},repository:{type:"git",url:"https://github.com/lusito/box2d.ts.git"},license:"MIT",author:"Santo Pfingsten",files:["dist"],scripts:{build:"rimraf dist && node src/ui/esbuild.js",start:"node src/ui/esbuild.js serve"},browserslist:["> 5%"],dependencies:{"@box2d/controllers":"^0.11.0","@box2d/core":"^0.11.0","@box2d/debug-draw":"^0.11.0","@box2d/lights":"^0.11.0","@box2d/particles":"^0.11.0","@react-nano/router":"^0.15.0","@types/randomcolor":"^0.5.9","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",esbuild:"^0.21.5","esbuild-sass-plugin":"^3.3.1","esbuild-ts-paths":"^1.1.3","gl-matrix":"^3.4.3",react:"^18.3.1","react-dom":"^18.3.1","sort-package-json":"^2.10.0","typed-glsl":"0.11.2","typed-signals":"^3.0.0","typeface-open-sans":"1.1.13"}};var BA={key:0,groups:[]};function CA(i,t){return{key:i.key+1,groups:t}}function AA(){let[i,t]=(0,Nr.useReducer)(CA,BA);return Nr.default.createElement("div",{className:"container"},Nr.default.createElement(Lx,{setTestControlGroups:t}),Nr.default.createElement(Yx,{testControlGroups:i}))}document.title=`@Box2D Testbed v${Jx.version}`;var TA=(0,jx.createRoot)(document.getElementById("root"));TA.render(Nr.default.createElement(U2,{mode:"hash"},Nr.default.createElement(AA,null)));})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/

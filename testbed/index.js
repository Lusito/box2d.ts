"use strict";(()=>{var Qx=Object.create;var Tu=Object.defineProperty;var qx=Object.getOwnPropertyDescriptor;var Wx=Object.getOwnPropertyNames;var Kx=Object.getPrototypeOf,$x=Object.prototype.hasOwnProperty;var Vt=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),Zf=(i,t)=>{for(var e in t)Tu(i,e,{get:t[e],enumerable:!0})},tg=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Wx(t))!$x.call(i,o)&&o!==e&&Tu(i,o,{get:()=>t[o],enumerable:!(r=qx(t,o))||r.enumerable});return i};var $=(i,t,e)=>(e=i!=null?Qx(Kx(i)):{},tg(t||!i||!i.__esModule?Tu(e,"default",{value:i,enumerable:!0}):e,i));var nb=Vt(nt=>{"use strict";var Ms=Symbol.for("react.element"),eg=Symbol.for("react.portal"),ig=Symbol.for("react.fragment"),rg=Symbol.for("react.strict_mode"),og=Symbol.for("react.profiler"),sg=Symbol.for("react.provider"),ng=Symbol.for("react.context"),lg=Symbol.for("react.forward_ref"),ag=Symbol.for("react.suspense"),cg=Symbol.for("react.memo"),ug=Symbol.for("react.lazy"),Qf=Symbol.iterator;function mg(i){return i===null||typeof i!="object"?null:(i=Qf&&i[Qf]||i["@@iterator"],typeof i=="function"?i:null)}var Kf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$f=Object.assign,tb={};function vo(i,t,e){this.props=i,this.context=t,this.refs=tb,this.updater=e||Kf}vo.prototype.isReactComponent={};vo.prototype.setState=function(i,t){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,t,"setState")};vo.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function eb(){}eb.prototype=vo.prototype;function Du(i,t,e){this.props=i,this.context=t,this.refs=tb,this.updater=e||Kf}var Mu=Du.prototype=new eb;Mu.constructor=Du;$f(Mu,vo.prototype);Mu.isPureReactComponent=!0;var qf=Array.isArray,ib=Object.prototype.hasOwnProperty,Ru={current:null},rb={key:!0,ref:!0,__self:!0,__source:!0};function ob(i,t,e){var r,o={},s=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(s=""+t.key),t)ib.call(t,r)&&!rb.hasOwnProperty(r)&&(o[r]=t[r]);var a=arguments.length-2;if(a===1)o.children=e;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];o.children=c}if(i&&i.defaultProps)for(r in a=i.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:Ms,type:i,key:s,ref:l,props:o,_owner:Ru.current}}function pg(i,t){return{$$typeof:Ms,type:i.type,key:t,ref:i.ref,props:i.props,_owner:i._owner}}function ku(i){return typeof i=="object"&&i!==null&&i.$$typeof===Ms}function dg(i){var t={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(e){return t[e]})}var Wf=/\/+/g;function Pu(i,t){return typeof i=="object"&&i!==null&&i.key!=null?dg(""+i.key):t.toString(36)}function ul(i,t,e,r,o){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var l=!1;if(i===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(i.$$typeof){case Ms:case eg:l=!0}}if(l)return l=i,o=o(l),i=r===""?"."+Pu(l,0):r,qf(o)?(e="",i!=null&&(e=i.replace(Wf,"$&/")+"/"),ul(o,t,e,"",function(u){return u})):o!=null&&(ku(o)&&(o=pg(o,e+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(Wf,"$&/")+"/")+i)),t.push(o)),1;if(l=0,r=r===""?".":r+":",qf(i))for(var a=0;a<i.length;a++){s=i[a];var c=r+Pu(s,a);l+=ul(s,t,e,c,o)}else if(c=mg(i),typeof c=="function")for(i=c.call(i),a=0;!(s=i.next()).done;)s=s.value,c=r+Pu(s,a++),l+=ul(s,t,e,c,o);else if(s==="object")throw t=String(i),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function cl(i,t,e){if(i==null)return i;var r=[],o=0;return ul(i,r,"","",function(s){return t.call(e,s,o++)}),r}function hg(i){if(i._status===-1){var t=i._result;t=t(),t.then(function(e){(i._status===0||i._status===-1)&&(i._status=1,i._result=e)},function(e){(i._status===0||i._status===-1)&&(i._status=2,i._result=e)}),i._status===-1&&(i._status=0,i._result=t)}if(i._status===1)return i._result.default;throw i._result}var _e={current:null},ml={transition:null},fg={ReactCurrentDispatcher:_e,ReactCurrentBatchConfig:ml,ReactCurrentOwner:Ru};function sb(){throw Error("act(...) is not supported in production builds of React.")}nt.Children={map:cl,forEach:function(i,t,e){cl(i,function(){t.apply(this,arguments)},e)},count:function(i){var t=0;return cl(i,function(){t++}),t},toArray:function(i){return cl(i,function(t){return t})||[]},only:function(i){if(!ku(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};nt.Component=vo;nt.Fragment=ig;nt.Profiler=og;nt.PureComponent=Du;nt.StrictMode=rg;nt.Suspense=ag;nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fg;nt.act=sb;nt.cloneElement=function(i,t,e){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var r=$f({},i.props),o=i.key,s=i.ref,l=i._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,l=Ru.current),t.key!==void 0&&(o=""+t.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(c in t)ib.call(t,c)&&!rb.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=e;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ms,type:i.type,key:o,ref:s,props:r,_owner:l}};nt.createContext=function(i){return i={$$typeof:ng,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:sg,_context:i},i.Consumer=i};nt.createElement=ob;nt.createFactory=function(i){var t=ob.bind(null,i);return t.type=i,t};nt.createRef=function(){return{current:null}};nt.forwardRef=function(i){return{$$typeof:lg,render:i}};nt.isValidElement=ku;nt.lazy=function(i){return{$$typeof:ug,_payload:{_status:-1,_result:i},_init:hg}};nt.memo=function(i,t){return{$$typeof:cg,type:i,compare:t===void 0?null:t}};nt.startTransition=function(i){var t=ml.transition;ml.transition={};try{i()}finally{ml.transition=t}};nt.unstable_act=sb;nt.useCallback=function(i,t){return _e.current.useCallback(i,t)};nt.useContext=function(i){return _e.current.useContext(i)};nt.useDebugValue=function(){};nt.useDeferredValue=function(i){return _e.current.useDeferredValue(i)};nt.useEffect=function(i,t){return _e.current.useEffect(i,t)};nt.useId=function(){return _e.current.useId()};nt.useImperativeHandle=function(i,t,e){return _e.current.useImperativeHandle(i,t,e)};nt.useInsertionEffect=function(i,t){return _e.current.useInsertionEffect(i,t)};nt.useLayoutEffect=function(i,t){return _e.current.useLayoutEffect(i,t)};nt.useMemo=function(i,t){return _e.current.useMemo(i,t)};nt.useReducer=function(i,t,e){return _e.current.useReducer(i,t,e)};nt.useRef=function(i){return _e.current.useRef(i)};nt.useState=function(i){return _e.current.useState(i)};nt.useSyncExternalStore=function(i,t,e){return _e.current.useSyncExternalStore(i,t,e)};nt.useTransition=function(){return _e.current.useTransition()};nt.version="18.3.1"});var ye=Vt((LA,lb)=>{"use strict";lb.exports=nb()});var _b=Vt(yt=>{"use strict";function Gu(i,t){var e=i.length;i.push(t);t:for(;0<e;){var r=e-1>>>1,o=i[r];if(0<pl(o,t))i[r]=t,i[e]=o,e=r;else break t}}function ai(i){return i.length===0?null:i[0]}function hl(i){if(i.length===0)return null;var t=i[0],e=i.pop();if(e!==t){i[0]=e;t:for(var r=0,o=i.length,s=o>>>1;r<s;){var l=2*(r+1)-1,a=i[l],c=l+1,u=i[c];if(0>pl(a,e))c<o&&0>pl(u,a)?(i[r]=u,i[c]=e,r=c):(i[r]=a,i[l]=e,r=l);else if(c<o&&0>pl(u,e))i[r]=u,i[c]=e,r=c;else break t}}return t}function pl(i,t){var e=i.sortIndex-t.sortIndex;return e!==0?e:i.id-t.id}typeof performance=="object"&&typeof performance.now=="function"?(ab=performance,yt.unstable_now=function(){return ab.now()}):(Fu=Date,cb=Fu.now(),yt.unstable_now=function(){return Fu.now()-cb});var ab,Fu,cb,Bi=[],ar=[],bg=1,Qe=null,le=3,fl=!1,Wr=!1,ks=!1,pb=typeof setTimeout=="function"?setTimeout:null,db=typeof clearTimeout=="function"?clearTimeout:null,ub=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Vu(i){for(var t=ai(ar);t!==null;){if(t.callback===null)hl(ar);else if(t.startTime<=i)hl(ar),t.sortIndex=t.expirationTime,Gu(Bi,t);else break;t=ai(ar)}}function Eu(i){if(ks=!1,Vu(i),!Wr)if(ai(Bi)!==null)Wr=!0,Yu(Uu);else{var t=ai(ar);t!==null&&Ju(Eu,t.startTime-i)}}function Uu(i,t){Wr=!1,ks&&(ks=!1,db(Fs),Fs=-1),fl=!0;var e=le;try{for(Vu(t),Qe=ai(Bi);Qe!==null&&(!(Qe.expirationTime>t)||i&&!bb());){var r=Qe.callback;if(typeof r=="function"){Qe.callback=null,le=Qe.priorityLevel;var o=r(Qe.expirationTime<=t);t=yt.unstable_now(),typeof o=="function"?Qe.callback=o:Qe===ai(Bi)&&hl(Bi),Vu(t)}else hl(Bi);Qe=ai(Bi)}if(Qe!==null)var s=!0;else{var l=ai(ar);l!==null&&Ju(Eu,l.startTime-t),s=!1}return s}finally{Qe=null,le=e,fl=!1}}var bl=!1,dl=null,Fs=-1,hb=5,fb=-1;function bb(){return!(yt.unstable_now()-fb<hb)}function Iu(){if(dl!==null){var i=yt.unstable_now();fb=i;var t=!0;try{t=dl(!0,i)}finally{t?Rs():(bl=!1,dl=null)}}else bl=!1}var Rs;typeof ub=="function"?Rs=function(){ub(Iu)}:typeof MessageChannel<"u"?(Lu=new MessageChannel,mb=Lu.port2,Lu.port1.onmessage=Iu,Rs=function(){mb.postMessage(null)}):Rs=function(){pb(Iu,0)};var Lu,mb;function Yu(i){dl=i,bl||(bl=!0,Rs())}function Ju(i,t){Fs=pb(function(){i(yt.unstable_now())},t)}yt.unstable_IdlePriority=5;yt.unstable_ImmediatePriority=1;yt.unstable_LowPriority=4;yt.unstable_NormalPriority=3;yt.unstable_Profiling=null;yt.unstable_UserBlockingPriority=2;yt.unstable_cancelCallback=function(i){i.callback=null};yt.unstable_continueExecution=function(){Wr||fl||(Wr=!0,Yu(Uu))};yt.unstable_forceFrameRate=function(i){0>i||125<i?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):hb=0<i?Math.floor(1e3/i):5};yt.unstable_getCurrentPriorityLevel=function(){return le};yt.unstable_getFirstCallbackNode=function(){return ai(Bi)};yt.unstable_next=function(i){switch(le){case 1:case 2:case 3:var t=3;break;default:t=le}var e=le;le=t;try{return i()}finally{le=e}};yt.unstable_pauseExecution=function(){};yt.unstable_requestPaint=function(){};yt.unstable_runWithPriority=function(i,t){switch(i){case 1:case 2:case 3:case 4:case 5:break;default:i=3}var e=le;le=i;try{return t()}finally{le=e}};yt.unstable_scheduleCallback=function(i,t,e){var r=yt.unstable_now();switch(typeof e=="object"&&e!==null?(e=e.delay,e=typeof e=="number"&&0<e?r+e:r):e=r,i){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=e+o,i={id:bg++,callback:t,priorityLevel:i,startTime:e,expirationTime:o,sortIndex:-1},e>r?(i.sortIndex=e,Gu(ar,i),ai(Bi)===null&&i===ai(ar)&&(ks?(db(Fs),Fs=-1):ks=!0,Ju(Eu,e-r))):(i.sortIndex=o,Gu(Bi,i),Wr||fl||(Wr=!0,Yu(Uu))),i};yt.unstable_shouldYield=bb;yt.unstable_wrapCallback=function(i){var t=le;return function(){var e=le;le=t;try{return i.apply(this,arguments)}finally{le=e}}}});var xb=Vt((VA,yb)=>{"use strict";yb.exports=_b()});var v2=Vt(ze=>{"use strict";var _g=ye(),Ye=xb();function J(i){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+i,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+i+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A_=new Set,en={};function uo(i,t){Xo(i,t),Xo(i+"Capture",t)}function Xo(i,t){for(en[i]=t,i=0;i<t.length;i++)A_.add(t[i])}var Hi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),um=Object.prototype.hasOwnProperty,yg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gb={},Sb={};function xg(i){return um.call(Sb,i)?!0:um.call(gb,i)?!1:yg.test(i)?Sb[i]=!0:(gb[i]=!0,!1)}function gg(i,t,e,r){if(e!==null&&e.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:e!==null?!e.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Sg(i,t,e,r){if(t===null||typeof t>"u"||gg(i,t,e,r))return!0;if(r)return!1;if(e!==null)switch(e.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Se(i,t,e,r,o,s,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=e,this.propertyName=i,this.type=t,this.sanitizeURL=s,this.removeEmptyString=l}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ne[i]=new Se(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var t=i[0];ne[t]=new Se(t,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ne[i]=new Se(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ne[i]=new Se(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ne[i]=new Se(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ne[i]=new Se(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ne[i]=new Se(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ne[i]=new Se(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ne[i]=new Se(i,5,!1,i.toLowerCase(),null,!1,!1)});var ip=/[\-:]([a-z])/g;function rp(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var t=i.replace(ip,rp);ne[t]=new Se(t,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var t=i.replace(ip,rp);ne[t]=new Se(t,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var t=i.replace(ip,rp);ne[t]=new Se(t,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ne[i]=new Se(i,1,!1,i.toLowerCase(),null,!1,!1)});ne.xlinkHref=new Se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ne[i]=new Se(i,1,!1,i.toLowerCase(),null,!0,!0)});function op(i,t,e,r){var o=ne.hasOwnProperty(t)?ne[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Sg(t,e,o,r)&&(e=null),r||o===null?xg(t)&&(e===null?i.removeAttribute(t):i.setAttribute(t,""+e)):o.mustUseProperty?i[o.propertyName]=e===null?o.type===3?!1:"":e:(t=o.attributeName,r=o.attributeNamespace,e===null?i.removeAttribute(t):(o=o.type,e=o===3||o===4&&e===!0?"":""+e,r?i.setAttributeNS(r,t,e):i.setAttribute(t,e))))}var Qi=_g.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_l=Symbol.for("react.element"),Ao=Symbol.for("react.portal"),To=Symbol.for("react.fragment"),sp=Symbol.for("react.strict_mode"),mm=Symbol.for("react.profiler"),T_=Symbol.for("react.provider"),P_=Symbol.for("react.context"),np=Symbol.for("react.forward_ref"),pm=Symbol.for("react.suspense"),dm=Symbol.for("react.suspense_list"),lp=Symbol.for("react.memo"),ur=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var D_=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var wb=Symbol.iterator;function Is(i){return i===null||typeof i!="object"?null:(i=wb&&i[wb]||i["@@iterator"],typeof i=="function"?i:null)}var Ft=Object.assign,zu;function zs(i){if(zu===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);zu=t&&t[1]||""}return`
`+zu+i}var ju=!1;function Xu(i,t){if(!i||ju)return"";ju=!0;var e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(i,[],t)}else{try{t.call()}catch(u){r=u}i.call(t.prototype)}else{try{throw Error()}catch(u){r=u}i()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),s=r.stack.split(`
`),l=o.length-1,a=s.length-1;1<=l&&0<=a&&o[l]!==s[a];)a--;for(;1<=l&&0<=a;l--,a--)if(o[l]!==s[a]){if(l!==1||a!==1)do if(l--,a--,0>a||o[l]!==s[a]){var c=`
`+o[l].replace(" at new "," at ");return i.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",i.displayName)),c}while(1<=l&&0<=a);break}}}finally{ju=!1,Error.prepareStackTrace=e}return(i=i?i.displayName||i.name:"")?zs(i):""}function wg(i){switch(i.tag){case 5:return zs(i.type);case 16:return zs("Lazy");case 13:return zs("Suspense");case 19:return zs("SuspenseList");case 0:case 2:case 15:return i=Xu(i.type,!1),i;case 11:return i=Xu(i.type.render,!1),i;case 1:return i=Xu(i.type,!0),i;default:return""}}function hm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case To:return"Fragment";case Ao:return"Portal";case mm:return"Profiler";case sp:return"StrictMode";case pm:return"Suspense";case dm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case P_:return(i.displayName||"Context")+".Consumer";case T_:return(i._context.displayName||"Context")+".Provider";case np:var t=i.render;return i=i.displayName,i||(i=t.displayName||t.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case lp:return t=i.displayName||null,t!==null?t:hm(i.type)||"Memo";case ur:t=i._payload,i=i._init;try{return hm(i(t))}catch{}}return null}function vg(i){var t=i.type;switch(i.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=t.render,i=i.displayName||i.name||"",t.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hm(t);case 8:return t===sp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Br(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function M_(i){var t=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bg(i){var t=M_(i)?"checked":"value",e=Object.getOwnPropertyDescriptor(i.constructor.prototype,t),r=""+i[t];if(!i.hasOwnProperty(t)&&typeof e<"u"&&typeof e.get=="function"&&typeof e.set=="function"){var o=e.get,s=e.set;return Object.defineProperty(i,t,{configurable:!0,get:function(){return o.call(this)},set:function(l){r=""+l,s.call(this,l)}}),Object.defineProperty(i,t,{enumerable:e.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){i._valueTracker=null,delete i[t]}}}}function yl(i){i._valueTracker||(i._valueTracker=Bg(i))}function R_(i){if(!i)return!1;var t=i._valueTracker;if(!t)return!0;var e=t.getValue(),r="";return i&&(r=M_(i)?i.checked?"true":"false":i.value),i=r,i!==e?(t.setValue(i),!0):!1}function Ol(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function fm(i,t){var e=t.checked;return Ft({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:e??i._wrapperState.initialChecked})}function vb(i,t){var e=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;e=Br(t.value!=null?t.value:e),i._wrapperState={initialChecked:r,initialValue:e,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function k_(i,t){t=t.checked,t!=null&&op(i,"checked",t,!1)}function bm(i,t){k_(i,t);var e=Br(t.value),r=t.type;if(e!=null)r==="number"?(e===0&&i.value===""||i.value!=e)&&(i.value=""+e):i.value!==""+e&&(i.value=""+e);else if(r==="submit"||r==="reset"){i.removeAttribute("value");return}t.hasOwnProperty("value")?_m(i,t.type,e):t.hasOwnProperty("defaultValue")&&_m(i,t.type,Br(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(i.defaultChecked=!!t.defaultChecked)}function Bb(i,t,e){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+i._wrapperState.initialValue,e||t===i.value||(i.value=t),i.defaultValue=t}e=i.name,e!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,e!==""&&(i.name=e)}function _m(i,t,e){(t!=="number"||Ol(i.ownerDocument)!==i)&&(e==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+e&&(i.defaultValue=""+e))}var js=Array.isArray;function Eo(i,t,e,r){if(i=i.options,t){t={};for(var o=0;o<e.length;o++)t["$"+e[o]]=!0;for(e=0;e<i.length;e++)o=t.hasOwnProperty("$"+i[e].value),i[e].selected!==o&&(i[e].selected=o),o&&r&&(i[e].defaultSelected=!0)}else{for(e=""+Br(e),t=null,o=0;o<i.length;o++){if(i[o].value===e){i[o].selected=!0,r&&(i[o].defaultSelected=!0);return}t!==null||i[o].disabled||(t=i[o])}t!==null&&(t.selected=!0)}}function ym(i,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return Ft({},t,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Cb(i,t){var e=t.value;if(e==null){if(e=t.children,t=t.defaultValue,e!=null){if(t!=null)throw Error(J(92));if(js(e)){if(1<e.length)throw Error(J(93));e=e[0]}t=e}t==null&&(t=""),e=t}i._wrapperState={initialValue:Br(e)}}function F_(i,t){var e=Br(t.value),r=Br(t.defaultValue);e!=null&&(e=""+e,e!==i.value&&(i.value=e),t.defaultValue==null&&i.defaultValue!==e&&(i.defaultValue=e)),r!=null&&(i.defaultValue=""+r)}function Ab(i){var t=i.textContent;t===i._wrapperState.initialValue&&t!==""&&t!==null&&(i.value=t)}function I_(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xm(i,t){return i==null||i==="http://www.w3.org/1999/xhtml"?I_(t):i==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var xl,L_=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,e,r,o){MSApp.execUnsafeLocalFunction(function(){return i(t,e,r,o)})}:i}(function(i,t){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=t;else{for(xl=xl||document.createElement("div"),xl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=xl.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;t.firstChild;)i.appendChild(t.firstChild)}});function rn(i,t){if(t){var e=i.firstChild;if(e&&e===i.lastChild&&e.nodeType===3){e.nodeValue=t;return}}i.textContent=t}var Os={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Cg=["Webkit","ms","Moz","O"];Object.keys(Os).forEach(function(i){Cg.forEach(function(t){t=t+i.charAt(0).toUpperCase()+i.substring(1),Os[t]=Os[i]})});function G_(i,t,e){return t==null||typeof t=="boolean"||t===""?"":e||typeof t!="number"||t===0||Os.hasOwnProperty(i)&&Os[i]?(""+t).trim():t+"px"}function V_(i,t){i=i.style;for(var e in t)if(t.hasOwnProperty(e)){var r=e.indexOf("--")===0,o=G_(e,t[e],r);e==="float"&&(e="cssFloat"),r?i.setProperty(e,o):i[e]=o}}var Ag=Ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gm(i,t){if(t){if(Ag[i]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,i));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function Sm(i,t){if(i.indexOf("-")===-1)return typeof t.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wm=null;function ap(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var vm=null,Uo=null,Yo=null;function Tb(i){if(i=Sn(i)){if(typeof vm!="function")throw Error(J(280));var t=i.stateNode;t&&(t=ga(t),vm(i.stateNode,i.type,t))}}function E_(i){Uo?Yo?Yo.push(i):Yo=[i]:Uo=i}function U_(){if(Uo){var i=Uo,t=Yo;if(Yo=Uo=null,Tb(i),t)for(i=0;i<t.length;i++)Tb(t[i])}}function Y_(i,t){return i(t)}function J_(){}var Hu=!1;function z_(i,t,e){if(Hu)return i(t,e);Hu=!0;try{return Y_(i,t,e)}finally{Hu=!1,(Uo!==null||Yo!==null)&&(J_(),U_())}}function on(i,t){var e=i.stateNode;if(e===null)return null;var r=ga(e);if(r===null)return null;e=r[t];t:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(i=i.type,r=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!r;break t;default:i=!1}if(i)return null;if(e&&typeof e!="function")throw Error(J(231,t,typeof e));return e}var Bm=!1;if(Hi)try{Bo={},Object.defineProperty(Bo,"passive",{get:function(){Bm=!0}}),window.addEventListener("test",Bo,Bo),window.removeEventListener("test",Bo,Bo)}catch{Bm=!1}var Bo;function Tg(i,t,e,r,o,s,l,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(e,u)}catch(m){this.onError(m)}}var Ns=!1,Nl=null,Zl=!1,Cm=null,Pg={onError:function(i){Ns=!0,Nl=i}};function Dg(i,t,e,r,o,s,l,a,c){Ns=!1,Nl=null,Tg.apply(Pg,arguments)}function Mg(i,t,e,r,o,s,l,a,c){if(Dg.apply(this,arguments),Ns){if(Ns){var u=Nl;Ns=!1,Nl=null}else throw Error(J(198));Zl||(Zl=!0,Cm=u)}}function mo(i){var t=i,e=i;if(i.alternate)for(;t.return;)t=t.return;else{i=t;do t=i,(t.flags&4098)!==0&&(e=t.return),i=t.return;while(i)}return t.tag===3?e:null}function j_(i){if(i.tag===13){var t=i.memoizedState;if(t===null&&(i=i.alternate,i!==null&&(t=i.memoizedState)),t!==null)return t.dehydrated}return null}function Pb(i){if(mo(i)!==i)throw Error(J(188))}function Rg(i){var t=i.alternate;if(!t){if(t=mo(i),t===null)throw Error(J(188));return t!==i?null:i}for(var e=i,r=t;;){var o=e.return;if(o===null)break;var s=o.alternate;if(s===null){if(r=o.return,r!==null){e=r;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===e)return Pb(o),i;if(s===r)return Pb(o),t;s=s.sibling}throw Error(J(188))}if(e.return!==r.return)e=o,r=s;else{for(var l=!1,a=o.child;a;){if(a===e){l=!0,e=o,r=s;break}if(a===r){l=!0,r=o,e=s;break}a=a.sibling}if(!l){for(a=s.child;a;){if(a===e){l=!0,e=s,r=o;break}if(a===r){l=!0,r=s,e=o;break}a=a.sibling}if(!l)throw Error(J(189))}}if(e.alternate!==r)throw Error(J(190))}if(e.tag!==3)throw Error(J(188));return e.stateNode.current===e?i:t}function X_(i){return i=Rg(i),i!==null?H_(i):null}function H_(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var t=H_(i);if(t!==null)return t;i=i.sibling}return null}var O_=Ye.unstable_scheduleCallback,Db=Ye.unstable_cancelCallback,kg=Ye.unstable_shouldYield,Fg=Ye.unstable_requestPaint,Jt=Ye.unstable_now,Ig=Ye.unstable_getCurrentPriorityLevel,cp=Ye.unstable_ImmediatePriority,N_=Ye.unstable_UserBlockingPriority,Ql=Ye.unstable_NormalPriority,Lg=Ye.unstable_LowPriority,Z_=Ye.unstable_IdlePriority,ba=null,Pi=null;function Gg(i){if(Pi&&typeof Pi.onCommitFiberRoot=="function")try{Pi.onCommitFiberRoot(ba,i,void 0,(i.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:Ug,Vg=Math.log,Eg=Math.LN2;function Ug(i){return i>>>=0,i===0?32:31-(Vg(i)/Eg|0)|0}var gl=64,Sl=4194304;function Xs(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function ql(i,t){var e=i.pendingLanes;if(e===0)return 0;var r=0,o=i.suspendedLanes,s=i.pingedLanes,l=e&268435455;if(l!==0){var a=l&~o;a!==0?r=Xs(a):(s&=l,s!==0&&(r=Xs(s)))}else l=e&~o,l!==0?r=Xs(l):s!==0&&(r=Xs(s));if(r===0)return 0;if(t!==0&&t!==r&&(t&o)===0&&(o=r&-r,s=t&-t,o>=s||o===16&&(s&4194240)!==0))return t;if((r&4)!==0&&(r|=e&16),t=i.entangledLanes,t!==0)for(i=i.entanglements,t&=r;0<t;)e=31-di(t),o=1<<e,r|=i[e],t&=~o;return r}function Yg(i,t){switch(i){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jg(i,t){for(var e=i.suspendedLanes,r=i.pingedLanes,o=i.expirationTimes,s=i.pendingLanes;0<s;){var l=31-di(s),a=1<<l,c=o[l];c===-1?((a&e)===0||(a&r)!==0)&&(o[l]=Yg(a,t)):c<=t&&(i.expiredLanes|=a),s&=~a}}function Am(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Q_(){var i=gl;return gl<<=1,(gl&4194240)===0&&(gl=64),i}function Ou(i){for(var t=[],e=0;31>e;e++)t.push(i);return t}function xn(i,t,e){i.pendingLanes|=t,t!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,t=31-di(t),i[t]=e}function zg(i,t){var e=i.pendingLanes&~t;i.pendingLanes=t,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=t,i.mutableReadLanes&=t,i.entangledLanes&=t,t=i.entanglements;var r=i.eventTimes;for(i=i.expirationTimes;0<e;){var o=31-di(e),s=1<<o;t[o]=0,r[o]=-1,i[o]=-1,e&=~s}}function up(i,t){var e=i.entangledLanes|=t;for(i=i.entanglements;e;){var r=31-di(e),o=1<<r;o&t|i[r]&t&&(i[r]|=t),e&=~o}}var ft=0;function q_(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var W_,mp,K_,$_,ty,Tm=!1,wl=[],br=null,_r=null,yr=null,sn=new Map,nn=new Map,pr=[],jg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mb(i,t){switch(i){case"focusin":case"focusout":br=null;break;case"dragenter":case"dragleave":_r=null;break;case"mouseover":case"mouseout":yr=null;break;case"pointerover":case"pointerout":sn.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":nn.delete(t.pointerId)}}function Ls(i,t,e,r,o,s){return i===null||i.nativeEvent!==s?(i={blockedOn:t,domEventName:e,eventSystemFlags:r,nativeEvent:s,targetContainers:[o]},t!==null&&(t=Sn(t),t!==null&&mp(t)),i):(i.eventSystemFlags|=r,t=i.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),i)}function Xg(i,t,e,r,o){switch(t){case"focusin":return br=Ls(br,i,t,e,r,o),!0;case"dragenter":return _r=Ls(_r,i,t,e,r,o),!0;case"mouseover":return yr=Ls(yr,i,t,e,r,o),!0;case"pointerover":var s=o.pointerId;return sn.set(s,Ls(sn.get(s)||null,i,t,e,r,o)),!0;case"gotpointercapture":return s=o.pointerId,nn.set(s,Ls(nn.get(s)||null,i,t,e,r,o)),!0}return!1}function ey(i){var t=to(i.target);if(t!==null){var e=mo(t);if(e!==null){if(t=e.tag,t===13){if(t=j_(e),t!==null){i.blockedOn=t,ty(i.priority,function(){K_(e)});return}}else if(t===3&&e.stateNode.current.memoizedState.isDehydrated){i.blockedOn=e.tag===3?e.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Gl(i){if(i.blockedOn!==null)return!1;for(var t=i.targetContainers;0<t.length;){var e=Pm(i.domEventName,i.eventSystemFlags,t[0],i.nativeEvent);if(e===null){e=i.nativeEvent;var r=new e.constructor(e.type,e);wm=r,e.target.dispatchEvent(r),wm=null}else return t=Sn(e),t!==null&&mp(t),i.blockedOn=e,!1;t.shift()}return!0}function Rb(i,t,e){Gl(i)&&e.delete(t)}function Hg(){Tm=!1,br!==null&&Gl(br)&&(br=null),_r!==null&&Gl(_r)&&(_r=null),yr!==null&&Gl(yr)&&(yr=null),sn.forEach(Rb),nn.forEach(Rb)}function Gs(i,t){i.blockedOn===t&&(i.blockedOn=null,Tm||(Tm=!0,Ye.unstable_scheduleCallback(Ye.unstable_NormalPriority,Hg)))}function ln(i){function t(o){return Gs(o,i)}if(0<wl.length){Gs(wl[0],i);for(var e=1;e<wl.length;e++){var r=wl[e];r.blockedOn===i&&(r.blockedOn=null)}}for(br!==null&&Gs(br,i),_r!==null&&Gs(_r,i),yr!==null&&Gs(yr,i),sn.forEach(t),nn.forEach(t),e=0;e<pr.length;e++)r=pr[e],r.blockedOn===i&&(r.blockedOn=null);for(;0<pr.length&&(e=pr[0],e.blockedOn===null);)ey(e),e.blockedOn===null&&pr.shift()}var Jo=Qi.ReactCurrentBatchConfig,Wl=!0;function Og(i,t,e,r){var o=ft,s=Jo.transition;Jo.transition=null;try{ft=1,pp(i,t,e,r)}finally{ft=o,Jo.transition=s}}function Ng(i,t,e,r){var o=ft,s=Jo.transition;Jo.transition=null;try{ft=4,pp(i,t,e,r)}finally{ft=o,Jo.transition=s}}function pp(i,t,e,r){if(Wl){var o=Pm(i,t,e,r);if(o===null)$u(i,t,r,Kl,e),Mb(i,r);else if(Xg(o,i,t,e,r))r.stopPropagation();else if(Mb(i,r),t&4&&-1<jg.indexOf(i)){for(;o!==null;){var s=Sn(o);if(s!==null&&W_(s),s=Pm(i,t,e,r),s===null&&$u(i,t,r,Kl,e),s===o)break;o=s}o!==null&&r.stopPropagation()}else $u(i,t,r,null,e)}}var Kl=null;function Pm(i,t,e,r){if(Kl=null,i=ap(r),i=to(i),i!==null)if(t=mo(i),t===null)i=null;else if(e=t.tag,e===13){if(i=j_(t),i!==null)return i;i=null}else if(e===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;i=null}else t!==i&&(i=null);return Kl=i,null}function iy(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ig()){case cp:return 1;case N_:return 4;case Ql:case Lg:return 16;case Z_:return 536870912;default:return 16}default:return 16}}var hr=null,dp=null,Vl=null;function ry(){if(Vl)return Vl;var i,t=dp,e=t.length,r,o="value"in hr?hr.value:hr.textContent,s=o.length;for(i=0;i<e&&t[i]===o[i];i++);var l=e-i;for(r=1;r<=l&&t[e-r]===o[s-r];r++);return Vl=o.slice(i,1<r?1-r:void 0)}function El(i){var t=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&t===13&&(i=13)):i=t,i===10&&(i=13),32<=i||i===13?i:0}function vl(){return!0}function kb(){return!1}function Je(i){function t(e,r,o,s,l){this._reactName=e,this._targetInst=o,this.type=r,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(e=i[a],this[a]=e?e(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?vl:kb,this.isPropagationStopped=kb,this}return Ft(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!="unknown"&&(e.returnValue=!1),this.isDefaultPrevented=vl)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!="unknown"&&(e.cancelBubble=!0),this.isPropagationStopped=vl)},persist:function(){},isPersistent:vl}),t}var Wo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hp=Je(Wo),gn=Ft({},Wo,{view:0,detail:0}),Zg=Je(gn),Nu,Zu,Vs,_a=Ft({},gn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fp,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Vs&&(Vs&&i.type==="mousemove"?(Nu=i.screenX-Vs.screenX,Zu=i.screenY-Vs.screenY):Zu=Nu=0,Vs=i),Nu)},movementY:function(i){return"movementY"in i?i.movementY:Zu}}),Fb=Je(_a),Qg=Ft({},_a,{dataTransfer:0}),qg=Je(Qg),Wg=Ft({},gn,{relatedTarget:0}),Qu=Je(Wg),Kg=Ft({},Wo,{animationName:0,elapsedTime:0,pseudoElement:0}),$g=Je(Kg),tS=Ft({},Wo,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),eS=Je(tS),iS=Ft({},Wo,{data:0}),Ib=Je(iS),rS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nS(i){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(i):(i=sS[i])?!!t[i]:!1}function fp(){return nS}var lS=Ft({},gn,{key:function(i){if(i.key){var t=rS[i.key]||i.key;if(t!=="Unidentified")return t}return i.type==="keypress"?(i=El(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?oS[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fp,charCode:function(i){return i.type==="keypress"?El(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?El(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),aS=Je(lS),cS=Ft({},_a,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lb=Je(cS),uS=Ft({},gn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fp}),mS=Je(uS),pS=Ft({},Wo,{propertyName:0,elapsedTime:0,pseudoElement:0}),dS=Je(pS),hS=Ft({},_a,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),fS=Je(hS),bS=[9,13,27,32],bp=Hi&&"CompositionEvent"in window,Zs=null;Hi&&"documentMode"in document&&(Zs=document.documentMode);var _S=Hi&&"TextEvent"in window&&!Zs,oy=Hi&&(!bp||Zs&&8<Zs&&11>=Zs),Gb=" ",Vb=!1;function sy(i,t){switch(i){case"keyup":return bS.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ny(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Po=!1;function yS(i,t){switch(i){case"compositionend":return ny(t);case"keypress":return t.which!==32?null:(Vb=!0,Gb);case"textInput":return i=t.data,i===Gb&&Vb?null:i;default:return null}}function xS(i,t){if(Po)return i==="compositionend"||!bp&&sy(i,t)?(i=ry(),Vl=dp=hr=null,Po=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return oy&&t.locale!=="ko"?null:t.data;default:return null}}var gS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eb(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t==="input"?!!gS[i.type]:t==="textarea"}function ly(i,t,e,r){E_(r),t=$l(t,"onChange"),0<t.length&&(e=new hp("onChange","change",null,e,r),i.push({event:e,listeners:t}))}var Qs=null,an=null;function SS(i){yy(i,0)}function ya(i){var t=Ro(i);if(R_(t))return i}function wS(i,t){if(i==="change")return t}var ay=!1;Hi&&(Hi?(Cl="oninput"in document,Cl||(qu=document.createElement("div"),qu.setAttribute("oninput","return;"),Cl=typeof qu.oninput=="function"),Bl=Cl):Bl=!1,ay=Bl&&(!document.documentMode||9<document.documentMode));var Bl,Cl,qu;function Ub(){Qs&&(Qs.detachEvent("onpropertychange",cy),an=Qs=null)}function cy(i){if(i.propertyName==="value"&&ya(an)){var t=[];ly(t,an,i,ap(i)),z_(SS,t)}}function vS(i,t,e){i==="focusin"?(Ub(),Qs=t,an=e,Qs.attachEvent("onpropertychange",cy)):i==="focusout"&&Ub()}function BS(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ya(an)}function CS(i,t){if(i==="click")return ya(t)}function AS(i,t){if(i==="input"||i==="change")return ya(t)}function TS(i,t){return i===t&&(i!==0||1/i===1/t)||i!==i&&t!==t}var fi=typeof Object.is=="function"?Object.is:TS;function cn(i,t){if(fi(i,t))return!0;if(typeof i!="object"||i===null||typeof t!="object"||t===null)return!1;var e=Object.keys(i),r=Object.keys(t);if(e.length!==r.length)return!1;for(r=0;r<e.length;r++){var o=e[r];if(!um.call(t,o)||!fi(i[o],t[o]))return!1}return!0}function Yb(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Jb(i,t){var e=Yb(i);i=0;for(var r;e;){if(e.nodeType===3){if(r=i+e.textContent.length,i<=t&&r>=t)return{node:e,offset:t-i};i=r}t:{for(;e;){if(e.nextSibling){e=e.nextSibling;break t}e=e.parentNode}e=void 0}e=Yb(e)}}function uy(i,t){return i&&t?i===t?!0:i&&i.nodeType===3?!1:t&&t.nodeType===3?uy(i,t.parentNode):"contains"in i?i.contains(t):i.compareDocumentPosition?!!(i.compareDocumentPosition(t)&16):!1:!1}function my(){for(var i=window,t=Ol();t instanceof i.HTMLIFrameElement;){try{var e=typeof t.contentWindow.location.href=="string"}catch{e=!1}if(e)i=t.contentWindow;else break;t=Ol(i.document)}return t}function _p(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t&&(t==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||t==="textarea"||i.contentEditable==="true")}function PS(i){var t=my(),e=i.focusedElem,r=i.selectionRange;if(t!==e&&e&&e.ownerDocument&&uy(e.ownerDocument.documentElement,e)){if(r!==null&&_p(e)){if(t=r.start,i=r.end,i===void 0&&(i=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(i,e.value.length);else if(i=(t=e.ownerDocument||document)&&t.defaultView||window,i.getSelection){i=i.getSelection();var o=e.textContent.length,s=Math.min(r.start,o);r=r.end===void 0?s:Math.min(r.end,o),!i.extend&&s>r&&(o=r,r=s,s=o),o=Jb(e,s);var l=Jb(e,r);o&&l&&(i.rangeCount!==1||i.anchorNode!==o.node||i.anchorOffset!==o.offset||i.focusNode!==l.node||i.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),i.removeAllRanges(),s>r?(i.addRange(t),i.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),i.addRange(t)))}}for(t=[],i=e;i=i.parentNode;)i.nodeType===1&&t.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof e.focus=="function"&&e.focus(),e=0;e<t.length;e++)i=t[e],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var DS=Hi&&"documentMode"in document&&11>=document.documentMode,Do=null,Dm=null,qs=null,Mm=!1;function zb(i,t,e){var r=e.window===e?e.document:e.nodeType===9?e:e.ownerDocument;Mm||Do==null||Do!==Ol(r)||(r=Do,"selectionStart"in r&&_p(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),qs&&cn(qs,r)||(qs=r,r=$l(Dm,"onSelect"),0<r.length&&(t=new hp("onSelect","select",null,t,e),i.push({event:t,listeners:r}),t.target=Do)))}function Al(i,t){var e={};return e[i.toLowerCase()]=t.toLowerCase(),e["Webkit"+i]="webkit"+t,e["Moz"+i]="moz"+t,e}var Mo={animationend:Al("Animation","AnimationEnd"),animationiteration:Al("Animation","AnimationIteration"),animationstart:Al("Animation","AnimationStart"),transitionend:Al("Transition","TransitionEnd")},Wu={},py={};Hi&&(py=document.createElement("div").style,"AnimationEvent"in window||(delete Mo.animationend.animation,delete Mo.animationiteration.animation,delete Mo.animationstart.animation),"TransitionEvent"in window||delete Mo.transitionend.transition);function xa(i){if(Wu[i])return Wu[i];if(!Mo[i])return i;var t=Mo[i],e;for(e in t)if(t.hasOwnProperty(e)&&e in py)return Wu[i]=t[e];return i}var dy=xa("animationend"),hy=xa("animationiteration"),fy=xa("animationstart"),by=xa("transitionend"),_y=new Map,jb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ar(i,t){_y.set(i,t),uo(t,[i])}for(Tl=0;Tl<jb.length;Tl++)Pl=jb[Tl],Xb=Pl.toLowerCase(),Hb=Pl[0].toUpperCase()+Pl.slice(1),Ar(Xb,"on"+Hb);var Pl,Xb,Hb,Tl;Ar(dy,"onAnimationEnd");Ar(hy,"onAnimationIteration");Ar(fy,"onAnimationStart");Ar("dblclick","onDoubleClick");Ar("focusin","onFocus");Ar("focusout","onBlur");Ar(by,"onTransitionEnd");Xo("onMouseEnter",["mouseout","mouseover"]);Xo("onMouseLeave",["mouseout","mouseover"]);Xo("onPointerEnter",["pointerout","pointerover"]);Xo("onPointerLeave",["pointerout","pointerover"]);uo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));uo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));uo("onBeforeInput",["compositionend","keypress","textInput","paste"]);uo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));uo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hs));function Ob(i,t,e){var r=i.type||"unknown-event";i.currentTarget=e,Mg(r,t,void 0,i),i.currentTarget=null}function yy(i,t){t=(t&4)!==0;for(var e=0;e<i.length;e++){var r=i[e],o=r.event;r=r.listeners;t:{var s=void 0;if(t)for(var l=r.length-1;0<=l;l--){var a=r[l],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==s&&o.isPropagationStopped())break t;Ob(o,a,u),s=c}else for(l=0;l<r.length;l++){if(a=r[l],c=a.instance,u=a.currentTarget,a=a.listener,c!==s&&o.isPropagationStopped())break t;Ob(o,a,u),s=c}}}if(Zl)throw i=Cm,Zl=!1,Cm=null,i}function vt(i,t){var e=t[Lm];e===void 0&&(e=t[Lm]=new Set);var r=i+"__bubble";e.has(r)||(xy(t,i,2,!1),e.add(r))}function Ku(i,t,e){var r=0;t&&(r|=4),xy(e,i,r,t)}var Dl="_reactListening"+Math.random().toString(36).slice(2);function un(i){if(!i[Dl]){i[Dl]=!0,A_.forEach(function(e){e!=="selectionchange"&&(MS.has(e)||Ku(e,!1,i),Ku(e,!0,i))});var t=i.nodeType===9?i:i.ownerDocument;t===null||t[Dl]||(t[Dl]=!0,Ku("selectionchange",!1,t))}}function xy(i,t,e,r){switch(iy(t)){case 1:var o=Og;break;case 4:o=Ng;break;default:o=pp}e=o.bind(null,t,e,i),o=void 0,!Bm||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?i.addEventListener(t,e,{capture:!0,passive:o}):i.addEventListener(t,e,!0):o!==void 0?i.addEventListener(t,e,{passive:o}):i.addEventListener(t,e,!1)}function $u(i,t,e,r,o){var s=r;if((t&1)===0&&(t&2)===0&&r!==null)t:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(l===4)for(l=r.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===o||c.nodeType===8&&c.parentNode===o))return;l=l.return}for(;a!==null;){if(l=to(a),l===null)return;if(c=l.tag,c===5||c===6){r=s=l;continue t}a=a.parentNode}}r=r.return}z_(function(){var u=s,m=ap(e),p=[];t:{var d=_y.get(i);if(d!==void 0){var h=hp,f=i;switch(i){case"keypress":if(El(e)===0)break t;case"keydown":case"keyup":h=aS;break;case"focusin":f="focus",h=Qu;break;case"focusout":f="blur",h=Qu;break;case"beforeblur":case"afterblur":h=Qu;break;case"click":if(e.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Fb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=qg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=mS;break;case dy:case hy:case fy:h=$g;break;case by:h=dS;break;case"scroll":h=Zg;break;case"wheel":h=fS;break;case"copy":case"cut":case"paste":h=eS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Lb}var b=(t&4)!==0,x=!b&&i==="scroll",_=b?d!==null?d+"Capture":null:d;b=[];for(var y=u,g;y!==null;){g=y;var S=g.stateNode;if(g.tag===5&&S!==null&&(g=S,_!==null&&(S=on(y,_),S!=null&&b.push(mn(y,S,g)))),x)break;y=y.return}0<b.length&&(d=new h(d,f,null,e,m),p.push({event:d,listeners:b}))}}if((t&7)===0){t:{if(d=i==="mouseover"||i==="pointerover",h=i==="mouseout"||i==="pointerout",d&&e!==wm&&(f=e.relatedTarget||e.fromElement)&&(to(f)||f[Oi]))break t;if((h||d)&&(d=m.window===m?m:(d=m.ownerDocument)?d.defaultView||d.parentWindow:window,h?(f=e.relatedTarget||e.toElement,h=u,f=f?to(f):null,f!==null&&(x=mo(f),f!==x||f.tag!==5&&f.tag!==6)&&(f=null)):(h=null,f=u),h!==f)){if(b=Fb,S="onMouseLeave",_="onMouseEnter",y="mouse",(i==="pointerout"||i==="pointerover")&&(b=Lb,S="onPointerLeave",_="onPointerEnter",y="pointer"),x=h==null?d:Ro(h),g=f==null?d:Ro(f),d=new b(S,y+"leave",h,e,m),d.target=x,d.relatedTarget=g,S=null,to(m)===u&&(b=new b(_,y+"enter",f,e,m),b.target=g,b.relatedTarget=x,S=b),x=S,h&&f)e:{for(b=h,_=f,y=0,g=b;g;g=Co(g))y++;for(g=0,S=_;S;S=Co(S))g++;for(;0<y-g;)b=Co(b),y--;for(;0<g-y;)_=Co(_),g--;for(;y--;){if(b===_||_!==null&&b===_.alternate)break e;b=Co(b),_=Co(_)}b=null}else b=null;h!==null&&Nb(p,d,h,b,!1),f!==null&&x!==null&&Nb(p,x,f,b,!0)}}t:{if(d=u?Ro(u):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var w=wS;else if(Eb(d))if(ay)w=AS;else{w=BS;var B=vS}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(w=CS);if(w&&(w=w(i,u))){ly(p,w,e,m);break t}B&&B(i,d,u),i==="focusout"&&(B=d._wrapperState)&&B.controlled&&d.type==="number"&&_m(d,"number",d.value)}switch(B=u?Ro(u):window,i){case"focusin":(Eb(B)||B.contentEditable==="true")&&(Do=B,Dm=u,qs=null);break;case"focusout":qs=Dm=Do=null;break;case"mousedown":Mm=!0;break;case"contextmenu":case"mouseup":case"dragend":Mm=!1,zb(p,e,m);break;case"selectionchange":if(DS)break;case"keydown":case"keyup":zb(p,e,m)}var C;if(bp)t:{switch(i){case"compositionstart":var A="onCompositionStart";break t;case"compositionend":A="onCompositionEnd";break t;case"compositionupdate":A="onCompositionUpdate";break t}A=void 0}else Po?sy(i,e)&&(A="onCompositionEnd"):i==="keydown"&&e.keyCode===229&&(A="onCompositionStart");A&&(oy&&e.locale!=="ko"&&(Po||A!=="onCompositionStart"?A==="onCompositionEnd"&&Po&&(C=ry()):(hr=m,dp="value"in hr?hr.value:hr.textContent,Po=!0)),B=$l(u,A),0<B.length&&(A=new Ib(A,i,null,e,m),p.push({event:A,listeners:B}),C?A.data=C:(C=ny(e),C!==null&&(A.data=C)))),(C=_S?yS(i,e):xS(i,e))&&(u=$l(u,"onBeforeInput"),0<u.length&&(m=new Ib("onBeforeInput","beforeinput",null,e,m),p.push({event:m,listeners:u}),m.data=C))}yy(p,t)})}function mn(i,t,e){return{instance:i,listener:t,currentTarget:e}}function $l(i,t){for(var e=t+"Capture",r=[];i!==null;){var o=i,s=o.stateNode;o.tag===5&&s!==null&&(o=s,s=on(i,e),s!=null&&r.unshift(mn(i,s,o)),s=on(i,t),s!=null&&r.push(mn(i,s,o))),i=i.return}return r}function Co(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Nb(i,t,e,r,o){for(var s=t._reactName,l=[];e!==null&&e!==r;){var a=e,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,o?(c=on(e,s),c!=null&&l.unshift(mn(e,c,a))):o||(c=on(e,s),c!=null&&l.push(mn(e,c,a)))),e=e.return}l.length!==0&&i.push({event:t,listeners:l})}var RS=/\r\n?/g,kS=/\u0000|\uFFFD/g;function Zb(i){return(typeof i=="string"?i:""+i).replace(RS,`
`).replace(kS,"")}function Ml(i,t,e){if(t=Zb(t),Zb(i)!==t&&e)throw Error(J(425))}function ta(){}var Rm=null,km=null;function Fm(i,t){return i==="textarea"||i==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Im=typeof setTimeout=="function"?setTimeout:void 0,FS=typeof clearTimeout=="function"?clearTimeout:void 0,Qb=typeof Promise=="function"?Promise:void 0,IS=typeof queueMicrotask=="function"?queueMicrotask:typeof Qb<"u"?function(i){return Qb.resolve(null).then(i).catch(LS)}:Im;function LS(i){setTimeout(function(){throw i})}function tm(i,t){var e=t,r=0;do{var o=e.nextSibling;if(i.removeChild(e),o&&o.nodeType===8)if(e=o.data,e==="/$"){if(r===0){i.removeChild(o),ln(t);return}r--}else e!=="$"&&e!=="$?"&&e!=="$!"||r++;e=o}while(e);ln(t)}function xr(i){for(;i!=null;i=i.nextSibling){var t=i.nodeType;if(t===1||t===3)break;if(t===8){if(t=i.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return i}function qb(i){i=i.previousSibling;for(var t=0;i;){if(i.nodeType===8){var e=i.data;if(e==="$"||e==="$!"||e==="$?"){if(t===0)return i;t--}else e==="/$"&&t++}i=i.previousSibling}return null}var Ko=Math.random().toString(36).slice(2),Ti="__reactFiber$"+Ko,pn="__reactProps$"+Ko,Oi="__reactContainer$"+Ko,Lm="__reactEvents$"+Ko,GS="__reactListeners$"+Ko,VS="__reactHandles$"+Ko;function to(i){var t=i[Ti];if(t)return t;for(var e=i.parentNode;e;){if(t=e[Oi]||e[Ti]){if(e=t.alternate,t.child!==null||e!==null&&e.child!==null)for(i=qb(i);i!==null;){if(e=i[Ti])return e;i=qb(i)}return t}i=e,e=i.parentNode}return null}function Sn(i){return i=i[Ti]||i[Oi],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ro(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(J(33))}function ga(i){return i[pn]||null}var Gm=[],ko=-1;function Tr(i){return{current:i}}function Bt(i){0>ko||(i.current=Gm[ko],Gm[ko]=null,ko--)}function xt(i,t){ko++,Gm[ko]=i.current,i.current=t}var Cr={},me=Tr(Cr),Pe=Tr(!1),so=Cr;function Ho(i,t){var e=i.type.contextTypes;if(!e)return Cr;var r=i.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},s;for(s in e)o[s]=t[s];return r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=t,i.__reactInternalMemoizedMaskedChildContext=o),o}function De(i){return i=i.childContextTypes,i!=null}function ea(){Bt(Pe),Bt(me)}function Wb(i,t,e){if(me.current!==Cr)throw Error(J(168));xt(me,t),xt(Pe,e)}function gy(i,t,e){var r=i.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return e;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(J(108,vg(i)||"Unknown",o));return Ft({},e,r)}function ia(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Cr,so=me.current,xt(me,i),xt(Pe,Pe.current),!0}function Kb(i,t,e){var r=i.stateNode;if(!r)throw Error(J(169));e?(i=gy(i,t,so),r.__reactInternalMemoizedMergedChildContext=i,Bt(Pe),Bt(me),xt(me,i)):Bt(Pe),xt(Pe,e)}var Ji=null,Sa=!1,em=!1;function Sy(i){Ji===null?Ji=[i]:Ji.push(i)}function ES(i){Sa=!0,Sy(i)}function Pr(){if(!em&&Ji!==null){em=!0;var i=0,t=ft;try{var e=Ji;for(ft=1;i<e.length;i++){var r=e[i];do r=r(!0);while(r!==null)}Ji=null,Sa=!1}catch(o){throw Ji!==null&&(Ji=Ji.slice(i+1)),O_(cp,Pr),o}finally{ft=t,em=!1}}return null}var Fo=[],Io=0,ra=null,oa=0,qe=[],We=0,no=null,zi=1,ji="";function Kr(i,t){Fo[Io++]=oa,Fo[Io++]=ra,ra=i,oa=t}function wy(i,t,e){qe[We++]=zi,qe[We++]=ji,qe[We++]=no,no=i;var r=zi;i=ji;var o=32-di(r)-1;r&=~(1<<o),e+=1;var s=32-di(t)+o;if(30<s){var l=o-o%5;s=(r&(1<<l)-1).toString(32),r>>=l,o-=l,zi=1<<32-di(t)+o|e<<o|r,ji=s+i}else zi=1<<s|e<<o|r,ji=i}function yp(i){i.return!==null&&(Kr(i,1),wy(i,1,0))}function xp(i){for(;i===ra;)ra=Fo[--Io],Fo[Io]=null,oa=Fo[--Io],Fo[Io]=null;for(;i===no;)no=qe[--We],qe[We]=null,ji=qe[--We],qe[We]=null,zi=qe[--We],qe[We]=null}var Ue=null,Ee=null,Tt=!1,pi=null;function vy(i,t){var e=Ke(5,null,null,0);e.elementType="DELETED",e.stateNode=t,e.return=i,t=i.deletions,t===null?(i.deletions=[e],i.flags|=16):t.push(e)}function $b(i,t){switch(i.tag){case 5:var e=i.type;return t=t.nodeType!==1||e.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(i.stateNode=t,Ue=i,Ee=xr(t.firstChild),!0):!1;case 6:return t=i.pendingProps===""||t.nodeType!==3?null:t,t!==null?(i.stateNode=t,Ue=i,Ee=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(e=no!==null?{id:zi,overflow:ji}:null,i.memoizedState={dehydrated:t,treeContext:e,retryLane:1073741824},e=Ke(18,null,null,0),e.stateNode=t,e.return=i,i.child=e,Ue=i,Ee=null,!0):!1;default:return!1}}function Vm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Em(i){if(Tt){var t=Ee;if(t){var e=t;if(!$b(i,t)){if(Vm(i))throw Error(J(418));t=xr(e.nextSibling);var r=Ue;t&&$b(i,t)?vy(r,e):(i.flags=i.flags&-4097|2,Tt=!1,Ue=i)}}else{if(Vm(i))throw Error(J(418));i.flags=i.flags&-4097|2,Tt=!1,Ue=i}}}function t_(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ue=i}function Rl(i){if(i!==Ue)return!1;if(!Tt)return t_(i),Tt=!0,!1;var t;if((t=i.tag!==3)&&!(t=i.tag!==5)&&(t=i.type,t=t!=="head"&&t!=="body"&&!Fm(i.type,i.memoizedProps)),t&&(t=Ee)){if(Vm(i))throw By(),Error(J(418));for(;t;)vy(i,t),t=xr(t.nextSibling)}if(t_(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));t:{for(i=i.nextSibling,t=0;i;){if(i.nodeType===8){var e=i.data;if(e==="/$"){if(t===0){Ee=xr(i.nextSibling);break t}t--}else e!=="$"&&e!=="$!"&&e!=="$?"||t++}i=i.nextSibling}Ee=null}}else Ee=Ue?xr(i.stateNode.nextSibling):null;return!0}function By(){for(var i=Ee;i;)i=xr(i.nextSibling)}function Oo(){Ee=Ue=null,Tt=!1}function gp(i){pi===null?pi=[i]:pi.push(i)}var US=Qi.ReactCurrentBatchConfig;function Es(i,t,e){if(i=e.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(e._owner){if(e=e._owner,e){if(e.tag!==1)throw Error(J(309));var r=e.stateNode}if(!r)throw Error(J(147,i));var o=r,s=""+i;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(l){var a=o.refs;l===null?delete a[s]:a[s]=l},t._stringRef=s,t)}if(typeof i!="string")throw Error(J(284));if(!e._owner)throw Error(J(290,i))}return i}function kl(i,t){throw i=Object.prototype.toString.call(t),Error(J(31,i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i))}function e_(i){var t=i._init;return t(i._payload)}function Cy(i){function t(_,y){if(i){var g=_.deletions;g===null?(_.deletions=[y],_.flags|=16):g.push(y)}}function e(_,y){if(!i)return null;for(;y!==null;)t(_,y),y=y.sibling;return null}function r(_,y){for(_=new Map;y!==null;)y.key!==null?_.set(y.key,y):_.set(y.index,y),y=y.sibling;return _}function o(_,y){return _=vr(_,y),_.index=0,_.sibling=null,_}function s(_,y,g){return _.index=g,i?(g=_.alternate,g!==null?(g=g.index,g<y?(_.flags|=2,y):g):(_.flags|=2,y)):(_.flags|=1048576,y)}function l(_){return i&&_.alternate===null&&(_.flags|=2),_}function a(_,y,g,S){return y===null||y.tag!==6?(y=am(g,_.mode,S),y.return=_,y):(y=o(y,g),y.return=_,y)}function c(_,y,g,S){var w=g.type;return w===To?m(_,y,g.props.children,S,g.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ur&&e_(w)===y.type)?(S=o(y,g.props),S.ref=Es(_,y,g),S.return=_,S):(S=Hl(g.type,g.key,g.props,null,_.mode,S),S.ref=Es(_,y,g),S.return=_,S)}function u(_,y,g,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==g.containerInfo||y.stateNode.implementation!==g.implementation?(y=cm(g,_.mode,S),y.return=_,y):(y=o(y,g.children||[]),y.return=_,y)}function m(_,y,g,S,w){return y===null||y.tag!==7?(y=oo(g,_.mode,S,w),y.return=_,y):(y=o(y,g),y.return=_,y)}function p(_,y,g){if(typeof y=="string"&&y!==""||typeof y=="number")return y=am(""+y,_.mode,g),y.return=_,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case _l:return g=Hl(y.type,y.key,y.props,null,_.mode,g),g.ref=Es(_,null,y),g.return=_,g;case Ao:return y=cm(y,_.mode,g),y.return=_,y;case ur:var S=y._init;return p(_,S(y._payload),g)}if(js(y)||Is(y))return y=oo(y,_.mode,g,null),y.return=_,y;kl(_,y)}return null}function d(_,y,g,S){var w=y!==null?y.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return w!==null?null:a(_,y,""+g,S);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case _l:return g.key===w?c(_,y,g,S):null;case Ao:return g.key===w?u(_,y,g,S):null;case ur:return w=g._init,d(_,y,w(g._payload),S)}if(js(g)||Is(g))return w!==null?null:m(_,y,g,S,null);kl(_,g)}return null}function h(_,y,g,S,w){if(typeof S=="string"&&S!==""||typeof S=="number")return _=_.get(g)||null,a(y,_,""+S,w);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case _l:return _=_.get(S.key===null?g:S.key)||null,c(y,_,S,w);case Ao:return _=_.get(S.key===null?g:S.key)||null,u(y,_,S,w);case ur:var B=S._init;return h(_,y,g,B(S._payload),w)}if(js(S)||Is(S))return _=_.get(g)||null,m(y,_,S,w,null);kl(y,S)}return null}function f(_,y,g,S){for(var w=null,B=null,C=y,A=y=0,k=null;C!==null&&A<g.length;A++){C.index>A?(k=C,C=null):k=C.sibling;var M=d(_,C,g[A],S);if(M===null){C===null&&(C=k);break}i&&C&&M.alternate===null&&t(_,C),y=s(M,y,A),B===null?w=M:B.sibling=M,B=M,C=k}if(A===g.length)return e(_,C),Tt&&Kr(_,A),w;if(C===null){for(;A<g.length;A++)C=p(_,g[A],S),C!==null&&(y=s(C,y,A),B===null?w=C:B.sibling=C,B=C);return Tt&&Kr(_,A),w}for(C=r(_,C);A<g.length;A++)k=h(C,_,A,g[A],S),k!==null&&(i&&k.alternate!==null&&C.delete(k.key===null?A:k.key),y=s(k,y,A),B===null?w=k:B.sibling=k,B=k);return i&&C.forEach(function(E){return t(_,E)}),Tt&&Kr(_,A),w}function b(_,y,g,S){var w=Is(g);if(typeof w!="function")throw Error(J(150));if(g=w.call(g),g==null)throw Error(J(151));for(var B=w=null,C=y,A=y=0,k=null,M=g.next();C!==null&&!M.done;A++,M=g.next()){C.index>A?(k=C,C=null):k=C.sibling;var E=d(_,C,M.value,S);if(E===null){C===null&&(C=k);break}i&&C&&E.alternate===null&&t(_,C),y=s(E,y,A),B===null?w=E:B.sibling=E,B=E,C=k}if(M.done)return e(_,C),Tt&&Kr(_,A),w;if(C===null){for(;!M.done;A++,M=g.next())M=p(_,M.value,S),M!==null&&(y=s(M,y,A),B===null?w=M:B.sibling=M,B=M);return Tt&&Kr(_,A),w}for(C=r(_,C);!M.done;A++,M=g.next())M=h(C,_,A,M.value,S),M!==null&&(i&&M.alternate!==null&&C.delete(M.key===null?A:M.key),y=s(M,y,A),B===null?w=M:B.sibling=M,B=M);return i&&C.forEach(function(L){return t(_,L)}),Tt&&Kr(_,A),w}function x(_,y,g,S){if(typeof g=="object"&&g!==null&&g.type===To&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case _l:t:{for(var w=g.key,B=y;B!==null;){if(B.key===w){if(w=g.type,w===To){if(B.tag===7){e(_,B.sibling),y=o(B,g.props.children),y.return=_,_=y;break t}}else if(B.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ur&&e_(w)===B.type){e(_,B.sibling),y=o(B,g.props),y.ref=Es(_,B,g),y.return=_,_=y;break t}e(_,B);break}else t(_,B);B=B.sibling}g.type===To?(y=oo(g.props.children,_.mode,S,g.key),y.return=_,_=y):(S=Hl(g.type,g.key,g.props,null,_.mode,S),S.ref=Es(_,y,g),S.return=_,_=S)}return l(_);case Ao:t:{for(B=g.key;y!==null;){if(y.key===B)if(y.tag===4&&y.stateNode.containerInfo===g.containerInfo&&y.stateNode.implementation===g.implementation){e(_,y.sibling),y=o(y,g.children||[]),y.return=_,_=y;break t}else{e(_,y);break}else t(_,y);y=y.sibling}y=cm(g,_.mode,S),y.return=_,_=y}return l(_);case ur:return B=g._init,x(_,y,B(g._payload),S)}if(js(g))return f(_,y,g,S);if(Is(g))return b(_,y,g,S);kl(_,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,y!==null&&y.tag===6?(e(_,y.sibling),y=o(y,g),y.return=_,_=y):(e(_,y),y=am(g,_.mode,S),y.return=_,_=y),l(_)):e(_,y)}return x}var No=Cy(!0),Ay=Cy(!1),sa=Tr(null),na=null,Lo=null,Sp=null;function wp(){Sp=Lo=na=null}function vp(i){var t=sa.current;Bt(sa),i._currentValue=t}function Um(i,t,e){for(;i!==null;){var r=i.alternate;if((i.childLanes&t)!==t?(i.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),i===e)break;i=i.return}}function zo(i,t){na=i,Sp=Lo=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&t)!==0&&(Te=!0),i.firstContext=null)}function ti(i){var t=i._currentValue;if(Sp!==i)if(i={context:i,memoizedValue:t,next:null},Lo===null){if(na===null)throw Error(J(308));Lo=i,na.dependencies={lanes:0,firstContext:i}}else Lo=Lo.next=i;return t}var eo=null;function Bp(i){eo===null?eo=[i]:eo.push(i)}function Ty(i,t,e,r){var o=t.interleaved;return o===null?(e.next=e,Bp(t)):(e.next=o.next,o.next=e),t.interleaved=e,Ni(i,r)}function Ni(i,t){i.lanes|=t;var e=i.alternate;for(e!==null&&(e.lanes|=t),e=i,i=i.return;i!==null;)i.childLanes|=t,e=i.alternate,e!==null&&(e.childLanes|=t),e=i,i=i.return;return e.tag===3?e.stateNode:null}var mr=!1;function Cp(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Py(i,t){i=i.updateQueue,t.updateQueue===i&&(t.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Xi(i,t){return{eventTime:i,lane:t,tag:0,payload:null,callback:null,next:null}}function gr(i,t,e){var r=i.updateQueue;if(r===null)return null;if(r=r.shared,(ut&2)!==0){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Ni(i,e)}return o=r.interleaved,o===null?(t.next=t,Bp(r)):(t.next=o.next,o.next=t),r.interleaved=t,Ni(i,e)}function Ul(i,t,e){if(t=t.updateQueue,t!==null&&(t=t.shared,(e&4194240)!==0)){var r=t.lanes;r&=i.pendingLanes,e|=r,t.lanes=e,up(i,e)}}function i_(i,t){var e=i.updateQueue,r=i.alternate;if(r!==null&&(r=r.updateQueue,e===r)){var o=null,s=null;if(e=e.firstBaseUpdate,e!==null){do{var l={eventTime:e.eventTime,lane:e.lane,tag:e.tag,payload:e.payload,callback:e.callback,next:null};s===null?o=s=l:s=s.next=l,e=e.next}while(e!==null);s===null?o=s=t:s=s.next=t}else o=s=t;e={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:r.shared,effects:r.effects},i.updateQueue=e;return}i=e.lastBaseUpdate,i===null?e.firstBaseUpdate=t:i.next=t,e.lastBaseUpdate=t}function la(i,t,e,r){var o=i.updateQueue;mr=!1;var s=o.firstBaseUpdate,l=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var c=a,u=c.next;c.next=null,l===null?s=u:l.next=u,l=c;var m=i.alternate;m!==null&&(m=m.updateQueue,a=m.lastBaseUpdate,a!==l&&(a===null?m.firstBaseUpdate=u:a.next=u,m.lastBaseUpdate=c))}if(s!==null){var p=o.baseState;l=0,m=u=c=null,a=s;do{var d=a.lane,h=a.eventTime;if((r&d)===d){m!==null&&(m=m.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var f=i,b=a;switch(d=t,h=e,b.tag){case 1:if(f=b.payload,typeof f=="function"){p=f.call(h,p,d);break t}p=f;break t;case 3:f.flags=f.flags&-65537|128;case 0:if(f=b.payload,d=typeof f=="function"?f.call(h,p,d):f,d==null)break t;p=Ft({},p,d);break t;case 2:mr=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,d=o.effects,d===null?o.effects=[a]:d.push(a))}else h={eventTime:h,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},m===null?(u=m=h,c=p):m=m.next=h,l|=d;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;d=a,a=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(!0);if(m===null&&(c=p),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=m,t=o.shared.interleaved,t!==null){o=t;do l|=o.lane,o=o.next;while(o!==t)}else s===null&&(o.shared.lanes=0);ao|=l,i.lanes=l,i.memoizedState=p}}function r_(i,t,e){if(i=t.effects,t.effects=null,i!==null)for(t=0;t<i.length;t++){var r=i[t],o=r.callback;if(o!==null){if(r.callback=null,r=e,typeof o!="function")throw Error(J(191,o));o.call(r)}}}var wn={},Di=Tr(wn),dn=Tr(wn),hn=Tr(wn);function io(i){if(i===wn)throw Error(J(174));return i}function Ap(i,t){switch(xt(hn,t),xt(dn,i),xt(Di,wn),i=t.nodeType,i){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:xm(null,"");break;default:i=i===8?t.parentNode:t,t=i.namespaceURI||null,i=i.tagName,t=xm(t,i)}Bt(Di),xt(Di,t)}function Zo(){Bt(Di),Bt(dn),Bt(hn)}function Dy(i){io(hn.current);var t=io(Di.current),e=xm(t,i.type);t!==e&&(xt(dn,i),xt(Di,e))}function Tp(i){dn.current===i&&(Bt(Di),Bt(dn))}var Rt=Tr(0);function aa(i){for(var t=i;t!==null;){if(t.tag===13){var e=t.memoizedState;if(e!==null&&(e=e.dehydrated,e===null||e.data==="$?"||e.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var im=[];function Pp(){for(var i=0;i<im.length;i++)im[i]._workInProgressVersionPrimary=null;im.length=0}var Yl=Qi.ReactCurrentDispatcher,rm=Qi.ReactCurrentBatchConfig,lo=0,kt=null,Qt=null,$t=null,ca=!1,Ws=!1,fn=0,YS=0;function ae(){throw Error(J(321))}function Dp(i,t){if(t===null)return!1;for(var e=0;e<t.length&&e<i.length;e++)if(!fi(i[e],t[e]))return!1;return!0}function Mp(i,t,e,r,o,s){if(lo=s,kt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yl.current=i===null||i.memoizedState===null?XS:HS,i=e(r,o),Ws){s=0;do{if(Ws=!1,fn=0,25<=s)throw Error(J(301));s+=1,$t=Qt=null,t.updateQueue=null,Yl.current=OS,i=e(r,o)}while(Ws)}if(Yl.current=ua,t=Qt!==null&&Qt.next!==null,lo=0,$t=Qt=kt=null,ca=!1,t)throw Error(J(300));return i}function Rp(){var i=fn!==0;return fn=0,i}function Ai(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?kt.memoizedState=$t=i:$t=$t.next=i,$t}function ei(){if(Qt===null){var i=kt.alternate;i=i!==null?i.memoizedState:null}else i=Qt.next;var t=$t===null?kt.memoizedState:$t.next;if(t!==null)$t=t,Qt=i;else{if(i===null)throw Error(J(310));Qt=i,i={memoizedState:Qt.memoizedState,baseState:Qt.baseState,baseQueue:Qt.baseQueue,queue:Qt.queue,next:null},$t===null?kt.memoizedState=$t=i:$t=$t.next=i}return $t}function bn(i,t){return typeof t=="function"?t(i):t}function om(i){var t=ei(),e=t.queue;if(e===null)throw Error(J(311));e.lastRenderedReducer=i;var r=Qt,o=r.baseQueue,s=e.pending;if(s!==null){if(o!==null){var l=o.next;o.next=s.next,s.next=l}r.baseQueue=o=s,e.pending=null}if(o!==null){s=o.next,r=r.baseState;var a=l=null,c=null,u=s;do{var m=u.lane;if((lo&m)===m)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:i(r,u.action);else{var p={lane:m,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=p,l=r):c=c.next=p,kt.lanes|=m,ao|=m}u=u.next}while(u!==null&&u!==s);c===null?l=r:c.next=a,fi(r,t.memoizedState)||(Te=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=c,e.lastRenderedState=r}if(i=e.interleaved,i!==null){o=i;do s=o.lane,kt.lanes|=s,ao|=s,o=o.next;while(o!==i)}else o===null&&(e.lanes=0);return[t.memoizedState,e.dispatch]}function sm(i){var t=ei(),e=t.queue;if(e===null)throw Error(J(311));e.lastRenderedReducer=i;var r=e.dispatch,o=e.pending,s=t.memoizedState;if(o!==null){e.pending=null;var l=o=o.next;do s=i(s,l.action),l=l.next;while(l!==o);fi(s,t.memoizedState)||(Te=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),e.lastRenderedState=s}return[s,r]}function My(){}function Ry(i,t){var e=kt,r=ei(),o=t(),s=!fi(r.memoizedState,o);if(s&&(r.memoizedState=o,Te=!0),r=r.queue,kp(Iy.bind(null,e,r,i),[i]),r.getSnapshot!==t||s||$t!==null&&$t.memoizedState.tag&1){if(e.flags|=2048,_n(9,Fy.bind(null,e,r,o,t),void 0,null),te===null)throw Error(J(349));(lo&30)!==0||ky(e,t,o)}return o}function ky(i,t,e){i.flags|=16384,i={getSnapshot:t,value:e},t=kt.updateQueue,t===null?(t={lastEffect:null,stores:null},kt.updateQueue=t,t.stores=[i]):(e=t.stores,e===null?t.stores=[i]:e.push(i))}function Fy(i,t,e,r){t.value=e,t.getSnapshot=r,Ly(t)&&Gy(i)}function Iy(i,t,e){return e(function(){Ly(t)&&Gy(i)})}function Ly(i){var t=i.getSnapshot;i=i.value;try{var e=t();return!fi(i,e)}catch{return!0}}function Gy(i){var t=Ni(i,1);t!==null&&hi(t,i,1,-1)}function o_(i){var t=Ai();return typeof i=="function"&&(i=i()),t.memoizedState=t.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bn,lastRenderedState:i},t.queue=i,i=i.dispatch=jS.bind(null,kt,i),[t.memoizedState,i]}function _n(i,t,e,r){return i={tag:i,create:t,destroy:e,deps:r,next:null},t=kt.updateQueue,t===null?(t={lastEffect:null,stores:null},kt.updateQueue=t,t.lastEffect=i.next=i):(e=t.lastEffect,e===null?t.lastEffect=i.next=i:(r=e.next,e.next=i,i.next=r,t.lastEffect=i)),i}function Vy(){return ei().memoizedState}function Jl(i,t,e,r){var o=Ai();kt.flags|=i,o.memoizedState=_n(1|t,e,void 0,r===void 0?null:r)}function wa(i,t,e,r){var o=ei();r=r===void 0?null:r;var s=void 0;if(Qt!==null){var l=Qt.memoizedState;if(s=l.destroy,r!==null&&Dp(r,l.deps)){o.memoizedState=_n(t,e,s,r);return}}kt.flags|=i,o.memoizedState=_n(1|t,e,s,r)}function s_(i,t){return Jl(8390656,8,i,t)}function kp(i,t){return wa(2048,8,i,t)}function Ey(i,t){return wa(4,2,i,t)}function Uy(i,t){return wa(4,4,i,t)}function Yy(i,t){if(typeof t=="function")return i=i(),t(i),function(){t(null)};if(t!=null)return i=i(),t.current=i,function(){t.current=null}}function Jy(i,t,e){return e=e!=null?e.concat([i]):null,wa(4,4,Yy.bind(null,t,i),e)}function Fp(){}function zy(i,t){var e=ei();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Dp(t,r[1])?r[0]:(e.memoizedState=[i,t],i)}function jy(i,t){var e=ei();t=t===void 0?null:t;var r=e.memoizedState;return r!==null&&t!==null&&Dp(t,r[1])?r[0]:(i=i(),e.memoizedState=[i,t],i)}function Xy(i,t,e){return(lo&21)===0?(i.baseState&&(i.baseState=!1,Te=!0),i.memoizedState=e):(fi(e,t)||(e=Q_(),kt.lanes|=e,ao|=e,i.baseState=!0),t)}function JS(i,t){var e=ft;ft=e!==0&&4>e?e:4,i(!0);var r=rm.transition;rm.transition={};try{i(!1),t()}finally{ft=e,rm.transition=r}}function Hy(){return ei().memoizedState}function zS(i,t,e){var r=wr(i);if(e={lane:r,action:e,hasEagerState:!1,eagerState:null,next:null},Oy(i))Ny(t,e);else if(e=Ty(i,t,e,r),e!==null){var o=ge();hi(e,i,r,o),Zy(e,t,r)}}function jS(i,t,e){var r=wr(i),o={lane:r,action:e,hasEagerState:!1,eagerState:null,next:null};if(Oy(i))Ny(t,o);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var l=t.lastRenderedState,a=s(l,e);if(o.hasEagerState=!0,o.eagerState=a,fi(a,l)){var c=t.interleaved;c===null?(o.next=o,Bp(t)):(o.next=c.next,c.next=o),t.interleaved=o;return}}catch{}finally{}e=Ty(i,t,o,r),e!==null&&(o=ge(),hi(e,i,r,o),Zy(e,t,r))}}function Oy(i){var t=i.alternate;return i===kt||t!==null&&t===kt}function Ny(i,t){Ws=ca=!0;var e=i.pending;e===null?t.next=t:(t.next=e.next,e.next=t),i.pending=t}function Zy(i,t,e){if((e&4194240)!==0){var r=t.lanes;r&=i.pendingLanes,e|=r,t.lanes=e,up(i,e)}}var ua={readContext:ti,useCallback:ae,useContext:ae,useEffect:ae,useImperativeHandle:ae,useInsertionEffect:ae,useLayoutEffect:ae,useMemo:ae,useReducer:ae,useRef:ae,useState:ae,useDebugValue:ae,useDeferredValue:ae,useTransition:ae,useMutableSource:ae,useSyncExternalStore:ae,useId:ae,unstable_isNewReconciler:!1},XS={readContext:ti,useCallback:function(i,t){return Ai().memoizedState=[i,t===void 0?null:t],i},useContext:ti,useEffect:s_,useImperativeHandle:function(i,t,e){return e=e!=null?e.concat([i]):null,Jl(4194308,4,Yy.bind(null,t,i),e)},useLayoutEffect:function(i,t){return Jl(4194308,4,i,t)},useInsertionEffect:function(i,t){return Jl(4,2,i,t)},useMemo:function(i,t){var e=Ai();return t=t===void 0?null:t,i=i(),e.memoizedState=[i,t],i},useReducer:function(i,t,e){var r=Ai();return t=e!==void 0?e(t):t,r.memoizedState=r.baseState=t,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:t},r.queue=i,i=i.dispatch=zS.bind(null,kt,i),[r.memoizedState,i]},useRef:function(i){var t=Ai();return i={current:i},t.memoizedState=i},useState:o_,useDebugValue:Fp,useDeferredValue:function(i){return Ai().memoizedState=i},useTransition:function(){var i=o_(!1),t=i[0];return i=JS.bind(null,i[1]),Ai().memoizedState=i,[t,i]},useMutableSource:function(){},useSyncExternalStore:function(i,t,e){var r=kt,o=Ai();if(Tt){if(e===void 0)throw Error(J(407));e=e()}else{if(e=t(),te===null)throw Error(J(349));(lo&30)!==0||ky(r,t,e)}o.memoizedState=e;var s={value:e,getSnapshot:t};return o.queue=s,s_(Iy.bind(null,r,s,i),[i]),r.flags|=2048,_n(9,Fy.bind(null,r,s,e,t),void 0,null),e},useId:function(){var i=Ai(),t=te.identifierPrefix;if(Tt){var e=ji,r=zi;e=(r&~(1<<32-di(r)-1)).toString(32)+e,t=":"+t+"R"+e,e=fn++,0<e&&(t+="H"+e.toString(32)),t+=":"}else e=YS++,t=":"+t+"r"+e.toString(32)+":";return i.memoizedState=t},unstable_isNewReconciler:!1},HS={readContext:ti,useCallback:zy,useContext:ti,useEffect:kp,useImperativeHandle:Jy,useInsertionEffect:Ey,useLayoutEffect:Uy,useMemo:jy,useReducer:om,useRef:Vy,useState:function(){return om(bn)},useDebugValue:Fp,useDeferredValue:function(i){var t=ei();return Xy(t,Qt.memoizedState,i)},useTransition:function(){var i=om(bn)[0],t=ei().memoizedState;return[i,t]},useMutableSource:My,useSyncExternalStore:Ry,useId:Hy,unstable_isNewReconciler:!1},OS={readContext:ti,useCallback:zy,useContext:ti,useEffect:kp,useImperativeHandle:Jy,useInsertionEffect:Ey,useLayoutEffect:Uy,useMemo:jy,useReducer:sm,useRef:Vy,useState:function(){return sm(bn)},useDebugValue:Fp,useDeferredValue:function(i){var t=ei();return Qt===null?t.memoizedState=i:Xy(t,Qt.memoizedState,i)},useTransition:function(){var i=sm(bn)[0],t=ei().memoizedState;return[i,t]},useMutableSource:My,useSyncExternalStore:Ry,useId:Hy,unstable_isNewReconciler:!1};function ui(i,t){if(i&&i.defaultProps){t=Ft({},t),i=i.defaultProps;for(var e in i)t[e]===void 0&&(t[e]=i[e]);return t}return t}function Ym(i,t,e,r){t=i.memoizedState,e=e(r,t),e=e==null?t:Ft({},t,e),i.memoizedState=e,i.lanes===0&&(i.updateQueue.baseState=e)}var va={isMounted:function(i){return(i=i._reactInternals)?mo(i)===i:!1},enqueueSetState:function(i,t,e){i=i._reactInternals;var r=ge(),o=wr(i),s=Xi(r,o);s.payload=t,e!=null&&(s.callback=e),t=gr(i,s,o),t!==null&&(hi(t,i,o,r),Ul(t,i,o))},enqueueReplaceState:function(i,t,e){i=i._reactInternals;var r=ge(),o=wr(i),s=Xi(r,o);s.tag=1,s.payload=t,e!=null&&(s.callback=e),t=gr(i,s,o),t!==null&&(hi(t,i,o,r),Ul(t,i,o))},enqueueForceUpdate:function(i,t){i=i._reactInternals;var e=ge(),r=wr(i),o=Xi(e,r);o.tag=2,t!=null&&(o.callback=t),t=gr(i,o,r),t!==null&&(hi(t,i,r,e),Ul(t,i,r))}};function n_(i,t,e,r,o,s,l){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(r,s,l):t.prototype&&t.prototype.isPureReactComponent?!cn(e,r)||!cn(o,s):!0}function Qy(i,t,e){var r=!1,o=Cr,s=t.contextType;return typeof s=="object"&&s!==null?s=ti(s):(o=De(t)?so:me.current,r=t.contextTypes,s=(r=r!=null)?Ho(i,o):Cr),t=new t(e,s),i.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=va,i.stateNode=t,t._reactInternals=i,r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=s),t}function l_(i,t,e,r){i=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(e,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(e,r),t.state!==i&&va.enqueueReplaceState(t,t.state,null)}function Jm(i,t,e,r){var o=i.stateNode;o.props=e,o.state=i.memoizedState,o.refs={},Cp(i);var s=t.contextType;typeof s=="object"&&s!==null?o.context=ti(s):(s=De(t)?so:me.current,o.context=Ho(i,s)),o.state=i.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Ym(i,t,s,e),o.state=i.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&va.enqueueReplaceState(o,o.state,null),la(i,e,o,r),o.state=i.memoizedState),typeof o.componentDidMount=="function"&&(i.flags|=4194308)}function Qo(i,t){try{var e="",r=t;do e+=wg(r),r=r.return;while(r);var o=e}catch(s){o=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:t,stack:o,digest:null}}function nm(i,t,e){return{value:i,source:null,stack:e??null,digest:t??null}}function zm(i,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var NS=typeof WeakMap=="function"?WeakMap:Map;function qy(i,t,e){e=Xi(-1,e),e.tag=3,e.payload={element:null};var r=t.value;return e.callback=function(){pa||(pa=!0,Km=r),zm(i,t)},e}function Wy(i,t,e){e=Xi(-1,e),e.tag=3;var r=i.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;e.payload=function(){return r(o)},e.callback=function(){zm(i,t)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(e.callback=function(){zm(i,t),typeof r!="function"&&(Sr===null?Sr=new Set([this]):Sr.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),e}function a_(i,t,e){var r=i.pingCache;if(r===null){r=i.pingCache=new NS;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(e)||(o.add(e),i=lw.bind(null,i,t,e),t.then(i,i))}function c_(i){do{var t;if((t=i.tag===13)&&(t=i.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return i;i=i.return}while(i!==null);return null}function u_(i,t,e,r,o){return(i.mode&1)===0?(i===t?i.flags|=65536:(i.flags|=128,e.flags|=131072,e.flags&=-52805,e.tag===1&&(e.alternate===null?e.tag=17:(t=Xi(-1,1),t.tag=2,gr(e,t,1))),e.lanes|=1),i):(i.flags|=65536,i.lanes=o,i)}var ZS=Qi.ReactCurrentOwner,Te=!1;function xe(i,t,e,r){t.child=i===null?Ay(t,null,e,r):No(t,i.child,e,r)}function m_(i,t,e,r,o){e=e.render;var s=t.ref;return zo(t,o),r=Mp(i,t,e,r,s,o),e=Rp(),i!==null&&!Te?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~o,Zi(i,t,o)):(Tt&&e&&yp(t),t.flags|=1,xe(i,t,r,o),t.child)}function p_(i,t,e,r,o){if(i===null){var s=e.type;return typeof s=="function"&&!Jp(s)&&s.defaultProps===void 0&&e.compare===null&&e.defaultProps===void 0?(t.tag=15,t.type=s,Ky(i,t,s,r,o)):(i=Hl(e.type,null,r,t,t.mode,o),i.ref=t.ref,i.return=t,t.child=i)}if(s=i.child,(i.lanes&o)===0){var l=s.memoizedProps;if(e=e.compare,e=e!==null?e:cn,e(l,r)&&i.ref===t.ref)return Zi(i,t,o)}return t.flags|=1,i=vr(s,r),i.ref=t.ref,i.return=t,t.child=i}function Ky(i,t,e,r,o){if(i!==null){var s=i.memoizedProps;if(cn(s,r)&&i.ref===t.ref)if(Te=!1,t.pendingProps=r=s,(i.lanes&o)!==0)(i.flags&131072)!==0&&(Te=!0);else return t.lanes=i.lanes,Zi(i,t,o)}return jm(i,t,e,r,o)}function $y(i,t,e){var r=t.pendingProps,o=r.children,s=i!==null?i.memoizedState:null;if(r.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(Vo,Ve),Ve|=e;else{if((e&1073741824)===0)return i=s!==null?s.baseLanes|e:e,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:i,cachePool:null,transitions:null},t.updateQueue=null,xt(Vo,Ve),Ve|=i,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:e,xt(Vo,Ve),Ve|=r}else s!==null?(r=s.baseLanes|e,t.memoizedState=null):r=e,xt(Vo,Ve),Ve|=r;return xe(i,t,o,e),t.child}function t2(i,t){var e=t.ref;(i===null&&e!==null||i!==null&&i.ref!==e)&&(t.flags|=512,t.flags|=2097152)}function jm(i,t,e,r,o){var s=De(e)?so:me.current;return s=Ho(t,s),zo(t,o),e=Mp(i,t,e,r,s,o),r=Rp(),i!==null&&!Te?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~o,Zi(i,t,o)):(Tt&&r&&yp(t),t.flags|=1,xe(i,t,e,o),t.child)}function d_(i,t,e,r,o){if(De(e)){var s=!0;ia(t)}else s=!1;if(zo(t,o),t.stateNode===null)zl(i,t),Qy(t,e,r),Jm(t,e,r,o),r=!0;else if(i===null){var l=t.stateNode,a=t.memoizedProps;l.props=a;var c=l.context,u=e.contextType;typeof u=="object"&&u!==null?u=ti(u):(u=De(e)?so:me.current,u=Ho(t,u));var m=e.getDerivedStateFromProps,p=typeof m=="function"||typeof l.getSnapshotBeforeUpdate=="function";p||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==r||c!==u)&&l_(t,l,r,u),mr=!1;var d=t.memoizedState;l.state=d,la(t,r,l,o),c=t.memoizedState,a!==r||d!==c||Pe.current||mr?(typeof m=="function"&&(Ym(t,e,m,r),c=t.memoizedState),(a=mr||n_(t,e,a,r,d,c,u))?(p||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),l.props=r,l.state=c,l.context=u,r=a):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,Py(i,t),a=t.memoizedProps,u=t.type===t.elementType?a:ui(t.type,a),l.props=u,p=t.pendingProps,d=l.context,c=e.contextType,typeof c=="object"&&c!==null?c=ti(c):(c=De(e)?so:me.current,c=Ho(t,c));var h=e.getDerivedStateFromProps;(m=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(a!==p||d!==c)&&l_(t,l,r,c),mr=!1,d=t.memoizedState,l.state=d,la(t,r,l,o);var f=t.memoizedState;a!==p||d!==f||Pe.current||mr?(typeof h=="function"&&(Ym(t,e,h,r),f=t.memoizedState),(u=mr||n_(t,e,u,r,d,f,c)||!1)?(m||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,f,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,f,c)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),l.props=r,l.state=f,l.context=c,r=u):(typeof l.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(t.flags|=1024),r=!1)}return Xm(i,t,e,r,s,o)}function Xm(i,t,e,r,o,s){t2(i,t);var l=(t.flags&128)!==0;if(!r&&!l)return o&&Kb(t,e,!1),Zi(i,t,s);r=t.stateNode,ZS.current=t;var a=l&&typeof e.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,i!==null&&l?(t.child=No(t,i.child,null,s),t.child=No(t,null,a,s)):xe(i,t,a,s),t.memoizedState=r.state,o&&Kb(t,e,!0),t.child}function e2(i){var t=i.stateNode;t.pendingContext?Wb(i,t.pendingContext,t.pendingContext!==t.context):t.context&&Wb(i,t.context,!1),Ap(i,t.containerInfo)}function h_(i,t,e,r,o){return Oo(),gp(o),t.flags|=256,xe(i,t,e,r),t.child}var Hm={dehydrated:null,treeContext:null,retryLane:0};function Om(i){return{baseLanes:i,cachePool:null,transitions:null}}function i2(i,t,e){var r=t.pendingProps,o=Rt.current,s=!1,l=(t.flags&128)!==0,a;if((a=l)||(a=i!==null&&i.memoizedState===null?!1:(o&2)!==0),a?(s=!0,t.flags&=-129):(i===null||i.memoizedState!==null)&&(o|=1),xt(Rt,o&1),i===null)return Em(t),i=t.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((t.mode&1)===0?t.lanes=1:i.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(l=r.children,i=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},(r&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=l):s=Aa(l,r,0,null),i=oo(i,r,e,null),s.return=t,i.return=t,s.sibling=i,t.child=s,t.child.memoizedState=Om(e),t.memoizedState=Hm,i):Ip(t,l));if(o=i.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return QS(i,t,l,r,a,o,e);if(s){s=r.fallback,l=t.mode,o=i.child,a=o.sibling;var c={mode:"hidden",children:r.children};return(l&1)===0&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=vr(o,c),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?s=vr(a,s):(s=oo(s,l,e,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=i.child.memoizedState,l=l===null?Om(e):{baseLanes:l.baseLanes|e,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=i.childLanes&~e,t.memoizedState=Hm,r}return s=i.child,i=s.sibling,r=vr(s,{mode:"visible",children:r.children}),(t.mode&1)===0&&(r.lanes=e),r.return=t,r.sibling=null,i!==null&&(e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)),t.child=r,t.memoizedState=null,r}function Ip(i,t){return t=Aa({mode:"visible",children:t},i.mode,0,null),t.return=i,i.child=t}function Fl(i,t,e,r){return r!==null&&gp(r),No(t,i.child,null,e),i=Ip(t,t.pendingProps.children),i.flags|=2,t.memoizedState=null,i}function QS(i,t,e,r,o,s,l){if(e)return t.flags&256?(t.flags&=-257,r=nm(Error(J(422))),Fl(i,t,l,r)):t.memoizedState!==null?(t.child=i.child,t.flags|=128,null):(s=r.fallback,o=t.mode,r=Aa({mode:"visible",children:r.children},o,0,null),s=oo(s,o,l,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,(t.mode&1)!==0&&No(t,i.child,null,l),t.child.memoizedState=Om(l),t.memoizedState=Hm,s);if((t.mode&1)===0)return Fl(i,t,l,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(J(419)),r=nm(s,r,void 0),Fl(i,t,l,r)}if(a=(l&i.childLanes)!==0,Te||a){if(r=te,r!==null){switch(l&-l){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(r.suspendedLanes|l))!==0?0:o,o!==0&&o!==s.retryLane&&(s.retryLane=o,Ni(i,o),hi(r,i,o,-1))}return Yp(),r=nm(Error(J(421))),Fl(i,t,l,r)}return o.data==="$?"?(t.flags|=128,t.child=i.child,t=aw.bind(null,i),o._reactRetry=t,null):(i=s.treeContext,Ee=xr(o.nextSibling),Ue=t,Tt=!0,pi=null,i!==null&&(qe[We++]=zi,qe[We++]=ji,qe[We++]=no,zi=i.id,ji=i.overflow,no=t),t=Ip(t,r.children),t.flags|=4096,t)}function f_(i,t,e){i.lanes|=t;var r=i.alternate;r!==null&&(r.lanes|=t),Um(i.return,t,e)}function lm(i,t,e,r,o){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:e,tailMode:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=e,s.tailMode=o)}function r2(i,t,e){var r=t.pendingProps,o=r.revealOrder,s=r.tail;if(xe(i,t,r.children,e),r=Rt.current,(r&2)!==0)r=r&1|2,t.flags|=128;else{if(i!==null&&(i.flags&128)!==0)t:for(i=t.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&f_(i,e,t);else if(i.tag===19)f_(i,e,t);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break t;for(;i.sibling===null;){if(i.return===null||i.return===t)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}r&=1}if(xt(Rt,r),(t.mode&1)===0)t.memoizedState=null;else switch(o){case"forwards":for(e=t.child,o=null;e!==null;)i=e.alternate,i!==null&&aa(i)===null&&(o=e),e=e.sibling;e=o,e===null?(o=t.child,t.child=null):(o=e.sibling,e.sibling=null),lm(t,!1,o,e,s);break;case"backwards":for(e=null,o=t.child,t.child=null;o!==null;){if(i=o.alternate,i!==null&&aa(i)===null){t.child=o;break}i=o.sibling,o.sibling=e,e=o,o=i}lm(t,!0,e,null,s);break;case"together":lm(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zl(i,t){(t.mode&1)===0&&i!==null&&(i.alternate=null,t.alternate=null,t.flags|=2)}function Zi(i,t,e){if(i!==null&&(t.dependencies=i.dependencies),ao|=t.lanes,(e&t.childLanes)===0)return null;if(i!==null&&t.child!==i.child)throw Error(J(153));if(t.child!==null){for(i=t.child,e=vr(i,i.pendingProps),t.child=e,e.return=t;i.sibling!==null;)i=i.sibling,e=e.sibling=vr(i,i.pendingProps),e.return=t;e.sibling=null}return t.child}function qS(i,t,e){switch(t.tag){case 3:e2(t),Oo();break;case 5:Dy(t);break;case 1:De(t.type)&&ia(t);break;case 4:Ap(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;xt(sa,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(xt(Rt,Rt.current&1),t.flags|=128,null):(e&t.child.childLanes)!==0?i2(i,t,e):(xt(Rt,Rt.current&1),i=Zi(i,t,e),i!==null?i.sibling:null);xt(Rt,Rt.current&1);break;case 19:if(r=(e&t.childLanes)!==0,(i.flags&128)!==0){if(r)return r2(i,t,e);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),xt(Rt,Rt.current),r)break;return null;case 22:case 23:return t.lanes=0,$y(i,t,e)}return Zi(i,t,e)}var o2,Nm,s2,n2;o2=function(i,t){for(var e=t.child;e!==null;){if(e.tag===5||e.tag===6)i.appendChild(e.stateNode);else if(e.tag!==4&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return;e=e.return}e.sibling.return=e.return,e=e.sibling}};Nm=function(){};s2=function(i,t,e,r){var o=i.memoizedProps;if(o!==r){i=t.stateNode,io(Di.current);var s=null;switch(e){case"input":o=fm(i,o),r=fm(i,r),s=[];break;case"select":o=Ft({},o,{value:void 0}),r=Ft({},r,{value:void 0}),s=[];break;case"textarea":o=ym(i,o),r=ym(i,r),s=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(i.onclick=ta)}gm(e,r);var l;e=null;for(u in o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var a=o[u];for(l in a)a.hasOwnProperty(l)&&(e||(e={}),e[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(en.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(a=o?.[u],r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(l in a)!a.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(e||(e={}),e[l]="");for(l in c)c.hasOwnProperty(l)&&a[l]!==c[l]&&(e||(e={}),e[l]=c[l])}else e||(s||(s=[]),s.push(u,e)),e=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(en.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&vt("scroll",i),s||a===c||(s=[])):(s=s||[]).push(u,c))}e&&(s=s||[]).push("style",e);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};n2=function(i,t,e,r){e!==r&&(t.flags|=4)};function Us(i,t){if(!Tt)switch(i.tailMode){case"hidden":t=i.tail;for(var e=null;t!==null;)t.alternate!==null&&(e=t),t=t.sibling;e===null?i.tail=null:e.sibling=null;break;case"collapsed":e=i.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t||i.tail===null?i.tail=null:i.tail.sibling=null:r.sibling=null}}function ce(i){var t=i.alternate!==null&&i.alternate.child===i.child,e=0,r=0;if(t)for(var o=i.child;o!==null;)e|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=i,o=o.sibling;else for(o=i.child;o!==null;)e|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=i,o=o.sibling;return i.subtreeFlags|=r,i.childLanes=e,t}function WS(i,t,e){var r=t.pendingProps;switch(xp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ce(t),null;case 1:return De(t.type)&&ea(),ce(t),null;case 3:return r=t.stateNode,Zo(),Bt(Pe),Bt(me),Pp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(i===null||i.child===null)&&(Rl(t)?t.flags|=4:i===null||i.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,pi!==null&&(ep(pi),pi=null))),Nm(i,t),ce(t),null;case 5:Tp(t);var o=io(hn.current);if(e=t.type,i!==null&&t.stateNode!=null)s2(i,t,e,r,o),i.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return ce(t),null}if(i=io(Di.current),Rl(t)){r=t.stateNode,e=t.type;var s=t.memoizedProps;switch(r[Ti]=t,r[pn]=s,i=(t.mode&1)!==0,e){case"dialog":vt("cancel",r),vt("close",r);break;case"iframe":case"object":case"embed":vt("load",r);break;case"video":case"audio":for(o=0;o<Hs.length;o++)vt(Hs[o],r);break;case"source":vt("error",r);break;case"img":case"image":case"link":vt("error",r),vt("load",r);break;case"details":vt("toggle",r);break;case"input":vb(r,s),vt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},vt("invalid",r);break;case"textarea":Cb(r,s),vt("invalid",r)}gm(e,s),o=null;for(var l in s)if(s.hasOwnProperty(l)){var a=s[l];l==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Ml(r.textContent,a,i),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Ml(r.textContent,a,i),o=["children",""+a]):en.hasOwnProperty(l)&&a!=null&&l==="onScroll"&&vt("scroll",r)}switch(e){case"input":yl(r),Bb(r,s,!0);break;case"textarea":yl(r),Ab(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ta)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=o.nodeType===9?o:o.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=I_(e)),i==="http://www.w3.org/1999/xhtml"?e==="script"?(i=l.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof r.is=="string"?i=l.createElement(e,{is:r.is}):(i=l.createElement(e),e==="select"&&(l=i,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):i=l.createElementNS(i,e),i[Ti]=t,i[pn]=r,o2(i,t,!1,!1),t.stateNode=i;t:{switch(l=Sm(e,r),e){case"dialog":vt("cancel",i),vt("close",i),o=r;break;case"iframe":case"object":case"embed":vt("load",i),o=r;break;case"video":case"audio":for(o=0;o<Hs.length;o++)vt(Hs[o],i);o=r;break;case"source":vt("error",i),o=r;break;case"img":case"image":case"link":vt("error",i),vt("load",i),o=r;break;case"details":vt("toggle",i),o=r;break;case"input":vb(i,r),o=fm(i,r),vt("invalid",i);break;case"option":o=r;break;case"select":i._wrapperState={wasMultiple:!!r.multiple},o=Ft({},r,{value:void 0}),vt("invalid",i);break;case"textarea":Cb(i,r),o=ym(i,r),vt("invalid",i);break;default:o=r}gm(e,o),a=o;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?V_(i,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&L_(i,c)):s==="children"?typeof c=="string"?(e!=="textarea"||c!=="")&&rn(i,c):typeof c=="number"&&rn(i,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(en.hasOwnProperty(s)?c!=null&&s==="onScroll"&&vt("scroll",i):c!=null&&op(i,s,c,l))}switch(e){case"input":yl(i),Bb(i,r,!1);break;case"textarea":yl(i),Ab(i);break;case"option":r.value!=null&&i.setAttribute("value",""+Br(r.value));break;case"select":i.multiple=!!r.multiple,s=r.value,s!=null?Eo(i,!!r.multiple,s,!1):r.defaultValue!=null&&Eo(i,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(i.onclick=ta)}switch(e){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break t;case"img":r=!0;break t;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ce(t),null;case 6:if(i&&t.stateNode!=null)n2(i,t,i.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(e=io(hn.current),io(Di.current),Rl(t)){if(r=t.stateNode,e=t.memoizedProps,r[Ti]=t,(s=r.nodeValue!==e)&&(i=Ue,i!==null))switch(i.tag){case 3:Ml(r.nodeValue,e,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Ml(r.nodeValue,e,(i.mode&1)!==0)}s&&(t.flags|=4)}else r=(e.nodeType===9?e:e.ownerDocument).createTextNode(r),r[Ti]=t,t.stateNode=r}return ce(t),null;case 13:if(Bt(Rt),r=t.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Tt&&Ee!==null&&(t.mode&1)!==0&&(t.flags&128)===0)By(),Oo(),t.flags|=98560,s=!1;else if(s=Rl(t),r!==null&&r.dehydrated!==null){if(i===null){if(!s)throw Error(J(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(J(317));s[Ti]=t}else Oo(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;ce(t),s=!1}else pi!==null&&(ep(pi),pi=null),s=!0;if(!s)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=e,t):(r=r!==null,r!==(i!==null&&i.memoizedState!==null)&&r&&(t.child.flags|=8192,(t.mode&1)!==0&&(i===null||(Rt.current&1)!==0?qt===0&&(qt=3):Yp())),t.updateQueue!==null&&(t.flags|=4),ce(t),null);case 4:return Zo(),Nm(i,t),i===null&&un(t.stateNode.containerInfo),ce(t),null;case 10:return vp(t.type._context),ce(t),null;case 17:return De(t.type)&&ea(),ce(t),null;case 19:if(Bt(Rt),s=t.memoizedState,s===null)return ce(t),null;if(r=(t.flags&128)!==0,l=s.rendering,l===null)if(r)Us(s,!1);else{if(qt!==0||i!==null&&(i.flags&128)!==0)for(i=t.child;i!==null;){if(l=aa(i),l!==null){for(t.flags|=128,Us(s,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=e,e=t.child;e!==null;)s=e,i=r,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),e=e.sibling;return xt(Rt,Rt.current&1|2),t.child}i=i.sibling}s.tail!==null&&Jt()>qo&&(t.flags|=128,r=!0,Us(s,!1),t.lanes=4194304)}else{if(!r)if(i=aa(l),i!==null){if(t.flags|=128,r=!0,e=i.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),Us(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!Tt)return ce(t),null}else 2*Jt()-s.renderingStartTime>qo&&e!==1073741824&&(t.flags|=128,r=!0,Us(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(e=s.last,e!==null?e.sibling=l:t.child=l,s.last=l)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Jt(),t.sibling=null,e=Rt.current,xt(Rt,r?e&1|2:e&1),t):(ce(t),null);case 22:case 23:return Up(),r=t.memoizedState!==null,i!==null&&i.memoizedState!==null!==r&&(t.flags|=8192),r&&(t.mode&1)!==0?(Ve&1073741824)!==0&&(ce(t),t.subtreeFlags&6&&(t.flags|=8192)):ce(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function KS(i,t){switch(xp(t),t.tag){case 1:return De(t.type)&&ea(),i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 3:return Zo(),Bt(Pe),Bt(me),Pp(),i=t.flags,(i&65536)!==0&&(i&128)===0?(t.flags=i&-65537|128,t):null;case 5:return Tp(t),null;case 13:if(Bt(Rt),i=t.memoizedState,i!==null&&i.dehydrated!==null){if(t.alternate===null)throw Error(J(340));Oo()}return i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 19:return Bt(Rt),null;case 4:return Zo(),null;case 10:return vp(t.type._context),null;case 22:case 23:return Up(),null;case 24:return null;default:return null}}var Il=!1,ue=!1,$S=typeof WeakSet=="function"?WeakSet:Set,X=null;function Go(i,t){var e=i.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(r){Et(i,t,r)}else e.current=null}function Zm(i,t,e){try{e()}catch(r){Et(i,t,r)}}var b_=!1;function tw(i,t){if(Rm=Wl,i=my(),_p(i)){if("selectionStart"in i)var e={start:i.selectionStart,end:i.selectionEnd};else t:{e=(e=i.ownerDocument)&&e.defaultView||window;var r=e.getSelection&&e.getSelection();if(r&&r.rangeCount!==0){e=r.anchorNode;var o=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{e.nodeType,s.nodeType}catch{e=null;break t}var l=0,a=-1,c=-1,u=0,m=0,p=i,d=null;e:for(;;){for(var h;p!==e||o!==0&&p.nodeType!==3||(a=l+o),p!==s||r!==0&&p.nodeType!==3||(c=l+r),p.nodeType===3&&(l+=p.nodeValue.length),(h=p.firstChild)!==null;)d=p,p=h;for(;;){if(p===i)break e;if(d===e&&++u===o&&(a=l),d===s&&++m===r&&(c=l),(h=p.nextSibling)!==null)break;p=d,d=p.parentNode}p=h}e=a===-1||c===-1?null:{start:a,end:c}}else e=null}e=e||{start:0,end:0}}else e=null;for(km={focusedElem:i,selectionRange:e},Wl=!1,X=t;X!==null;)if(t=X,i=t.child,(t.subtreeFlags&1028)!==0&&i!==null)i.return=t,X=i;else for(;X!==null;){t=X;try{var f=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var b=f.memoizedProps,x=f.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?b:ui(t.type,b),x);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(S){Et(t,t.return,S)}if(i=t.sibling,i!==null){i.return=t.return,X=i;break}X=t.return}return f=b_,b_=!1,f}function Ks(i,t,e){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&i)===i){var s=o.destroy;o.destroy=void 0,s!==void 0&&Zm(t,e,s)}o=o.next}while(o!==r)}}function Ba(i,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var e=t=t.next;do{if((e.tag&i)===i){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}}function Qm(i){var t=i.ref;if(t!==null){var e=i.stateNode;switch(i.tag){case 5:i=e;break;default:i=e}typeof t=="function"?t(i):t.current=i}}function l2(i){var t=i.alternate;t!==null&&(i.alternate=null,l2(t)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(t=i.stateNode,t!==null&&(delete t[Ti],delete t[pn],delete t[Lm],delete t[GS],delete t[VS])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function a2(i){return i.tag===5||i.tag===3||i.tag===4}function __(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||a2(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function qm(i,t,e){var r=i.tag;if(r===5||r===6)i=i.stateNode,t?e.nodeType===8?e.parentNode.insertBefore(i,t):e.insertBefore(i,t):(e.nodeType===8?(t=e.parentNode,t.insertBefore(i,e)):(t=e,t.appendChild(i)),e=e._reactRootContainer,e!=null||t.onclick!==null||(t.onclick=ta));else if(r!==4&&(i=i.child,i!==null))for(qm(i,t,e),i=i.sibling;i!==null;)qm(i,t,e),i=i.sibling}function Wm(i,t,e){var r=i.tag;if(r===5||r===6)i=i.stateNode,t?e.insertBefore(i,t):e.appendChild(i);else if(r!==4&&(i=i.child,i!==null))for(Wm(i,t,e),i=i.sibling;i!==null;)Wm(i,t,e),i=i.sibling}var oe=null,mi=!1;function cr(i,t,e){for(e=e.child;e!==null;)c2(i,t,e),e=e.sibling}function c2(i,t,e){if(Pi&&typeof Pi.onCommitFiberUnmount=="function")try{Pi.onCommitFiberUnmount(ba,e)}catch{}switch(e.tag){case 5:ue||Go(e,t);case 6:var r=oe,o=mi;oe=null,cr(i,t,e),oe=r,mi=o,oe!==null&&(mi?(i=oe,e=e.stateNode,i.nodeType===8?i.parentNode.removeChild(e):i.removeChild(e)):oe.removeChild(e.stateNode));break;case 18:oe!==null&&(mi?(i=oe,e=e.stateNode,i.nodeType===8?tm(i.parentNode,e):i.nodeType===1&&tm(i,e),ln(i)):tm(oe,e.stateNode));break;case 4:r=oe,o=mi,oe=e.stateNode.containerInfo,mi=!0,cr(i,t,e),oe=r,mi=o;break;case 0:case 11:case 14:case 15:if(!ue&&(r=e.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var s=o,l=s.destroy;s=s.tag,l!==void 0&&((s&2)!==0||(s&4)!==0)&&Zm(e,t,l),o=o.next}while(o!==r)}cr(i,t,e);break;case 1:if(!ue&&(Go(e,t),r=e.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=e.memoizedProps,r.state=e.memoizedState,r.componentWillUnmount()}catch(a){Et(e,t,a)}cr(i,t,e);break;case 21:cr(i,t,e);break;case 22:e.mode&1?(ue=(r=ue)||e.memoizedState!==null,cr(i,t,e),ue=r):cr(i,t,e);break;default:cr(i,t,e)}}function y_(i){var t=i.updateQueue;if(t!==null){i.updateQueue=null;var e=i.stateNode;e===null&&(e=i.stateNode=new $S),t.forEach(function(r){var o=cw.bind(null,i,r);e.has(r)||(e.add(r),r.then(o,o))})}}function ci(i,t){var e=t.deletions;if(e!==null)for(var r=0;r<e.length;r++){var o=e[r];try{var s=i,l=t,a=l;t:for(;a!==null;){switch(a.tag){case 5:oe=a.stateNode,mi=!1;break t;case 3:oe=a.stateNode.containerInfo,mi=!0;break t;case 4:oe=a.stateNode.containerInfo,mi=!0;break t}a=a.return}if(oe===null)throw Error(J(160));c2(s,l,o),oe=null,mi=!1;var c=o.alternate;c!==null&&(c.return=null),o.return=null}catch(u){Et(o,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)u2(t,i),t=t.sibling}function u2(i,t){var e=i.alternate,r=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ci(t,i),Ci(i),r&4){try{Ks(3,i,i.return),Ba(3,i)}catch(b){Et(i,i.return,b)}try{Ks(5,i,i.return)}catch(b){Et(i,i.return,b)}}break;case 1:ci(t,i),Ci(i),r&512&&e!==null&&Go(e,e.return);break;case 5:if(ci(t,i),Ci(i),r&512&&e!==null&&Go(e,e.return),i.flags&32){var o=i.stateNode;try{rn(o,"")}catch(b){Et(i,i.return,b)}}if(r&4&&(o=i.stateNode,o!=null)){var s=i.memoizedProps,l=e!==null?e.memoizedProps:s,a=i.type,c=i.updateQueue;if(i.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&k_(o,s),Sm(a,l);var u=Sm(a,s);for(l=0;l<c.length;l+=2){var m=c[l],p=c[l+1];m==="style"?V_(o,p):m==="dangerouslySetInnerHTML"?L_(o,p):m==="children"?rn(o,p):op(o,m,p,u)}switch(a){case"input":bm(o,s);break;case"textarea":F_(o,s);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?Eo(o,!!s.multiple,h,!1):d!==!!s.multiple&&(s.defaultValue!=null?Eo(o,!!s.multiple,s.defaultValue,!0):Eo(o,!!s.multiple,s.multiple?[]:"",!1))}o[pn]=s}catch(b){Et(i,i.return,b)}}break;case 6:if(ci(t,i),Ci(i),r&4){if(i.stateNode===null)throw Error(J(162));o=i.stateNode,s=i.memoizedProps;try{o.nodeValue=s}catch(b){Et(i,i.return,b)}}break;case 3:if(ci(t,i),Ci(i),r&4&&e!==null&&e.memoizedState.isDehydrated)try{ln(t.containerInfo)}catch(b){Et(i,i.return,b)}break;case 4:ci(t,i),Ci(i);break;case 13:ci(t,i),Ci(i),o=i.child,o.flags&8192&&(s=o.memoizedState!==null,o.stateNode.isHidden=s,!s||o.alternate!==null&&o.alternate.memoizedState!==null||(Vp=Jt())),r&4&&y_(i);break;case 22:if(m=e!==null&&e.memoizedState!==null,i.mode&1?(ue=(u=ue)||m,ci(t,i),ue=u):ci(t,i),Ci(i),r&8192){if(u=i.memoizedState!==null,(i.stateNode.isHidden=u)&&!m&&(i.mode&1)!==0)for(X=i,m=i.child;m!==null;){for(p=X=m;X!==null;){switch(d=X,h=d.child,d.tag){case 0:case 11:case 14:case 15:Ks(4,d,d.return);break;case 1:Go(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,e=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(b){Et(r,e,b)}}break;case 5:Go(d,d.return);break;case 22:if(d.memoizedState!==null){g_(p);continue}}h!==null?(h.return=d,X=h):g_(p)}m=m.sibling}t:for(m=null,p=i;;){if(p.tag===5){if(m===null){m=p;try{o=p.stateNode,u?(s=o.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,c=p.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=G_("display",l))}catch(b){Et(i,i.return,b)}}}else if(p.tag===6){if(m===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(b){Et(i,i.return,b)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===i)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===i)break t;for(;p.sibling===null;){if(p.return===null||p.return===i)break t;m===p&&(m=null),p=p.return}m===p&&(m=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ci(t,i),Ci(i),r&4&&y_(i);break;case 21:break;default:ci(t,i),Ci(i)}}function Ci(i){var t=i.flags;if(t&2){try{t:{for(var e=i.return;e!==null;){if(a2(e)){var r=e;break t}e=e.return}throw Error(J(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(rn(o,""),r.flags&=-33);var s=__(i);Wm(i,s,o);break;case 3:case 4:var l=r.stateNode.containerInfo,a=__(i);qm(i,a,l);break;default:throw Error(J(161))}}catch(c){Et(i,i.return,c)}i.flags&=-3}t&4096&&(i.flags&=-4097)}function ew(i,t,e){X=i,m2(i,t,e)}function m2(i,t,e){for(var r=(i.mode&1)!==0;X!==null;){var o=X,s=o.child;if(o.tag===22&&r){var l=o.memoizedState!==null||Il;if(!l){var a=o.alternate,c=a!==null&&a.memoizedState!==null||ue;a=Il;var u=ue;if(Il=l,(ue=c)&&!u)for(X=o;X!==null;)l=X,c=l.child,l.tag===22&&l.memoizedState!==null?S_(o):c!==null?(c.return=l,X=c):S_(o);for(;s!==null;)X=s,m2(s,t,e),s=s.sibling;X=o,Il=a,ue=u}x_(i,t,e)}else(o.subtreeFlags&8772)!==0&&s!==null?(s.return=o,X=s):x_(i,t,e)}}function x_(i){for(;X!==null;){var t=X;if((t.flags&8772)!==0){var e=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:ue||Ba(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ue)if(e===null)r.componentDidMount();else{var o=t.elementType===t.type?e.memoizedProps:ui(t.type,e.memoizedProps);r.componentDidUpdate(o,e.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&r_(t,s,r);break;case 3:var l=t.updateQueue;if(l!==null){if(e=null,t.child!==null)switch(t.child.tag){case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}r_(t,l,e)}break;case 5:var a=t.stateNode;if(e===null&&t.flags&4){e=a;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&e.focus();break;case"img":c.src&&(e.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var m=u.memoizedState;if(m!==null){var p=m.dehydrated;p!==null&&ln(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}ue||t.flags&512&&Qm(t)}catch(d){Et(t,t.return,d)}}if(t===i){X=null;break}if(e=t.sibling,e!==null){e.return=t.return,X=e;break}X=t.return}}function g_(i){for(;X!==null;){var t=X;if(t===i){X=null;break}var e=t.sibling;if(e!==null){e.return=t.return,X=e;break}X=t.return}}function S_(i){for(;X!==null;){var t=X;try{switch(t.tag){case 0:case 11:case 15:var e=t.return;try{Ba(4,t)}catch(c){Et(t,e,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(c){Et(t,o,c)}}var s=t.return;try{Qm(t)}catch(c){Et(t,s,c)}break;case 5:var l=t.return;try{Qm(t)}catch(c){Et(t,l,c)}}}catch(c){Et(t,t.return,c)}if(t===i){X=null;break}var a=t.sibling;if(a!==null){a.return=t.return,X=a;break}X=t.return}}var iw=Math.ceil,ma=Qi.ReactCurrentDispatcher,Lp=Qi.ReactCurrentOwner,$e=Qi.ReactCurrentBatchConfig,ut=0,te=null,Ht=null,se=0,Ve=0,Vo=Tr(0),qt=0,yn=null,ao=0,Ca=0,Gp=0,$s=null,Ae=null,Vp=0,qo=1/0,Yi=null,pa=!1,Km=null,Sr=null,Ll=!1,fr=null,da=0,tn=0,$m=null,jl=-1,Xl=0;function ge(){return(ut&6)!==0?Jt():jl!==-1?jl:jl=Jt()}function wr(i){return(i.mode&1)===0?1:(ut&2)!==0&&se!==0?se&-se:US.transition!==null?(Xl===0&&(Xl=Q_()),Xl):(i=ft,i!==0||(i=window.event,i=i===void 0?16:iy(i.type)),i)}function hi(i,t,e,r){if(50<tn)throw tn=0,$m=null,Error(J(185));xn(i,e,r),((ut&2)===0||i!==te)&&(i===te&&((ut&2)===0&&(Ca|=e),qt===4&&dr(i,se)),Me(i,r),e===1&&ut===0&&(t.mode&1)===0&&(qo=Jt()+500,Sa&&Pr()))}function Me(i,t){var e=i.callbackNode;Jg(i,t);var r=ql(i,i===te?se:0);if(r===0)e!==null&&Db(e),i.callbackNode=null,i.callbackPriority=0;else if(t=r&-r,i.callbackPriority!==t){if(e!=null&&Db(e),t===1)i.tag===0?ES(w_.bind(null,i)):Sy(w_.bind(null,i)),IS(function(){(ut&6)===0&&Pr()}),e=null;else{switch(q_(r)){case 1:e=cp;break;case 4:e=N_;break;case 16:e=Ql;break;case 536870912:e=Z_;break;default:e=Ql}e=x2(e,p2.bind(null,i))}i.callbackPriority=t,i.callbackNode=e}}function p2(i,t){if(jl=-1,Xl=0,(ut&6)!==0)throw Error(J(327));var e=i.callbackNode;if(jo()&&i.callbackNode!==e)return null;var r=ql(i,i===te?se:0);if(r===0)return null;if((r&30)!==0||(r&i.expiredLanes)!==0||t)t=ha(i,r);else{t=r;var o=ut;ut|=2;var s=h2();(te!==i||se!==t)&&(Yi=null,qo=Jt()+500,ro(i,t));do try{sw();break}catch(a){d2(i,a)}while(!0);wp(),ma.current=s,ut=o,Ht!==null?t=0:(te=null,se=0,t=qt)}if(t!==0){if(t===2&&(o=Am(i),o!==0&&(r=o,t=tp(i,o))),t===1)throw e=yn,ro(i,0),dr(i,r),Me(i,Jt()),e;if(t===6)dr(i,r);else{if(o=i.current.alternate,(r&30)===0&&!rw(o)&&(t=ha(i,r),t===2&&(s=Am(i),s!==0&&(r=s,t=tp(i,s))),t===1))throw e=yn,ro(i,0),dr(i,r),Me(i,Jt()),e;switch(i.finishedWork=o,i.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:$r(i,Ae,Yi);break;case 3:if(dr(i,r),(r&130023424)===r&&(t=Vp+500-Jt(),10<t)){if(ql(i,0)!==0)break;if(o=i.suspendedLanes,(o&r)!==r){ge(),i.pingedLanes|=i.suspendedLanes&o;break}i.timeoutHandle=Im($r.bind(null,i,Ae,Yi),t);break}$r(i,Ae,Yi);break;case 4:if(dr(i,r),(r&4194240)===r)break;for(t=i.eventTimes,o=-1;0<r;){var l=31-di(r);s=1<<l,l=t[l],l>o&&(o=l),r&=~s}if(r=o,r=Jt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*iw(r/1960))-r,10<r){i.timeoutHandle=Im($r.bind(null,i,Ae,Yi),r);break}$r(i,Ae,Yi);break;case 5:$r(i,Ae,Yi);break;default:throw Error(J(329))}}}return Me(i,Jt()),i.callbackNode===e?p2.bind(null,i):null}function tp(i,t){var e=$s;return i.current.memoizedState.isDehydrated&&(ro(i,t).flags|=256),i=ha(i,t),i!==2&&(t=Ae,Ae=e,t!==null&&ep(t)),i}function ep(i){Ae===null?Ae=i:Ae.push.apply(Ae,i)}function rw(i){for(var t=i;;){if(t.flags&16384){var e=t.updateQueue;if(e!==null&&(e=e.stores,e!==null))for(var r=0;r<e.length;r++){var o=e[r],s=o.getSnapshot;o=o.value;try{if(!fi(s(),o))return!1}catch{return!1}}}if(e=t.child,t.subtreeFlags&16384&&e!==null)e.return=t,t=e;else{if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function dr(i,t){for(t&=~Gp,t&=~Ca,i.suspendedLanes|=t,i.pingedLanes&=~t,i=i.expirationTimes;0<t;){var e=31-di(t),r=1<<e;i[e]=-1,t&=~r}}function w_(i){if((ut&6)!==0)throw Error(J(327));jo();var t=ql(i,0);if((t&1)===0)return Me(i,Jt()),null;var e=ha(i,t);if(i.tag!==0&&e===2){var r=Am(i);r!==0&&(t=r,e=tp(i,r))}if(e===1)throw e=yn,ro(i,0),dr(i,t),Me(i,Jt()),e;if(e===6)throw Error(J(345));return i.finishedWork=i.current.alternate,i.finishedLanes=t,$r(i,Ae,Yi),Me(i,Jt()),null}function Ep(i,t){var e=ut;ut|=1;try{return i(t)}finally{ut=e,ut===0&&(qo=Jt()+500,Sa&&Pr())}}function co(i){fr!==null&&fr.tag===0&&(ut&6)===0&&jo();var t=ut;ut|=1;var e=$e.transition,r=ft;try{if($e.transition=null,ft=1,i)return i()}finally{ft=r,$e.transition=e,ut=t,(ut&6)===0&&Pr()}}function Up(){Ve=Vo.current,Bt(Vo)}function ro(i,t){i.finishedWork=null,i.finishedLanes=0;var e=i.timeoutHandle;if(e!==-1&&(i.timeoutHandle=-1,FS(e)),Ht!==null)for(e=Ht.return;e!==null;){var r=e;switch(xp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ea();break;case 3:Zo(),Bt(Pe),Bt(me),Pp();break;case 5:Tp(r);break;case 4:Zo();break;case 13:Bt(Rt);break;case 19:Bt(Rt);break;case 10:vp(r.type._context);break;case 22:case 23:Up()}e=e.return}if(te=i,Ht=i=vr(i.current,null),se=Ve=t,qt=0,yn=null,Gp=Ca=ao=0,Ae=$s=null,eo!==null){for(t=0;t<eo.length;t++)if(e=eo[t],r=e.interleaved,r!==null){e.interleaved=null;var o=r.next,s=e.pending;if(s!==null){var l=s.next;s.next=o,r.next=l}e.pending=r}eo=null}return i}function d2(i,t){do{var e=Ht;try{if(wp(),Yl.current=ua,ca){for(var r=kt.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}ca=!1}if(lo=0,$t=Qt=kt=null,Ws=!1,fn=0,Lp.current=null,e===null||e.return===null){qt=1,yn=t,Ht=null;break}t:{var s=i,l=e.return,a=e,c=t;if(t=se,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,m=a,p=m.tag;if((m.mode&1)===0&&(p===0||p===11||p===15)){var d=m.alternate;d?(m.updateQueue=d.updateQueue,m.memoizedState=d.memoizedState,m.lanes=d.lanes):(m.updateQueue=null,m.memoizedState=null)}var h=c_(l);if(h!==null){h.flags&=-257,u_(h,l,a,s,t),h.mode&1&&a_(s,u,t),t=h,c=u;var f=t.updateQueue;if(f===null){var b=new Set;b.add(c),t.updateQueue=b}else f.add(c);break t}else{if((t&1)===0){a_(s,u,t),Yp();break t}c=Error(J(426))}}else if(Tt&&a.mode&1){var x=c_(l);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),u_(x,l,a,s,t),gp(Qo(c,a));break t}}s=c=Qo(c,a),qt!==4&&(qt=2),$s===null?$s=[s]:$s.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var _=qy(s,c,t);i_(s,_);break t;case 1:a=c;var y=s.type,g=s.stateNode;if((s.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Sr===null||!Sr.has(g)))){s.flags|=65536,t&=-t,s.lanes|=t;var S=Wy(s,a,t);i_(s,S);break t}}s=s.return}while(s!==null)}b2(e)}catch(w){t=w,Ht===e&&e!==null&&(Ht=e=e.return);continue}break}while(!0)}function h2(){var i=ma.current;return ma.current=ua,i===null?ua:i}function Yp(){(qt===0||qt===3||qt===2)&&(qt=4),te===null||(ao&268435455)===0&&(Ca&268435455)===0||dr(te,se)}function ha(i,t){var e=ut;ut|=2;var r=h2();(te!==i||se!==t)&&(Yi=null,ro(i,t));do try{ow();break}catch(o){d2(i,o)}while(!0);if(wp(),ut=e,ma.current=r,Ht!==null)throw Error(J(261));return te=null,se=0,qt}function ow(){for(;Ht!==null;)f2(Ht)}function sw(){for(;Ht!==null&&!kg();)f2(Ht)}function f2(i){var t=y2(i.alternate,i,Ve);i.memoizedProps=i.pendingProps,t===null?b2(i):Ht=t,Lp.current=null}function b2(i){var t=i;do{var e=t.alternate;if(i=t.return,(t.flags&32768)===0){if(e=WS(e,t,Ve),e!==null){Ht=e;return}}else{if(e=KS(e,t),e!==null){e.flags&=32767,Ht=e;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{qt=6,Ht=null;return}}if(t=t.sibling,t!==null){Ht=t;return}Ht=t=i}while(t!==null);qt===0&&(qt=5)}function $r(i,t,e){var r=ft,o=$e.transition;try{$e.transition=null,ft=1,nw(i,t,e,r)}finally{$e.transition=o,ft=r}return null}function nw(i,t,e,r){do jo();while(fr!==null);if((ut&6)!==0)throw Error(J(327));e=i.finishedWork;var o=i.finishedLanes;if(e===null)return null;if(i.finishedWork=null,i.finishedLanes=0,e===i.current)throw Error(J(177));i.callbackNode=null,i.callbackPriority=0;var s=e.lanes|e.childLanes;if(zg(i,s),i===te&&(Ht=te=null,se=0),(e.subtreeFlags&2064)===0&&(e.flags&2064)===0||Ll||(Ll=!0,x2(Ql,function(){return jo(),null})),s=(e.flags&15990)!==0,(e.subtreeFlags&15990)!==0||s){s=$e.transition,$e.transition=null;var l=ft;ft=1;var a=ut;ut|=4,Lp.current=null,tw(i,e),u2(e,i),PS(km),Wl=!!Rm,km=Rm=null,i.current=e,ew(e,i,o),Fg(),ut=a,ft=l,$e.transition=s}else i.current=e;if(Ll&&(Ll=!1,fr=i,da=o),s=i.pendingLanes,s===0&&(Sr=null),Gg(e.stateNode,r),Me(i,Jt()),t!==null)for(r=i.onRecoverableError,e=0;e<t.length;e++)o=t[e],r(o.value,{componentStack:o.stack,digest:o.digest});if(pa)throw pa=!1,i=Km,Km=null,i;return(da&1)!==0&&i.tag!==0&&jo(),s=i.pendingLanes,(s&1)!==0?i===$m?tn++:(tn=0,$m=i):tn=0,Pr(),null}function jo(){if(fr!==null){var i=q_(da),t=$e.transition,e=ft;try{if($e.transition=null,ft=16>i?16:i,fr===null)var r=!1;else{if(i=fr,fr=null,da=0,(ut&6)!==0)throw Error(J(331));var o=ut;for(ut|=4,X=i.current;X!==null;){var s=X,l=s.child;if((X.flags&16)!==0){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(X=u;X!==null;){var m=X;switch(m.tag){case 0:case 11:case 15:Ks(8,m,s)}var p=m.child;if(p!==null)p.return=m,X=p;else for(;X!==null;){m=X;var d=m.sibling,h=m.return;if(l2(m),m===u){X=null;break}if(d!==null){d.return=h,X=d;break}X=h}}}var f=s.alternate;if(f!==null){var b=f.child;if(b!==null){f.child=null;do{var x=b.sibling;b.sibling=null,b=x}while(b!==null)}}X=s}}if((s.subtreeFlags&2064)!==0&&l!==null)l.return=s,X=l;else t:for(;X!==null;){if(s=X,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:Ks(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,X=_;break t}X=s.return}}var y=i.current;for(X=y;X!==null;){l=X;var g=l.child;if((l.subtreeFlags&2064)!==0&&g!==null)g.return=l,X=g;else t:for(l=y;X!==null;){if(a=X,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Ba(9,a)}}catch(w){Et(a,a.return,w)}if(a===l){X=null;break t}var S=a.sibling;if(S!==null){S.return=a.return,X=S;break t}X=a.return}}if(ut=o,Pr(),Pi&&typeof Pi.onPostCommitFiberRoot=="function")try{Pi.onPostCommitFiberRoot(ba,i)}catch{}r=!0}return r}finally{ft=e,$e.transition=t}}return!1}function v_(i,t,e){t=Qo(e,t),t=qy(i,t,1),i=gr(i,t,1),t=ge(),i!==null&&(xn(i,1,t),Me(i,t))}function Et(i,t,e){if(i.tag===3)v_(i,i,e);else for(;t!==null;){if(t.tag===3){v_(t,i,e);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Sr===null||!Sr.has(r))){i=Qo(e,i),i=Wy(t,i,1),t=gr(t,i,1),i=ge(),t!==null&&(xn(t,1,i),Me(t,i));break}}t=t.return}}function lw(i,t,e){var r=i.pingCache;r!==null&&r.delete(t),t=ge(),i.pingedLanes|=i.suspendedLanes&e,te===i&&(se&e)===e&&(qt===4||qt===3&&(se&130023424)===se&&500>Jt()-Vp?ro(i,0):Gp|=e),Me(i,t)}function _2(i,t){t===0&&((i.mode&1)===0?t=1:(t=Sl,Sl<<=1,(Sl&130023424)===0&&(Sl=4194304)));var e=ge();i=Ni(i,t),i!==null&&(xn(i,t,e),Me(i,e))}function aw(i){var t=i.memoizedState,e=0;t!==null&&(e=t.retryLane),_2(i,e)}function cw(i,t){var e=0;switch(i.tag){case 13:var r=i.stateNode,o=i.memoizedState;o!==null&&(e=o.retryLane);break;case 19:r=i.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),_2(i,e)}var y2;y2=function(i,t,e){if(i!==null)if(i.memoizedProps!==t.pendingProps||Pe.current)Te=!0;else{if((i.lanes&e)===0&&(t.flags&128)===0)return Te=!1,qS(i,t,e);Te=(i.flags&131072)!==0}else Te=!1,Tt&&(t.flags&1048576)!==0&&wy(t,oa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;zl(i,t),i=t.pendingProps;var o=Ho(t,me.current);zo(t,e),o=Mp(null,t,r,i,o,e);var s=Rp();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,De(r)?(s=!0,ia(t)):s=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Cp(t),o.updater=va,t.stateNode=o,o._reactInternals=t,Jm(t,r,i,e),t=Xm(null,t,r,!0,s,e)):(t.tag=0,Tt&&s&&yp(t),xe(null,t,o,e),t=t.child),t;case 16:r=t.elementType;t:{switch(zl(i,t),i=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=mw(r),i=ui(r,i),o){case 0:t=jm(null,t,r,i,e);break t;case 1:t=d_(null,t,r,i,e);break t;case 11:t=m_(null,t,r,i,e);break t;case 14:t=p_(null,t,r,ui(r.type,i),e);break t}throw Error(J(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ui(r,o),jm(i,t,r,o,e);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ui(r,o),d_(i,t,r,o,e);case 3:t:{if(e2(t),i===null)throw Error(J(387));r=t.pendingProps,s=t.memoizedState,o=s.element,Py(i,t),la(t,r,null,e);var l=t.memoizedState;if(r=l.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){o=Qo(Error(J(423)),t),t=h_(i,t,r,e,o);break t}else if(r!==o){o=Qo(Error(J(424)),t),t=h_(i,t,r,e,o);break t}else for(Ee=xr(t.stateNode.containerInfo.firstChild),Ue=t,Tt=!0,pi=null,e=Ay(t,null,r,e),t.child=e;e;)e.flags=e.flags&-3|4096,e=e.sibling;else{if(Oo(),r===o){t=Zi(i,t,e);break t}xe(i,t,r,e)}t=t.child}return t;case 5:return Dy(t),i===null&&Em(t),r=t.type,o=t.pendingProps,s=i!==null?i.memoizedProps:null,l=o.children,Fm(r,o)?l=null:s!==null&&Fm(r,s)&&(t.flags|=32),t2(i,t),xe(i,t,l,e),t.child;case 6:return i===null&&Em(t),null;case 13:return i2(i,t,e);case 4:return Ap(t,t.stateNode.containerInfo),r=t.pendingProps,i===null?t.child=No(t,null,r,e):xe(i,t,r,e),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ui(r,o),m_(i,t,r,o,e);case 7:return xe(i,t,t.pendingProps,e),t.child;case 8:return xe(i,t,t.pendingProps.children,e),t.child;case 12:return xe(i,t,t.pendingProps.children,e),t.child;case 10:t:{if(r=t.type._context,o=t.pendingProps,s=t.memoizedProps,l=o.value,xt(sa,r._currentValue),r._currentValue=l,s!==null)if(fi(s.value,l)){if(s.children===o.children&&!Pe.current){t=Zi(i,t,e);break t}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){l=s.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=Xi(-1,e&-e),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var m=u.pending;m===null?c.next=c:(c.next=m.next,m.next=c),u.pending=c}}s.lanes|=e,c=s.alternate,c!==null&&(c.lanes|=e),Um(s.return,e,t),a.lanes|=e;break}c=c.next}}else if(s.tag===10)l=s.type===t.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(J(341));l.lanes|=e,a=l.alternate,a!==null&&(a.lanes|=e),Um(l,e,t),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===t){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}xe(i,t,o.children,e),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,zo(t,e),o=ti(o),r=r(o),t.flags|=1,xe(i,t,r,e),t.child;case 14:return r=t.type,o=ui(r,t.pendingProps),o=ui(r.type,o),p_(i,t,r,o,e);case 15:return Ky(i,t,t.type,t.pendingProps,e);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ui(r,o),zl(i,t),t.tag=1,De(r)?(i=!0,ia(t)):i=!1,zo(t,e),Qy(t,r,o),Jm(t,r,o,e),Xm(null,t,r,!0,i,e);case 19:return r2(i,t,e);case 22:return $y(i,t,e)}throw Error(J(156,t.tag))};function x2(i,t){return O_(i,t)}function uw(i,t,e,r){this.tag=i,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ke(i,t,e,r){return new uw(i,t,e,r)}function Jp(i){return i=i.prototype,!(!i||!i.isReactComponent)}function mw(i){if(typeof i=="function")return Jp(i)?1:0;if(i!=null){if(i=i.$$typeof,i===np)return 11;if(i===lp)return 14}return 2}function vr(i,t){var e=i.alternate;return e===null?(e=Ke(i.tag,t,i.key,i.mode),e.elementType=i.elementType,e.type=i.type,e.stateNode=i.stateNode,e.alternate=i,i.alternate=e):(e.pendingProps=t,e.type=i.type,e.flags=0,e.subtreeFlags=0,e.deletions=null),e.flags=i.flags&14680064,e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},e.sibling=i.sibling,e.index=i.index,e.ref=i.ref,e}function Hl(i,t,e,r,o,s){var l=2;if(r=i,typeof i=="function")Jp(i)&&(l=1);else if(typeof i=="string")l=5;else t:switch(i){case To:return oo(e.children,o,s,t);case sp:l=8,o|=8;break;case mm:return i=Ke(12,e,t,o|2),i.elementType=mm,i.lanes=s,i;case pm:return i=Ke(13,e,t,o),i.elementType=pm,i.lanes=s,i;case dm:return i=Ke(19,e,t,o),i.elementType=dm,i.lanes=s,i;case D_:return Aa(e,o,s,t);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case T_:l=10;break t;case P_:l=9;break t;case np:l=11;break t;case lp:l=14;break t;case ur:l=16,r=null;break t}throw Error(J(130,i==null?i:typeof i,""))}return t=Ke(l,e,t,o),t.elementType=i,t.type=r,t.lanes=s,t}function oo(i,t,e,r){return i=Ke(7,i,r,t),i.lanes=e,i}function Aa(i,t,e,r){return i=Ke(22,i,r,t),i.elementType=D_,i.lanes=e,i.stateNode={isHidden:!1},i}function am(i,t,e){return i=Ke(6,i,null,t),i.lanes=e,i}function cm(i,t,e){return t=Ke(4,i.children!==null?i.children:[],i.key,t),t.lanes=e,t.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},t}function pw(i,t,e,r,o){this.tag=t,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ou(0),this.expirationTimes=Ou(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ou(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function zp(i,t,e,r,o,s,l,a,c){return i=new pw(i,t,e,a,c),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Ke(3,null,null,t),i.current=s,s.stateNode=i,s.memoizedState={element:r,isDehydrated:e,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cp(s),i}function dw(i,t,e){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ao,key:r==null?null:""+r,children:i,containerInfo:t,implementation:e}}function g2(i){if(!i)return Cr;i=i._reactInternals;t:{if(mo(i)!==i||i.tag!==1)throw Error(J(170));var t=i;do{switch(t.tag){case 3:t=t.stateNode.context;break t;case 1:if(De(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break t}}t=t.return}while(t!==null);throw Error(J(171))}if(i.tag===1){var e=i.type;if(De(e))return gy(i,e,t)}return t}function S2(i,t,e,r,o,s,l,a,c){return i=zp(e,r,!0,i,o,s,l,a,c),i.context=g2(null),e=i.current,r=ge(),o=wr(e),s=Xi(r,o),s.callback=t??null,gr(e,s,o),i.current.lanes=o,xn(i,o,r),Me(i,r),i}function Ta(i,t,e,r){var o=t.current,s=ge(),l=wr(o);return e=g2(e),t.context===null?t.context=e:t.pendingContext=e,t=Xi(s,l),t.payload={element:i},r=r===void 0?null:r,r!==null&&(t.callback=r),i=gr(o,t,l),i!==null&&(hi(i,o,l,s),Ul(i,o,l)),l}function fa(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function B_(i,t){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var e=i.retryLane;i.retryLane=e!==0&&e<t?e:t}}function jp(i,t){B_(i,t),(i=i.alternate)&&B_(i,t)}function hw(){return null}var w2=typeof reportError=="function"?reportError:function(i){console.error(i)};function Xp(i){this._internalRoot=i}Pa.prototype.render=Xp.prototype.render=function(i){var t=this._internalRoot;if(t===null)throw Error(J(409));Ta(i,t,null,null)};Pa.prototype.unmount=Xp.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var t=i.containerInfo;co(function(){Ta(null,i,null,null)}),t[Oi]=null}};function Pa(i){this._internalRoot=i}Pa.prototype.unstable_scheduleHydration=function(i){if(i){var t=$_();i={blockedOn:null,target:i,priority:t};for(var e=0;e<pr.length&&t!==0&&t<pr[e].priority;e++);pr.splice(e,0,i),e===0&&ey(i)}};function Hp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Da(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function C_(){}function fw(i,t,e,r,o){if(o){if(typeof r=="function"){var s=r;r=function(){var u=fa(l);s.call(u)}}var l=S2(t,r,i,0,null,!1,!1,"",C_);return i._reactRootContainer=l,i[Oi]=l.current,un(i.nodeType===8?i.parentNode:i),co(),l}for(;o=i.lastChild;)i.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var u=fa(c);a.call(u)}}var c=zp(i,0,!1,null,null,!1,!1,"",C_);return i._reactRootContainer=c,i[Oi]=c.current,un(i.nodeType===8?i.parentNode:i),co(function(){Ta(t,c,e,r)}),c}function Ma(i,t,e,r,o){var s=e._reactRootContainer;if(s){var l=s;if(typeof o=="function"){var a=o;o=function(){var c=fa(l);a.call(c)}}Ta(t,l,i,o)}else l=fw(e,t,i,o,r);return fa(l)}W_=function(i){switch(i.tag){case 3:var t=i.stateNode;if(t.current.memoizedState.isDehydrated){var e=Xs(t.pendingLanes);e!==0&&(up(t,e|1),Me(t,Jt()),(ut&6)===0&&(qo=Jt()+500,Pr()))}break;case 13:co(function(){var r=Ni(i,1);if(r!==null){var o=ge();hi(r,i,1,o)}}),jp(i,1)}};mp=function(i){if(i.tag===13){var t=Ni(i,134217728);if(t!==null){var e=ge();hi(t,i,134217728,e)}jp(i,134217728)}};K_=function(i){if(i.tag===13){var t=wr(i),e=Ni(i,t);if(e!==null){var r=ge();hi(e,i,t,r)}jp(i,t)}};$_=function(){return ft};ty=function(i,t){var e=ft;try{return ft=i,t()}finally{ft=e}};vm=function(i,t,e){switch(t){case"input":if(bm(i,e),t=e.name,e.type==="radio"&&t!=null){for(e=i;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<e.length;t++){var r=e[t];if(r!==i&&r.form===i.form){var o=ga(r);if(!o)throw Error(J(90));R_(r),bm(r,o)}}}break;case"textarea":F_(i,e);break;case"select":t=e.value,t!=null&&Eo(i,!!e.multiple,t,!1)}};Y_=Ep;J_=co;var bw={usingClientEntryPoint:!1,Events:[Sn,Ro,ga,E_,U_,Ep]},Ys={findFiberByHostInstance:to,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_w={bundleType:Ys.bundleType,version:Ys.version,rendererPackageName:Ys.rendererPackageName,rendererConfig:Ys.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qi.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=X_(i),i===null?null:i.stateNode},findFiberByHostInstance:Ys.findFiberByHostInstance||hw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(Js=__REACT_DEVTOOLS_GLOBAL_HOOK__,!Js.isDisabled&&Js.supportsFiber))try{ba=Js.inject(_w),Pi=Js}catch{}var Js;ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bw;ze.createPortal=function(i,t){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hp(t))throw Error(J(200));return dw(i,t,null,e)};ze.createRoot=function(i,t){if(!Hp(i))throw Error(J(299));var e=!1,r="",o=w2;return t!=null&&(t.unstable_strictMode===!0&&(e=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=zp(i,1,!1,null,null,e,!1,r,o),i[Oi]=t.current,un(i.nodeType===8?i.parentNode:i),new Xp(t)};ze.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var t=i._reactInternals;if(t===void 0)throw typeof i.render=="function"?Error(J(188)):(i=Object.keys(i).join(","),Error(J(268,i)));return i=X_(t),i=i===null?null:i.stateNode,i};ze.flushSync=function(i){return co(i)};ze.hydrate=function(i,t,e){if(!Da(t))throw Error(J(200));return Ma(null,i,t,!0,e)};ze.hydrateRoot=function(i,t,e){if(!Hp(i))throw Error(J(405));var r=e!=null&&e.hydratedSources||null,o=!1,s="",l=w2;if(e!=null&&(e.unstable_strictMode===!0&&(o=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(l=e.onRecoverableError)),t=S2(t,null,i,1,e??null,o,!1,s,l),i[Oi]=t.current,un(i),r)for(i=0;i<r.length;i++)e=r[i],o=e._getVersion,o=o(e._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[e,o]:t.mutableSourceEagerHydrationData.push(e,o);return new Pa(t)};ze.render=function(i,t,e){if(!Da(t))throw Error(J(200));return Ma(null,i,t,!1,e)};ze.unmountComponentAtNode=function(i){if(!Da(i))throw Error(J(40));return i._reactRootContainer?(co(function(){Ma(null,null,i,!1,function(){i._reactRootContainer=null,i[Oi]=null})}),!0):!1};ze.unstable_batchedUpdates=Ep;ze.unstable_renderSubtreeIntoContainer=function(i,t,e,r){if(!Da(e))throw Error(J(200));if(i==null||i._reactInternals===void 0)throw Error(J(38));return Ma(i,t,e,!1,r)};ze.version="18.3.1-next-f1338f8080-20240426"});var A2=Vt((UA,C2)=>{"use strict";function B2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B2)}catch(i){console.error(i)}}B2(),C2.exports=v2()});var P2=Vt(Op=>{"use strict";var T2=A2();Op.createRoot=T2.createRoot,Op.hydrateRoot=T2.hydrateRoot;var YA});var k2=Vt(Fa=>{"use strict";var xw=ye(),gw=Symbol.for("react.element"),Sw=Symbol.for("react.fragment"),ww=Object.prototype.hasOwnProperty,vw=xw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bw={key:!0,ref:!0,__self:!0,__source:!0};function R2(i,t,e){var r,o={},s=null,l=null;e!==void 0&&(s=""+e),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)ww.call(t,r)&&!Bw.hasOwnProperty(r)&&(o[r]=t[r]);if(i&&i.defaultProps)for(r in t=i.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:gw,type:i,key:s,ref:l,props:o,_owner:vw.current}}Fa.Fragment=Sw;Fa.jsx=R2;Fa.jsxs=R2});var bt=Vt((WA,F2)=>{"use strict";F2.exports=k2()});var hs=Vt(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.Collector=void 0;var dd=class{constructor(t){this.emit=(...e)=>{t.emitCollecting(this,e)}}};Ic.Collector=dd});var x0=Vt(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.CollectorArray=void 0;var y1=hs(),hd=class extends y1.Collector{constructor(){super(...arguments),this.result=[]}handleResult(t){return this.result.push(t),!0}getResult(){return this.result}reset(){this.result.length=0}};Lc.CollectorArray=hd});var g0=Vt(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.CollectorLast=void 0;var x1=hs(),fd=class extends x1.Collector{handleResult(t){return this.result=t,!0}getResult(){return this.result}reset(){delete this.result}};Gc.CollectorLast=fd});var S0=Vt(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.CollectorUntil0=void 0;var g1=hs(),bd=class extends g1.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,this.result}getResult(){return this.result}reset(){this.result=!1}};Vc.CollectorUntil0=bd});var w0=Vt(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.CollectorWhile0=void 0;var S1=hs(),_d=class extends S1.Collector{constructor(){super(...arguments),this.result=!1}handleResult(t){return this.result=t,!this.result}getResult(){return this.result}reset(){this.result=!1}};Ec.CollectorWhile0=_d});var v0=Vt(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.SignalConnectionImpl=void 0;var yd=class{constructor(t){this.link=t}disconnect(){return this.link.unlink()}set enabled(t){this.link.setEnabled(t)}get enabled(){return this.link.isEnabled()}};Uc.SignalConnectionImpl=yd});var B0=Vt(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.SignalLink=void 0;var xd=class i{constructor(t,e,r){this.enabled=!0,this.newLink=!1,this.prev=t??this,this.next=e??this,this.order=r.order,this.isPublic=r.isPublic,this.callback=r.callback,this.onUnlink=r.onUnlink}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){return this.callback?(delete this.callback,this.next.prev=this.prev,this.prev.next=this.next,this.onUnlink(),!0):!1}insert(t){let{order:e}=t,r=this.prev;for(;r!==this&&!(r.order<=e);)r=r.prev;let o=new i(r,r.next,t);return r.next=o,o.next.prev=o,o}};Yc.SignalLink=xd});var C0=Vt(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.Signal=void 0;var w1=v0(),v1=B0(),B1={order:0,isPublic:!0,onUnlink(){}},gd=class{constructor(){this.head=new v1.SignalLink(null,null,B1),this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0,this.onUnlink=()=>{this.connectionsCount--}}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(t,{order:e=0,isPublic:r=!0}={}){this.connectionsCount++;let o=this.head.insert({callback:t,order:e,isPublic:r,onUnlink:this.onUnlink});return this.emitDepth>0&&(this.hasNewLinks=!0,o.newLink=!0),new w1.SignalConnectionImpl(o)}disconnect(t){for(let e=this.head.next;e!==this.head;e=e.next)if(e.callback===t)return e.unlink(),!0;return!1}disconnectAll(){let{next:t}=this.head;for(;t!==this.head;)t.isPublic&&t.unlink(),t=t.next}emit(...t){this.emitDepth++;for(let e=this.head.next;e!==this.head;e=e.next)e.isEnabled()&&e.callback&&e.callback.apply(null,t);this.emitDepth--,this.unsetNewLink()}emitCollecting(t,e){this.emitDepth++;for(let r=this.head.next;r!==this.head;r=r.next)if(r.isEnabled()&&r.callback){let o=r.callback.apply(null,e);if(!t.handleResult(o))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let t=this.head.next;t!==this.head;t=t.next)t.newLink=!1;this.hasNewLinks=!1}}};Jc.Signal=gd});var A0=Vt(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.SignalConnections=void 0;var Sd=class{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(let t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}};zc.SignalConnections=Sd});var T0=Vt(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.SignalConnections=he.Signal=he.CollectorWhile0=he.CollectorUntil0=he.CollectorLast=he.CollectorArray=he.Collector=void 0;var C1=hs();Object.defineProperty(he,"Collector",{enumerable:!0,get:function(){return C1.Collector}});var A1=x0();Object.defineProperty(he,"CollectorArray",{enumerable:!0,get:function(){return A1.CollectorArray}});var T1=g0();Object.defineProperty(he,"CollectorLast",{enumerable:!0,get:function(){return T1.CollectorLast}});var P1=S0();Object.defineProperty(he,"CollectorUntil0",{enumerable:!0,get:function(){return P1.CollectorUntil0}});var D1=w0();Object.defineProperty(he,"CollectorWhile0",{enumerable:!0,get:function(){return D1.CollectorWhile0}});var M1=C0();Object.defineProperty(he,"Signal",{enumerable:!0,get:function(){return M1.Signal}});var R1=A0();Object.defineProperty(he,"SignalConnections",{enumerable:!0,get:function(){return R1.SignalConnections}})});var Q0=Vt(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.factoriesGl1=void 0;jc.factoriesGl1={uniform1f:(i,t)=>({location:t,set:e=>i.uniform1f(t,e),setV:e=>i.uniform1fv(t,e)}),uniform2f:(i,t)=>({location:t,set:(e,r)=>i.uniform2f(t,e,r),setV:e=>i.uniform2fv(t,e)}),uniform3f:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3f(t,e,r,o),setV:e=>i.uniform3fv(t,e)}),uniform4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4f(t,e,r,o,s),setV:e=>i.uniform4fv(t,e)}),uniform1i:(i,t)=>({location:t,set:e=>i.uniform1i(t,e),setV:e=>i.uniform1iv(t,e)}),uniform2i:(i,t)=>({location:t,set:(e,r)=>i.uniform2i(t,e,r),setV:e=>i.uniform2iv(t,e)}),uniform3i:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3i(t,e,r,o),setV:e=>i.uniform3iv(t,e)}),uniform4i:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4i(t,e,r,o,s),setV:e=>i.uniform4iv(t,e)}),uniformMatrix2f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix2fv(t,e,r)}),uniformMatrix3f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix3fv(t,e,r)}),uniformMatrix4f:(i,t)=>({location:t,set:(e,r)=>i.uniformMatrix4fv(t,e,r)}),vertexAttrib1f:(i,t)=>({location:t,set:e=>i.vertexAttrib1f(t,e),setV:e=>i.vertexAttrib1fv(t,e)}),vertexAttrib2f:(i,t)=>({location:t,set:(e,r)=>i.vertexAttrib2f(t,e,r),setV:e=>i.vertexAttrib2fv(t,e)}),vertexAttrib3f:(i,t)=>({location:t,set:(e,r,o)=>i.vertexAttrib3f(t,e,r,o),setV:e=>i.vertexAttrib3fv(t,e)}),vertexAttrib4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttrib4f(t,e,r,o,s),setV:e=>i.vertexAttrib4fv(t,e)}),vertexAttribPointer:(i,t)=>({location:t,enable:()=>i.enableVertexAttribArray(t),disable:()=>i.disableVertexAttribArray(t),set:(e,r,o,s,l)=>i.vertexAttribPointer(t,e,r,o,s,l)})}});var q0=Vt(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.factoriesGl2=void 0;var hC=Q0();Xc.factoriesGl2=Object.assign(Object.assign({},hC.factoriesGl1),{uniform1ui:(i,t)=>({location:t,set:e=>i.uniform1ui(t,e),setV:(e,r,o)=>i.uniform1uiv(t,e,r,o)}),uniform2ui:(i,t)=>({location:t,set:(e,r)=>i.uniform2ui(t,e,r),setV:(e,r,o)=>i.uniform2uiv(t,e,r,o)}),uniform3ui:(i,t)=>({location:t,set:(e,r,o)=>i.uniform3ui(t,e,r,o),setV:(e,r,o)=>i.uniform3uiv(t,e,r,o)}),uniform4ui:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniform4ui(t,e,r,o,s),setV:(e,r,o)=>i.uniform4uiv(t,e,r,o)}),uniformMatrix2x3f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix2x3fv(t,e,r,o,s)}),uniformMatrix2x4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix2x4fv(t,e,r,o,s)}),uniformMatrix3x2f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix3x2fv(t,e,r,o,s)}),uniformMatrix3x4f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix3x4fv(t,e,r,o,s)}),uniformMatrix4x2f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix4x2fv(t,e,r,o,s)}),uniformMatrix4x3f:(i,t)=>({location:t,set:(e,r,o,s)=>i.uniformMatrix4x3fv(t,e,r,o,s)}),vertexAttribDivisor:(i,t)=>({location:t,set:e=>i.vertexAttribDivisor(t,e)}),vertexAttribI4i:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttribI4i(t,e,r,o,s),setV:e=>i.vertexAttribI4iv(t,e)}),vertexAttribI4ui:(i,t)=>({location:t,set:(e,r,o,s)=>i.vertexAttribI4ui(t,e,r,o,s),setV:e=>i.vertexAttribI4uiv(t,e)}),vertexAttribIPointer:(i,t)=>({location:t,enable:()=>i.enableVertexAttribArray(t),disable:()=>i.disableVertexAttribArray(t),set:(e,r,o,s)=>i.vertexAttribIPointer(t,e,r,o,s)})})});var _o=Vt(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.createShaderProgram=fs.glsl=void 0;var fC=q0();function bC(i,...t){let e="";for(let r=0;r<t.length;r++)e+=i[r],e+=t[r];return e.replace(/^[\r\n]+/,"")+i[i.length-1]}fs.glsl=bC;function W0(i,t,e,r){let o=i.createShader(e);return i.shaderSource(o,r),i.compileShader(o),i.attachShader(t,o),o}function _C(i,t,e,r){let o=i.createProgram(),s={},l=W0(i,o,i.VERTEX_SHADER,t),a=W0(i,o,i.FRAGMENT_SHADER,e);i.linkProgram(o),i.useProgram(o);for(let c of Object.keys(r)){let u=r[c],m=fC.factoriesGl2[u];if(!m)throw new Error(`Can't handle ${u}!`);let p=u.startsWith("uniform")?i.getUniformLocation(o,c):i.getAttribLocation(o,c);s[c]=m(i,p)}return Object.assign(Object.assign({},s),{use(){i.useProgram(o)},dispose(){i.useProgram(null),i.deleteShader(a),i.deleteShader(l),i.deleteProgram(o)}})}fs.createShaderProgram=_C});var Ox=$(ye()),Nx=$(P2());var Ra=i=>document.location.pathname.substring(i.length);var yw=function(i,t,e,r){function o(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function a(m){try{u(r.next(m))}catch(p){l(p)}}function c(m){try{u(r.throw(m))}catch(p){l(p)}}function u(m){m.done?s(m.value):o(m.value).then(a,c)}u((r=r.apply(i,t||[])).next())})},Np=()=>window.location.hash.substr(1);function D2({hashMode:i,basename:t,setPath:e,onNavigate:r}){let{location:o,history:s}=window,l=i?()=>e(Np()):()=>e(Ra(t)),a=i?u=>`${o.pathname}${o.search}#${u}`:u=>`${t}${u}`;function c(u,m){return yw(this,void 0,void 0,function*(){let p=a(u),d=o.pathname+o.search+o.hash;if(p!==d){if(r&&!(yield r({from:d,to:p,type:"push"})))return!1;m==="push"?s.pushState({},"",p):s.replaceState({},"",p),l()}return!0})}return{push:u=>c(u,"push"),replace:u=>c(u,"replace"),onChange:l,urlTo:a}}var Zp=$(ye());var M2=$(ye()),$o=()=>{throw new Error("You forgot to add a Router element to your app.")},ka=(0,M2.createContext)({basename:"",path:"",history:{push:$o,replace:$o,onChange:$o,urlTo:$o},matchRoute:$o,urlTo:$o});var qi=()=>(0,Zp.useContext)(ka);var I2=$(bt()),L2=$(ye());function Cw(i,t){let{history:e}=qi();return(0,L2.useMemo)(()=>({onClick(r){try{t?.(r)}catch(o){console.error(o)}r.defaultPrevented||(r.preventDefault(),e.push(i))},href:e.urlTo(i)}),[i,t,e])}function G2(i){let t=Cw(i.href,i.onClick);return(0,I2.jsx)("a",Object.assign({},i,{href:t.href,onClick:t.onClick}))}var V2=$(bt()),Aw=$(ye());function E2(i){let t={};return(e,r)=>(t[e]||(t[e]=i(e)))(r)}var Y2=$(bt()),Dr=$(ye());function U2(i){return t=>t===i||i==="*"?{}:null}var J2=({basename:i="",mode:t,routeMatcherFactory:e=U2,children:r,onNavigate:o})=>{let s=t==="hash",[l,a]=(0,Dr.useState)(()=>s?Np():Ra(i)),c=(0,Dr.useMemo)(()=>D2({hashMode:s,basename:i,setPath:a,onNavigate:o}),[a,i,s,o]),u=(0,Dr.useMemo)(()=>E2(e),[e]),m=(0,Dr.useMemo)(()=>({basename:i,path:l,history:c,matchRoute:u,urlTo:c.urlTo}),[i,l,c,u]);return(0,Dr.useEffect)(()=>(window.addEventListener("popstate",c.onChange),()=>window.removeEventListener("popstate",c.onChange)),[c]),(0,Y2.jsx)(ka.Provider,{value:m,children:r})};var Tw=$(ye());var Ei=$(ye());var Pw={lengthUnitsPerMeter:1,maxPolygonVertices:8},Qp={...Pw};var Mr=Qp.lengthUnitsPerMeter,Wt=Qp.maxPolygonVertices;function N(i,t){if(!i)throw new Error(t)}function ct(i){if(i===null)throw new Error;return i}var tt=1e37,gt=1e-5,Rr=gt*gt,Ot=2,Ia=.1*Mr,qp=4,Z=.005*Mr,bi=2/180*Math.PI,Re=2*Z,z2=8,La=32,ts=.2*Mr,Cn=8/180*Math.PI,vn=2*Mr,Wp=vn*vn,Bn=.5*Math.PI,Kp=Bn*Bn,j2=.2,X2=.75,H2=.5,$p=.01*Mr,td=2/180*Math.PI;function je(i,t=0){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}function O2(i,t=!1){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}function H(i,t){let e=new Array(i);for(let r=0;r<i;r++)e[r]=new t;return e}var Dw=Math.PI/180,Mw=180/Math.PI,N2=2*Math.PI;function et(i,t,e){return i<t?t:i>e?e:i}function pt(i){return i*Dw}function Z2(i){return i*Mw}function An(){return Math.random()*2-1}function W(i,t){return(t-i)*Math.random()+i}function Ga(i,t){return Math.round((t-i)*Math.random()+i)}var n=class i{static{this.ZERO=new i}static{this.UNITX=new i(1,0)}static{this.UNITY=new i(0,1)}static{this.s_t0=new i}static{this.s_t1=new i}static{this.s_t2=new i}static{this.s_t3=new i}constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new i(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}Add(t){return this.x+=t.x,this.y+=t.y,this}AddXY(t,e){return this.x+=t,this.y+=e,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this}SubtractXY(t,e){return this.x-=t,this.y-=e,this}Scale(t){return this.x*=t,this.y*=t,this}AddScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SubtractScaled(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){let{x:t,y:e}=this;return Math.sqrt(t*t+e*e)}LengthSquared(){let{x:t,y:e}=this;return t*t+e*e}Normalize(){let t=this.Length();if(t<gt)return 0;let e=1/t;return this.x*=e,this.y*=e,t}Rotate(t){let e=Math.cos(t),r=Math.sin(t),{x:o}=this;return this.x=e*o-r*this.y,this.y=r*o+e*this.y,this}RotateCosSin(t,e){let{x:r}=this;return this.x=t*r-e*this.y,this.y=e*r+t*this.y,this}IsValid(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}Abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}GetAbs(t){return t.x=Math.abs(this.x),t.y=Math.abs(this.y),t}Negate(){return this.x=-this.x,this.y=-this.y,this}Skew(){let{x:t}=this;return this.x=-this.y,this.y=t,this}static Min(t,e,r){return r.x=Math.min(t.x,e.x),r.y=Math.min(t.y,e.y),r}static Max(t,e,r){return r.x=Math.max(t.x,e.x),r.y=Math.max(t.y,e.y),r}static Clamp(t,e,r,o){return o.x=et(t.x,e.x,r.x),o.y=et(t.y,e.y,r.y),o}static Rotate(t,e,r){let o=t.x,s=t.y,l=Math.cos(e),a=Math.sin(e);return r.x=l*o-a*s,r.y=a*o+l*s,r}static Dot(t,e){return t.x*e.x+t.y*e.y}static Cross(t,e){return t.x*e.y-t.y*e.x}static CrossVec2Scalar(t,e,r){let o=t.x;return r.x=e*t.y,r.y=-e*o,r}static CrossVec2One(t,e){let r=t.x;return e.x=t.y,e.y=-r,e}static CrossScalarVec2(t,e,r){let o=e.x;return r.x=-t*e.y,r.y=t*o,r}static CrossOneVec2(t,e){let r=t.x;return e.x=-t.y,e.y=r,e}static Add(t,e,r){return r.x=t.x+e.x,r.y=t.y+e.y,r}static Subtract(t,e,r){return r.x=t.x-e.x,r.y=t.y-e.y,r}static Scale(t,e,r){return r.x=e.x*t,r.y=e.y*t,r}static AddScaled(t,e,r,o){return o.x=t.x+e*r.x,o.y=t.y+e*r.y,o}static SubtractScaled(t,e,r,o){return o.x=t.x-e*r.x,o.y=t.y-e*r.y,o}static AddCrossScalarVec2(t,e,r,o){let s=r.x;return o.x=t.x-e*r.y,o.y=t.y+e*s,o}static Mid(t,e,r){return r.x=(t.x+e.x)*.5,r.y=(t.y+e.y)*.5,r}static Extents(t,e,r){return r.x=(e.x-t.x)*.5,r.y=(e.y-t.y)*.5,r}static Equals(t,e){return t.x===e.x&&t.y===e.y}static Distance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}static DistanceSquared(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}static Negate(t,e){return e.x=-t.x,e.y=-t.y,e}static Normalize(t,e){let r=t.x**2+t.y**2;if(r>=Rr){let o=1/Math.sqrt(r);e.x=o*t.x,e.y=o*t.y}else e.x=0,e.y=0;return e}static Skew(t,e){let{x:r}=t;return e.x=-t.y,e.y=r,e}},we=class i{static{this.ZERO=new i(0,0,0)}static{this.s_t0=new i}constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}Clone(){return new i(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}Set(t,e,r){return this.x=t,this.y=e,this.z=r,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}Negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}Add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}AddXYZ(t,e,r){return this.x+=t,this.y+=e,this.z+=r,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SubtractXYZ(t,e,r){return this.x-=t,this.y-=e,this.z-=r,this}Scale(t){return this.x*=t,this.y*=t,this.z*=t,this}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static Cross(t,e,r){let o=t.x,s=t.y,l=t.z,a=e.x,c=e.y,u=e.z;return r.x=s*u-l*c,r.y=l*a-o*u,r.z=o*c-s*a,r}},It=class i{constructor(){this.ex=new n(1,0);this.ey=new n(0,1)}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}static FromColumns(t,e){return new i().SetColumns(t,e)}static FromScalars(t,e,r,o){return new i().SetScalars(t,e,r,o)}static FromAngle(t){return new i().SetAngle(t)}SetScalars(t,e,r,o){return this.ex.Set(t,r),this.ey.Set(e,o),this}SetColumns(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){let e=Math.cos(t),r=Math.sin(t);return this.ex.Set(e,r),this.ey.Set(-r,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}Solve(t,e,r){let o=this.ex.x,s=this.ey.x,l=this.ex.y,a=this.ey.y,c=o*a-s*l;return c!==0&&(c=1/c),r.x=c*(a*t-s*e),r.y=c*(o*e-l*t),r}Abs(){return this.ex.Abs(),this.ey.Abs(),this}Inverse(){return this.GetInverse(this),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this}Subtract(t){return this.ex.Subtract(t.ex),this.ey.Subtract(t.ey),this}GetInverse(t){let e=this.ex.x,r=this.ey.x,o=this.ex.y,s=this.ey.y,l=e*s-r*o;return l!==0&&(l=1/l),t.ex.x=l*s,t.ey.x=-l*r,t.ex.y=-l*o,t.ey.y=l*e,t}GetAbs(t){return t.ex.x=Math.abs(this.ex.x),t.ex.y=Math.abs(this.ex.y),t.ey.x=Math.abs(this.ey.x),t.ey.y=Math.abs(this.ey.y),t}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.ex.x*o+t.ey.x*s,r.y=t.ex.y*o+t.ey.y*s,r}static TransposeMultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.ex.x*o+t.ex.y*s,r.y=t.ey.x*o+t.ey.y*s,r}static Add(t,e,r){return r.ex.x=t.ex.x+e.ex.x,r.ex.y=t.ex.y+e.ex.y,r.ey.x=t.ey.x+e.ey.x,r.ey.y=t.ey.y+e.ey.y,r}static Multiply(t,e,r){let o=t.ex.x,s=t.ex.y,l=t.ey.x,a=t.ey.y,c=e.ex.x,u=e.ex.y,m=e.ey.x,p=e.ey.y;return r.ex.x=o*c+l*u,r.ex.y=s*c+a*u,r.ey.x=o*m+l*p,r.ey.y=s*m+a*p,r}static TransposeMultiply(t,e,r){let o=t.ex.x,s=t.ex.y,l=t.ey.x,a=t.ey.y,c=e.ex.x,u=e.ex.y,m=e.ey.x,p=e.ey.y;return r.ex.x=o*c+s*u,r.ex.y=l*c+a*u,r.ey.x=o*m+s*p,r.ey.y=l*m+a*p,r}},Wi=class i{constructor(){this.ex=new we(1,0,0);this.ey=new we(0,1,0);this.ez=new we(0,0,1)}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}SetColumns(t,e,r){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(r),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this.ez.Add(t.ez),this}Solve33(t,e,r,o){let s=this.ex.x,l=this.ex.y,a=this.ex.z,c=this.ey.x,u=this.ey.y,m=this.ey.z,p=this.ez.x,d=this.ez.y,h=this.ez.z,f=s*(u*h-m*d)+l*(m*p-c*h)+a*(c*d-u*p);return f!==0&&(f=1/f),o.x=f*(t*(u*h-m*d)+e*(m*p-c*h)+r*(c*d-u*p)),o.y=f*(s*(e*h-r*d)+l*(r*p-t*h)+a*(t*d-e*p)),o.z=f*(s*(u*r-m*e)+l*(m*t-c*r)+a*(c*e-u*t)),o}Solve22(t,e,r){let o=this.ex.x,s=this.ey.x,l=this.ex.y,a=this.ey.y,c=o*a-s*l;return c!==0&&(c=1/c),r.x=c*(a*t-s*e),r.y=c*(o*e-l*t),r}GetInverse22(t){let e=this.ex.x,r=this.ey.x,o=this.ex.y,s=this.ey.y,l=e*s-r*o;l!==0&&(l=1/l),t.ex.x=l*s,t.ey.x=-l*r,t.ex.z=0,t.ex.y=-l*o,t.ey.y=l*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=we.Dot(this.ex,we.Cross(this.ey,this.ez,we.s_t0));e!==0&&(e=1/e);let r=this.ex.x,o=this.ey.x,s=this.ez.x,l=this.ey.y,a=this.ez.y,c=this.ez.z;t.ex.x=e*(l*c-a*a),t.ex.y=e*(s*a-o*c),t.ex.z=e*(o*a-s*l),t.ey.x=t.ex.y,t.ey.y=e*(r*c-s*s),t.ey.z=e*(s*o-r*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(r*l-o*o)}static MultiplyVec3(t,e,r){let{x:o,y:s,z:l}=e;return r.x=t.ex.x*o+t.ey.x*s+t.ez.x*l,r.y=t.ex.y*o+t.ey.y*s+t.ez.y*l,r.z=t.ex.z*o+t.ey.z*s+t.ez.z*l,r}static MultiplyVec2(t,e,r){let{x:o,y:s}=e;return r.x=t.ex.x*o+t.ey.x*s,r.y=t.ex.y*o+t.ey.y*s,r}},D=class i{constructor(t=0){this.s=0;this.c=1;t&&(this.s=Math.sin(t),this.c=Math.cos(t))}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}Set(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static Multiply(t,e,r){let o=t.s*e.c+t.c*e.s,s=t.c*e.c-t.s*e.s;return r.s=o,r.c=s,r}static TransposeMultiply(t,e,r){let o=t.c*e.s-t.s*e.c,s=t.c*e.c+t.s*e.s;return r.s=o,r.c=s,r}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.c*o-t.s*s,r.y=t.s*o+t.c*s,r}static TransposeMultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.c*o+t.s*s,r.y=-t.s*o+t.c*s,r}},T=class i{constructor(){this.p=new n;this.q=new D}static{this.IDENTITY=new i}Clone(){return new i().Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.Set(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.Set(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetAngle(){return this.q.GetAngle()}static MultiplyVec2(t,e,r){let o=e.x,s=e.y;return r.x=t.q.c*o-t.q.s*s+t.p.x,r.y=t.q.s*o+t.q.c*s+t.p.y,r}static TransposeMultiplyVec2(t,e,r){let o=e.x-t.p.x,s=e.y-t.p.y;return r.x=t.q.c*o+t.q.s*s,r.y=-t.q.s*o+t.q.c*s,r}static Multiply(t,e,r){return D.Multiply(t.q,e.q,r.q),D.MultiplyVec2(t.q,e.p,r.p).Add(t.p),r}static TransposeMultiply(t,e,r){return D.TransposeMultiply(t.q,e.q,r.q),D.TransposeMultiplyVec2(t.q,n.Subtract(e.p,t.p,r.p),r.p),r}},ee=class i{constructor(){this.localCenter=new n;this.c0=new n;this.c=new n;this.a0=0;this.a=0;this.alpha0=0}Clone(){return new i().Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){let r=1-e;t.p.x=r*this.c0.x+e*this.c.x,t.p.y=r*this.c0.y+e*this.c.y;let o=r*this.a0+e*this.a;return t.q.Set(o),t.p.Subtract(D.MultiplyVec2(t.q,this.localCenter,n.s_t0)),t}Advance(t){let e=(t-this.alpha0)/(1-this.alpha0);this.c0.x+=e*(this.c.x-this.c0.x),this.c0.y+=e*(this.c.y-this.c0.y),this.a0+=e*(this.a-this.a0),this.alpha0=t}Normalize(){let t=N2*Math.floor(this.a0/N2);this.a0-=t,this.a-=t}};var F=class i{static{this.ZERO=new i(0,0,0,0)}static{this.RED=new i(1,0,0)}static{this.GREEN=new i(0,1,0)}static{this.BLUE=new i(0,0,1)}static{this.WHITE=new i(1,1,1)}static{this.BLACK=new i(0,0,0)}constructor(t=.5,e=.5,r=.5,o=1){this.r=t,this.g=e,this.b=r,this.a=o}Clone(){return new i(this.r,this.g,this.b,this.a)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return this.r===0&&this.g===0&&this.b===0&&this.a===0}SetByteRGB(t,e,r){return this.r=t/255,this.g=e/255,this.b=r/255,this}SetByteRGBA(t,e,r,o){return this.r=t/255,this.g=e/255,this.b=r/255,this.a=o/255,this}SetRGB(t,e,r){return this.r=t,this.g=e,this.b=r,this}SetRGBA(t,e,r,o){return this.r=t,this.g=e,this.b=r,this.a=o,this}Add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Subtract(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Scale(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mix(t,e){i.MixColors(this,t,e)}static Add(t,e,r){return r.r=t.r+e.r,r.g=t.g+e.g,r.b=t.b+e.b,r.a=t.a+e.a,r}static Subtract(t,e,r){return r.r=t.r-e.r,r.g=t.g-e.g,r.b=t.b-e.b,r.a=t.a-e.a,r}static Scale(t,e,r){return r.r=t.r*e,r.g=t.g*e,r.b=t.b*e,r.a=t.a*e,r}static MixColors(t,e,r){let o=r*(e.r-t.r),s=r*(e.g-t.g),l=r*(e.b-t.b),a=r*(e.a-t.a);t.r+=o,t.g+=s,t.b+=l,t.a+=a,e.r-=o,e.g-=s,e.b-=l,e.a-=a}},Q={badBody:new F(1,0,0),disabledBody:new F(.5,.5,.3),staticBody:new F(.5,.9,.5),kinematicBody:new F(.5,.5,.9),sleepingBody:new F(.6,.6,.6),body:new F(.9,.7,.7),pair:new F(.3,.9,.9),aabb:new F(.9,.3,.9),joint1:new F(.7,.7,.7),joint2:new F(.3,.9,.3),joint3:new F(.9,.3,.3),joint4:new F(.3,.3,.9),joint5:new F(.4,.4,.4),joint6:new F(.5,.8,.8),joint7:new F(0,1,0),joint8:new F(.8,.8,.8),rope:new F(.4,.5,.7),ropePointG:new F(.1,.8,.1),ropePointD:new F(.7,.2,.4)};var ke=class{constructor(){this.mass=0;this.center=new n;this.I=0}};var ii=class{constructor(t,e){this.m_radius=0;this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}};var Ki=class{constructor(){this.m_buffer=H(2,n);this.m_vertices=this.m_buffer;this.m_count=0;this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0]=t.m_buffer[0],this.m_buffer[1]=t.m_buffer[1]):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}SetVerticesRadius(t,e,r){this.m_vertices=t,this.m_count=e,this.m_radius=r}GetSupport(t){let e=0,r=n.Dot(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){let s=n.Dot(this.m_vertices[o],t);s>r&&(e=o,r=s)}return e}GetSupportVertex(t){let e=0,r=n.Dot(this.m_vertices[0],t);for(let o=1;o<this.m_count;++o){let s=n.Dot(this.m_vertices[o],t);s>r&&(e=o,r=s)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}},Mi=class{constructor(){this.metric=0;this.count=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}},Ri=class{constructor(){this.proxyA=new Ki;this.proxyB=new Ki;this.transformA=new T;this.transformB=new T;this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}},ki=class{constructor(){this.pointA=new n;this.pointB=new n;this.distance=0;this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}},Va=class{constructor(){this.proxyA=new Ki;this.proxyB=new Ki;this.transformA=new T;this.transformB=new T;this.translationB=new n}},Ea=class{constructor(){this.point=new n;this.normal=new n;this.lambda=0;this.iterations=0}},Kt={calls:0,iters:0,maxIters:0,reset(){this.calls=0,this.iters=0,this.maxIters=0}},Tn=class{constructor(){this.wA=new n;this.wB=new n;this.w=new n;this.a=0;this.indexA=0;this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}},Ua=class i{constructor(){this.m_v1=new Tn;this.m_v2=new Tn;this.m_v3=new Tn;this.m_count=0;this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}ReadCache(t,e,r,o,s){this.m_count=t.count;let l=this.m_vertices;for(let a=0;a<this.m_count;++a){let c=l[a];c.indexA=t.indexA[a],c.indexB=t.indexB[a];let u=e.GetVertex(c.indexA),m=o.GetVertex(c.indexB);T.MultiplyVec2(r,u,c.wA),T.MultiplyVec2(s,m,c.wB),n.Subtract(c.wB,c.wA,c.w),c.a=0}if(this.m_count>1){let a=t.metric,c=this.GetMetric();(c<.5*a||2*a<c||c<gt)&&(this.m_count=0)}if(this.m_count===0){let a=l[0];a.indexA=0,a.indexB=0;let c=e.GetVertex(0),u=o.GetVertex(0);T.MultiplyVec2(r,c,a.wA),T.MultiplyVec2(s,u,a.wB),n.Subtract(a.wB,a.wA,a.w),a.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;let e=this.m_vertices;for(let r=0;r<this.m_count;++r)t.indexA[r]=e[r].indexA,t.indexB[r]=e[r].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return n.Negate(this.m_v1.w,t);case 2:{let e=n.Subtract(this.m_v2.w,this.m_v1.w,t);return n.Cross(e,n.Negate(this.m_v1.w,n.s_t0))>0?n.CrossOneVec2(e,t):n.CrossVec2One(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return t.SetZero();default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:break}}GetMetric(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return n.Distance(this.m_v1.w,this.m_v2.w);case 3:return n.Cross(n.Subtract(this.m_v2.w,this.m_v1.w,n.s_t0),n.Subtract(this.m_v3.w,this.m_v1.w,n.s_t1));default:return 0}}Solve2(){let t=this.m_v1.w,e=this.m_v2.w,r=n.Subtract(e,t,i.s_e12),o=-n.Dot(t,r);if(o<=0){this.m_v1.a=1,this.m_count=1;return}let s=n.Dot(e,r);if(s<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}let l=1/(s+o);this.m_v1.a=s*l,this.m_v2.a=o*l,this.m_count=2}Solve3(){let t=this.m_v1.w,e=this.m_v2.w,r=this.m_v3.w,o=n.Subtract(e,t,i.s_e12),s=n.Dot(t,o),a=n.Dot(e,o),c=-s,u=n.Subtract(r,t,i.s_e13),m=n.Dot(t,u),d=n.Dot(r,u),h=-m,f=n.Subtract(r,e,i.s_e23),b=n.Dot(e,f),_=n.Dot(r,f),y=-b,g=n.Cross(o,u),S=g*n.Cross(e,r),w=g*n.Cross(r,t),B=g*n.Cross(t,e);if(c<=0&&h<=0){this.m_v1.a=1,this.m_count=1;return}if(a>0&&c>0&&B<=0){let A=1/(a+c);this.m_v1.a=a*A,this.m_v2.a=c*A,this.m_count=2;return}if(d>0&&h>0&&w<=0){let A=1/(d+h);this.m_v1.a=d*A,this.m_v3.a=h*A,this.m_count=2,this.m_v2.Copy(this.m_v3);return}if(a<=0&&y<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}if(d<=0&&_<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);return}if(_>0&&y>0&&S<=0){let A=1/(_+y);this.m_v2.a=_*A,this.m_v3.a=y*A,this.m_count=2,this.m_v1.Copy(this.m_v3);return}let C=1/(S+w+B);this.m_v1.a=S*C,this.m_v2.a=w*C,this.m_v3.a=B*C,this.m_count=3}static{this.s_e12=new n}static{this.s_e13=new n}static{this.s_e23=new n}},Rw=new Ua,kw=[0,0,0],Fw=[0,0,0],Iw=new n,Lw=new n,Gw=new n,Vw=new n,Ew=new n;function kr(i,t,e){++Kt.calls;let{proxyA:r,proxyB:o,transformA:s,transformB:l}=e,a=Rw;a.ReadCache(t,r,s,o,l);let c=a.m_vertices,u=20,m=kw,p=Fw,d=0,h=0;for(;h<u;){d=a.m_count;for(let _=0;_<d;++_)m[_]=c[_].indexA,p[_]=c[_].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3();break}if(a.m_count===3)break;let f=a.GetSearchDirection(Lw);if(f.LengthSquared()<Rr)break;let b=c[a.m_count];b.indexA=r.GetSupport(D.TransposeMultiplyVec2(s.q,n.Negate(f,n.s_t0),Vw)),T.MultiplyVec2(s,r.GetVertex(b.indexA),b.wA),b.indexB=o.GetSupport(D.TransposeMultiplyVec2(l.q,f,Ew)),T.MultiplyVec2(l,o.GetVertex(b.indexB),b.wB),n.Subtract(b.wB,b.wA,b.w),++h,++Kt.iters;let x=!1;for(let _=0;_<d;++_)if(b.indexA===m[_]&&b.indexB===p[_]){x=!0;break}if(x)break;++a.m_count}if(Kt.maxIters=Math.max(Kt.maxIters,h),a.GetWitnessPoints(i.pointA,i.pointB),i.distance=n.Distance(i.pointA,i.pointB),i.iterations=h,a.WriteCache(t),e.useRadii)if(i.distance<gt){let f=n.Mid(i.pointA,i.pointB,Iw);i.pointA.Copy(f),i.pointB.Copy(f),i.distance=0}else{let f=r.m_radius,b=o.m_radius,x=n.Subtract(i.pointB,i.pointA,Gw);x.Normalize(),i.distance=Math.max(0,i.distance-f-b),i.pointA.AddScaled(f,x),i.pointB.SubtractScaled(b,x)}}var Uw=new n,Yw=new Ua,Q2=new n,q2=new n,Jw=new n,zw=new n,jw=new n,Xw=new n;function W2(i,t){i.iterations=0,i.lambda=1,i.normal.SetZero(),i.point.SetZero();let{proxyA:e,proxyB:r}=t,o=Math.max(e.m_radius,Re),s=Math.max(r.m_radius,Re),l=o+s,a=t.transformA,c=t.transformB,u=t.translationB,m=Uw.SetZero(),p=0,d=Yw;d.m_count=0;let h=d.m_vertices,f=e.GetSupport(D.TransposeMultiplyVec2(a.q,n.Negate(u,n.s_t1),n.s_t0)),b=T.MultiplyVec2(a,e.GetVertex(f),Q2),x=r.GetSupport(D.TransposeMultiplyVec2(c.q,u,n.s_t0)),_=T.MultiplyVec2(c,r.GetVertex(x),q2),y=n.Subtract(b,_,Jw),g=Math.max(Re,l-Re),S=.5*Z,w=20,B=0;for(;B<w&&y.Length()-g>S;){i.iterations+=1,f=e.GetSupport(D.TransposeMultiplyVec2(a.q,n.Negate(y,n.s_t1),n.s_t0)),b=T.MultiplyVec2(a,e.GetVertex(f),Q2),x=r.GetSupport(D.TransposeMultiplyVec2(c.q,y,n.s_t0)),_=T.MultiplyVec2(c,r.GetVertex(x),q2);let k=n.Subtract(b,_,zw);y.Normalize();let M=n.Dot(y,k),E=n.Dot(y,u);if(M-g>p*E){if(E<=0||(p=(M-g)/E,p>1))return!1;n.Negate(y,m),d.m_count=0}let L=h[d.m_count];switch(L.indexA=x,n.AddScaled(_,p,u,L.wA),L.indexB=f,L.wB.Copy(b),n.Subtract(L.wB,L.wA,L.w),L.a=1,d.m_count+=1,d.m_count){case 1:break;case 2:d.Solve2();break;case 3:d.Solve3();break}if(d.m_count===3)return!1;d.GetClosestPoint(y),++B}if(B===0)return!1;let C=jw,A=Xw;return d.GetWitnessPoints(C,A),y.LengthSquared()>0&&(n.Negate(y,m),m.Normalize()),n.AddScaled(C,o,m,i.point),i.normal.Copy(m),i.lambda=p,i.iterations=B,!0}var ed=class{constructor(){this.m_key=0;this.m_key_invalid=!1;this.m_indexA=0;this.m_indexB=0;this.m_typeA=0;this.m_typeB=0}get key(){return this.m_key_invalid&&(this.m_key_invalid=!1,this.m_key=this.m_indexA|this.m_indexB<<8|this.m_typeA<<16|this.m_typeB<<24),this.m_key}set key(t){this.m_key=t,this.m_key_invalid=!1,this.m_indexA=this.m_key&255,this.m_indexB=this.m_key>>8&255,this.m_typeA=this.m_key>>16&255,this.m_typeB=this.m_key>>24&255}get indexA(){return this.m_indexA}set indexA(t){this.m_indexA=t,this.m_key_invalid=!0}get indexB(){return this.m_indexB}set indexB(t){this.m_indexB=t,this.m_key_invalid=!0}get typeA(){return this.m_typeA}set typeA(t){this.m_typeA=t,this.m_key_invalid=!0}get typeB(){return this.m_typeB}set typeB(t){this.m_typeB=t,this.m_key_invalid=!0}},es=class i{constructor(){this.cf=new ed}Copy(t){return this.key=t.key,this}Clone(){return new i().Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}},id=class{constructor(){this.localPoint=new n;this.normalImpulse=0;this.tangentImpulse=0;this.id=new es}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}};var po=class i{constructor(){this.points=H(Ot,id);this.localNormal=new n;this.localPoint=new n;this.type=0;this.pointCount=0}Reset(){for(let t=0;t<Ot;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=0,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<Ot;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return new i().Copy(this)}},Fi=class i{constructor(){this.normal=new n;this.points=H(Ot,n);this.separations=je(Ot)}static{this.Initialize_s_pointA=new n}static{this.Initialize_s_pointB=new n}static{this.Initialize_s_cA=new n}static{this.Initialize_s_cB=new n}static{this.Initialize_s_planePoint=new n}static{this.Initialize_s_clipPoint=new n}Initialize(t,e,r,o,s){if(t.pointCount!==0)switch(t.type){case 0:{this.normal.Set(1,0);let l=T.MultiplyVec2(e,t.localPoint,i.Initialize_s_pointA),a=T.MultiplyVec2(o,t.points[0].localPoint,i.Initialize_s_pointB);n.DistanceSquared(l,a)>Rr&&n.Subtract(a,l,this.normal).Normalize();let c=n.AddScaled(l,r,this.normal,i.Initialize_s_cA),u=n.SubtractScaled(a,s,this.normal,i.Initialize_s_cB);n.Mid(c,u,this.points[0]),this.separations[0]=n.Dot(n.Subtract(u,c,n.s_t0),this.normal);break}case 1:{D.MultiplyVec2(e.q,t.localNormal,this.normal);let l=T.MultiplyVec2(e,t.localPoint,i.Initialize_s_planePoint);for(let a=0;a<t.pointCount;++a){let c=T.MultiplyVec2(o,t.points[a].localPoint,i.Initialize_s_clipPoint),u=r-n.Dot(n.Subtract(c,l,n.s_t0),this.normal),m=n.AddScaled(c,u,this.normal,i.Initialize_s_cA),p=n.SubtractScaled(c,s,this.normal,i.Initialize_s_cB);n.Mid(m,p,this.points[a]),this.separations[a]=n.Dot(n.Subtract(p,m,n.s_t0),this.normal)}break}case 2:{D.MultiplyVec2(o.q,t.localNormal,this.normal);let l=T.MultiplyVec2(o,t.localPoint,i.Initialize_s_planePoint);for(let a=0;a<t.pointCount;++a){let c=T.MultiplyVec2(e,t.points[a].localPoint,i.Initialize_s_clipPoint),u=s-n.Dot(n.Subtract(c,l,n.s_t0),this.normal),m=n.AddScaled(c,u,this.normal,i.Initialize_s_cB),p=n.SubtractScaled(c,r,this.normal,i.Initialize_s_cA);n.Mid(p,m,this.points[a]),this.separations[a]=n.Dot(n.Subtract(p,m,n.s_t0),this.normal)}this.normal.Negate();break}}}};function i0(i,t,e,r){let o;for(o=0;o<e.pointCount;++o){let{key:s}=e.points[o].id;i[o]=3;for(let l=0;l<r.pointCount;++l)if(r.points[l].id.key===s){i[o]=2;break}}for(;o<Ot;++o)i[o]=0;for(o=0;o<r.pointCount;++o){let{key:s}=r.points[o].id;t[o]=1;for(let l=0;l<e.pointCount;++l)if(e.points[l].id.key===s){t[o]=2;break}}for(;o<Ot;++o)t[o]=0}var pe=class{constructor(){this.v=new n;this.id=new es}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}},_i=class{constructor(){this.p1=new n;this.p2=new n;this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}},yi=class{constructor(){this.normal=new n;this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}},lt=class{constructor(){this.lowerBound=new n;this.upperBound=new n}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){return this.lowerBound.IsValid()&&this.upperBound.IsValid()&&this.upperBound.x>=this.lowerBound.x&&this.upperBound.y>=this.lowerBound.y}GetCenter(t){return n.Mid(this.lowerBound,this.upperBound,t)}GetExtents(t){return n.Extents(this.lowerBound,this.upperBound,t)}GetPerimeter(){let t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)}Combine1(t){return this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,r){return r.Combine2(t,e),r}Contains(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let r=-tt,o=tt,s=e.p1.x,l=e.p1.y,a=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,u=Math.abs(a),m=Math.abs(c),{normal:p}=t;if(u<gt){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{let d=1/a,h=(this.lowerBound.x-s)*d,f=(this.upperBound.x-s)*d,b=-1;if(h>f){let x=h;h=f,f=x,b=1}if(h>r&&(p.x=b,p.y=0,r=h),o=Math.min(o,f),r>o)return!1}if(m<gt){if(l<this.lowerBound.y||this.upperBound.y<l)return!1}else{let d=1/c,h=(this.lowerBound.y-l)*d,f=(this.upperBound.y-l)*d,b=-1;if(h>f){let x=h;h=f,f=x,b=1}if(h>r&&(p.x=0,p.y=b,r=h),o=Math.min(o,f),r>o)return!1}return r<0||e.maxFraction<r?!1:(t.fraction=r,!0)}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}};function is(i,[t,e],r,o,s){let l=0,a=n.Dot(r,t.v)-o,c=n.Dot(r,e.v)-o;if(a<=0&&i[l++].Copy(t),c<=0&&i[l++].Copy(e),a*c<0){let u=a/(a-c),{v:m,id:p}=i[l];m.x=t.v.x+u*(e.v.x-t.v.x),m.y=t.v.y+u*(e.v.y-t.v.y),p.cf.indexA=s,p.cf.indexB=t.id.cf.indexB,p.cf.typeA=0,p.cf.typeB=1,++l}return l}var Hw=new Ri,Ow=new Mi,Nw=new ki;function rs(i,t,e,r,o,s){let l=Hw.Reset();l.proxyA.SetShape(i,t),l.proxyB.SetShape(e,r),l.transformA.Copy(o),l.transformB.Copy(s),l.useRadii=!0;let a=Ow.Reset();a.count=0;let c=Nw.Reset();return kr(c,a,l),c.distance<10*gt}var Zw=new n,K2=new n,Pn=[];function Ya(i,t,e){if(e.length===0)return Pn;let r=n.Subtract(t,i,Zw);r.Normalize();let o=[],s=0,l=n.Cross(n.Subtract(e[s],i,K2),r);l>0&&o.push(e[s]);for(let p=1;p<e.length;++p){let d=n.Cross(n.Subtract(e[p],i,K2),r);d>l&&(s=p,l=d),d>0&&o.push(e[p])}if(l<2*Z)return Pn;let a=e[s],c=Ya(i,a,o),u=Ya(a,t,o),m=[...c,a,...u];return N(m.length<Wt),m}var $2=new n,Qw=new n,qw=new n,Ww=new n,Kw=new lt;function Dn(i,t){if(t<3||t>Wt)return Pn;t=Math.min(t,Wt);let e=Kw;e.lowerBound.Set(tt,tt),e.upperBound.Set(-tt,-tt);let r=[],o=16*Z*Z;for(let S=0;S<t;++S){n.Min(e.lowerBound,i[S],e.lowerBound),n.Max(e.upperBound,i[S],e.upperBound);let w=i[S],B=!0;for(let C=0;C<S;++C){let A=i[C];if(n.DistanceSquared(w,A)<o){B=!1;break}}B&&r.push(w)}let s=r.length;if(s<3)return Pn;let l=e.GetCenter(qw),a=0,c=n.DistanceSquared(l,r[a]);for(let S=1;S<s;++S){let w=n.DistanceSquared(l,r[S]);w>c&&(a=S,c=w)}let u=r[a];r[a]=r[s-1],s-=1;let m=0,p=n.DistanceSquared(u,r[m]);for(let S=1;S<s;++S){let w=n.DistanceSquared(u,r[S]);w>p&&(m=S,p=w)}let d=r[m];r[m]=r[s-1],s-=1;let h=[],f=[],b=n.Subtract(d,u,$2);b.Normalize();for(let S=0;S<s;++S){let w=n.Cross(n.Subtract(r[S],u,Ww),b);w>=2*Z?h.push(r[S]):w<=-2*Z&&f.push(r[S])}let x=Ya(u,d,h),_=Ya(d,u,f);if(x.length===0&&_.length===0)return Pn;let y=[u,...x,d,..._];N(y.length<=Wt);let g=!0;for(;g&&y.length>2;){g=!1;for(let S=0;S<y.length;++S){let w=S,B=(S+1)%y.length,C=(S+2)%y.length,A=y[w],k=y[B],M=y[C],E=n.Subtract(M,A,$2);E.Normalize();let L=n.Subtract(k,A,Qw);if(n.Cross(L,E)<=2*Z){y.splice(B,1),g=!0;break}}}return y.length<3&&(y.length=0),y}var t0=new n,e0=new n;function Mn(i,t){if(t<3||Wt<t)return!1;for(let e=0;e<t;++e){let r=e,o=e<t-1?r+1:0,s=i[r],l=n.Subtract(i[o],s,t0);l.Normalize();for(let a=0;a<t;++a){if(a===r||a===o)continue;if(n.Cross(n.Subtract(i[a],s,e0),l)>=0)return!1}}for(let e=0;e<t;++e){let r=e,o=(e+1)%t,s=(e+2)%t,l=i[r],a=i[o],c=i[s],u=n.Subtract(c,l,t0);if(u.Normalize(),n.Cross(n.Subtract(a,l,e0),u)<=Z)return!1}return!0}var $w={c1:new n,c2:new n},Ja={categoryBits:1,maskBits:65535,groupIndex:0},rd=class{constructor(t,e,r,o){this.aabb=new lt;this.fixture=t,this.childIndex=o,t.m_shape.ComputeAABB(this.aabb,r,o),this.treeNode=e.CreateProxy(this.aabb,this)}},tv=new lt,ev=new lt,iv=new n,za=class{constructor(t,e){this.m_density=0;this.m_next=null;this.m_friction=0;this.m_restitution=0;this.m_restitutionThreshold=0;this.m_proxies=[];this.m_isSensor=!1;this.m_userData={};this.m_body=t,this.m_shape=e.shape.Clone(),e.userData&&this.SetUserData(e.userData),this.m_friction=e.friction??.2,this.m_restitution=e.restitution??0,this.m_restitutionThreshold=e.restitutionThreshold??Mr,this.m_filter={...Ja,...e.filter},this.m_isSensor=e.isSensor??!1,this.m_density=e.density??0}get m_proxyCount(){return this.m_proxies.length}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.categoryBits=t.categoryBits??Ja.categoryBits,this.m_filter.groupIndex=t.groupIndex??Ja.groupIndex,this.m_filter.maskBits=t.maskBits??Ja.maskBits,this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){let{contact:o}=t,s=o.GetFixtureA(),l=o.GetFixtureB();(s===this||l===this)&&o.FlagForFiltering(),t=t.next}let r=this.m_body.GetWorld().m_contactManager.m_broadPhase;for(let o of this.m_proxies)r.TouchProxy(o.treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}RayCast(t,e,r){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),r)}GetMassData(t=new ke){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetAABB(t){return this.m_proxies[t].aabb}CreateProxies(t,e){N(this.m_proxies.length===0),this.m_proxies.length=this.m_shape.GetChildCount();for(let r=0;r<this.m_proxies.length;++r)this.m_proxies[r]=new rd(this,t,e,r)}DestroyProxies(t){for(let e of this.m_proxies)t.DestroyProxy(e.treeNode);this.m_proxies.length=0}Synchronize(t,e,r){let{c1:o,c2:s}=$w,l=iv;for(let a of this.m_proxies){let c=tv,u=ev;this.m_shape.ComputeAABB(c,e,a.childIndex),this.m_shape.ComputeAABB(u,r,a.childIndex),a.aabb.Combine2(c,u),n.Subtract(u.GetCenter(s),c.GetCenter(o),l),t.MoveProxy(a.treeNode,a.aabb,l)}}};var ho=class i{constructor(t,e){this.m_type=0;this.m_islandFlag=!1;this.m_awakeFlag=!1;this.m_autoSleepFlag=!1;this.m_bulletFlag=!1;this.m_fixedRotationFlag=!1;this.m_enabledFlag=!1;this.m_toiFlag=!1;this.m_islandIndex=0;this.m_xf=new T;this.m_sweep=new ee;this.m_linearVelocity=new n;this.m_angularVelocity=0;this.m_force=new n;this.m_torque=0;this.m_prev=null;this.m_next=null;this.m_fixtureList=null;this.m_fixtureCount=0;this.m_jointList=null;this.m_contactList=null;this.m_mass=1;this.m_invMass=1;this.m_I=0;this.m_invI=0;this.m_linearDamping=0;this.m_angularDamping=0;this.m_gravityScale=1;this.m_sleepTime=0;this.m_userData={};this.m_bulletFlag=t.bullet??!1,this.m_fixedRotationFlag=t.fixedRotation??!1,this.m_autoSleepFlag=t.allowSleep??!0,(t.awake??!0)&&(t.type??0)!==0&&(this.m_awakeFlag=!0),this.m_enabledFlag=t.enabled??!0,this.m_world=e,this.m_xf.p.Copy(t.position??n.ZERO),this.m_xf.q.Set(t.angle??0),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity??n.ZERO),this.m_angularVelocity=t.angularVelocity??0,this.m_linearDamping=t.linearDamping??0,this.m_angularDamping=t.angularDamping??0,this.m_gravityScale=t.gravityScale??1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type??0,this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,t.userData&&this.SetUserData(t.userData),this.m_fixtureList=null,this.m_fixtureCount=0}CreateFixture(t){N(!this.m_world.IsLocked());let e=new za(this,t);if(this.m_enabledFlag){let r=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(r,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}DestroyFixture(t){N(!this.m_world.IsLocked());let e=this.m_fixtureList,r=null;for(;e!==null;){if(e===t){r?r.m_next=t.m_next:this.m_fixtureList=t.m_next;break}r=e,e=e.m_next}let o=t.m_density,s=this.m_contactList;for(;s;){let l=s.contact;s=s.next;let a=l.GetFixtureA(),c=l.GetFixtureB();(t===a||t===c)&&this.m_world.m_contactManager.Destroy(l)}if(this.m_enabledFlag){let l=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(l)}t.m_next=null,--this.m_fixtureCount,o>0&&this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,r){N(!this.m_world.IsLocked()),this.m_xf.q.Set(r),this.m_xf.p.Set(t,e),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=r,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=r;let o=this.m_world.m_contactManager.m_broadPhase;for(let s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(o,this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==0&&(n.Dot(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==0&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}ApplyForce(t,e,r=!0){this.m_type===2&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,r=!0){this.m_type===2&&(r&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===2&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*n.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*n.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}static{this.SetMassData_s_oldCenter=new n}SetMassData(t){if(N(!this.m_world.IsLocked()),this.m_type!==2)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*n.Dot(t.center,t.center),this.m_invI=1/this.m_I);let e=i.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(this.m_sweep.c,e,n.s_t0),this.m_linearVelocity)}static{this.ResetMassData_s_localCenter=new n}static{this.ResetMassData_s_oldCenter=new n}static{this.ResetMassData_s_massData=new ke}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===0||this.m_type===1){this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}let t=i.ResetMassData_s_localCenter.SetZero();for(let r=this.m_fixtureList;r;r=r.m_next){if(r.m_density===0)continue;let o=r.GetMassData(i.ResetMassData_s_massData);this.m_mass+=o.mass,t.AddScaled(o.mass,o.center),this.m_I+=o.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,t.Scale(this.m_invMass)),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*n.Dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);let e=i.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),T.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(this.m_sweep.c,e,n.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return T.MultiplyVec2(this.m_xf,t,e)}GetWorldVector(t,e){return D.MultiplyVec2(this.m_xf.q,t,e)}GetLocalPoint(t,e){return T.TransposeMultiplyVec2(this.m_xf,t,e)}GetLocalVector(t,e){return D.TransposeMultiplyVec2(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(t,this.m_sweep.c,n.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if(N(!this.m_world.IsLocked()),this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===0&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){let o=e;e=e.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null;let r=this.m_world.m_contactManager.m_broadPhase;for(let o=this.m_fixtureList;o;o=o.m_next)for(let s of o.m_proxies)r.TouchProxy(s.treeNode)}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){this.m_type!==0&&(t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(t){if(N(!this.m_world.IsLocked()),t===this.IsEnabled())return;this.m_enabledFlag=t;let e=this.m_world.m_contactManager.m_broadPhase;if(t){for(let r=this.m_fixtureList;r;r=r.m_next)r.CreateProxies(e,this.m_xf);this.m_world.m_newContacts=!0}else{for(let o=this.m_fixtureList;o;o=o.m_next)o.DestroyProxies(e);let r=this.m_contactList;for(;r;){let o=r;r=r.next,this.m_world.m_contactManager.Destroy(o.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}GetWorld(){return this.m_world}static{this.SynchronizeFixtures_s_xf1=new T}SynchronizeFixtures(){let t=this.m_world.m_contactManager.m_broadPhase;if(this.m_awakeFlag){let e=i.SynchronizeFixtures_s_xf1;e.q.Set(this.m_sweep.a0),D.MultiplyVec2(e.q,this.m_sweep.localCenter,e.p),n.Subtract(this.m_sweep.c0,e.p,e.p);for(let r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(t,e,this.m_xf)}else for(let e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.Set(this.m_sweep.a),D.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return this.m_type!==2&&t.m_type!==2?!1:this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),D.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),n.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}};var r0={cA:new n,cB:new n,vs:H(4,n),xf:new T};function rv(i){return i.GetType()===2&&i.m_mass===0?Q.badBody:i.IsEnabled()?i.GetType()===0?Q.staticBody:i.GetType()===1?Q.kinematicBody:i.IsAwake()?Q.body:Q.sleepingBody:Q.disabledBody}function ov(i,t){for(let e=0;e<i.m_proxyCount;e++)if(t.TestOverlap(i.GetAABB(e)))return!0;return!1}function o0(i,t,e){for(let r=t.GetBodyList();r;r=r.m_next){let o=r.m_xf;i.PushTransform(o);for(let s=r.GetFixtureList();s;s=s.m_next)e&&!ov(s,e)||s.GetShape().Draw(i,rv(r));i.PopTransform(o)}}function s0(i,t){for(let e=t.GetJointList();e;e=e.m_next)e.Draw(i)}function n0(i,t,e){let{vs:r}=r0;for(let o=t.GetBodyList();o;o=o.m_next)if(o.IsEnabled())for(let s=o.GetFixtureList();s;s=s.m_next)for(let l=0;l<s.m_proxyCount;++l){let{aabb:a}=s.m_proxies[l].treeNode;e&&!e.TestOverlap(a)||(r[0].Set(a.lowerBound.x,a.lowerBound.y),r[1].Set(a.upperBound.x,a.lowerBound.y),r[2].Set(a.upperBound.x,a.upperBound.y),r[3].Set(a.lowerBound.x,a.upperBound.y),i.DrawPolygon(r,4,Q.aabb))}}function l0(i,t){let{xf:e}=r0;for(let r=t.GetBodyList();r;r=r.m_next)e.q.Copy(r.m_xf.q),e.p.Copy(r.GetWorldCenter()),i.DrawTransform(e)}var ri=class{constructor(){this.m_start=performance.now()}Reset(){return this.m_start=performance.now(),this}GetMilliseconds(){return performance.now()-this.m_start}};function Ii(i,t){for(let e of Object.keys(t)){let r=t[e],o=i[e],s=function(...l){return r.call(this,o.bind(this),...l)};Object.defineProperty(s,"name",{value:e}),i[e]=s}}var $i={stack:[],t:new n,r:new n,v:new n,abs_v:new n,segmentAABB:new lt,subInput:new _i,combinedAABB:new lt,aabb:new lt,fatAABB:new lt,hugeAABB:new lt,c:new n,h:new n},sv=0,Rn=class{constructor(){this.aabb=new lt;this.userData=null;this.parent=null;this.child1=null;this.child2=null;this.height=0;this.moved=!1;this.id=sv++}Reset(){this.child1=null,this.child2=null,this.height=-1,this.userData=null}IsLeaf(){return this.child1===null}GetArea(){if(this.IsLeaf())return 0;let t=this.aabb.GetPerimeter();return this.child1&&(t+=this.child1.GetArea()),this.child2&&(t+=this.child2.GetArea()),t}ComputeHeight(){if(this.IsLeaf())return 0;N(this.child1!==null&&this.child2!==null);let t=ct(this.child1).ComputeHeight(),e=ct(this.child2).ComputeHeight();return 1+Math.max(t,e)}GetMaxBalance(){if(this.height<=1)return 0;let t=ct(this.child1),e=ct(this.child2);return Math.max(t.GetMaxBalance(),e.GetMaxBalance(),Math.abs(e.height-t.height))}ShiftOrigin(t){this.height<=1||(ct(this.child1).ShiftOrigin(t),ct(this.child2).ShiftOrigin(t),this.aabb.lowerBound.Subtract(t),this.aabb.upperBound.Subtract(t))}},os=class{constructor(){this.m_root=null;this.m_freeList=null}Query(t,e){let r=$i.stack;r.length=0;let o=this.m_root;for(;o;){if(o.aabb.TestOverlap(t))if(o.IsLeaf()){if(!e(o))return}else r.push(o.child1),r.push(o.child2);o=r.pop()}}QueryPoint(t,e){let r=$i.stack;r.length=0;let o=this.m_root;for(;o;){if(o.aabb.TestContain(t))if(o.IsLeaf()){if(!e(o))return}else r.push(o.child1),r.push(o.child2);o=r.pop()}}RayCast(t,e){let{p1:r,p2:o}=t,s=n.Subtract(o,r,$i.r);s.Normalize();let l=n.CrossOneVec2(s,$i.v),a=l.GetAbs($i.abs_v),{maxFraction:c}=t,{segmentAABB:u,subInput:m,c:p,h:d,t:h}=$i;n.AddScaled(r,c,n.Subtract(o,r,h),h),n.Min(r,h,u.lowerBound),n.Max(r,h,u.upperBound);let f=$i.stack;f.length=0;let b=this.m_root;for(;b;){if(!b.aabb.TestOverlap(u)){b=f.pop();continue}if(b.aabb.GetCenter(p),b.aabb.GetExtents(d),Math.abs(n.Dot(l,n.Subtract(r,p,n.s_t0)))-n.Dot(a,d)>0){b=f.pop();continue}if(b.IsLeaf()){m.p1.Copy(t.p1),m.p2.Copy(t.p2),m.maxFraction=c;let _=e(m,b);if(_===0)return;_>0&&(c=_,n.AddScaled(r,c,n.Subtract(o,r,h),h),n.Min(r,h,u.lowerBound),n.Max(r,h,u.upperBound))}else f.push(b.child1),f.push(b.child2);b=f.pop()}}AllocateNode(){if(this.m_freeList===null)return new Rn;let t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}FreeNode(t){t.parent=this.m_freeList,t.Reset(),this.m_freeList=t}CreateProxy(t,e){let r=this.AllocateNode(),o=Ia;return r.aabb.lowerBound.Set(t.lowerBound.x-o,t.lowerBound.y-o),r.aabb.upperBound.Set(t.upperBound.x+o,t.upperBound.y+o),r.userData=e,r.height=0,r.moved=!0,this.InsertLeaf(r),r}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,r){let{fatAABB:o,hugeAABB:s}=$i,l=Ia;o.lowerBound.Set(e.lowerBound.x-l,e.lowerBound.y-l),o.upperBound.Set(e.upperBound.x+l,e.upperBound.y+l);let a=qp*r.x,c=qp*r.y;a<0?o.lowerBound.x+=a:o.upperBound.x+=a,c<0?o.lowerBound.y+=c:o.upperBound.y+=c;let u=t.aabb;if(u.Contains(e)){let m=4*Ia;if(s.lowerBound.Set(o.lowerBound.x-m,e.lowerBound.y-m),s.upperBound.Set(o.upperBound.x+m,e.upperBound.y+m),s.Contains(u))return!1}return this.RemoveLeaf(t),t.aabb.Copy(o),this.InsertLeaf(t),t.moved=!0,!0}InsertLeaf(t){if(this.m_root===null){this.m_root=t,this.m_root.parent=null;return}let{combinedAABB:e,aabb:r}=$i,o=t.aabb,s=this.m_root;for(;!s.IsLeaf();){let u=ct(s.child1),m=ct(s.child2),p=s.aabb.GetPerimeter();e.Combine2(s.aabb,o);let d=e.GetPerimeter(),h=2*d,f=2*(d-p),b,x,_;u.IsLeaf()?(r.Combine2(o,u.aabb),b=r.GetPerimeter()+f):(r.Combine2(o,u.aabb),x=u.aabb.GetPerimeter(),_=r.GetPerimeter(),b=_-x+f);let y;if(m.IsLeaf()?(r.Combine2(o,m.aabb),y=r.GetPerimeter()+f):(r.Combine2(o,m.aabb),x=m.aabb.GetPerimeter(),_=r.GetPerimeter(),y=_-x+f),h<b&&h<y)break;b<y?s=u:s=m}let l=s.parent,a=this.AllocateNode();a.parent=l,a.userData=null,a.aabb.Combine2(o,s.aabb),a.height=s.height+1,l!==null?(l.child1===s?l.child1=a:l.child2=a,a.child1=s,a.child2=t,s.parent=a,t.parent=a):(a.child1=s,a.child2=t,s.parent=a,t.parent=a,this.m_root=a);let c=t.parent;for(;c!==null;){c=this.Balance(c);let u=ct(c.child1),m=ct(c.child2);c.height=1+Math.max(u.height,m.height),c.aabb.Combine2(u.aabb,m.aabb),c=c.parent}}RemoveLeaf(t){if(t===this.m_root){this.m_root=null;return}let e=ct(t.parent),r=e.parent,o=ct(e.child1===t?e.child2:e.child1);if(r!==null){r.child1===e?r.child1=o:r.child2=o,o.parent=r,this.FreeNode(e);let s=r;for(;s!==null;){s=this.Balance(s);let l=ct(s.child1),a=ct(s.child2);s.aabb.Combine2(l.aabb,a.aabb),s.height=1+Math.max(l.height,a.height),s=s.parent}}else this.m_root=o,o.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;let e=ct(t.child1),r=ct(t.child2),o=r.height-e.height;if(o>1){let s=ct(r.child1),l=ct(r.child2);return r.child1=t,r.parent=t.parent,t.parent=r,r.parent!==null?r.parent.child1===t?r.parent.child1=r:r.parent.child2=r:this.m_root=r,s.height>l.height?(r.child2=s,t.child2=l,l.parent=t,t.aabb.Combine2(e.aabb,l.aabb),r.aabb.Combine2(t.aabb,s.aabb),t.height=1+Math.max(e.height,l.height),r.height=1+Math.max(t.height,s.height)):(r.child2=l,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),r.aabb.Combine2(t.aabb,l.aabb),t.height=1+Math.max(e.height,s.height),r.height=1+Math.max(t.height,l.height)),r}if(o<-1){let s=ct(e.child1),l=ct(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,e.parent!==null?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,s.height>l.height?(e.child2=s,t.child1=l,l.parent=t,t.aabb.Combine2(r.aabb,l.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+Math.max(r.height,l.height),e.height=1+Math.max(t.height,s.height)):(e.child2=l,t.child1=s,s.parent=t,t.aabb.Combine2(r.aabb,s.aabb),e.aabb.Combine2(t.aabb,l.aabb),t.height=1+Math.max(r.height,s.height),e.height=1+Math.max(t.height,l.height)),e}return t}GetHeight(){return this.m_root===null?0:this.m_root.height}GetAreaRatio(){if(this.m_root===null)return 0;let t=this.m_root,e=t.aabb.GetPerimeter();return t.GetArea()/e}GetMaxBalance(){return this.m_root===null?0:this.m_root.GetMaxBalance()}ShiftOrigin(t){this.m_root?.ShiftOrigin(t)}};var ja=class{constructor(){this.m_tree=new os;this.m_proxyCount=0;this.m_moveCount=0;this.m_moveBuffer=[];this.m_pairCount=0;this.m_pairBuffer=[];this.m_queryProxy=new Rn;this.QueryCallback=t=>(t.id===this.m_queryProxy.id||t.moved&&t.id>this.m_queryProxy.id||(this.m_pairBuffer[this.m_pairCount]=t.id<this.m_queryProxy.id?[t,this.m_queryProxy]:[this.m_queryProxy,t],++this.m_pairCount),!0)}CreateProxy(t,e){let r=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(r),r}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,r){this.m_tree.MoveProxy(t,e,r)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let e=0;e<this.m_moveCount;++e){let r=this.m_moveBuffer[e];if(r===null)continue;this.m_queryProxy=r;let o=r.aabb;this.m_tree.Query(o,this.QueryCallback)}for(let e=0;e<this.m_pairCount;++e){let r=this.m_pairBuffer[e],o=ct(r[0].userData),s=ct(r[1].userData);t(o,s)}for(let e=0;e<this.m_moveCount;++e){let r=this.m_moveBuffer[e];r&&(r.moved=!1)}this.m_moveCount=0}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){for(let e=0;e<this.m_moveCount;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)}};var ot={time:0,maxTime:0,calls:0,iters:0,maxIters:0,rootIters:0,maxRootIters:0,reset(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}},Xa=new T,Ha=new T,tr=new n,er=new n,ss=new n,a0=new n,c0=new n,ns=class{constructor(){this.proxyA=new Ki;this.proxyB=new Ki;this.sweepA=new ee;this.sweepB=new ee;this.tMax=0}};var ls=class{constructor(){this.state=0;this.t=0}};var od=class{constructor(){this.m_sweepA=new ee;this.m_sweepB=new ee;this.m_type=0;this.m_localPoint=new n;this.m_axis=new n}Initialize(t,e,r,o,s,l){this.m_proxyA=e,this.m_proxyB=o;let{count:a}=t;this.m_sweepA.Copy(r),this.m_sweepB.Copy(s);let c=this.m_sweepA.GetTransform(Xa,l),u=this.m_sweepB.GetTransform(Ha,l);if(a===1){this.m_type=0;let _=this.m_proxyA.GetVertex(t.indexA[0]),y=this.m_proxyB.GetVertex(t.indexB[0]),g=T.MultiplyVec2(c,_,tr),S=T.MultiplyVec2(u,y,er);return n.Subtract(S,g,this.m_axis),this.m_axis.Normalize()}if(t.indexA[0]===t.indexA[1]){this.m_type=2;let _=this.m_proxyB.GetVertex(t.indexB[0]),y=this.m_proxyB.GetVertex(t.indexB[1]);n.CrossVec2One(n.Subtract(y,_,n.s_t0),this.m_axis).Normalize();let g=D.MultiplyVec2(u.q,this.m_axis,ss);n.Mid(_,y,this.m_localPoint);let S=T.MultiplyVec2(u,this.m_localPoint,er),w=this.m_proxyA.GetVertex(t.indexA[0]),B=T.MultiplyVec2(c,w,tr),C=n.Dot(n.Subtract(B,S,n.s_t0),g);return C<0&&(this.m_axis.Negate(),C=-C),C}this.m_type=1;let m=this.m_proxyA.GetVertex(t.indexA[0]),p=this.m_proxyA.GetVertex(t.indexA[1]);n.CrossVec2One(n.Subtract(p,m,n.s_t0),this.m_axis).Normalize();let d=D.MultiplyVec2(c.q,this.m_axis,ss);n.Mid(m,p,this.m_localPoint);let h=T.MultiplyVec2(c,this.m_localPoint,tr),f=this.m_proxyB.GetVertex(t.indexB[0]),b=T.MultiplyVec2(u,f,er),x=n.Dot(n.Subtract(b,h,n.s_t0),d);return x<0&&(this.m_axis.Negate(),x=-x),x}FindMinSeparation(t,e,r){let o=this.m_sweepA.GetTransform(Xa,r),s=this.m_sweepB.GetTransform(Ha,r);switch(this.m_type){case 0:{let l=D.TransposeMultiplyVec2(o.q,this.m_axis,a0),a=D.TransposeMultiplyVec2(s.q,n.Negate(this.m_axis,n.s_t0),c0);t[0]=this.m_proxyA.GetSupport(l),e[0]=this.m_proxyB.GetSupport(a);let c=this.m_proxyA.GetVertex(t[0]),u=this.m_proxyB.GetVertex(e[0]),m=T.MultiplyVec2(o,c,tr),p=T.MultiplyVec2(s,u,er);return n.Dot(n.Subtract(p,m,n.s_t0),this.m_axis)}case 1:{let l=D.MultiplyVec2(o.q,this.m_axis,ss),a=T.MultiplyVec2(o,this.m_localPoint,tr),c=D.TransposeMultiplyVec2(s.q,n.Negate(l,n.s_t0),c0);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);let u=this.m_proxyB.GetVertex(e[0]),m=T.MultiplyVec2(s,u,er);return n.Dot(n.Subtract(m,a,n.s_t0),l)}case 2:{let l=D.MultiplyVec2(s.q,this.m_axis,ss),a=T.MultiplyVec2(s,this.m_localPoint,er),c=D.TransposeMultiplyVec2(o.q,n.Negate(l,n.s_t0),a0);e[0]=-1,t[0]=this.m_proxyA.GetSupport(c);let u=this.m_proxyA.GetVertex(t[0]),m=T.MultiplyVec2(o,u,tr);return n.Dot(n.Subtract(m,a,n.s_t0),l)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,r){let o=this.m_sweepA.GetTransform(Xa,r),s=this.m_sweepB.GetTransform(Ha,r);switch(this.m_type){case 0:{let l=this.m_proxyA.GetVertex(t),a=this.m_proxyB.GetVertex(e),c=T.MultiplyVec2(o,l,tr),u=T.MultiplyVec2(s,a,er);return n.Dot(n.Subtract(u,c,n.s_t0),this.m_axis)}case 1:{let l=D.MultiplyVec2(o.q,this.m_axis,ss),a=T.MultiplyVec2(o,this.m_localPoint,tr),c=this.m_proxyB.GetVertex(e),u=T.MultiplyVec2(s,c,er);return n.Dot(n.Subtract(u,a,n.s_t0),l)}case 2:{let l=D.MultiplyVec2(s.q,this.m_axis,ss),a=T.MultiplyVec2(s,this.m_localPoint,er),c=this.m_proxyA.GetVertex(t),u=T.MultiplyVec2(o,c,tr);return n.Dot(n.Subtract(u,a,n.s_t0),l)}default:return N(!1),0}}},nv=new ri,lv=new Mi,av=new Ri,cv=new ki,uv=new od,mv=[0],pv=[0],dv=new ee,hv=new ee;function Oa(i,t){let e=nv.Reset();++ot.calls,i.state=0,i.t=t.tMax;let{proxyA:r,proxyB:o,tMax:s}=t,l=Math.max(Wt,r.m_count,o.m_count),a=dv.Copy(t.sweepA),c=hv.Copy(t.sweepB);a.Normalize(),c.Normalize();let u=r.m_radius+o.m_radius,m=Math.max(Z,u-3*Z),p=.25*Z,d=0,h=20,f=0,b=lv;b.count=0;let x=av;for(x.proxyA.Copy(t.proxyA),x.proxyB.Copy(t.proxyB),x.useRadii=!1;;){let y=a.GetTransform(Xa,d),g=c.GetTransform(Ha,d);x.transformA.Copy(y),x.transformB.Copy(g);let S=cv;if(kr(S,b,x),S.distance<=0){i.state=2,i.t=0;break}if(S.distance<m+p){i.state=3,i.t=d;break}let w=uv;w.Initialize(b,r,a,o,c,d);let B=!1,C=s,A=0;for(;;){let k=mv,M=pv,E=w.FindMinSeparation(k,M,C);if(E>m+p){i.state=4,i.t=s,B=!0;break}if(E>m-p){d=C;break}let L=w.Evaluate(k[0],M[0],d);if(L<m-p){i.state=1,i.t=d,B=!0;break}if(L<=m+p){i.state=3,i.t=d,B=!0;break}let U=0,Y=d,O=C;for(;;){let K;U&1?K=Y+(m-L)*(O-Y)/(E-L):K=.5*(Y+O),++U,++ot.rootIters;let mt=w.Evaluate(k[0],M[0],K);if(Math.abs(mt-m)<p){C=K;break}if(mt>m?(Y=K,L=mt):(O=K,E=mt),U===50)break}if(ot.maxRootIters=Math.max(ot.maxRootIters,U),++A,A===l)break}if(++f,++ot.iters,B)break;if(f===h){i.state=1,i.t=d;break}}ot.maxIters=Math.max(ot.maxIters,f);let _=e.GetMilliseconds();ot.maxTime=Math.max(ot.maxTime,_),ot.time+=_}var fv=new n,bv=new n;function u0(i,t,e,r,o){i.pointCount=0;let s=T.MultiplyVec2(e,t.m_p,fv),l=T.MultiplyVec2(o,r.m_p,bv),a=n.DistanceSquared(s,l),c=t.m_radius+r.m_radius;a>c*c||(i.type=0,i.localPoint.Copy(t.m_p),i.localNormal.SetZero(),i.pointCount=1,i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0)}var _v=new n,yv=new n,xv=new n;function m0(i,t,e,r,o){i.pointCount=0;let s=T.MultiplyVec2(o,r.m_p,_v),l=T.TransposeMultiplyVec2(e,s,yv),a=0,c=-tt,u=t.m_radius+r.m_radius,m=t.m_count,p=t.m_vertices,d=t.m_normals;for(let g=0;g<m;++g){let S=n.Dot(d[g],n.Subtract(l,p[g],n.s_t0));if(S>u)return;S>c&&(c=S,a=g)}let h=a,f=h+1<m?h+1:0,b=p[h],x=p[f];if(c<gt){i.pointCount=1,i.type=1,i.localNormal.Copy(d[a]),n.Mid(b,x,i.localPoint),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0;return}let _=n.Dot(n.Subtract(l,b,n.s_t0),n.Subtract(x,b,n.s_t1)),y=n.Dot(n.Subtract(l,x,n.s_t0),n.Subtract(b,x,n.s_t1));if(_<=0){if(n.DistanceSquared(l,b)>u*u)return;i.pointCount=1,i.type=1,n.Subtract(l,b,i.localNormal).Normalize(),i.localPoint.Copy(b),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}else if(y<=0){if(n.DistanceSquared(l,x)>u*u)return;i.pointCount=1,i.type=1,n.Subtract(l,x,i.localNormal).Normalize(),i.localPoint.Copy(x),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}else{let g=n.Mid(b,x,xv);if(n.Dot(n.Subtract(l,g,n.s_t1),d[h])>u)return;i.pointCount=1,i.type=1,i.localNormal.Copy(d[h]),i.localPoint.Copy(g),i.points[0].localPoint.Copy(r.m_p),i.points[0].id.key=0}}var Sv=new T,wv=new n,vv=new n;function p0(i,t,e,r,o){let s=t.m_count,l=r.m_count,a=t.m_normals,c=t.m_vertices,u=r.m_vertices,m=T.TransposeMultiply(o,e,Sv),p=0,d=-tt;for(let h=0;h<s;++h){let f=D.MultiplyVec2(m.q,a[h],wv),b=T.MultiplyVec2(m,c[h],vv),x=tt;for(let _=0;_<l;++_){let y=n.Dot(f,n.Subtract(u[_],b,n.s_t0));y<x&&(x=y)}x>d&&(d=x,p=h)}return i[0]=p,d}var Bv=new n;function Cv(i,t,e,r,o,s){let l=t.m_normals,a=o.m_count,c=o.m_vertices,u=o.m_normals,m=D.TransposeMultiplyVec2(s.q,D.MultiplyVec2(e.q,l[r],n.s_t0),Bv),p=0,d=tt;for(let g=0;g<a;++g){let S=n.Dot(m,u[g]);S<d&&(d=S,p=g)}let h=p,f=h+1<a?h+1:0,b=i[0];T.MultiplyVec2(s,c[h],b.v);let x=b.id.cf;x.indexA=r,x.indexB=h,x.typeA=1,x.typeB=0;let _=i[1];T.MultiplyVec2(s,c[f],_.v);let y=_.id.cf;y.indexA=r,y.indexB=f,y.typeA=1,y.typeB=0}var Av=[new pe,new pe],Tv=[new pe,new pe],Pv=[new pe,new pe],Dv=[0],Mv=[0],Rv=new n,kv=new n,Fv=new n,Iv=new n,Lv=new n,Gv=new n,Vv=new n,Ev=new n;function Na(i,t,e,r,o){i.pointCount=0;let s=t.m_radius+r.m_radius,l=Dv,a=p0(l,t,e,r,o);if(a>s)return;let c=Mv,u=p0(c,r,o,t,e);if(u>s)return;let m,p,d,h,f,b,x=.1*Z;u>a+x?(m=r,p=t,d=o,h=e,f=c[0],i.type=2,b=1):(m=t,p=r,d=e,h=o,f=l[0],i.type=1,b=0);let _=Av;Cv(_,m,d,f,p,h);let y=m.m_count,g=m.m_vertices,S=f,w=f+1<y?f+1:0,B=g[S],C=g[w],A=n.Subtract(C,B,Rv);A.Normalize();let k=n.CrossVec2One(A,kv),M=n.Mid(B,C,Fv),E=D.MultiplyVec2(d.q,A,Lv),L=n.CrossVec2One(E,Iv);B=T.MultiplyVec2(d,B,Vv),C=T.MultiplyVec2(d,C,Ev);let U=n.Dot(L,B),Y=-n.Dot(E,B)+s,O=n.Dot(E,C)+s,K=Tv,mt=Pv,at=n.Negate(E,Gv),At=is(K,_,at,Y,S);if(At<2||(At=is(mt,K,E,O,w),At<2))return;i.localNormal.Copy(k),i.localPoint.Copy(M);let Gt=0;for(let wt=0;wt<Ot;++wt){let Ce=mt[wt];if(n.Dot(L,Ce.v)-U<=s){let li=i.points[Gt];if(T.TransposeMultiplyVec2(h,Ce.v,li.localPoint),li.id.Copy(Ce.id),b){let{cf:Xt}=li.id;Xt.indexA=Xt.indexB,Xt.indexB=Xt.indexA,Xt.typeA=Xt.typeB,Xt.typeB=Xt.typeA}++Gt}}i.pointCount=Gt}var Uv=new n,Yv=new n,nd=new n,Jv=new n,zv=new n,jv=new n,Xv=new n,Hv=new es;function Qa(i,t,e,r,o){i.pointCount=0;let s=T.TransposeMultiplyVec2(e,T.MultiplyVec2(o,r.m_p,n.s_t0),Uv),l=t.m_vertex1,a=t.m_vertex2,c=n.Subtract(a,l,Yv),u=Xv.Set(c.y,-c.x),m=n.Dot(u,n.Subtract(s,l,n.s_t0));if(t.m_oneSided&&m<0)return;let d=n.Dot(c,n.Subtract(a,s,n.s_t0)),h=n.Dot(c,n.Subtract(s,l,n.s_t0)),f=t.m_radius+r.m_radius,b=Hv;if(b.cf.indexB=0,b.cf.typeB=0,h<=0){let S=l,w=n.Subtract(s,S,nd);if(n.Dot(w,w)>f*f)return;if(t.m_oneSided){let C=t.m_vertex0,A=l,k=n.Subtract(A,C,Jv);if(n.Dot(k,n.Subtract(A,s,n.s_t0))>0)return}b.cf.indexA=0,b.cf.typeA=0,i.pointCount=1,i.type=0,i.localNormal.SetZero(),i.localPoint.Copy(S),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p);return}if(d<=0){let S=a,w=n.Subtract(s,S,nd);if(n.Dot(w,w)>f*f)return;if(t.m_oneSided){let C=t.m_vertex3,A=a,k=n.Subtract(C,A,zv);if(n.Dot(k,n.Subtract(s,A,n.s_t0))>0)return}b.cf.indexA=1,b.cf.typeA=0,i.pointCount=1,i.type=0,i.localNormal.SetZero(),i.localPoint.Copy(S),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p);return}let x=n.Dot(c,c),_=jv;_.x=1/x*(d*l.x+h*a.x),_.y=1/x*(d*l.y+h*a.y);let y=n.Subtract(s,_,nd);n.Dot(y,y)>f*f||(m<0&&u.Set(-u.x,-u.y),u.Normalize(),b.cf.indexA=0,b.cf.typeA=1,i.pointCount=1,i.type=1,i.localNormal.Copy(u),i.localPoint.Copy(l),i.points[0].id.Copy(b),i.points[0].localPoint.Copy(r.m_p))}var Za=class{constructor(){this.normal=new n;this.type=0;this.index=0;this.separation=0}},ld=class{constructor(){this.vertices=H(Wt,n);this.normals=H(Wt,n);this.count=0}},ad=class{constructor(){this.i1=0;this.i2=0;this.v1=new n;this.v2=new n;this.normal=new n;this.sideNormal1=new n;this.sideOffset1=0;this.sideNormal2=new n;this.sideOffset2=0}},Ov=new Za,Nv=[new n,new n];function Zv(i,t,e){let r=Ov;r.type=1,r.index=-1,r.separation=-tt,r.normal.SetZero();let o=Nv;o[0].Copy(e),n.Negate(e,o[1]);for(let s=0;s<2;++s){let l=tt;for(let a=0;a<i.count;++a){let c=n.Dot(o[s],n.Subtract(i.vertices[a],t,n.s_t0));c<l&&(l=c)}l>r.separation&&(r.index=s,r.separation=l,r.normal.Copy(o[s]))}return r}var Qv=new Za,qv=new n;function Wv(i,t,e){let r=Qv;r.type=0,r.index=-1,r.separation=-tt,r.normal.SetZero();for(let o=0;o<i.count;++o){let s=n.Negate(i.normals[o],qv),l=n.Dot(s,n.Subtract(i.vertices[o],t,n.s_t0)),a=n.Dot(s,n.Subtract(i.vertices[o],e,n.s_t0)),c=Math.min(l,a);c>r.separation&&(r.type=2,r.index=o,r.separation=c,r.normal.Copy(s))}return r}var Kv=new T,$v=new n,t1=new n,e1=new n,i1=new n,r1=new n,o1=new n,s1=new n,n1=new ld,l1=new ad,a1=[new pe,new pe],c1=[new pe,new pe],u1=[new pe,new pe];function qa(i,t,e,r,o){i.pointCount=0;let s=T.TransposeMultiply(e,o,Kv),l=T.MultiplyVec2(s,r.m_centroid,$v),a=t.m_vertex1,c=t.m_vertex2,u=n.Subtract(c,a,t1);u.Normalize();let m=e1.Set(u.y,-u.x),p=n.Dot(m,n.Subtract(l,a,n.s_t0)),d=t.m_oneSided;if(d&&p<0)return;let h=n1;h.count=r.m_count;for(let M=0;M<r.m_count;++M)T.MultiplyVec2(s,r.m_vertices[M],h.vertices[M]),D.MultiplyVec2(s.q,r.m_normals[M],h.normals[M]);let f=r.m_radius+t.m_radius,b=Zv(h,a,m);if(b.separation>f)return;let x=Wv(h,a,c);if(x.separation>f)return;let _=.98,y=.001,g;if(x.separation-f>_*(b.separation-f)+y?g=x:g=b,d){let M=n.Subtract(a,t.m_vertex0,i1);M.Normalize();let E=r1.Set(M.y,-M.x),L=n.Cross(M,u)>=0,U=n.Subtract(t.m_vertex3,c,o1);U.Normalize();let Y=s1.Set(U.y,-U.x),O=n.Cross(u,U)>=0,K=.1;if(n.Dot(g.normal,u)<=0)if(L){if(n.Cross(g.normal,E)>K)return}else g=b;else if(O){if(n.Cross(Y,g.normal)>K)return}else g=b}let S=a1,w=l1;if(g.type===1){i.type=1;let M=0,E=n.Dot(g.normal,h.normals[0]);for(let Y=1;Y<h.count;++Y){let O=n.Dot(g.normal,h.normals[Y]);O<E&&(E=O,M=Y)}let L=M,U=L+1<h.count?L+1:0;S[0].v.Copy(h.vertices[L]),S[0].id.cf.indexA=0,S[0].id.cf.indexB=L,S[0].id.cf.typeA=1,S[0].id.cf.typeB=0,S[1].v.Copy(h.vertices[U]),S[1].id.cf.indexA=0,S[1].id.cf.indexB=U,S[1].id.cf.typeA=1,S[1].id.cf.typeB=0,w.i1=0,w.i2=1,w.v1.Copy(a),w.v2.Copy(c),w.normal.Copy(g.normal),n.Negate(u,w.sideNormal1),w.sideNormal2.Copy(u)}else i.type=2,S[0].v.Copy(c),S[0].id.cf.indexA=1,S[0].id.cf.indexB=g.index,S[0].id.cf.typeA=0,S[0].id.cf.typeB=1,S[1].v.Copy(a),S[1].id.cf.indexA=0,S[1].id.cf.indexB=g.index,S[1].id.cf.typeA=0,S[1].id.cf.typeB=1,w.i1=g.index,w.i2=w.i1+1<h.count?w.i1+1:0,w.v1.Copy(h.vertices[w.i1]),w.v2.Copy(h.vertices[w.i2]),w.normal.Copy(h.normals[w.i1]),w.sideNormal1.Set(w.normal.y,-w.normal.x),n.Negate(w.sideNormal1,w.sideNormal2);w.sideOffset1=n.Dot(w.sideNormal1,w.v1),w.sideOffset2=n.Dot(w.sideNormal2,w.v2);let B=c1,C=u1,A;if(A=is(B,S,w.sideNormal1,w.sideOffset1,w.i1),A<Ot||(A=is(C,B,w.sideNormal2,w.sideOffset2,w.i2),A<Ot))return;g.type===1?(i.localNormal.Copy(w.normal),i.localPoint.Copy(w.v1)):(i.localNormal.Copy(r.m_normals[w.i1]),i.localPoint.Copy(r.m_vertices[w.i1]));let k=0;for(let M=0;M<Ot;++M)if(n.Dot(w.normal,n.Subtract(C[M].v,w.v1,n.s_t0))<=f){let L=i.points[k];g.type===1?(T.TransposeMultiplyVec2(s,C[M].v,L.localPoint),L.id.Copy(C[M].id)):(L.localPoint.Copy(C[M].v),L.id.cf.typeA=C[M].id.cf.typeB,L.id.cf.typeB=C[M].id.cf.typeA,L.id.cf.indexA=C[M].id.cf.indexB,L.id.cf.indexB=C[M].id.cf.indexA),++k}i.pointCount=k}var V=class i extends ii{constructor(e=0){super(0,e);this.m_p=new n}Set(e,r=this.m_radius){return this.m_p.Copy(e),this.m_radius=r,this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.m_p.Copy(e.m_p),this}GetChildCount(){return 1}static{this.TestPoint_s_center=new n}static{this.TestPoint_s_d=new n}TestPoint(e,r){let o=T.MultiplyVec2(e,this.m_p,i.TestPoint_s_center),s=n.Subtract(r,o,i.TestPoint_s_d);return n.Dot(s,s)<=this.m_radius**2}static{this.RayCast_s_position=new n}static{this.RayCast_s_s=new n}static{this.RayCast_s_r=new n}RayCast(e,r,o,s){let l=T.MultiplyVec2(o,this.m_p,i.RayCast_s_position),a=n.Subtract(r.p1,l,i.RayCast_s_s),c=n.Dot(a,a)-this.m_radius**2,u=n.Subtract(r.p2,r.p1,i.RayCast_s_r),m=n.Dot(a,u),p=n.Dot(u,u),d=m*m-p*c;if(d<0||p<gt)return!1;let h=-(m+Math.sqrt(d));return h>=0&&h<=r.maxFraction*p?(h/=p,e.fraction=h,n.AddScaled(a,h,u,e.normal).Normalize(),!0):!1}static{this.ComputeAABB_s_p=new n}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_p,i.ComputeAABB_s_p);e.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),e.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}ComputeMass(e,r){let o=this.m_radius**2;e.mass=r*Math.PI*o,e.center.Copy(this.m_p),e.I=e.mass*(.5*o+n.Dot(this.m_p,this.m_p))}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_p,e.m_count=1,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_p,s=this.m_radius,l=n.UNITX;e.DrawSolidCircle(o,s,l,r)}};var xi={ComputeCentroid:{s:new n,p1:new n,p2:new n,p3:new n,e1:new n,e2:new n},TestPoint:{pLocal:new n},ComputeAABB:{v:new n},ComputeMass:{center:new n,s:new n,e1:new n,e2:new n},Validate:{e:new n,v:new n},Set:{r:new n,v:new n},RayCast:{p1:new n,p2:new n,d:new n},SetAsBox:{xf:new T}};function m1(i,t,e){let r=e;r.SetZero();let o=0,{s,p1:l,p2:a,p3:c,e1:u,e2:m}=xi.ComputeCentroid;s.Copy(i[0]);let p=1/3;for(let h=0;h<t;++h){n.Subtract(i[0],s,l),n.Subtract(i[h],s,a),n.Subtract(i[h+1<t?h+1:0],s,c),n.Subtract(a,l,u),n.Subtract(c,l,m);let b=.5*n.Cross(u,m);o+=b,r.x+=b*p*(l.x+a.x+c.x),r.y+=b*p*(l.y+a.y+c.y)}let d=1/o;return r.x=d*r.x+s.x,r.y=d*r.y+s.y,r}var p1=new n,v=class i extends ii{constructor(){super(2,Re);this.m_centroid=new n;this.m_vertices=[];this.m_normals=[];this.m_count=0}Clone(){return new i().Copy(this)}Copy(e){super.Copy(e),this.m_centroid.Copy(e.m_centroid),this.m_count=e.m_count,this.m_vertices=H(this.m_count,n),this.m_normals=H(this.m_count,n);for(let r=0;r<this.m_count;++r)this.m_vertices[r].Copy(e.m_vertices[r]),this.m_normals[r].Copy(e.m_normals[r]);return this}GetChildCount(){return 1}Set(e,r=e.length){let o=Dn(e,r);return o.length<3?!1:(this.SetHull(o,o.length),!0)}SetHull(e,r){N(r>=3),this.m_count=r,this.m_vertices=H(r,n);for(let o=0;o<r;++o)this.m_vertices[o].Copy(e[o]);this.m_normals=H(r,n);for(let o=0;o<this.m_count;++o){let s=o,l=o+1<this.m_count?o+1:0,a=n.Subtract(this.m_vertices[l],this.m_vertices[s],p1);n.CrossVec2Scalar(a,1,this.m_normals[o]),this.m_normals[o].Normalize()}return m1(this.m_vertices,this.m_count,this.m_centroid),this}SetAsBox(e,r,o,s=0){if(this.m_count=4,this.m_vertices=H(this.m_count,n),this.m_normals=H(this.m_count,n),this.m_vertices[0].Set(-e,-r),this.m_vertices[1].Set(e,-r),this.m_vertices[2].Set(e,r),this.m_vertices[3].Set(-e,r),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),o){this.m_centroid.Copy(o);let{xf:l}=xi.SetAsBox;l.SetPosition(o),l.SetRotationAngle(s);for(let a=0;a<this.m_count;++a)T.MultiplyVec2(l,this.m_vertices[a],this.m_vertices[a]),D.MultiplyVec2(l.q,this.m_normals[a],this.m_normals[a])}else this.m_centroid.SetZero();return this}TestPoint(e,r){let o=T.TransposeMultiplyVec2(e,r,xi.TestPoint.pLocal);for(let s=0;s<this.m_count;++s)if(n.Dot(this.m_normals[s],n.Subtract(o,this.m_vertices[s],n.s_t0))>0)return!1;return!0}RayCast(e,r,o,s){let l=T.TransposeMultiplyVec2(o,r.p1,xi.RayCast.p1),a=T.TransposeMultiplyVec2(o,r.p2,xi.RayCast.p2),c=n.Subtract(a,l,xi.RayCast.d),u=0,m=r.maxFraction,p=-1;for(let d=0;d<this.m_count;++d){let h=n.Dot(this.m_normals[d],n.Subtract(this.m_vertices[d],l,n.s_t0)),f=n.Dot(this.m_normals[d],c);if(f===0){if(h<0)return!1}else f<0&&h<u*f?(u=h/f,p=d):f>0&&h<m*f&&(m=h/f);if(m<u)return!1}return p>=0?(e.fraction=u,D.MultiplyVec2(o.q,this.m_normals[p],e.normal),!0):!1}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_vertices[0],e.lowerBound),l=e.upperBound.Copy(s);for(let c=1;c<this.m_count;++c){let u=T.MultiplyVec2(r,this.m_vertices[c],xi.ComputeAABB.v);n.Min(s,u,s),n.Max(l,u,l)}let a=this.m_radius;s.SubtractXY(a,a),l.AddXY(a,a)}ComputeMass(e,r){let o=xi.ComputeMass.center.SetZero(),s=0,l=0,a=xi.ComputeMass.s.Copy(this.m_vertices[0]),c=1/3;for(let u=0;u<this.m_count;++u){let m=n.Subtract(this.m_vertices[u],a,xi.ComputeMass.e1),p=n.Subtract(this.m_vertices[u+1<this.m_count?u+1:0],a,xi.ComputeMass.e2),d=n.Cross(m,p),h=.5*d;s+=h,o.AddScaled(h*c,n.Add(m,p,n.s_t0));let f=m.x,b=m.y,x=p.x,_=p.y,y=f*f+x*f+x*x,g=b*b+_*b+_*_;l+=.25*c*d*(y+g)}e.mass=r*s,o.Scale(1/s),n.Add(o,a,e.center),e.I=r*l,e.I+=e.mass*(n.Dot(e.center,e.center)-n.Dot(o,o))}Validate(){return this.m_count<3||Wt<this.m_count?!1:Mn(this.m_vertices,this.m_count)}SetupDistanceProxy(e,r){e.m_vertices=this.m_vertices,e.m_count=this.m_count,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_count,s=this.m_vertices;e.DrawSolidPolygon(s,o,r)}};var I=class i extends ii{constructor(){super(1,Re);this.m_vertex1=new n;this.m_vertex2=new n;this.m_vertex0=new n;this.m_vertex3=new n;this.m_oneSided=!1}SetOneSided(e,r,o,s){return this.m_vertex0.Copy(e),this.m_vertex1.Copy(r),this.m_vertex2.Copy(o),this.m_vertex3.Copy(s),this.m_oneSided=!0,this}SetTwoSided(e,r){return this.m_vertex1.Copy(e),this.m_vertex2.Copy(r),this.m_oneSided=!1,this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.m_vertex1.Copy(e.m_vertex1),this.m_vertex2.Copy(e.m_vertex2),this.m_vertex0.Copy(e.m_vertex0),this.m_vertex3.Copy(e.m_vertex3),this.m_oneSided=e.m_oneSided,this}GetChildCount(){return 1}TestPoint(e,r){return!1}static{this.RayCast_s_p1=new n}static{this.RayCast_s_p2=new n}static{this.RayCast_s_d=new n}static{this.RayCast_s_e=new n}static{this.RayCast_s_q=new n}static{this.RayCast_s_r=new n}RayCast(e,r,o,s){let l=T.TransposeMultiplyVec2(o,r.p1,i.RayCast_s_p1),a=T.TransposeMultiplyVec2(o,r.p2,i.RayCast_s_p2),c=n.Subtract(a,l,i.RayCast_s_d),u=this.m_vertex1,m=this.m_vertex2,p=n.Subtract(m,u,i.RayCast_s_e),{normal:d}=e;d.Set(p.y,-p.x).Normalize();let h=n.Dot(d,n.Subtract(u,l,n.s_t0));if(this.m_oneSided&&h>0)return!1;let f=n.Dot(d,c);if(f===0)return!1;let b=h/f;if(b<0||r.maxFraction<b)return!1;let x=n.AddScaled(l,b,c,i.RayCast_s_q),_=n.Subtract(m,u,i.RayCast_s_r),y=n.Dot(_,_);if(y===0)return!1;let g=n.Dot(n.Subtract(x,u,n.s_t0),_)/y;return g<0||g>1?!1:(e.fraction=b,D.MultiplyVec2(o.q,e.normal,e.normal),h>0&&e.normal.Negate(),!0)}static{this.ComputeAABB_s_v1=new n}static{this.ComputeAABB_s_v2=new n}ComputeAABB(e,r,o){let s=T.MultiplyVec2(r,this.m_vertex1,i.ComputeAABB_s_v1),l=T.MultiplyVec2(r,this.m_vertex2,i.ComputeAABB_s_v2);n.Min(s,l,e.lowerBound),n.Max(s,l,e.upperBound);let a=this.m_radius;e.lowerBound.SubtractXY(a,a),e.upperBound.AddXY(a,a)}ComputeMass(e,r){e.mass=0,n.Mid(this.m_vertex1,this.m_vertex2,e.center),e.I=0}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_count=2,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_vertex1,s=this.m_vertex2;e.DrawSegment(o,s,r),this.m_oneSided===!1&&(e.DrawPoint(o,4,r),e.DrawPoint(s,4,r))}};var dt=class i extends ii{constructor(){super(3,Re);this.m_vertices=[];this.m_prevVertex=new n;this.m_nextVertex=new n}CreateLoop(e,r=e.length){if(r<3)return this;this.m_vertices.length=r+1;for(let o=0;o<r;++o){let{x:s,y:l}=e[o];this.m_vertices[o]=new n(s,l)}return this.m_vertices[r]=this.m_vertices[0].Clone(),this.m_prevVertex.Copy(this.m_vertices[this.m_vertices.length-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}CreateChain(e,r,o,s){this.m_vertices.length=r;for(let l=0;l<r;++l){let{x:a,y:c}=e[l];this.m_vertices[l]=new n(a,c)}return this.m_prevVertex.Copy(o),this.m_nextVertex.Copy(s),this}Clone(){return new i().Copy(this)}Copy(e){return super.Copy(e),this.CreateChain(e.m_vertices,e.m_vertices.length,e.m_prevVertex,e.m_nextVertex)}GetChildCount(){return this.m_vertices.length-1}GetChildEdge(e,r){e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[r]),e.m_vertex2.Copy(this.m_vertices[r+1]),e.m_oneSided=!0,r>0?e.m_vertex0.Copy(this.m_vertices[r-1]):e.m_vertex0.Copy(this.m_prevVertex),r<this.m_vertices.length-2?e.m_vertex3.Copy(this.m_vertices[r+2]):e.m_vertex3.Copy(this.m_nextVertex)}TestPoint(e,r){return!1}static{this.RayCast_s_edgeShape=new I}RayCast(e,r,o,s){let l=i.RayCast_s_edgeShape,a=s,c=s+1;return c===this.m_vertices.length&&(c=0),l.m_vertex1.Copy(this.m_vertices[a]),l.m_vertex2.Copy(this.m_vertices[c]),l.RayCast(e,r,o,0)}static{this.ComputeAABB_s_v1=new n}static{this.ComputeAABB_s_v2=new n}static{this.ComputeAABB_s_lower=new n}static{this.ComputeAABB_s_upper=new n}ComputeAABB(e,r,o){let s=o,l=o+1;l===this.m_vertices.length&&(l=0);let a=T.MultiplyVec2(r,this.m_vertices[s],i.ComputeAABB_s_v1),c=T.MultiplyVec2(r,this.m_vertices[l],i.ComputeAABB_s_v2),u=n.Min(a,c,i.ComputeAABB_s_lower),m=n.Max(a,c,i.ComputeAABB_s_upper);e.lowerBound.x=u.x-this.m_radius,e.lowerBound.y=u.y-this.m_radius,e.upperBound.x=m.x+this.m_radius,e.upperBound.y=m.y+this.m_radius}ComputeMass(e,r){e.mass=0,e.center.SetZero(),e.I=0}SetupDistanceProxy(e,r){e.m_vertices=e.m_buffer,e.m_vertices[0]=this.m_vertices[r];let o=r+1<this.m_vertices.length?r+1:0;e.m_vertices[1]=this.m_vertices[o],e.m_count=2,e.m_radius=this.m_radius}Draw(e,r){let o=this.m_vertices,s=o[0];for(let l=1;l<o.length;++l){let a=o[l];e.DrawSegment(s,a,r),s=a}}};var d0={pA:new n,pB:new n};var Wa=class{constructor(t,e){this.prev=null;this.next=null;this.joint=t,this.other=e}},Pt=class{constructor(t){this.userData={};this.collideConnected=!1;this.type=t}};function Ct(i,t,e,r,o){let s=r.GetMass(),l=o.GetMass(),a;s>0&&l>0?a=s*l/(s+l):s>0?a=s:a=l;let c=2*Math.PI*t;i.stiffness=a*c*c,i.damping=2*a*e*c}function cd(i,t,e,r,o){let s=r.GetInertia(),l=o.GetInertia(),a;s>0&&l>0?a=s*l/(s+l):s>0?a=s:a=l;let c=2*Math.PI*t;i.stiffness=a*c*c,i.damping=2*a*e*c}var Dt=class{constructor(t){this.m_type=0;this.m_prev=null;this.m_next=null;this.m_islandFlag=!1;this.m_collideConnected=!1;this.m_userData={};this.m_type=t.type,this.m_edgeA=new Wa(this,t.bodyB),this.m_edgeB=new Wa(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected??!1,this.SetUserData(t.userData)}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}ShiftOrigin(t){}Draw(t){let e=this.m_bodyA.GetTransform().p,r=this.m_bodyB.GetTransform().p,o=this.GetAnchorA(d0.pA),s=this.GetAnchorB(d0.pB);t.DrawSegment(e,o,Q.joint6),t.DrawSegment(o,s,Q.joint6),t.DrawSegment(r,s,Q.joint6)}};var Mt={worldPointA:new n,worldPointB:new n,vpA:new n,vpB:new n,vpBA:new n,P:new n,qA:new D,qB:new D,lalcA:new n,lalcB:new n,Draw:{pA:new n,pB:new n,axis:new n,pRest:new n,p1:new n,p2:new n}},Fe=class extends Pt{constructor(){super(3);this.localAnchorA=new n;this.localAnchorB=new n;this.length=1;this.minLength=0;this.maxLength=tt;this.stiffness=0;this.damping=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=Math.max(n.Distance(o,s),Z),this.minLength=this.length,this.maxLength=this.length}},Ka=class extends Dt{constructor(e){super(e);this.m_bias=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_gamma=0;this.m_impulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_indexA=0;this.m_indexB=0;this.m_u=new n;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_currentLength=0;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_softMass=0;this.m_mass=0;this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_length=Math.max(e.length,Z),this.m_minLength=Math.max(e.minLength,Z),this.m_maxLength=Math.max(e.maxLength,this.m_minLength),this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=e*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse);return r.x=o*this.m_u.x,r.y=o*this.m_u.y,r}GetReactionTorque(e){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(e){return this.m_impulse=0,this.m_length=Math.max(Z,e),this.m_length}GetLength(){return this.m_length}SetMinLength(e){return this.m_lowerImpulse=0,this.m_minLength=et(e,Z,this.m_maxLength),this.m_minLength}GetMinLength(){return this.m_minLength}SetMaxLength(e){return this.m_upperImpulse=0,this.m_maxLength=Math.max(e,this.m_minLength),this.m_maxLength}GetMaxLength(){return this.m_maxLength}GetCurrentLength(){let e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Mt.worldPointA),r=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Mt.worldPointB);return n.Distance(r,e)}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f}=Mt;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),this.m_rA),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),this.m_u.x=a.x+this.m_rB.x-r.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-r.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>Z?this.m_u.Scale(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);let b=n.Cross(this.m_rA,this.m_u),x=n.Cross(this.m_rB,this.m_u),_=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*x*x;if(this.m_mass=_!==0?1/_:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){let y=this.m_currentLength-this.m_length,g=this.m_damping,S=this.m_stiffness,w=e.step.dt;this.m_gamma=w*(g+w*S),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=y*w*S*this.m_gamma,_+=this.m_gamma,this.m_softMass=_!==0?1/_:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let{P:y}=Mt;n.Scale(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,y),s.SubtractScaled(this.m_invMassA,y),l-=this.m_invIA*n.Cross(this.m_rA,y),u.AddScaled(this.m_invMassB,y),m+=this.m_invIB*n.Cross(this.m_rB,y)}else this.m_impulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){let a=n.AddCrossScalarVec2(r,o,this.m_rA,Mt.vpA),c=n.AddCrossScalarVec2(s,l,this.m_rB,Mt.vpB),u=n.Dot(this.m_u,n.Subtract(c,a,Mt.vpBA)),m=-this.m_softMass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;let p=n.Scale(m,this.m_u,Mt.P);r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(this.m_rB,p)}{let a=this.m_currentLength-this.m_minLength,c=Math.max(0,a)*e.step.inv_dt,u=n.AddCrossScalarVec2(r,o,this.m_rA,Mt.vpA),m=n.AddCrossScalarVec2(s,l,this.m_rB,Mt.vpB),p=n.Dot(this.m_u,n.Subtract(m,u,Mt.vpBA)),d=-this.m_mass*(p+c),h=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(0,this.m_lowerImpulse+d),d=this.m_lowerImpulse-h;let f=n.Scale(d,this.m_u,Mt.P);r.SubtractScaled(this.m_invMassA,f),o-=this.m_invIA*n.Cross(this.m_rA,f),s.AddScaled(this.m_invMassB,f),l+=this.m_invIB*n.Cross(this.m_rB,f)}{let a=this.m_maxLength-this.m_currentLength,c=Math.max(0,a)*e.step.inv_dt,u=n.AddCrossScalarVec2(r,o,this.m_rA,Mt.vpA),m=n.AddCrossScalarVec2(s,l,this.m_rB,Mt.vpB),p=n.Dot(this.m_u,n.Subtract(u,m,Mt.vpBA)),d=-this.m_mass*(p+c),h=this.m_upperImpulse;this.m_upperImpulse=Math.max(0,this.m_upperImpulse+d),d=this.m_upperImpulse-h;let f=n.Scale(-d,this.m_u,Mt.P);r.SubtractScaled(this.m_invMassA,f),o-=this.m_invIA*n.Cross(this.m_rA,f),s.AddScaled(this.m_invMassB,f),l+=this.m_invIB*n.Cross(this.m_rB,f)}}else{let a=n.AddCrossScalarVec2(r,o,this.m_rA,Mt.vpA),c=n.AddCrossScalarVec2(s,l,this.m_rB,Mt.vpB),u=n.Dot(this.m_u,n.Subtract(c,a,Mt.vpBA)),m=-this.m_mass*u;this.m_impulse+=m;let p=n.Scale(m,this.m_u,Mt.P);r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(this.m_rB,p)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,P:p}=Mt;a.Set(o),c.Set(l);let d=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),h=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB);this.m_u.x=s.x+h.x-r.x-d.x,this.m_u.y=s.y+h.y-r.y-d.y;let f=this.m_u.Normalize(),b;if(this.m_minLength===this.m_maxLength)b=f-this.m_minLength;else if(f<this.m_minLength)b=f-this.m_minLength;else if(this.m_maxLength<f)b=f-this.m_maxLength;else return!0;let x=-this.m_mass*b;return n.Scale(x,this.m_u,p),r.SubtractScaled(this.m_invMassA,p),o-=this.m_invIA*n.Cross(d,p),s.AddScaled(this.m_invMassB,p),l+=this.m_invIB*n.Cross(h,p),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,Math.abs(b)<Z}Draw(e){let{pA:r,pB:o,axis:s,pRest:l}=Mt.Draw,a=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();if(T.MultiplyVec2(a,this.m_localAnchorA,r),T.MultiplyVec2(c,this.m_localAnchorB,o),n.Subtract(o,r,s),s.Normalize(),e.DrawSegment(r,o,Q.joint5),n.AddScaled(r,this.m_length,s,l),e.DrawPoint(l,8,Q.joint1),this.m_minLength!==this.m_maxLength){if(this.m_minLength>Z){let u=n.AddScaled(r,this.m_minLength,s,Mt.Draw.p1);e.DrawPoint(u,4,Q.joint2)}if(this.m_maxLength<tt){let u=n.AddScaled(r,this.m_maxLength,s,Mt.Draw.p1);e.DrawPoint(u,4,Q.joint3)}}}};var $a=class extends Pt{constructor(){super(11);this.bodies=[];this.stiffness=0;this.damping=0}AddBody(e){this.bodies.push(e),this.bodies.length===1?this.bodyA=e:this.bodies.length===2&&(this.bodyB=e)}},tc=class extends Dt{constructor(e){super(e);this.m_stiffness=0;this.m_damping=0;this.m_impulse=0;this.m_targetArea=0;this.m_joints=[];this.m_delta=new n;this.m_bodies=e.bodies,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0,this.m_targetLengths=je(e.bodies.length),this.m_normals=H(e.bodies.length,n),this.m_deltas=H(e.bodies.length,n);let r=new Fe;r.stiffness=this.m_stiffness,r.damping=this.m_damping,this.m_targetArea=0;for(let o=0;o<this.m_bodies.length;++o){let s=this.m_bodies[o],l=this.m_bodies[(o+1)%this.m_bodies.length],a=s.GetWorldCenter(),c=l.GetWorldCenter();this.m_targetLengths[o]=n.Distance(a,c),this.m_targetArea+=n.Cross(a,c),r.Initialize(s,l,a,c),this.m_joints[o]=s.GetWorld().CreateJoint(r)}this.m_targetArea*=.5}GetAnchorA(e){return e}GetAnchorB(e){return e}GetReactionForce(e,r){return r}GetReactionTorque(e){return 0}SetStiffness(e){this.m_stiffness=e;for(let r of this.m_joints)r.SetStiffness(e)}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e;for(let r of this.m_joints)r.SetDamping(e)}GetDamping(){return this.m_damping}InitVelocityConstraints(e){for(let r=0;r<this.m_bodies.length;++r){let o=this.m_bodies[(r+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(r+1)%this.m_bodies.length],l=e.positions[o.m_islandIndex].c,a=e.positions[s.m_islandIndex].c,c=this.m_deltas[r];n.Subtract(a,l,c)}if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;for(let r=0;r<this.m_bodies.length;++r){let o=this.m_bodies[r],s=e.velocities[o.m_islandIndex].v,l=this.m_deltas[r];s.x+=o.m_invMass*l.y*.5*this.m_impulse,s.y+=o.m_invMass*-l.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(e){let r=0,o=0;for(let l=0;l<this.m_bodies.length;++l){let a=this.m_bodies[l],c=e.velocities[a.m_islandIndex].v,u=this.m_deltas[l];r+=u.LengthSquared()/a.GetMass(),o+=n.Cross(c,u)}let s=-2*o/r;this.m_impulse+=s;for(let l=0;l<this.m_bodies.length;++l){let a=this.m_bodies[l],c=e.velocities[a.m_islandIndex].v,u=this.m_deltas[l];c.x+=a.m_invMass*u.y*.5*s,c.y+=a.m_invMass*-u.x*.5*s}}SolvePositionConstraints(e){let r=0,o=0;for(let c=0;c<this.m_bodies.length;++c){let u=this.m_bodies[c],m=this.m_bodies[(c+1)%this.m_bodies.length],p=e.positions[u.m_islandIndex].c,d=e.positions[m.m_islandIndex].c,h=n.Subtract(d,p,this.m_delta),f=h.Length();f<gt&&(f=1),this.m_normals[c].x=h.y/f,this.m_normals[c].y=-h.x/f,r+=f,o+=n.Cross(p,d)}o*=.5;let l=.5*(this.m_targetArea-o)/r,a=!0;for(let c=0;c<this.m_bodies.length;++c){let u=this.m_bodies[c],m=e.positions[u.m_islandIndex].c,p=(c+1)%this.m_bodies.length,d=n.Add(this.m_normals[c],this.m_normals[p],this.m_delta);d.Scale(l);let h=d.LengthSquared();h>ts**2&&d.Scale(ts/Math.sqrt(h)),h>Z**2&&(a=!1),m.Add(d)}return a}};var h0={qA:new D,qB:new D,lalcA:new n,lalcB:new n,Cdot:new n,impulse:new n,oldImpulse:new n},kn=class extends Pt{constructor(){super(9);this.localAnchorA=new n;this.localAnchorB=new n;this.maxForce=0;this.maxTorque=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB)}},ec=class extends Dt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_linearImpulse=new n;this.m_angularImpulse=0;this.m_maxForce=0;this.m_maxTorque=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_linearMass=new It;this.m_angularMass=0;this.m_localAnchorA.Copy(e.localAnchorA),this.m_localAnchorB.Copy(e.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce??0,this.m_maxTorque=e.maxTorque??0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d}=h0;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB,_=this.m_linearMass;if(_.ex.x=h+f+b*this.m_rA.y*this.m_rA.y+x*this.m_rB.y*this.m_rB.y,_.ex.y=-b*this.m_rA.x*this.m_rA.y-x*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=h+f+b*this.m_rA.x*this.m_rA.x+x*this.m_rB.x*this.m_rB.x,_.Inverse(),this.m_angularMass=b+x,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.step.warmStarting){this.m_linearImpulse.Scale(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;let y=this.m_linearImpulse;o.SubtractScaled(h,y),s-=b*(n.Cross(this.m_rA,y)+this.m_angularImpulse),a.AddScaled(f,y),c+=x*(n.Cross(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=e.step.dt;{let d=l-o,h=-this.m_angularMass*d,f=this.m_angularImpulse,b=p*this.m_maxTorque;this.m_angularImpulse=et(this.m_angularImpulse+h,-b,b),h=this.m_angularImpulse-f,o-=u*h,l+=m*h}{let{Cdot:d,impulse:h,oldImpulse:f}=h0;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),d),It.MultiplyVec2(this.m_linearMass,d,h).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(h);let b=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(b)),n.Subtract(this.m_linearImpulse,f,h),r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){return!0}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_linearImpulse.x,r.y=e*this.m_linearImpulse.y,r}GetReactionTorque(e){return e*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetMaxTorque(e){this.m_maxTorque=e}GetMaxTorque(){return this.m_maxTorque}};var as={qA:new D,qB:new D,qC:new D,qD:new D,lalcA:new n,lalcB:new n,lalcC:new n,lalcD:new n,u:new n,rA:new n,rB:new n,rC:new n,rD:new n,JvAC:new n,JvBD:new n},cs=class extends Pt{constructor(){super(6);this.ratio=1}},ic=class extends Dt{constructor(e){super(e);this.m_typeA=0;this.m_typeB=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localAnchorC=new n;this.m_localAnchorD=new n;this.m_localAxisC=new n;this.m_localAxisD=new n;this.m_referenceAngleA=0;this.m_referenceAngleB=0;this.m_constant=0;this.m_ratio=0;this.m_tolerance=0;this.m_impulse=0;this.m_indexA=0;this.m_indexB=0;this.m_indexC=0;this.m_indexD=0;this.m_lcA=new n;this.m_lcB=new n;this.m_lcC=new n;this.m_lcD=new n;this.m_mA=0;this.m_mB=0;this.m_mC=0;this.m_mD=0;this.m_iA=0;this.m_iB=0;this.m_iC=0;this.m_iD=0;this.m_JvAC=new n;this.m_JvBD=new n;this.m_JwA=0;this.m_JwB=0;this.m_JwC=0;this.m_JwD=0;this.m_mass=0;this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType();let r,o;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();let s=this.m_bodyA.m_xf,l=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,c=this.m_bodyC.m_sweep.a;if(this.m_typeA===1){let h=e.joint1;this.m_localAnchorC.Copy(h.m_localAnchorA),this.m_localAnchorA.Copy(h.m_localAnchorB),this.m_referenceAngleA=h.m_referenceAngle,this.m_localAxisC.SetZero(),r=l-c-this.m_referenceAngleA,this.m_tolerance=bi}else{let h=e.joint1;this.m_localAnchorC.Copy(h.m_localAnchorA),this.m_localAnchorA.Copy(h.m_localAnchorB),this.m_referenceAngleA=h.m_referenceAngle,this.m_localAxisC.Copy(h.m_localXAxisA);let f=this.m_localAnchorC,b=D.TransposeMultiplyVec2(a.q,D.MultiplyVec2(s.q,this.m_localAnchorA,n.s_t0).Add(s.p).Subtract(a.p),n.s_t0);r=n.Dot(b.Subtract(f),this.m_localAxisC),this.m_tolerance=Z}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();let u=this.m_bodyB.m_xf,m=this.m_bodyB.m_sweep.a,p=this.m_bodyD.m_xf,d=this.m_bodyD.m_sweep.a;if(this.m_typeB===1){let h=e.joint2;this.m_localAnchorD.Copy(h.m_localAnchorA),this.m_localAnchorB.Copy(h.m_localAnchorB),this.m_referenceAngleB=h.m_referenceAngle,this.m_localAxisD.SetZero(),o=m-d-this.m_referenceAngleB}else{let h=e.joint2;this.m_localAnchorD.Copy(h.m_localAnchorA),this.m_localAnchorB.Copy(h.m_localAnchorB),this.m_referenceAngleB=h.m_referenceAngle,this.m_localAxisD.Copy(h.m_localXAxisA);let f=this.m_localAnchorD,b=D.TransposeMultiplyVec2(p.q,D.MultiplyVec2(u.q,this.m_localAnchorB,n.s_t0).Add(u.p).Subtract(p.p),n.s_t0);o=n.Dot(b.Subtract(f),this.m_localAxisD)}this.m_ratio=e.ratio??1,this.m_constant=r+this.m_ratio*o,this.m_impulse=0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,u=e.positions[this.m_indexC].a,m=e.velocities[this.m_indexC].v,p=e.velocities[this.m_indexC].w,d=e.positions[this.m_indexD].a,h=e.velocities[this.m_indexD].v,f=e.velocities[this.m_indexD].w,{qA:b,qB:x,qC:_,qD:y}=as;if(b.Set(r),x.Set(l),_.Set(u),y.Set(d),this.m_mass=0,this.m_typeA===1)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{let{u:g,rC:S,rA:w,lalcA:B,lalcC:C}=as;D.MultiplyVec2(_,this.m_localAxisC,g),D.MultiplyVec2(_,n.Subtract(this.m_localAnchorC,this.m_lcC,C),S),D.MultiplyVec2(b,n.Subtract(this.m_localAnchorA,this.m_lcA,B),w),this.m_JvAC.Copy(g),this.m_JwC=n.Cross(S,g),this.m_JwA=n.Cross(w,g),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===1)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{let{u:g,rB:S,rD:w,lalcB:B,lalcD:C}=as;D.MultiplyVec2(y,this.m_localAxisD,g),D.MultiplyVec2(y,n.Subtract(this.m_localAnchorD,this.m_lcD,C),w),D.MultiplyVec2(x,n.Subtract(this.m_localAnchorB,this.m_lcB,B),S),n.Scale(this.m_ratio,g,this.m_JvBD),this.m_JwD=this.m_ratio*n.Cross(w,g),this.m_JwB=this.m_ratio*n.Cross(S,g),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(o.AddScaled(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,a.AddScaled(this.m_mB*this.m_impulse,this.m_JvBD),c+=this.m_iB*this.m_impulse*this.m_JwB,m.SubtractScaled(this.m_mC*this.m_impulse,this.m_JvAC),p-=this.m_iC*this.m_impulse*this.m_JwC,h.SubtractScaled(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c,e.velocities[this.m_indexC].w=p,e.velocities[this.m_indexD].w=f}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=e.velocities[this.m_indexC].v,c=e.velocities[this.m_indexC].w,u=e.velocities[this.m_indexD].v,m=e.velocities[this.m_indexD].w,p=n.Dot(this.m_JvAC,n.Subtract(r,a,n.s_t0))+n.Dot(this.m_JvBD,n.Subtract(s,u,n.s_t0));p+=this.m_JwA*o-this.m_JwC*c+(this.m_JwB*l-this.m_JwD*m);let d=-this.m_mass*p;this.m_impulse+=d,r.AddScaled(this.m_mA*d,this.m_JvAC),o+=this.m_iA*d*this.m_JwA,s.AddScaled(this.m_mB*d,this.m_JvBD),l+=this.m_iB*d*this.m_JwB,a.SubtractScaled(this.m_mC*d,this.m_JvAC),c-=this.m_iC*d*this.m_JwC,u.SubtractScaled(this.m_mD*d,this.m_JvBD),m-=this.m_iD*d*this.m_JwD,e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l,e.velocities[this.m_indexC].w=c,e.velocities[this.m_indexD].w=m}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,a=e.positions[this.m_indexC].c,c=e.positions[this.m_indexC].a,u=e.positions[this.m_indexD].c,m=e.positions[this.m_indexD].a,{qA:p,qB:d,qC:h,qD:f,JvAC:b,JvBD:x}=as;p.Set(o),d.Set(l),h.Set(c),f.Set(m);let _,y,g,S,w,B,C=0;if(this.m_typeA===1)b.SetZero(),g=1,w=1,C+=this.m_iA+this.m_iC,_=o-c-this.m_referenceAngleA;else{let{u:M,rC:E,rA:L,lalcC:U,lalcA:Y}=as;D.MultiplyVec2(h,this.m_localAxisC,M),D.MultiplyVec2(h,n.Subtract(this.m_localAnchorC,this.m_lcC,U),E),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_lcA,Y),L),b.Copy(M),w=n.Cross(E,M),g=n.Cross(L,M),C+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*g*g;let O=U,K=D.TransposeMultiplyVec2(h,n.Add(L,r,n.s_t0).Subtract(a),n.s_t0);_=n.Dot(n.Subtract(K,O,n.s_t0),this.m_localAxisC)}if(this.m_typeB===1)x.SetZero(),S=this.m_ratio,B=this.m_ratio,C+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),y=l-m-this.m_referenceAngleB;else{let{u:M,rD:E,rB:L,lalcD:U,lalcB:Y}=as;D.MultiplyVec2(f,this.m_localAxisD,M),D.MultiplyVec2(f,n.Subtract(this.m_localAnchorD,this.m_lcD,U),E),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_lcB,Y),L),n.Scale(this.m_ratio,M,x),B=this.m_ratio*n.Cross(E,M),S=this.m_ratio*n.Cross(L,M),C+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*B*B+this.m_iB*S*S;let O=U,K=D.TransposeMultiplyVec2(f,n.Add(L,s,n.s_t0).Subtract(u),n.s_t0);y=n.Dot(K.Subtract(O),this.m_localAxisD)}let A=_+this.m_ratio*y-this.m_constant,k=0;return C>0&&(k=-A/C),r.AddScaled(this.m_mA*k,b),o+=this.m_iA*k*g,s.AddScaled(this.m_mB*k,x),l+=this.m_iB*k*S,a.SubtractScaled(this.m_mC*k,b),c-=this.m_iC*k*w,u.SubtractScaled(this.m_mD*k,x),m-=this.m_iD*k*B,e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,e.positions[this.m_indexC].a=c,e.positions[this.m_indexD].a=m,Math.abs(A)<this.m_tolerance}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return n.Scale(e*this.m_impulse,this.m_JvAC,r)}GetReactionTorque(e){return e*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(e){this.m_ratio=e}};var f0={qA:new D,qB:new D,K:new It,Cdot:new n,impulse:new n,oldImpulse:new n},us=class extends Pt{constructor(){super(10);this.linearOffset=new n;this.angularOffset=0;this.maxForce=1;this.maxTorque=1;this.correctionFactor=.3}Initialize(e,r){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(r.GetPosition(),this.linearOffset);let o=e.GetAngle(),s=r.GetAngle();this.angularOffset=s-o}},rc=class extends Dt{constructor(e){super(e);this.m_linearOffset=new n;this.m_linearImpulse=new n;this.m_angularImpulse=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_linearError=new n;this.m_angularError=0;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_linearMass=new It;this.m_angularMass=0;this.m_linearOffset.Copy(e.linearOffset??n.ZERO),this.m_angularOffset=e.angularOffset??0,this.m_linearImpulse.SetZero(),this.m_maxForce=e.maxForce??1,this.m_maxTorque=e.maxTorque??1,this.m_correctionFactor=e.correctionFactor??.3}GetAnchorA(e){let r=this.m_bodyA.GetPosition();return e.x=r.x,e.y=r.y,e}GetAnchorB(e){let r=this.m_bodyB.GetPosition();return e.x=r.x,e.y=r.y,e}GetReactionForce(e,r){return n.Scale(e,this.m_linearImpulse,r)}GetReactionTorque(e){return e*this.m_angularImpulse}SetLinearOffset(e){n.Equals(e,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(e))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(e){e!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=e)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetMaxTorque(e){this.m_maxTorque=e}GetMaxTorque(){return this.m_maxTorque}GetCorrectionFactor(){return this.m_correctionFactor}SetCorrectionFactor(e){this.m_correctionFactor=e}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d}=f0;p.Set(o),d.Set(c);let h=D.MultiplyVec2(p,n.Subtract(this.m_linearOffset,this.m_localCenterA,n.s_t0),this.m_rA),f=D.MultiplyVec2(d,n.Negate(this.m_localCenterB,n.s_t0),this.m_rB),b=this.m_invMassA,x=this.m_invMassB,_=this.m_invIA,y=this.m_invIB,g=this.m_linearMass;if(g.ex.x=b+x+_*h.y*h.y+y*f.y*f.y,g.ex.y=-_*h.x*h.y-y*f.x*f.y,g.ey.x=g.ex.y,g.ey.y=b+x+_*h.x*h.x+y*f.x*f.x,g.Inverse(),this.m_angularMass=_+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),n.Subtract(n.Add(a,f,n.s_t0),n.Add(r,h,n.s_t1),this.m_linearError),this.m_angularError=c-o-this.m_angularOffset,e.step.warmStarting){this.m_linearImpulse.Scale(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;let S=this.m_linearImpulse;s.SubtractScaled(b,S),l-=_*(n.Cross(h,S)+this.m_angularImpulse),u.AddScaled(x,S),m+=y*(n.Cross(f,S)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=e.step.dt,d=e.step.inv_dt;{let h=l-o+d*this.m_correctionFactor*this.m_angularError,f=-this.m_angularMass*h,b=this.m_angularImpulse,x=p*this.m_maxTorque;this.m_angularImpulse=et(this.m_angularImpulse+f,-x,x),f=this.m_angularImpulse-b,o-=u*f,l+=m*f}{let{impulse:h,oldImpulse:f,Cdot:b}=f0;n.AddScaled(n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),n.s_t2),d*this.m_correctionFactor,this.m_linearError,b),It.MultiplyVec2(this.m_linearMass,b,h).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(h);let x=p*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(x)),n.Subtract(this.m_linearImpulse,f,h),r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){return!0}};var oc={qB:new D,lalcB:new n,Cdot:new n,impulse:new n,oldImpulse:new n,pA:new n,pB:new n},sc=class extends Pt{constructor(){super(5);this.target=new n;this.maxForce=0;this.stiffness=0;this.damping=0}},nc=class extends Dt{constructor(e){super(e);this.m_localAnchorB=new n;this.m_targetA=new n;this.m_stiffness=0;this.m_damping=0;this.m_beta=0;this.m_impulse=new n;this.m_maxForce=0;this.m_gamma=0;this.m_indexB=0;this.m_rB=new n;this.m_localCenterB=new n;this.m_invMassB=0;this.m_invIB=0;this.m_mass=new It;this.m_C=new n;this.m_targetA.Copy(e.target??n.ZERO),T.TransposeMultiplyVec2(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=e.maxForce??0,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0,this.m_beta=0,this.m_gamma=0}SetTarget(e){n.Equals(e,this.m_targetA)||(this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(e))}GetTarget(){return this.m_targetA}SetMaxForce(e){this.m_maxForce=e}GetMaxForce(){return this.m_maxForce}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexB].c,o=e.positions[this.m_indexB].a,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,{qB:a,lalcB:c}=oc;a.Set(o);let u=this.m_damping,m=this.m_stiffness,p=e.step.dt;this.m_gamma=p*(u+p*m),this.m_gamma!==0&&(this.m_gamma=1/this.m_gamma),this.m_beta=p*m*this.m_gamma,D.MultiplyVec2(a,n.Subtract(this.m_localAnchorB,this.m_localCenterB,c),this.m_rB);let d=this.m_mass;d.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,d.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,d.Inverse(),n.Add(r,this.m_rB,this.m_C).Subtract(this.m_targetA),this.m_C.Scale(this.m_beta),l*=Math.max(0,1-.02*(60*e.step.dt)),e.step.warmStarting?(this.m_impulse.Scale(e.step.dtRatio),s.AddScaled(this.m_invMassB,this.m_impulse),l+=this.m_invIB*n.Cross(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),e.velocities[this.m_indexB].w=l}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,{Cdot:s,impulse:l,oldImpulse:a}=oc;n.AddCrossScalarVec2(r,o,this.m_rB,s),It.MultiplyVec2(this.m_mass,n.Add(s,this.m_C,l).AddScaled(this.m_gamma,this.m_impulse).Negate(),l),a.Copy(this.m_impulse),this.m_impulse.Add(l);let c=e.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>c*c&&this.m_impulse.Scale(c/this.m_impulse.Length()),n.Subtract(this.m_impulse,a,l),r.AddScaled(this.m_invMassB,l),o+=this.m_invIB*n.Cross(this.m_rB,l),e.velocities[this.m_indexB].w=o}SolvePositionConstraints(e){return!0}GetAnchorA(e){return e.x=this.m_targetA.x,e.y=this.m_targetA.y,e}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return n.Scale(e,this.m_impulse,r)}GetReactionTorque(e){return 0}ShiftOrigin(e){this.m_targetA.Subtract(e)}Draw(e){let r=this.GetAnchorA(oc.pA),o=this.GetAnchorB(oc.pB);e.DrawPoint(r,4,Q.joint7),e.DrawPoint(o,4,Q.joint7),e.DrawSegment(r,o,Q.joint8)}};var Xe={K3:new Wi,K2:new It,qA:new D,qB:new D,lalcA:new n,lalcB:new n,rA:new n,rB:new n,GetJointTranslation:{pA:new n,pB:new n,d:new n,axis:new n},InitVelocityConstraints:{d:new n,P:new n},SolveVelocityConstraints:{P:new n,df:new n},SolvePositionConstraints:{d:new n,impulse:new we,impulse1:new n,P:new n},Draw:{p1:new n,p2:new n,pA:new n,pB:new n,axis:new n,lower:new n,upper:new n,perp:new n}},Nt=class extends Pt{constructor(){super(2);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n(1,0);this.referenceAngle=0;this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorForce=0;this.motorSpeed=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},lc=class extends Dt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localXAxisA=new n;this.m_localYAxisA=new n;this.m_referenceAngle=0;this.m_impulse=new n;this.m_motorImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_lowerTranslation=0;this.m_upperTranslation=0;this.m_maxMotorForce=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_enableMotor=!1;this.m_indexA=0;this.m_indexB=0;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_axis=new n;this.m_perp=new n;this.m_s1=0;this.m_s2=0;this.m_a1=0;this.m_a2=0;this.m_K=new It;this.m_translation=0;this.m_axialMass=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),n.Normalize(e.localAxisA??n.UNITX,this.m_localXAxisA),n.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=e.referenceAngle??0,this.m_lowerTranslation=e.lowerTranslation??0,this.m_upperTranslation=e.upperTranslation??0,this.m_maxMotorForce=e.maxMotorForce??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableLimit=e.enableLimit??!1,this.m_enableMotor=e.enableMotor??!1}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f,rA:b,rB:x}=Xe;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),b),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),x);let _=n.Subtract(a,r,Xe.InitVelocityConstraints.d).Add(x).Subtract(b),y=this.m_invMassA,g=this.m_invMassB,S=this.m_invIA,w=this.m_invIB;D.MultiplyVec2(p,this.m_localXAxisA,this.m_axis),this.m_a1=n.Cross(n.Add(_,b,n.s_t0),this.m_axis),this.m_a2=n.Cross(x,this.m_axis),this.m_axialMass=y+g+S*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),D.MultiplyVec2(p,this.m_localYAxisA,this.m_perp),this.m_s1=n.Cross(n.Add(_,b,n.s_t0),this.m_perp),this.m_s2=n.Cross(x,this.m_perp);let B=y+g+S*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,C=S*this.m_s1+w*this.m_s2,A=S+w;if(A===0&&(A=1),this.m_K.ex.Set(B,C),this.m_K.ey.Set(C,A),this.m_enableLimit?this.m_translation=n.Dot(this.m_axis,_):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let k=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:M}=Xe.InitVelocityConstraints;n.Scale(this.m_impulse.x,this.m_perp,M).AddScaled(k,this.m_axis);let E=this.m_impulse.x*this.m_s1+this.m_impulse.y+k*this.m_a1,L=this.m_impulse.x*this.m_s2+this.m_impulse.y+k*this.m_a2;s.SubtractScaled(y,M),l-=S*E,u.AddScaled(g,M),m+=w*L}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,{P:p,df:d}=Xe.SolveVelocityConstraints;if(this.m_enableMotor){let h=n.Dot(this.m_axis,n.Subtract(s,r,n.s_t0))+this.m_a2*l-this.m_a1*o,f=this.m_axialMass*(this.m_motorSpeed-h),b=this.m_motorImpulse,x=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=et(this.m_motorImpulse+f,-x,x),f=this.m_motorImpulse-b,n.Scale(f,this.m_axis,p);let _=f*this.m_a1,y=f*this.m_a2;r.SubtractScaled(a,p),o-=u*_,s.AddScaled(c,p),l+=m*y}if(this.m_enableLimit){{let h=this.m_translation-this.m_lowerTranslation,f=n.Dot(this.m_axis,n.Subtract(s,r,n.s_t0))+this.m_a2*l-this.m_a1*o,b=-this.m_axialMass*(f+Math.max(h,0)*e.step.inv_dt),x=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+b,0),b=this.m_lowerImpulse-x,n.Scale(b,this.m_axis,p);let _=b*this.m_a1,y=b*this.m_a2;r.SubtractScaled(a,p),o-=u*_,s.AddScaled(c,p),l+=m*y}{let h=this.m_upperTranslation-this.m_translation,f=n.Dot(this.m_axis,n.Subtract(r,s,n.s_t0))+this.m_a1*o-this.m_a2*l,b=-this.m_axialMass*(f+Math.max(h,0)*e.step.inv_dt),x=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+b,0),b=this.m_upperImpulse-x,n.Scale(b,this.m_axis,p);let _=b*this.m_a1,y=b*this.m_a2;r.AddScaled(a,p),o+=u*_,s.SubtractScaled(c,p),l-=m*y}}{let h=n.Dot(this.m_perp,n.Subtract(s,r,n.s_t0))+this.m_s2*l-this.m_s1*o,f=l-o;this.m_K.Solve(-h,-f,d),this.m_impulse.Add(d),n.Scale(d.x,this.m_perp,p);let b=d.x*this.m_s1+d.y,x=d.x*this.m_s2+d.y;r.SubtractScaled(a,p),o-=u*b,s.AddScaled(c,p),l+=m*x}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,rA:p,rB:d}=Xe;a.Set(o),c.Set(l);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB,{d:_,impulse:y,P:g}=Xe.SolvePositionConstraints;D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),p),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),d),n.Add(s,d,_).Subtract(r).Subtract(p);let S=D.MultiplyVec2(a,this.m_localXAxisA,this.m_axis),w=n.Cross(n.Add(_,p,n.s_t0),S),B=n.Cross(d,S),C=D.MultiplyVec2(a,this.m_localYAxisA,this.m_perp),A=n.Cross(n.Add(_,p,n.s_t0),C),k=n.Cross(d,C),M=n.Dot(C,_),E=l-o-this.m_referenceAngle,L=Math.abs(M),U=Math.abs(E),Y=!1,O=0;if(this.m_enableLimit){let at=n.Dot(S,_);Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Z?(O=at,L=Math.max(L,Math.abs(at)),Y=!0):at<=this.m_lowerTranslation?(O=Math.min(at-this.m_lowerTranslation,0),L=Math.max(L,this.m_lowerTranslation-at),Y=!0):at>=this.m_upperTranslation&&(O=Math.max(at-this.m_upperTranslation,0),L=Math.max(L,at-this.m_upperTranslation),Y=!0)}if(Y){let at=h+f+b*A*A+x*k*k,At=b*A+x*k,Gt=b*A*w+x*k*B,wt=b+x;wt===0&&(wt=1);let Ce=b*w+x*B,Ui=h+f+b*w*w+x*B*B,li=Xe.K3;li.ex.Set(at,At,Gt),li.ey.Set(At,wt,Ce),li.ez.Set(Gt,Ce,Ui),li.Solve33(-M,-E,-O,y)}else{let at=h+f+b*A*A+x*k*k,At=b*A+x*k,Gt=b+x;Gt===0&&(Gt=1);let wt=Xe.K2;wt.ex.Set(at,At),wt.ey.Set(At,Gt);let Ce=wt.Solve(-M,-E,Xe.SolvePositionConstraints.impulse1);y.x=Ce.x,y.y=Ce.y,y.z=0}n.Scale(y.x,C,g).AddScaled(y.z,S);let K=y.x*A+y.y+y.z*w,mt=y.x*k+y.y+y.z*B;return r.SubtractScaled(h,g),o-=b*K,s.AddScaled(f,g),l+=x*mt,e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,L<=Z&&U<=bi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse;return r.x=e*(this.m_impulse.x*this.m_perp.x+o*this.m_axis.x),r.y=e*(this.m_impulse.x*this.m_perp.y+o*this.m_axis.y),r}GetReactionTorque(e){return e*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){let{pA:e,pB:r,axis:o,d:s}=Xe.GetJointTranslation;return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e),this.m_bodyB.GetWorldPoint(this.m_localAnchorB,r),n.Subtract(r,e,s),this.m_bodyA.GetWorldVector(this.m_localXAxisA,o),n.Dot(s,o)}GetJointSpeed(){let e=this.m_bodyA,r=this.m_bodyB,{lalcA:o,lalcB:s,rA:l,rB:a}=Xe;D.MultiplyVec2(e.m_xf.q,n.Subtract(this.m_localAnchorA,e.m_sweep.localCenter,o),l),D.MultiplyVec2(r.m_xf.q,n.Subtract(this.m_localAnchorB,r.m_sweep.localCenter,s),a);let c=n.Add(e.m_sweep.c,l,n.s_t0),u=n.Add(r.m_sweep.c,a,n.s_t1),m=n.Subtract(u,c,n.s_t2),p=D.MultiplyVec2(e.m_xf.q,this.m_localXAxisA,this.m_axis),d=e.m_linearVelocity,h=r.m_linearVelocity,f=e.m_angularVelocity,b=r.m_angularVelocity;return n.Dot(m,n.CrossScalarVec2(f,p,n.s_t0))+n.Dot(p,n.Subtract(n.AddCrossScalarVec2(h,b,a,n.s_t0),n.AddCrossScalarVec2(d,f,l,n.s_t1),n.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(e,r){(e!==this.m_lowerTranslation||r!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_lowerImpulse=0,this.m_upperImpulse=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(e){e!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(e){return e*this.m_motorImpulse}Draw(e){let{p1:r,p2:o,pA:s,pB:l,axis:a}=Xe.Draw,c=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();if(T.MultiplyVec2(c,this.m_localAnchorA,s),T.MultiplyVec2(u,this.m_localAnchorB,l),D.MultiplyVec2(c.q,this.m_localXAxisA,a),e.DrawSegment(s,l,Q.joint5),this.m_enableLimit){let{lower:m,upper:p,perp:d}=Xe.Draw;n.AddScaled(s,this.m_lowerTranslation,a,m),n.AddScaled(s,this.m_upperTranslation,a,p),D.MultiplyVec2(c.q,this.m_localYAxisA,d),e.DrawSegment(m,p,Q.joint1),e.DrawSegment(n.SubtractScaled(m,.5,d,r),n.AddScaled(m,.5,d,o),Q.joint2),e.DrawSegment(n.SubtractScaled(p,.5,d,r),n.AddScaled(p,.5,d,o),Q.joint3)}else e.DrawSegment(n.Subtract(s,a,r),n.Add(s,a,o),Q.joint1);e.DrawPoint(s,5,Q.joint1),e.DrawPoint(l,5,Q.joint4)}};var Ir={qA:new D,qB:new D,lalcA:new n,lalcB:new n,p:new n,PA:new n,PB:new n,vpA:new n,vpB:new n,pA:new n,pB:new n},ac=class extends Pt{constructor(){super(4);this.groundAnchorA=new n(-1,1);this.groundAnchorB=new n(1,1);this.localAnchorA=new n(-1,0);this.localAnchorB=new n(1,0);this.lengthA=0;this.lengthB=0;this.ratio=1;this.collideConnected=!0}Initialize(e,r,o,s,l,a,c){this.bodyA=e,this.bodyB=r,this.groundAnchorA.Copy(o),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(l,this.localAnchorA),this.bodyB.GetLocalPoint(a,this.localAnchorB),this.lengthA=n.Distance(l,o),this.lengthB=n.Distance(a,s),this.ratio=c}},d1=new n(-1,1),h1=n.UNITX,f1=new n(-1,0),b1=n.UNITX,cc=class extends Dt{constructor(e){super(e);this.m_groundAnchorA=new n;this.m_groundAnchorB=new n;this.m_lengthA=0;this.m_lengthB=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_constant=0;this.m_ratio=0;this.m_impulse=0;this.m_indexA=0;this.m_indexB=0;this.m_uA=new n;this.m_uB=new n;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_mass=0;this.m_groundAnchorA.Copy(e.groundAnchorA??d1),this.m_groundAnchorB.Copy(e.groundAnchorB??h1),this.m_localAnchorA.Copy(e.localAnchorA??f1),this.m_localAnchorB.Copy(e.localAnchorB??b1),this.m_lengthA=e.lengthA??0,this.m_lengthB=e.lengthB??0,this.m_ratio=e.ratio??1,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,l=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{qA:p,qB:d,lalcA:h,lalcB:f}=Ir;p.Set(o),d.Set(c),D.MultiplyVec2(p,n.Subtract(this.m_localAnchorA,this.m_localCenterA,h),this.m_rA),D.MultiplyVec2(d,n.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),n.Add(r,this.m_rA,this.m_uA).Subtract(this.m_groundAnchorA),n.Add(a,this.m_rB,this.m_uB).Subtract(this.m_groundAnchorB);let b=this.m_uA.Length(),x=this.m_uB.Length();b>10*Z?this.m_uA.Scale(1/b):this.m_uA.SetZero(),x>10*Z?this.m_uB.Scale(1/x):this.m_uB.SetZero();let _=n.Cross(this.m_rA,this.m_uA),y=n.Cross(this.m_rB,this.m_uB),g=this.m_invMassA+this.m_invIA*_*_,S=this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=g+this.m_ratio*this.m_ratio*S,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.step.warmStarting){this.m_impulse*=e.step.dtRatio;let{PA:w,PB:B}=Ir;n.Scale(-this.m_impulse,this.m_uA,w),n.Scale(-this.m_ratio*this.m_impulse,this.m_uB,B),s.AddScaled(this.m_invMassA,w),l+=this.m_invIA*n.Cross(this.m_rA,w),u.AddScaled(this.m_invMassB,B),m+=this.m_invIB*n.Cross(this.m_rB,B)}else this.m_impulse=0;e.velocities[this.m_indexA].w=l,e.velocities[this.m_indexB].w=m}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,{PA:a,PB:c,vpA:u,vpB:m}=Ir;n.AddCrossScalarVec2(r,o,this.m_rA,u),n.AddCrossScalarVec2(s,l,this.m_rB,m);let p=-n.Dot(this.m_uA,u)-this.m_ratio*n.Dot(this.m_uB,m),d=-this.m_mass*p;this.m_impulse+=d,n.Scale(-d,this.m_uA,a),n.Scale(-this.m_ratio*d,this.m_uB,c),r.AddScaled(this.m_invMassA,a),o+=this.m_invIA*n.Cross(this.m_rA,a),s.AddScaled(this.m_invMassB,c),l+=this.m_invIB*n.Cross(this.m_rB,c),e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,PA:p,PB:d}=Ir;a.Set(o),c.Set(l);let h=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),f=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB),b=n.Add(r,h,this.m_uA).Subtract(this.m_groundAnchorA),x=n.Add(s,f,this.m_uB).Subtract(this.m_groundAnchorB),_=b.Length(),y=x.Length();_>10*Z?b.Scale(1/_):b.SetZero(),y>10*Z?x.Scale(1/y):x.SetZero();let g=n.Cross(h,b),S=n.Cross(f,x),w=this.m_invMassA+this.m_invIA*g*g,B=this.m_invMassB+this.m_invIB*S*S,C=w+this.m_ratio*this.m_ratio*B;C>0&&(C=1/C);let A=this.m_constant-_-this.m_ratio*y,k=Math.abs(A),M=-C*A;return n.Scale(-M,b,p),n.Scale(-this.m_ratio*M,x,d),r.AddScaled(this.m_invMassA,p),o+=this.m_invIA*n.Cross(h,p),s.AddScaled(this.m_invMassB,d),l+=this.m_invIB*n.Cross(f,d),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,k<Z}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse*this.m_uB.x,r.y=e*this.m_impulse*this.m_uB.y,r}GetReactionTorque(e){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){let e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Ir.p),r=this.m_groundAnchorA;return n.Distance(e,r)}GetCurrentLengthB(){let e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Ir.p),r=this.m_groundAnchorB;return n.Distance(e,r)}ShiftOrigin(e){this.m_groundAnchorA.Subtract(e),this.m_groundAnchorB.Subtract(e)}Draw(e){let r=this.GetAnchorA(Ir.pA),o=this.GetAnchorB(Ir.pB),s=this.GetGroundAnchorA(),l=this.GetGroundAnchorB();e.DrawSegment(s,r,Q.joint6),e.DrawSegment(l,o,Q.joint6),e.DrawSegment(s,l,Q.joint6)}};var fo={qA:new D,qB:new D,lalcA:new n,lalcB:new n,P:new n,Cdot:new n,C:new n,impulse:new n,p2:new n,r:new n,pA:new n,pB:new n,rlo:new n,rhi:new n},q=class extends Pt{constructor(){super(1);this.localAnchorA=new n;this.localAnchorB=new n;this.referenceAngle=0;this.enableLimit=!1;this.lowerAngle=0;this.upperAngle=0;this.enableMotor=!1;this.motorSpeed=0;this.maxMotorTorque=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},uc=class extends Dt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_impulse=new n;this.m_motorImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_enableMotor=!1;this.m_maxMotorTorque=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_referenceAngle=0;this.m_lowerAngle=0;this.m_upperAngle=0;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_K=new It;this.m_angle=0;this.m_axialMass=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_referenceAngle=e.referenceAngle??0,this.m_impulse.SetZero(),this.m_lowerAngle=e.lowerAngle??0,this.m_upperAngle=e.upperAngle??0,this.m_maxMotorTorque=e.maxMotorTorque??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableLimit=e.enableLimit??!1,this.m_enableMotor=e.enableMotor??!1}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d}=fo;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let h=this.m_invMassA,f=this.m_invMassB,b=this.m_invIA,x=this.m_invIB;this.m_K.ex.x=h+f+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*x,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*x,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=h+f+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*x,this.m_axialMass=b+x;let _;if(this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,_=!1):_=!0,this.m_angle=l-r-this.m_referenceAngle,(this.m_enableLimit===!1||_)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(this.m_enableMotor===!1||_)&&(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio,this.m_lowerImpulse*=e.step.dtRatio,this.m_upperImpulse*=e.step.dtRatio;let y=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,g=fo.P.Set(this.m_impulse.x,this.m_impulse.y);o.SubtractScaled(h,g),s-=b*(n.Cross(this.m_rA,g)+y),a.AddScaled(f,g),c+=x*(n.Cross(this.m_rB,g)+y)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,p=u+m===0;if(this.m_enableMotor&&!p){let d=l-o-this.m_motorSpeed,h=-this.m_axialMass*d,f=this.m_motorImpulse,b=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=et(this.m_motorImpulse+h,-b,b),h=this.m_motorImpulse-f,o-=u*h,l+=m*h}if(this.m_enableLimit&&!p){{let d=this.m_angle-this.m_lowerAngle,h=l-o,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-b,o-=u*f,l+=m*f}{let d=this.m_upperAngle-this.m_angle,h=o-l,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-b,o+=u*f,l-=m*f}}{let{Cdot:d,impulse:h}=fo;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),d),this.m_K.Solve(-d.x,-d.y,h),this.m_impulse.x+=h.x,this.m_impulse.y+=h.y,r.SubtractScaled(a,h),o-=u*n.Cross(this.m_rA,h),s.AddScaled(c,h),l+=m*n.Cross(this.m_rB,h)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,impulse:p}=fo;a.Set(o),c.Set(l);let d=0,h=0,f=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!f){let b=l-o-this.m_referenceAngle,x=0;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*bi?x=et(b-this.m_lowerAngle,-Cn,Cn):b<=this.m_lowerAngle?x=et(b-this.m_lowerAngle+bi,-Cn,0):b>=this.m_upperAngle&&(x=et(b-this.m_upperAngle-bi,0,Cn));let _=-this.m_axialMass*x;o-=this.m_invIA*_,l+=this.m_invIB*_,d=Math.abs(x)}{a.Set(o),c.Set(l);let b=D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),x=D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB),_=n.Add(s,x,fo.C).Subtract(r).Subtract(b);h=_.Length();let y=this.m_invMassA,g=this.m_invMassB,S=this.m_invIA,w=this.m_invIB,B=this.m_K;B.ex.x=y+g+S*b.y*b.y+w*x.y*x.y,B.ex.y=-S*b.x*b.y-w*x.x*x.y,B.ey.x=B.ex.y,B.ey.y=y+g+S*b.x*b.x+w*x.x*x.x,B.Solve(_.x,_.y,p).Negate(),r.SubtractScaled(y,p),o-=S*n.Cross(b,p),s.AddScaled(g,p),l+=w*n.Cross(x,p)}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,h<=Z&&d<=bi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse.x,r.y=e*this.m_impulse.y,r}GetReactionTorque(e){return e*(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}GetMotorTorque(e){return e*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(e){e!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(e,r){(e!==this.m_lowerAngle||r!==this.m_upperAngle)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=e,this.m_upperAngle=r)}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}Draw(e){let{p2:r,r:o,pA:s,pB:l}=fo,a=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();T.MultiplyVec2(a,this.m_localAnchorA,s),T.MultiplyVec2(c,this.m_localAnchorB,l),e.DrawPoint(s,5,Q.joint4),e.DrawPoint(l,5,Q.joint5);let u=this.m_bodyA.GetAngle(),p=this.m_bodyB.GetAngle()-u-this.m_referenceAngle,d=.5;if(o.Set(Math.cos(p),Math.sin(p)).Scale(d),e.DrawSegment(l,n.Add(l,o,r),Q.joint1),e.DrawCircle(l,d,Q.joint1),this.m_enableLimit){let{rlo:h,rhi:f}=fo;h.Set(Math.cos(this.m_lowerAngle),Math.sin(this.m_lowerAngle)).Scale(d),f.Set(Math.cos(this.m_upperAngle),Math.sin(this.m_upperAngle)).Scale(d),e.DrawSegment(l,n.Add(l,h,r),Q.joint2),e.DrawSegment(l,n.Add(l,f,r),Q.joint3)}e.DrawSegment(a.p,s,Q.joint6),e.DrawSegment(s,l,Q.joint6),e.DrawSegment(c.p,l,Q.joint6)}};var ms={qA:new D,qB:new D,rA:new n,rB:new n,lalcA:new n,lalcB:new n,K:new Wi,P:new n,Cdot1:new we,impulse1:new n,impulse:new we,C1:new n,C:new we},bo=class extends Pt{constructor(){super(8);this.localAnchorA=new n;this.localAnchorB=new n;this.referenceAngle=0;this.stiffness=0;this.damping=0}Initialize(e,r,o){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}},mc=class extends Dt{constructor(e){super(e);this.m_stiffness=0;this.m_damping=0;this.m_bias=0;this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_referenceAngle=0;this.m_gamma=0;this.m_impulse=new we;this.m_indexA=0;this.m_indexB=0;this.m_rA=new n;this.m_rB=new n;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_mass=new Wi;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_referenceAngle=e.referenceAngle??0,this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v,s=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,{qA:u,qB:m,lalcA:p,lalcB:d,K:h}=ms;u.Set(r),m.Set(l),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),D.MultiplyVec2(m,n.Subtract(this.m_localAnchorB,this.m_localCenterB,d),this.m_rB);let f=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,_=this.m_invIB;if(h.ex.x=f+b+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*_,h.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*_,h.ez.x=-this.m_rA.y*x-this.m_rB.y*_,h.ex.y=h.ey.x,h.ey.y=f+b+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*_,h.ez.y=this.m_rA.x*x+this.m_rB.x*_,h.ex.z=h.ez.x,h.ey.z=h.ez.y,h.ez.z=x+_,this.m_stiffness>0){h.GetInverse22(this.m_mass);let y=x+_,g=l-r-this.m_referenceAngle,S=this.m_damping,w=this.m_stiffness,B=e.step.dt;this.m_gamma=B*(S+B*w),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=g*B*w*this.m_gamma,y+=this.m_gamma,this.m_mass.ez.z=y!==0?1/y:0}else h.ez.z===0?(h.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(h.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.step.warmStarting){this.m_impulse.Scale(e.step.dtRatio);let{P:y}=ms;y.Copy(this.m_impulse),o.SubtractScaled(f,y),s-=x*(n.Cross(this.m_rA,y)+this.m_impulse.z),a.AddScaled(b,y),c+=_*(n.Cross(this.m_rB,y)+this.m_impulse.z)}else this.m_impulse.SetZero();e.velocities[this.m_indexA].w=s,e.velocities[this.m_indexB].w=c}SolveVelocityConstraints(e){let r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,m=this.m_invIB;if(this.m_stiffness>0){let p=l-o,d=-this.m_mass.ez.z*(p+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=d,o-=u*d,l+=m*d;let{Cdot1:h,impulse1:f}=ms;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),h),Wi.MultiplyVec2(this.m_mass,h,f).Negate(),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;let b=f;r.SubtractScaled(a,b),o-=u*n.Cross(this.m_rA,b),s.AddScaled(c,b),l+=m*n.Cross(this.m_rB,b)}else{let{Cdot1:p,impulse:d,P:h}=ms;n.Subtract(n.AddCrossScalarVec2(s,l,this.m_rB,n.s_t0),n.AddCrossScalarVec2(r,o,this.m_rA,n.s_t1),p),p.z=l-o,Wi.MultiplyVec3(this.m_mass,p,d).Negate(),this.m_impulse.Add(d),h.Set(d.x,d.y),r.SubtractScaled(a,h),o-=u*(n.Cross(this.m_rA,h)+d.z),s.AddScaled(c,h),l+=m*(n.Cross(this.m_rB,h)+d.z)}e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=l}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,{qA:a,qB:c,lalcA:u,lalcB:m,K:p,C1:d,P:h,rA:f,rB:b}=ms;a.Set(o),c.Set(l);let x=this.m_invMassA,_=this.m_invMassB,y=this.m_invIA,g=this.m_invIB;D.MultiplyVec2(a,n.Subtract(this.m_localAnchorA,this.m_localCenterA,u),f),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorB,this.m_localCenterB,m),b);let S,w;if(p.ex.x=x+_+f.y*f.y*y+b.y*b.y*g,p.ey.x=-f.y*f.x*y-b.y*b.x*g,p.ez.x=-f.y*y-b.y*g,p.ex.y=p.ey.x,p.ey.y=x+_+f.x*f.x*y+b.x*b.x*g,p.ez.y=f.x*y+b.x*g,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=y+g,this.m_stiffness>0)n.Add(s,b,d).Subtract(r).Subtract(f),S=d.Length(),w=0,p.Solve22(d.x,d.y,h).Negate(),r.SubtractScaled(x,h),o-=y*n.Cross(f,h),s.AddScaled(_,h),l+=g*n.Cross(b,h);else{n.Add(s,b,d).Subtract(r).Subtract(f),n.Subtract(n.Add(s,b,n.s_t0),n.Add(r,f,n.s_t1),d);let B=l-o-this.m_referenceAngle;S=d.Length(),w=Math.abs(B);let{impulse:C,C:A}=ms;A.Set(d.x,d.y,B),p.ez.z>0?p.Solve33(A.x,A.y,A.z,C).Negate():(p.Solve22(d.x,d.y,C).Negate(),C.z=0),h.Copy(C),r.SubtractScaled(x,h),o-=y*(n.Cross(f,h)+C.z),s.AddScaled(_,h),l+=g*(n.Cross(b,h)+C.z)}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,S<=Z&&w<=bi}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){return r.x=e*this.m_impulse.x,r.y=e*this.m_impulse.y,r}GetReactionTorque(e){return e*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}};var Lr={qA:new D,qB:new D,lalcA:new n,lalcB:new n,rA:new n,rB:new n,d:new n,P:new n,ay:new n,pA:new n,pB:new n,axis:new n,Draw:{p1:new n,p2:new n,pA:new n,pB:new n,axis:new n,lower:new n,upper:new n,perp:new n}},ps=class extends Pt{constructor(){super(7);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n(1,0);this.enableLimit=!1;this.lowerTranslation=0;this.upperTranslation=0;this.enableMotor=!1;this.maxMotorTorque=0;this.motorSpeed=0;this.stiffness=0;this.damping=0}Initialize(e,r,o,s){this.bodyA=e,this.bodyB=r,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}},pc=class extends Dt{constructor(e){super(e);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_localXAxisA=new n;this.m_localYAxisA=new n;this.m_impulse=0;this.m_motorImpulse=0;this.m_springImpulse=0;this.m_lowerImpulse=0;this.m_upperImpulse=0;this.m_translation=0;this.m_lowerTranslation=0;this.m_upperTranslation=0;this.m_maxMotorTorque=0;this.m_motorSpeed=0;this.m_enableLimit=!1;this.m_enableMotor=!1;this.m_stiffness=0;this.m_damping=0;this.m_indexA=0;this.m_indexB=0;this.m_localCenterA=new n;this.m_localCenterB=new n;this.m_invMassA=0;this.m_invMassB=0;this.m_invIA=0;this.m_invIB=0;this.m_ax=new n;this.m_ay=new n;this.m_sAx=0;this.m_sBx=0;this.m_sAy=0;this.m_sBy=0;this.m_mass=0;this.m_motorMass=0;this.m_axialMass=0;this.m_springMass=0;this.m_bias=0;this.m_gamma=0;this.m_localAnchorA.Copy(e.localAnchorA??n.ZERO),this.m_localAnchorB.Copy(e.localAnchorB??n.ZERO),this.m_localXAxisA.Copy(e.localAxisA??n.UNITX),n.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_lowerTranslation=e.lowerTranslation??0,this.m_upperTranslation=e.upperTranslation??0,this.m_enableLimit=e.enableLimit??!1,this.m_maxMotorTorque=e.maxMotorTorque??0,this.m_motorSpeed=e.motorSpeed??0,this.m_enableMotor=e.enableMotor??!1,this.m_ax.SetZero(),this.m_ay.SetZero(),this.m_stiffness=e.stiffness??0,this.m_damping=e.damping??0}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetStiffness(e){this.m_stiffness=e}GetStiffness(){return this.m_stiffness}SetDamping(e){this.m_damping=e}GetDamping(){return this.m_damping}InitVelocityConstraints(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;let r=this.m_invMassA,o=this.m_invMassB,s=this.m_invIA,l=this.m_invIB,a=e.positions[this.m_indexA].c,c=e.positions[this.m_indexA].a,u=e.velocities[this.m_indexA].v,m=e.velocities[this.m_indexA].w,p=e.positions[this.m_indexB].c,d=e.positions[this.m_indexB].a,h=e.velocities[this.m_indexB].v,f=e.velocities[this.m_indexB].w,{qA:b,qB:x,lalcA:_,lalcB:y,rA:g,rB:S,d:w}=Lr;b.Set(c),x.Set(d),D.MultiplyVec2(b,n.Subtract(this.m_localAnchorA,this.m_localCenterA,_),g),D.MultiplyVec2(x,n.Subtract(this.m_localAnchorB,this.m_localCenterB,y),S),n.Add(p,S,w).Subtract(a).Subtract(g),D.MultiplyVec2(b,this.m_localYAxisA,this.m_ay),this.m_sAy=n.Cross(n.Add(w,g,n.s_t0),this.m_ay),this.m_sBy=n.Cross(S,this.m_ay),this.m_mass=r+o+s*this.m_sAy*this.m_sAy+l*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),D.MultiplyVec2(b,this.m_localXAxisA,this.m_ax),this.m_sAx=n.Cross(n.Add(w,g,n.s_t0),this.m_ax),this.m_sBx=n.Cross(S,this.m_ax);let B=r+o+s*this.m_sAx*this.m_sAx+l*this.m_sBx*this.m_sBx;if(B>0?this.m_axialMass=1/B:this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&B>0){this.m_springMass=1/B;let C=n.Dot(w,this.m_ax),A=e.step.dt;this.m_gamma=A*(this.m_damping+A*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=C*A*this.m_stiffness*this.m_gamma,this.m_springMass=B+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=n.Dot(this.m_ax,w):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=s+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_springImpulse*=e.step.dtRatio,this.m_motorImpulse*=e.step.dtRatio;let C=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:A}=Lr;n.Scale(this.m_impulse,this.m_ay,A).AddScaled(C,this.m_ax);let k=this.m_impulse*this.m_sAy+C*this.m_sAx+this.m_motorImpulse,M=this.m_impulse*this.m_sBy+C*this.m_sBx+this.m_motorImpulse;u.SubtractScaled(this.m_invMassA,A),m-=this.m_invIA*k,h.AddScaled(this.m_invMassB,A),f+=this.m_invIB*M}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;e.velocities[this.m_indexA].w=m,e.velocities[this.m_indexB].w=f}SolveVelocityConstraints(e){let r=this.m_invMassA,o=this.m_invMassB,s=this.m_invIA,l=this.m_invIB,a=e.velocities[this.m_indexA].v,c=e.velocities[this.m_indexA].w,u=e.velocities[this.m_indexB].v,m=e.velocities[this.m_indexB].w,{P:p}=Lr;{let d=n.Dot(this.m_ax,n.Subtract(u,a,n.s_t0))+this.m_sBx*m-this.m_sAx*c,h=-this.m_springMass*(d+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h,n.Scale(h,this.m_ax,p);let f=h*this.m_sAx,b=h*this.m_sBx;a.SubtractScaled(r,p),c-=s*f,u.AddScaled(o,p),m+=l*b}{let d=m-c-this.m_motorSpeed,h=-this.m_motorMass*d,f=this.m_motorImpulse,b=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=et(this.m_motorImpulse+h,-b,b),h=this.m_motorImpulse-f,c-=s*h,m+=l*h}if(this.m_enableLimit){{let d=this.m_translation-this.m_lowerTranslation,h=n.Dot(this.m_ax,n.Subtract(u,a,n.s_t0))+this.m_sBx*m-this.m_sAx*c,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-b,n.Scale(f,this.m_ax,p);let x=f*this.m_sAx,_=f*this.m_sBx;a.SubtractScaled(r,p),c-=s*x,u.AddScaled(o,p),m+=l*_}{let d=this.m_upperTranslation-this.m_translation,h=n.Dot(this.m_ax,n.Subtract(a,u,n.s_t0))+this.m_sAx*c-this.m_sBx*m,f=-this.m_axialMass*(h+Math.max(d,0)*e.step.inv_dt),b=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-b,n.Scale(f,this.m_ax,p);let x=f*this.m_sAx,_=f*this.m_sBx;a.AddScaled(r,p),c+=s*x,u.SubtractScaled(o,p),m-=l*_}}{let d=n.Dot(this.m_ay,n.Subtract(u,a,n.s_t0))+this.m_sBy*m-this.m_sAy*c,h=-this.m_mass*d;this.m_impulse+=h,n.Scale(h,this.m_ay,p);let f=h*this.m_sAy,b=h*this.m_sBy;a.SubtractScaled(r,p),c-=s*f,u.AddScaled(o,p),m+=l*b}e.velocities[this.m_indexA].w=c,e.velocities[this.m_indexB].w=m}SolvePositionConstraints(e){let r=e.positions[this.m_indexA].c,o=e.positions[this.m_indexA].a,s=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,a=0,{qA:c,qB:u,lalcA:m,lalcB:p,rA:d,rB:h,d:f,P:b,ay:x}=Lr;if(this.m_enableLimit){c.Set(o),u.Set(l),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorA,this.m_localCenterA,m),d),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorB,this.m_localCenterB,p),h),n.Subtract(s,r,f).Add(h).Subtract(d);let _=D.MultiplyVec2(c,this.m_localXAxisA,this.m_ax),y=n.Cross(n.Add(f,d,n.s_t0),this.m_ax),g=n.Cross(h,this.m_ax),S=0,w=n.Dot(_,f);if(Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Z?S=w:w<=this.m_lowerTranslation?S=Math.min(w-this.m_lowerTranslation,0):w>=this.m_upperTranslation&&(S=Math.max(w-this.m_upperTranslation,0)),S!==0){let B=this.m_invMassA+this.m_invMassB+this.m_invIA*y*y+this.m_invIB*g*g,C=0;B!==0&&(C=-S/B),n.Scale(C,_,b);let A=C*y,k=C*g;r.SubtractScaled(this.m_invMassA,b),o-=this.m_invIA*A,s.AddScaled(this.m_invMassB,b),l+=this.m_invIB*k,a=Math.abs(S)}}{c.Set(o),u.Set(l),D.MultiplyVec2(c,n.Subtract(this.m_localAnchorA,this.m_localCenterA,m),d),D.MultiplyVec2(u,n.Subtract(this.m_localAnchorB,this.m_localCenterB,p),h),n.Subtract(s,r,f).Add(h).Subtract(d),D.MultiplyVec2(c,this.m_localYAxisA,x);let _=n.Cross(n.Add(f,d,n.s_t0),x),y=n.Cross(h,x),g=n.Dot(f,x),S=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,w=0;S!==0&&(w=-g/S),n.Scale(w,x,b);let B=w*_,C=w*y;r.SubtractScaled(this.m_invMassA,b),o-=this.m_invIA*B,s.AddScaled(this.m_invMassB,b),l+=this.m_invIB*C,a=Math.max(a,Math.abs(g))}return e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].a=l,a<=Z}GetAnchorA(e){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e)}GetAnchorB(e){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e)}GetReactionForce(e,r){let o=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse;return r.x=e*(this.m_impulse*this.m_ay.x+o*this.m_ax.x),r.y=e*(this.m_impulse*this.m_ay.y+o*this.m_ax.y),r}GetReactionTorque(e){return e*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){let e=this.m_bodyA,r=this.m_bodyB,{pA:o,pB:s,d:l,axis:a}=Lr;return e.GetWorldPoint(this.m_localAnchorA,o),r.GetWorldPoint(this.m_localAnchorB,s),n.Subtract(s,o,l),e.GetWorldVector(this.m_localXAxisA,a),n.Dot(l,a)}GetJointLinearSpeed(){let e=this.m_bodyA,r=this.m_bodyB,{rA:o,rB:s,lalcA:l,lalcB:a,axis:c}=Lr;D.MultiplyVec2(e.m_xf.q,n.Subtract(this.m_localAnchorA,e.m_sweep.localCenter,l),o),D.MultiplyVec2(r.m_xf.q,n.Subtract(this.m_localAnchorB,r.m_sweep.localCenter,a),s);let u=n.Add(e.m_sweep.c,o,n.s_t0),m=n.Add(r.m_sweep.c,s,n.s_t1),p=n.Subtract(m,u,n.s_t2);D.MultiplyVec2(e.m_xf.q,this.m_localXAxisA,c);let d=e.m_linearVelocity,h=r.m_linearVelocity,f=e.m_angularVelocity,b=r.m_angularVelocity;return n.Dot(p,n.CrossScalarVec2(f,c,n.s_t0))+n.Dot(c,n.AddCrossScalarVec2(h,b,s,n.s_t0).Subtract(d).Subtract(n.CrossScalarVec2(f,o,n.s_t1)))}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetJointAngularSpeed(){let e=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-e}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(e){return e!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e),e}SetMotorSpeed(e){return e!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e),e}SetMaxMotorTorque(e){e!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e)}GetMotorTorque(e){return e*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(e){return e!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_lowerImpulse=0,this.m_upperImpulse=0),e}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(e,r){(e!==this.m_lowerTranslation||r!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_lowerImpulse=0,this.m_upperImpulse=0)}Draw(e){let{p1:r,p2:o,pA:s,pB:l,axis:a}=Lr.Draw,c=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();if(T.MultiplyVec2(c,this.m_localAnchorA,s),T.MultiplyVec2(u,this.m_localAnchorB,l),D.MultiplyVec2(c.q,this.m_localXAxisA,a),e.DrawSegment(s,l,Q.joint5),this.m_enableLimit){let{lower:m,upper:p,perp:d}=Lr.Draw;n.AddScaled(s,this.m_lowerTranslation,a,m),n.AddScaled(s,this.m_upperTranslation,a,p),D.MultiplyVec2(c.q,this.m_localYAxisA,d),e.DrawSegment(m,p,Q.joint1),e.DrawSegment(n.SubtractScaled(m,.5,d,r),n.AddScaled(m,.5,d,o),Q.joint2),e.DrawSegment(n.SubtractScaled(p,.5,d,r),n.AddScaled(p,.5,d,o),Q.joint3)}else e.DrawSegment(n.Subtract(s,a,r),n.Add(s,a,o),Q.joint1);e.DrawPoint(s,5,Q.joint1),e.DrawPoint(l,5,Q.joint4)}};function b0(i,t){return Math.sqrt(i*t)}function _0(i,t){return i>t?i:t}function y0(i,t){return i<t?i:t}var dc=class{constructor(t){this.m_other=null;this.prev=null;this.next=null;this.contact=t}get other(){return N(this.m_other!==null),this.m_other}set other(t){N(this.m_other===null),this.m_other=t}Reset(){this.m_other=null,this.prev=null,this.next=null}},de=class{constructor(){this.m_islandFlag=!1;this.m_touchingFlag=!1;this.m_enabledFlag=!1;this.m_filterFlag=!1;this.m_bulletHitFlag=!1;this.m_toiFlag=!1;this.m_prev=null;this.m_next=null;this.m_nodeA=new dc(this);this.m_nodeB=new dc(this);this.m_indexA=0;this.m_indexB=0;this.m_manifold=new po;this.m_toiCount=0;this.m_toi=0;this.m_friction=0;this.m_restitution=0;this.m_restitutionThreshold=0;this.m_tangentSpeed=0;this.m_oldManifold=new po}GetManifold(){return this.m_manifold}GetWorldManifold(t){let e=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody(),o=this.GetShapeA(),s=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,r.GetTransform(),s.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=b0(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=_0(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=y0(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,r,o){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=r,this.m_indexA=e,this.m_indexB=o,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=b0(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=_0(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=y0(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(t){let e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let r=!1,o=this.m_touchingFlag,s=this.m_fixtureA.IsSensor(),l=this.m_fixtureB.IsSensor(),a=s||l,c=this.m_fixtureA.GetBody(),u=this.m_fixtureB.GetBody(),m=c.GetTransform(),p=u.GetTransform();if(a){let d=this.GetShapeA(),h=this.GetShapeB();r=rs(d,this.m_indexA,h,this.m_indexB,m,p),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,m,p),r=this.m_manifold.pointCount>0;for(let d=0;d<this.m_manifold.pointCount;++d){let h=this.m_manifold.points[d];h.normalImpulse=0,h.tangentImpulse=0;let f=h.id;for(let b=0;b<this.m_oldManifold.pointCount;++b){let x=this.m_oldManifold.points[b];if(x.id.key===f.key){h.normalImpulse=x.normalImpulse,h.tangentImpulse=x.tangentImpulse;break}}}r!==o&&(c.SetAwake(!0),u.SetAwake(!0))}this.m_touchingFlag=r,!o&&r&&t&&t.BeginContact(this),o&&!r&&t&&t.EndContact(this),!a&&r&&t&&t.PreSolve(this,this.m_oldManifold)}};var hc=class extends de{Evaluate(t,e,r){u0(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var fc=class extends de{Evaluate(t,e,r){Na(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var bc=class extends de{Evaluate(t,e,r){m0(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var _c=class extends de{Evaluate(t,e,r){Qa(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var yc=class extends de{Evaluate(t,e,r){qa(t,this.GetShapeA(),e,this.GetShapeB(),r)}};var xc=class i extends de{static{this.Evaluate_s_edge=new I}Evaluate(t,e,r){let o=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(o,this.m_indexA),Qa(t,o,e,this.GetShapeB(),r)}};var gc=class i extends de{static{this.Evaluate_s_edge=new I}Evaluate(t,e,r){let o=i.Evaluate_s_edge;this.GetShapeA().GetChildEdge(o,this.m_indexA),qa(t,o,e,this.GetShapeB(),r)}};var Sc=class{constructor(){let t=new Array(4);for(let e=0;e<4;e++)t[e]=new Array(4);this.m_registers=t,this.AddType(hc,0,0),this.AddType(bc,2,0),this.AddType(fc,2,2),this.AddType(_c,1,0),this.AddType(yc,1,2),this.AddType(xc,3,0),this.AddType(gc,3,2)}AddType(t,e,r){let o=[],s=l=>{o.push(l)};this.m_registers[e][r]={createFcn(l,a,c,u){let m=o.pop()??new t;return m.Reset(l,a,c,u),m},destroyFcn:s},e!==r&&(this.m_registers[r][e]={createFcn(l,a,c,u){let m=o.pop()??new t;return m.Reset(c,u,l,a),m},destroyFcn:s})}Create(t,e,r,o){let s=t.GetType(),l=r.GetType(),a=this.m_registers[s][l];return a?a.createFcn(t,e,r,o):null}Destroy(t){let e=t.m_fixtureA.GetType(),r=t.m_fixtureB.GetType();this.m_registers[e][r]?.destroyFcn(t)}};var Li=class{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}},Gr=class i{ShouldCollide(t,e){let r=t.GetFilterData(),o=e.GetFilterData();return r.groupIndex===o.groupIndex&&r.groupIndex!==0?r.groupIndex>0:(r.maskBits&o.categoryBits)!==0&&(r.categoryBits&o.maskBits)!==0}static{this.b2_defaultFilter=new i}},wc=class{constructor(){this.normalImpulses=je(Ot);this.tangentImpulses=je(Ot);this.count=0}},Vr=class i{BeginContact(t){}EndContact(t){}PreSolve(t,e){}PostSolve(t,e){}static{this.b2_defaultListener=new i}};var vc=class{constructor(){this.m_broadPhase=new ja;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=Gr.b2_defaultFilter;this.m_contactListener=Vr.b2_defaultListener;this.m_contactFactory=new Sc;this.AddPair=(t,e)=>{let r=t.fixture,o=e.fixture,s=t.childIndex,l=e.childIndex,a=r.GetBody(),c=o.GetBody();if(a===c)return;let u=c.GetContactList();for(;u;){if(u.other===a){let p=u.contact.GetFixtureA(),d=u.contact.GetFixtureB(),h=u.contact.GetChildIndexA(),f=u.contact.GetChildIndexB();if(p===r&&d===o&&h===s&&f===l||p===o&&d===r&&h===l&&f===s)return}u=u.next}if(c.ShouldCollide(a)===!1||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(r,o))return;let m=this.m_contactFactory.Create(r,s,o,l);m!==null&&(r=m.GetFixtureA(),o=m.GetFixtureB(),s=m.GetChildIndexA(),l=m.GetChildIndexB(),a=r.m_body,c=o.m_body,m.m_prev=null,m.m_next=this.m_contactList,this.m_contactList!==null&&(this.m_contactList.m_prev=m),this.m_contactList=m,m.m_nodeA.other=c,m.m_nodeA.prev=null,m.m_nodeA.next=a.m_contactList,a.m_contactList!==null&&(a.m_contactList.prev=m.m_nodeA),a.m_contactList=m.m_nodeA,m.m_nodeB.other=a,m.m_nodeB.prev=null,m.m_nodeB.next=c.m_contactList,c.m_contactList!==null&&(c.m_contactList.prev=m.m_nodeB),c.m_contactList=m.m_nodeB,++this.m_contactCount)}}FindNewContacts(){this.m_broadPhase.UpdatePairs(this.AddPair)}Destroy(t){let e=t.GetFixtureA(),r=t.GetFixtureB(),o=e.GetBody(),s=r.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===s.m_contactList&&(s.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!r.IsSensor()&&(e.GetBody().SetAwake(!0),r.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){let e=t.GetFixtureA(),r=t.GetFixtureB(),o=t.GetChildIndexA(),s=t.GetChildIndexB(),l=e.GetBody(),a=r.GetBody();if(t.m_filterFlag){if(!a.ShouldCollide(l)||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,r)){let h=t;t=h.m_next,this.Destroy(h);continue}t.m_filterFlag=!1}let c=l.IsAwake()&&l.m_type!==0,u=a.IsAwake()&&a.m_type!==0;if(!c&&!u){t=t.m_next;continue}let m=e.m_proxies[o].treeNode,p=r.m_proxies[s].treeNode;if(!m.aabb.TestOverlap(p.aabb)){let h=t;t=h.m_next,this.Destroy(h);continue}t.Update(this.m_contactListener),t=t.m_next}}};var ir=class{constructor(){this.step=0;this.collide=0;this.solve=0;this.solveInit=0;this.solveVelocity=0;this.solvePosition=0;this.broadphase=0;this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}},He=class i{constructor(){this.dt=0;this.inv_dt=0;this.dtRatio=0;this.config={velocityIterations:0,positionIterations:0};this.warmStarting=!1}static Create(){return new i}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.config={...t.config},this.warmStarting=t.warmStarting,this}},Fn=class{constructor(){this.c=new n;this.a=0}},In=class{constructor(){this.v=new n;this.w=0}},Bc=class{constructor(){this.step=He.Create()}};var Cc=!0;function Rc(i){Cc=i}function kc(){return Cc}var ud=class{constructor(){this.rA=new n;this.rB=new n;this.normalImpulse=0;this.tangentImpulse=0;this.normalMass=0;this.tangentMass=0;this.velocityBias=0}},Ac=class{constructor(){this.points=H(Ot,ud);this.normal=new n;this.tangent=new n;this.normalMass=new It;this.K=new It;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.invIA=0;this.invIB=0;this.friction=0;this.restitution=0;this.threshold=0;this.tangentSpeed=0;this.pointCount=0;this.contactIndex=0}},Tc=class{constructor(){this.localPoints=H(Ot,n);this.localNormal=new n;this.localPoint=new n;this.indexA=0;this.indexB=0;this.invMassA=0;this.invMassB=0;this.localCenterA=new n;this.localCenterB=new n;this.invIA=0;this.invIB=0;this.type=0;this.radiusA=0;this.radiusB=0;this.pointCount=0}},Pc=class{constructor(){this.step=He.Create();this.count=0}},Dc=class i{constructor(){this.normal=new n;this.point=new n;this.separation=0}static{this.Initialize_s_pointA=new n}static{this.Initialize_s_pointB=new n}static{this.Initialize_s_planePoint=new n}static{this.Initialize_s_clipPoint=new n}Initialize(t,e,r,o){let s=i.Initialize_s_pointA,l=i.Initialize_s_pointB,a=i.Initialize_s_planePoint,c=i.Initialize_s_clipPoint;switch(t.type){case 0:T.MultiplyVec2(e,t.localPoint,s),T.MultiplyVec2(r,t.localPoints[0],l),n.Subtract(l,s,this.normal).Normalize(),n.Mid(s,l,this.point),this.separation=n.Dot(n.Subtract(l,s,n.s_t0),this.normal)-t.radiusA-t.radiusB;break;case 1:D.MultiplyVec2(e.q,t.localNormal,this.normal),T.MultiplyVec2(e,t.localPoint,a),T.MultiplyVec2(r,t.localPoints[o],c),this.separation=n.Dot(n.Subtract(c,a,n.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(c);break;case 2:D.MultiplyVec2(r.q,t.localNormal,this.normal),T.MultiplyVec2(r,t.localPoint,a),T.MultiplyVec2(e,t.localPoints[o],c),this.separation=n.Dot(n.Subtract(c,a,n.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(c),this.normal.Negate();break}}},Mc=class i{constructor(){this.m_step=He.Create();this.m_positionConstraints=H(1024,Tc);this.m_velocityConstraints=H(1024,Ac);this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count){let e=Math.max(this.m_positionConstraints.length*2,this.m_count);for(;this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Tc}if(this.m_velocityConstraints.length<this.m_count){let e=Math.max(this.m_velocityConstraints.length*2,this.m_count);for(;this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new Ac}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let e=0;e<this.m_count;++e){let r=this.m_contacts[e],o=r.m_fixtureA,s=r.m_fixtureB,l=o.GetShape(),a=s.GetShape(),c=l.m_radius,u=a.m_radius,m=o.GetBody(),p=s.GetBody(),d=r.GetManifold(),{pointCount:h}=d,f=this.m_velocityConstraints[e];f.friction=r.m_friction,f.restitution=r.m_restitution,f.threshold=r.m_restitutionThreshold,f.tangentSpeed=r.m_tangentSpeed,f.indexA=m.m_islandIndex,f.indexB=p.m_islandIndex,f.invMassA=m.m_invMass,f.invMassB=p.m_invMass,f.invIA=m.m_invI,f.invIB=p.m_invI,f.contactIndex=e,f.pointCount=h,f.K.SetZero(),f.normalMass.SetZero();let b=this.m_positionConstraints[e];b.indexA=m.m_islandIndex,b.indexB=p.m_islandIndex,b.invMassA=m.m_invMass,b.invMassB=p.m_invMass,b.localCenterA.Copy(m.m_sweep.localCenter),b.localCenterB.Copy(p.m_sweep.localCenter),b.invIA=m.m_invI,b.invIB=p.m_invI,b.localNormal.Copy(d.localNormal),b.localPoint.Copy(d.localPoint),b.pointCount=h,b.radiusA=c,b.radiusB=u,b.type=d.type;for(let x=0;x<h;++x){let _=d.points[x],y=f.points[x];this.m_step.warmStarting?(y.normalImpulse=this.m_step.dtRatio*_.normalImpulse,y.tangentImpulse=this.m_step.dtRatio*_.tangentImpulse):(y.normalImpulse=0,y.tangentImpulse=0),y.rA.SetZero(),y.rB.SetZero(),y.normalMass=0,y.tangentMass=0,y.velocityBias=0,b.localPoints[x].Copy(_.localPoint)}}return this}static{this.InitializeVelocityConstraints_s_xfA=new T}static{this.InitializeVelocityConstraints_s_xfB=new T}static{this.InitializeVelocityConstraints_s_worldManifold=new Fi}InitializeVelocityConstraints(){let t=i.InitializeVelocityConstraints_s_xfA,e=i.InitializeVelocityConstraints_s_xfB,r=i.InitializeVelocityConstraints_s_worldManifold,o=1e3;for(let s=0;s<this.m_count;++s){let l=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],{radiusA:c,radiusB:u,localCenterA:m,localCenterB:p}=a,d=this.m_contacts[l.contactIndex].GetManifold(),{indexA:h,indexB:f,tangent:b,pointCount:x}=l,_=l.invMassA,y=l.invMassB,g=l.invIA,S=l.invIB,w=this.m_positions[h].c,B=this.m_positions[h].a,C=this.m_velocities[h].v,A=this.m_velocities[h].w,k=this.m_positions[f].c,M=this.m_positions[f].a,E=this.m_velocities[f].v,L=this.m_velocities[f].w;t.q.Set(B),e.q.Set(M),n.Subtract(w,D.MultiplyVec2(t.q,m,n.s_t0),t.p),n.Subtract(k,D.MultiplyVec2(e.q,p,n.s_t0),e.p),r.Initialize(d,t,c,e,u),l.normal.Copy(r.normal),n.CrossVec2One(l.normal,b);for(let U=0;U<x;++U){let Y=l.points[U];n.Subtract(r.points[U],w,Y.rA),n.Subtract(r.points[U],k,Y.rB);let O=n.Cross(Y.rA,l.normal),K=n.Cross(Y.rB,l.normal),mt=_+y+g*O*O+S*K*K;Y.normalMass=mt>0?1/mt:0;let at=n.Cross(Y.rA,b),At=n.Cross(Y.rB,b),Gt=_+y+g*at*at+S*At*At;Y.tangentMass=Gt>0?1/Gt:0,Y.velocityBias=0;let wt=n.Dot(l.normal,n.Subtract(n.AddCrossScalarVec2(E,L,Y.rB,n.s_t0),n.AddCrossScalarVec2(C,A,Y.rA,n.s_t1),n.s_t0));wt<-l.threshold&&(Y.velocityBias=-l.restitution*wt)}if(l.pointCount===2&&Cc){let U=l.points[0],Y=l.points[1],O=n.Cross(U.rA,l.normal),K=n.Cross(U.rB,l.normal),mt=n.Cross(Y.rA,l.normal),at=n.Cross(Y.rB,l.normal),At=_+y+g*O*O+S*K*K,Gt=_+y+g*mt*mt+S*at*at,wt=_+y+g*O*mt+S*K*at;At*At<o*(At*Gt-wt*wt)?(l.K.ex.Set(At,wt),l.K.ey.Set(wt,Gt),l.K.GetInverse(l.normalMass)):l.pointCount=1}}}static{this.WarmStart_s_P=new n}WarmStart(){let t=i.WarmStart_s_P;for(let e=0;e<this.m_count;++e){let r=this.m_velocityConstraints[e],{indexA:o,indexB:s,pointCount:l,normal:a,tangent:c}=r,u=r.invMassA,m=r.invIA,p=r.invMassB,d=r.invIB,h=this.m_velocities[o].v,f=this.m_velocities[o].w,b=this.m_velocities[s].v,x=this.m_velocities[s].w;for(let _=0;_<l;++_){let y=r.points[_];n.Add(n.Scale(y.normalImpulse,a,n.s_t0),n.Scale(y.tangentImpulse,c,n.s_t1),t),f-=m*n.Cross(y.rA,t),h.SubtractScaled(u,t),x+=d*n.Cross(y.rB,t),b.AddScaled(p,t)}this.m_velocities[o].w=f,this.m_velocities[s].w=x}}static{this.SolveVelocityConstraints_s_dv=new n}static{this.SolveVelocityConstraints_s_dv1=new n}static{this.SolveVelocityConstraints_s_dv2=new n}static{this.SolveVelocityConstraints_s_P=new n}static{this.SolveVelocityConstraints_s_a=new n}static{this.SolveVelocityConstraints_s_b=new n}static{this.SolveVelocityConstraints_s_x=new n}static{this.SolveVelocityConstraints_s_d=new n}static{this.SolveVelocityConstraints_s_P1=new n}static{this.SolveVelocityConstraints_s_P2=new n}static{this.SolveVelocityConstraints_s_P1P2=new n}SolveVelocityConstraints(){let t=i.SolveVelocityConstraints_s_dv,e=i.SolveVelocityConstraints_s_dv1,r=i.SolveVelocityConstraints_s_dv2,o=i.SolveVelocityConstraints_s_P,s=i.SolveVelocityConstraints_s_a,l=i.SolveVelocityConstraints_s_b,a=i.SolveVelocityConstraints_s_x,c=i.SolveVelocityConstraints_s_d,u=i.SolveVelocityConstraints_s_P1,m=i.SolveVelocityConstraints_s_P2,p=i.SolveVelocityConstraints_s_P1P2;for(let d=0;d<this.m_count;++d){let h=this.m_velocityConstraints[d],{indexA:f,indexB:b,pointCount:x,normal:_,tangent:y,friction:g}=h,S=h.invMassA,w=h.invIA,B=h.invMassB,C=h.invIB,A=this.m_velocities[f].v,k=this.m_velocities[f].w,M=this.m_velocities[b].v,E=this.m_velocities[b].w;for(let L=0;L<x;++L){let U=h.points[L];n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),t);let Y=n.Dot(t,y)-h.tangentSpeed,O=U.tangentMass*-Y,K=g*U.normalImpulse,mt=et(U.tangentImpulse+O,-K,K);O=mt-U.tangentImpulse,U.tangentImpulse=mt,n.Scale(O,y,o),A.SubtractScaled(S,o),k-=w*n.Cross(U.rA,o),M.AddScaled(B,o),E+=C*n.Cross(U.rB,o)}if(h.pointCount===1||Cc===!1)for(let L=0;L<x;++L){let U=h.points[L];n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),t);let Y=n.Dot(t,_),O=-U.normalMass*(Y-U.velocityBias),K=Math.max(U.normalImpulse+O,0);O=K-U.normalImpulse,U.normalImpulse=K,n.Scale(O,_,o),A.SubtractScaled(S,o),k-=w*n.Cross(U.rA,o),M.AddScaled(B,o),E+=C*n.Cross(U.rB,o)}else{let L=h.points[0],U=h.points[1];s.Set(L.normalImpulse,U.normalImpulse),n.Subtract(n.AddCrossScalarVec2(M,E,L.rB,n.s_t0),n.AddCrossScalarVec2(A,k,L.rA,n.s_t1),e),n.Subtract(n.AddCrossScalarVec2(M,E,U.rB,n.s_t0),n.AddCrossScalarVec2(A,k,U.rA,n.s_t1),r);let Y=n.Dot(e,_),O=n.Dot(r,_);for(l.x=Y-L.velocityBias,l.y=O-U.velocityBias,l.Subtract(It.MultiplyVec2(h.K,s,n.s_t0));;){if(It.MultiplyVec2(h.normalMass,l,a).Negate(),a.x>=0&&a.y>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=-L.normalMass*l.x,a.y=0,Y=0,O=h.K.ex.y*a.x+l.y,a.x>=0&&O>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=0,a.y=-U.normalMass*l.y,Y=h.K.ey.x*a.y+l.x,O=0,a.y>=0&&Y>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}if(a.x=0,a.y=0,Y=l.x,O=l.y,Y>=0&&O>=0){n.Subtract(a,s,c),n.Scale(c.x,_,u),n.Scale(c.y,_,m),n.Add(u,m,p),A.SubtractScaled(S,p),k-=w*(n.Cross(L.rA,u)+n.Cross(U.rA,m)),M.AddScaled(B,p),E+=C*(n.Cross(L.rB,u)+n.Cross(U.rB,m)),L.normalImpulse=a.x,U.normalImpulse=a.y;break}break}}this.m_velocities[f].w=k,this.m_velocities[b].w=E}}StoreImpulses(){for(let t=0;t<this.m_count;++t){let e=this.m_velocityConstraints[t],r=this.m_contacts[e.contactIndex].GetManifold();for(let o=0;o<e.pointCount;++o)r.points[o].normalImpulse=e.points[o].normalImpulse,r.points[o].tangentImpulse=e.points[o].tangentImpulse}}static{this.SolvePositionConstraints_s_xfA=new T}static{this.SolvePositionConstraints_s_xfB=new T}static{this.SolvePositionConstraints_s_psm=new Dc}static{this.SolvePositionConstraints_s_rA=new n}static{this.SolvePositionConstraints_s_rB=new n}static{this.SolvePositionConstraints_s_P=new n}SolvePositionConstraints(){let t=i.SolvePositionConstraints_s_xfA,e=i.SolvePositionConstraints_s_xfB,r=i.SolvePositionConstraints_s_psm,o=i.SolvePositionConstraints_s_rA,s=i.SolvePositionConstraints_s_rB,l=i.SolvePositionConstraints_s_P,a=0;for(let c=0;c<this.m_count;++c){let u=this.m_positionConstraints[c],{indexA:m,indexB:p,localCenterA:d,localCenterB:h,pointCount:f}=u,b=u.invMassA,x=u.invIA,_=u.invMassB,y=u.invIB,g=this.m_positions[m].c,S=this.m_positions[m].a,w=this.m_positions[p].c,B=this.m_positions[p].a;for(let C=0;C<f;++C){t.q.Set(S),e.q.Set(B),n.Subtract(g,D.MultiplyVec2(t.q,d,n.s_t0),t.p),n.Subtract(w,D.MultiplyVec2(e.q,h,n.s_t0),e.p),r.Initialize(u,t,e,C);let{normal:A,point:k,separation:M}=r;n.Subtract(k,g,o),n.Subtract(k,w,s),a=Math.min(a,M);let E=et(j2*(M+Z),-ts,0),L=n.Cross(o,A),U=n.Cross(s,A),Y=b+_+x*L*L+y*U*U,O=Y>0?-E/Y:0;n.Scale(O,A,l),g.SubtractScaled(b,l),S-=x*n.Cross(o,l),w.AddScaled(_,l),B+=y*n.Cross(s,l)}this.m_positions[m].c.Copy(g),this.m_positions[m].a=S,this.m_positions[p].c.Copy(w),this.m_positions[p].a=B}return a>=-3*Z}static{this.SolveTOIPositionConstraints_s_xfA=new T}static{this.SolveTOIPositionConstraints_s_xfB=new T}static{this.SolveTOIPositionConstraints_s_psm=new Dc}static{this.SolveTOIPositionConstraints_s_rA=new n}static{this.SolveTOIPositionConstraints_s_rB=new n}static{this.SolveTOIPositionConstraints_s_P=new n}SolveTOIPositionConstraints(t,e){let r=i.SolveTOIPositionConstraints_s_xfA,o=i.SolveTOIPositionConstraints_s_xfB,s=i.SolveTOIPositionConstraints_s_psm,l=i.SolveTOIPositionConstraints_s_rA,a=i.SolveTOIPositionConstraints_s_rB,c=i.SolveTOIPositionConstraints_s_P,u=0;for(let m=0;m<this.m_count;++m){let p=this.m_positionConstraints[m],{indexA:d,indexB:h,localCenterA:f,localCenterB:b,pointCount:x}=p,_=0,y=0;(d===t||d===e)&&(_=p.invMassA,y=p.invIA);let g=0,S=0;(h===t||h===e)&&(g=p.invMassB,S=p.invIB);let w=this.m_positions[d].c,B=this.m_positions[d].a,C=this.m_positions[h].c,A=this.m_positions[h].a;for(let k=0;k<x;++k){r.q.Set(B),o.q.Set(A),n.Subtract(w,D.MultiplyVec2(r.q,f,n.s_t0),r.p),n.Subtract(C,D.MultiplyVec2(o.q,b,n.s_t0),o.p),s.Initialize(p,r,o,k);let{normal:M,point:E,separation:L}=s;n.Subtract(E,w,l),n.Subtract(E,C,a),u=Math.min(u,L);let U=et(X2*(L+Z),-ts,0),Y=n.Cross(l,M),O=n.Cross(a,M),K=_+g+y*Y*Y+S*O*O,mt=K>0?-U/K:0;n.Scale(mt,M,c),w.SubtractScaled(_,c),B-=y*n.Cross(l,c),C.AddScaled(g,c),A+=S*n.Cross(a,c)}this.m_positions[d].a=B,this.m_positions[h].a=A}return u>=-1.5*Z}};var Fc=class i{constructor(t,e,r,o){this.m_bodyCount=0;this.m_jointCount=0;this.m_contactCount=0;this.m_bodyCapacity=t,this.m_listener=o,this.m_bodies=new Array(t),this.m_contacts=new Array(e),this.m_joints=new Array(r),this.m_velocities=H(t,In),this.m_positions=H(t,Fn),this.Resize(t)}Resize(t){for(;this.m_bodyCapacity<t;)this.m_velocities[this.m_bodyCapacity]=new In,this.m_positions[this.m_bodyCapacity]=new Fn,this.m_bodyCapacity++}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=t,++this.m_bodyCount}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}static{this.s_timer=new ri}static{this.s_solverData=new Bc}static{this.s_contactSolverDef=new Pc}static{this.s_contactSolver=new Mc}static{this.s_translation=new n}Solve(t,e,r,o){let s=i.s_timer.Reset(),l=e.dt;for(let p=0;p<this.m_bodyCount;++p){let d=this.m_bodies[p];this.m_positions[p].c.Copy(d.m_sweep.c);let{a:h}=d.m_sweep,f=this.m_velocities[p].v.Copy(d.m_linearVelocity),b=d.m_angularVelocity;d.m_sweep.c0.Copy(d.m_sweep.c),d.m_sweep.a0=d.m_sweep.a,d.m_type===2&&(f.x+=l*d.m_invMass*(d.m_gravityScale*d.m_mass*r.x+d.m_force.x),f.y+=l*d.m_invMass*(d.m_gravityScale*d.m_mass*r.y+d.m_force.y),b+=l*d.m_invI*d.m_torque,f.Scale(1/(1+l*d.m_linearDamping)),b*=1/(1+l*d.m_angularDamping)),this.m_positions[p].a=h,this.m_velocities[p].w=b}s.Reset();let a=i.s_solverData;a.step.Copy(e),a.positions=this.m_positions,a.velocities=this.m_velocities;let c=i.s_contactSolverDef;c.step.Copy(e),c.contacts=this.m_contacts,c.count=this.m_contactCount,c.positions=this.m_positions,c.velocities=this.m_velocities;let u=i.s_contactSolver.Initialize(c);u.InitializeVelocityConstraints(),e.warmStarting&&u.WarmStart();for(let p=0;p<this.m_jointCount;++p)this.m_joints[p].InitVelocityConstraints(a);t.solveInit=s.GetMilliseconds(),s.Reset();for(let p=0;p<e.config.velocityIterations;++p){for(let d=0;d<this.m_jointCount;++d)this.m_joints[d].SolveVelocityConstraints(a);u.SolveVelocityConstraints()}u.StoreImpulses(),t.solveVelocity=s.GetMilliseconds();for(let p=0;p<this.m_bodyCount;++p){let{c:d}=this.m_positions[p],{a:h}=this.m_positions[p],{v:f}=this.m_velocities[p],{w:b}=this.m_velocities[p],x=n.Scale(l,f,i.s_translation);if(n.Dot(x,x)>Wp){let y=vn/x.Length();f.Scale(y)}let _=l*b;if(_*_>Kp){let y=Bn/Math.abs(_);b*=y}d.AddScaled(l,f),h+=l*b,this.m_positions[p].a=h,this.m_velocities[p].w=b}s.Reset();let m=!1;for(let p=0;p<e.config.positionIterations;++p){let d=u.SolvePositionConstraints(),h=!0;for(let f=0;f<this.m_jointCount;++f){let b=this.m_joints[f].SolvePositionConstraints(a);h=h&&b}if(d&&h){m=!0;break}}for(let p=0;p<this.m_bodyCount;++p){let d=this.m_bodies[p];d.m_sweep.c.Copy(this.m_positions[p].c),d.m_sweep.a=this.m_positions[p].a,d.m_linearVelocity.Copy(this.m_velocities[p].v),d.m_angularVelocity=this.m_velocities[p].w,d.SynchronizeTransform()}if(t.solvePosition=s.GetMilliseconds(),this.Report(u.m_velocityConstraints),o){let p=tt,d=$p*$p,h=td*td;for(let f=0;f<this.m_bodyCount;++f){let b=this.m_bodies[f];b.GetType()!==0&&(!b.m_autoSleepFlag||b.m_angularVelocity*b.m_angularVelocity>h||n.Dot(b.m_linearVelocity,b.m_linearVelocity)>d?(b.m_sleepTime=0,p=0):(b.m_sleepTime+=l,p=Math.min(p,b.m_sleepTime)))}if(p>=H2&&m)for(let f=0;f<this.m_bodyCount;++f)this.m_bodies[f].SetAwake(!1)}}SolveTOI(t,e,r){for(let a=0;a<this.m_bodyCount;++a){let c=this.m_bodies[a];this.m_positions[a].c.Copy(c.m_sweep.c),this.m_positions[a].a=c.m_sweep.a,this.m_velocities[a].v.Copy(c.m_linearVelocity),this.m_velocities[a].w=c.m_angularVelocity}let o=i.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;let s=i.s_contactSolver.Initialize(o);for(let a=0;a<t.config.positionIterations&&!s.SolveTOIPositionConstraints(e,r);++a);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[r].m_sweep.c0.Copy(this.m_positions[r].c),this.m_bodies[r].m_sweep.a0=this.m_positions[r].a,s.InitializeVelocityConstraints();for(let a=0;a<t.config.velocityIterations;++a)s.SolveVelocityConstraints();let l=t.dt;for(let a=0;a<this.m_bodyCount;++a){let{c}=this.m_positions[a],{a:u}=this.m_positions[a],{v:m}=this.m_velocities[a],{w:p}=this.m_velocities[a],d=n.Scale(l,m,i.s_translation);if(n.Dot(d,d)>Wp){let b=vn/d.Length();m.Scale(b)}let h=l*p;if(h*h>Kp){let b=Bn/Math.abs(h);p*=b}c.AddScaled(l,m),u+=l*p,this.m_positions[a].a=u,this.m_velocities[a].w=p;let f=this.m_bodies[a];f.m_sweep.c.Copy(c),f.m_sweep.a=u,f.m_linearVelocity.Copy(m),f.m_angularVelocity=p,f.SynchronizeTransform()}this.Report(s.m_velocityConstraints)}static{this.s_impulse=new wc}Report(t){for(let e=0;e<this.m_contactCount;++e){let r=this.m_contacts[e],o=t[e],s=i.s_impulse;s.count=o.pointCount;for(let l=0;l<o.pointCount;++l)s.normalImpulses[l]=o.points[l].normalImpulse,s.tangentImpulses[l]=o.points[l].tangentImpulse;this.m_listener.PostSolve(r,s)}}};var Oe=class i{constructor(t){this.m_contactManager=new vc;this.m_bodyList=null;this.m_jointList=null;this.m_bodyCount=0;this.m_jointCount=0;this.m_gravity=new n;this.m_allowSleep=!0;this.m_destructionListener=null;this.m_inv_dt0=0;this.m_newContacts=!1;this.m_locked=!1;this.m_clearForces=!0;this.m_warmStarting=!0;this.m_continuousPhysics=!0;this.m_subStepping=!1;this.m_stepComplete=!0;this.m_profile=new ir;this.m_island=new Fc(2*La,La,0,this.m_contactManager.m_contactListener);this.s_stack=[];this.m_gravity.Copy(t)}static Create(t){return new i(t)}SetDestructionListener(t){this.m_destructionListener=t}GetDestructionListener(){return this.m_destructionListener}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t,this.m_island.m_listener=t}CreateBody(t={}){N(!this.IsLocked());let e=new ho(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){N(!this.IsLocked());let e=t.m_jointList;for(;e;){let l=e;e=e.next,this.m_destructionListener?.SayGoodbyeJoint(l.joint),this.DestroyJoint(l.joint),t.m_jointList=e}t.m_jointList=null;let r=t.m_contactList;for(;r;){let l=r;r=r.next,this.m_contactManager.Destroy(l.contact)}t.m_contactList=null;let o=this.m_contactManager.m_broadPhase,s=t.m_fixtureList;for(;s;){let l=s;s=s.m_next,this.m_destructionListener?.SayGoodbyeFixture(l),l.DestroyProxies(o),t.m_fixtureList=s,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static Joint_Create(t){switch(t.type){case 3:return new Ka(t);case 5:return new nc(t);case 2:return new lc(t);case 1:return new uc(t);case 4:return new cc(t);case 6:return new ic(t);case 7:return new pc(t);case 8:return new mc(t);case 9:return new ec(t);case 10:return new rc(t);case 11:return new tc(t)}throw new Error}CreateJoint(t){N(!this.IsLocked());let e=i.Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;let r=e.m_bodyA,o=e.m_bodyB;if(!t.collideConnected){let s=o.GetContactList();for(;s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next}return e}DestroyJoint(t){N(!this.IsLocked()),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);let e=t.m_bodyA,r=t.m_bodyB,o=t.m_collideConnected;if(e.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!o){let s=r.GetContactList();for(;s;)s.other===e&&s.contact.FlagForFiltering(),s=s.next}}static{this.Step_s_step=He.Create()}static{this.Step_s_stepTimer=new ri}static{this.Step_s_timer=new ri}Step(t,e){let r=i.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;let o=i.Step_s_step;o.dt=t,o.config={...e},t>0?o.inv_dt=1/t:o.inv_dt=0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;{let s=i.Step_s_timer.Reset();this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds()}if(this.m_stepComplete&&o.dt>0){let s=i.Step_s_timer.Reset();this.Solve(o),this.m_profile.solve=s.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){let s=i.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=s.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.GetNext())t.m_force.SetZero(),t.m_torque=0}QueryAABB(t,e){this.m_contactManager.m_broadPhase.Query(t,r=>{let o=ct(r.userData);return e(o.fixture)})}QueryAllAABB(t,e=[]){return this.QueryAABB(t,r=>(e.push(r),!0)),e}QueryPointAABB(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,r=>{let o=ct(r.userData);return e(o.fixture)})}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(t,r=>(e.push(r),!0)),e}static{this.QueryFixtureShape_s_aabb=new lt}QueryFixtureShape(t,e,r,o){let s=i.QueryFixtureShape_s_aabb;t.ComputeAABB(s,r,e),this.m_contactManager.m_broadPhase.Query(s,l=>{let a=ct(l.userData),{fixture:c}=a;return!rs(t,e,c.GetShape(),a.childIndex,r,c.GetBody().GetTransform())||o(c)})}QueryAllFixtureShape(t,e,r,o=[]){return this.QueryFixtureShape(t,e,r,s=>(o.push(s),!0)),o}QueryFixturePoint(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,r=>{let o=ct(r.userData),{fixture:s}=o;return!s.TestPoint(t)||e(s)})}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(t,r=>(e.push(r),!0)),e}static{this.RayCast_s_input=new _i}static{this.RayCast_s_output=new yi}static{this.RayCast_s_point=new n}RayCast(t,e,r){let o=i.RayCast_s_input;o.maxFraction=1,o.p1.Copy(t),o.p2.Copy(e),this.m_contactManager.m_broadPhase.RayCast(o,(s,l)=>{let a=ct(l.userData),{fixture:c}=a,u=a.childIndex,m=i.RayCast_s_output;if(c.RayCast(m,s,u)){let{fraction:d}=m,h=i.RayCast_s_point;return h.Set((1-d)*t.x+d*e.x,(1-d)*t.y+d*e.y),r(c,h,m.normal,d)}return s.maxFraction})}RayCastOne(t,e){let r=null,o=1;return this.RayCast(t,e,(s,l,a,c)=>(c<o&&(o=c,r=s),o)),r}RayCastAll(t,e,r=[]){return this.RayCast(t,e,o=>(r.push(o),1)),r}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t){this.m_gravity.Copy(t)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){N(!this.IsLocked());for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.Subtract(t),e.m_sweep.c0.Subtract(t),e.m_sweep.c.Subtract(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Solve(t){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;let e=this.m_island;e.Resize(this.m_bodyCount),e.Clear();for(let s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(let s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(let s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;let r=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag||!s.IsAwake()||!s.IsEnabled()||s.GetType()===0)continue;e.Clear();let l=0;for(r[l++]=s,s.m_islandFlag=!0;l>0;){let c=r[--l];if(N(c!==null),e.AddBody(c),c.GetType()!==0){c.m_awakeFlag=!0;for(let u=c.m_contactList;u;u=u.next){let{contact:m}=u;if(m.m_islandFlag||!m.IsEnabled()||!m.IsTouching())continue;let p=m.m_fixtureA.m_isSensor,d=m.m_fixtureB.m_isSensor;if(p||d)continue;e.AddContact(m),m.m_islandFlag=!0;let{other:h}=u;h.m_islandFlag||(r[l++]=h,h.m_islandFlag=!0)}for(let u=c.m_jointList;u;u=u.next){if(u.joint.m_islandFlag)continue;let{other:m}=u;m.IsEnabled()&&(e.AddJoint(u.joint),u.joint.m_islandFlag=!0,!m.m_islandFlag&&(r[l++]=m,m.m_islandFlag=!0))}}}let a=new ir;e.Solve(a,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=a.solveInit,this.m_profile.solveVelocity+=a.solveVelocity,this.m_profile.solvePosition+=a.solvePosition;for(let c=0;c<e.m_bodyCount;++c){let u=e.m_bodies[c];u.GetType()===0&&(u.m_islandFlag=!1)}}for(let s=0;s<r.length&&r[s];++s)r[s]=null;let o=new ri;for(let s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag&&s.GetType()!==0&&s.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=o.GetMilliseconds()}static{this.SolveTOI_s_subStep=He.Create()}static{this.SolveTOI_s_backup=new ee}static{this.SolveTOI_s_backup1=new ee}static{this.SolveTOI_s_backup2=new ee}static{this.SolveTOI_s_toi_input=new ns}static{this.SolveTOI_s_toi_output=new ls}SolveTOI(t){let e=this.m_island;if(e.Clear(),this.m_stepComplete){for(let r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(let r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){let r=null,o=1;for(let d=this.m_contactManager.m_contactList;d;d=d.m_next){if(!d.IsEnabled()||d.m_toiCount>z2)continue;let h=1;if(d.m_toiFlag)h=d.m_toi;else{let f=d.GetFixtureA(),b=d.GetFixtureB();if(f.IsSensor()||b.IsSensor())continue;let x=f.GetBody(),_=b.GetBody(),y=x.m_type,g=_.m_type,S=x.IsAwake()&&y!==0,w=_.IsAwake()&&g!==0;if(!S&&!w)continue;let B=x.IsBullet()||y!==2,C=_.IsBullet()||g!==2;if(!B&&!C)continue;let{alpha0:A}=x.m_sweep;x.m_sweep.alpha0<_.m_sweep.alpha0?(A=_.m_sweep.alpha0,x.m_sweep.Advance(A)):_.m_sweep.alpha0<x.m_sweep.alpha0&&(A=x.m_sweep.alpha0,_.m_sweep.Advance(A));let k=d.GetChildIndexA(),M=d.GetChildIndexB(),E=i.SolveTOI_s_toi_input;E.proxyA.SetShape(f.GetShape(),k),E.proxyB.SetShape(b.GetShape(),M),E.sweepA.Copy(x.m_sweep),E.sweepB.Copy(_.m_sweep),E.tMax=1;let L=i.SolveTOI_s_toi_output;Oa(L,E);let U=L.t;L.state===3?h=Math.min(A+(1-A)*U,1):h=1,d.m_toi=h,d.m_toiFlag=!0}h<o&&(r=d,o=h)}if(r===null||1-10*gt<o){this.m_stepComplete=!0;break}let s=r.GetFixtureA(),l=r.GetFixtureB(),a=s.GetBody(),c=l.GetBody(),u=i.SolveTOI_s_backup1.Copy(a.m_sweep),m=i.SolveTOI_s_backup2.Copy(c.m_sweep);if(a.Advance(o),c.Advance(o),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,!r.IsEnabled()||!r.IsTouching()){r.SetEnabled(!1),a.m_sweep.Copy(u),c.m_sweep.Copy(m),a.SynchronizeTransform(),c.SynchronizeTransform();continue}a.SetAwake(!0),c.SetAwake(!0),e.Clear(),e.AddBody(a),e.AddBody(c),e.AddContact(r),a.m_islandFlag=!0,c.m_islandFlag=!0,r.m_islandFlag=!0;for(let d=0;d<2;++d){let h=d===0?a:c;if(h.m_type===2)for(let f=h.m_contactList;f&&!(e.m_bodyCount===e.m_bodyCapacity||e.m_contactCount===La);f=f.next){let{contact:b}=f;if(b.m_islandFlag)continue;let{other:x}=f;if(x.m_type===2&&!h.IsBullet()&&!x.IsBullet())continue;let _=b.m_fixtureA.m_isSensor,y=b.m_fixtureB.m_isSensor;if(_||y)continue;let g=i.SolveTOI_s_backup.Copy(x.m_sweep);if(x.m_islandFlag||x.Advance(o),b.Update(this.m_contactManager.m_contactListener),!b.IsEnabled()){x.m_sweep.Copy(g),x.SynchronizeTransform();continue}if(!b.IsTouching()){x.m_sweep.Copy(g),x.SynchronizeTransform();continue}b.m_islandFlag=!0,e.AddContact(b),!x.m_islandFlag&&(x.m_islandFlag=!0,x.m_type!==0&&x.SetAwake(!0),e.AddBody(x))}}let p=i.SolveTOI_s_subStep;p.dt=(1-o)*t.dt,p.inv_dt=1/p.dt,p.dtRatio=1,p.config={...t.config,positionIterations:20},p.warmStarting=!1,e.SolveTOI(p,a.m_islandIndex,c.m_islandIndex);for(let d=0;d<e.m_bodyCount;++d){let h=e.m_bodies[d];if(h.m_islandFlag=!1,h.m_type===2){h.SynchronizeFixtures();for(let f=h.m_contactList;f;f=f.next)f.contact.m_toiFlag=!1,f.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}};var rr={J1:new n,J2:new n,J3:new n,r:new n,e1:new n,e2:new n,Jd1:new n,Jd2:new n,d:new n,u:new n,dp1:new n,dp2:new n,dp3:new n,d1:new n,d2:new n,dHat:new n};var ds=class{constructor(){this.stretchingModel=0;this.bendingModel=1;this.damping=0;this.stretchStiffness=1;this.stretchHertz=1;this.stretchDamping=0;this.bendStiffness=.5;this.bendHertz=1;this.bendDamping=0;this.isometric=!1;this.fixedEffectiveMass=!1;this.warmStart=!1}Copy(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}},md=class{constructor(){this.i1=0;this.i2=0;this.invMass1=0;this.invMass2=0;this.L=0;this.lambda=0;this.spring=0;this.damper=0}},pd=class{constructor(){this.i1=0;this.i2=0;this.i3=0;this.invMass1=0;this.invMass2=0;this.invMass3=0;this.invEffectiveMass=0;this.lambda=0;this.L1=0;this.L2=0;this.alpha1=0;this.alpha2=0;this.spring=0;this.damper=0}},Ln=class{constructor(t){this.m_position=new n;this.m_count=0;this.m_stretchCount=0;this.m_bendCount=0;this.m_gravity=new n;this.m_tuning=new ds;N(t.vertices.length>=3),this.m_position.Copy(t.position),this.m_count=t.vertices.length,this.m_bindPositions=H(this.m_count,n),this.m_ps=H(this.m_count,n),this.m_p0s=H(this.m_count,n),this.m_vs=H(this.m_count,n),this.m_invMasses=je(this.m_count);for(let u=0;u<this.m_count;++u){this.m_bindPositions[u].Copy(t.vertices[u]),n.Add(t.vertices[u],this.m_position,this.m_ps[u]),n.Add(t.vertices[u],this.m_position,this.m_p0s[u]),this.m_vs[u].SetZero();let m=t.masses[u];m>0?this.m_invMasses[u]=1/m:this.m_invMasses[u]=0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,this.m_stretchConstraints=new Array(this.m_stretchCount);for(let u=0;u<this.m_stretchCount;u++)this.m_stretchConstraints[u]=new md;this.m_bendConstraints=new Array(this.m_bendCount);for(let u=0;u<this.m_bendCount;u++)this.m_bendConstraints[u]=new pd;for(let u=0;u<this.m_stretchCount;++u){let m=this.m_stretchConstraints[u],p=this.m_ps[u],d=this.m_ps[u+1];m.i1=u,m.i2=u+1,m.L=n.Distance(p,d),m.invMass1=this.m_invMasses[u],m.invMass2=this.m_invMasses[u+1],m.lambda=0,m.damper=0,m.spring=0}let{J1:e,J2:r,r:o,e1:s,e2:l,Jd1:a,Jd2:c}=rr;for(let u=0;u<this.m_bendCount;++u){let m=this.m_bendConstraints[u],p=this.m_ps[u],d=this.m_ps[u+1],h=this.m_ps[u+2];m.i1=u,m.i2=u+1,m.i3=u+2,m.invMass1=this.m_invMasses[u],m.invMass2=this.m_invMasses[u+1],m.invMass3=this.m_invMasses[u+2],m.invEffectiveMass=0,m.L1=n.Distance(p,d),m.L2=n.Distance(d,h),m.lambda=0,n.Subtract(d,p,s),n.Subtract(h,d,l);let f=s.LengthSquared(),b=l.LengthSquared();if(f*b===0)continue;n.Skew(s,a).Scale(-1/f),n.Skew(l,c).Scale(1/b),n.Negate(a,e),n.Subtract(a,c,r);let x=c;m.invEffectiveMass=m.invMass1*n.Dot(e,e)+m.invMass2*n.Dot(r,r)+m.invMass3*n.Dot(x,x),n.Subtract(h,p,o);let _=o.LengthSquared();_!==0&&(m.alpha1=n.Dot(l,o)/_,m.alpha2=n.Dot(s,o)/_)}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}SetTuning(t){this.m_tuning.Copy(t);let e=2*Math.PI*this.m_tuning.bendHertz;for(let o=0;o<this.m_bendCount;++o){let s=this.m_bendConstraints[o],l=s.L1*s.L1,a=s.L2*s.L2;if(l*a===0){s.spring=0,s.damper=0;continue}let c=1/s.L1+1/s.L2,u=s.invMass1/l+s.invMass2*c*c+s.invMass3/a;if(u===0){s.spring=0,s.damper=0;continue}let m=1/u;s.spring=m*e*e,s.damper=2*m*this.m_tuning.bendDamping*e}let r=2*Math.PI*this.m_tuning.stretchHertz;for(let o=0;o<this.m_stretchCount;++o){let s=this.m_stretchConstraints[o],l=s.invMass1+s.invMass2;if(l===0)continue;let a=1/l;s.spring=a*r*r,s.damper=2*a*this.m_tuning.stretchDamping*r}}Step(t,e,r){if(t===0)return;let o=1/t,s=Math.exp(-t*this.m_tuning.damping);for(let l=0;l<this.m_count;++l)this.m_invMasses[l]>0?(this.m_vs[l].Scale(s),this.m_vs[l].AddScaled(t,this.m_gravity)):(this.m_vs[l].x=o*(this.m_bindPositions[l].x+r.x-this.m_p0s[l].x),this.m_vs[l].y=o*(this.m_bindPositions[l].y+r.y-this.m_p0s[l].y));this.m_tuning.bendingModel===0&&this.ApplyBendForces(t);for(let l=0;l<this.m_bendCount;++l)this.m_bendConstraints[l].lambda=0;for(let l=0;l<this.m_stretchCount;++l)this.m_stretchConstraints[l].lambda=0;for(let l=0;l<this.m_count;++l)this.m_ps[l].AddScaled(t,this.m_vs[l]);for(let l=0;l<e;++l)this.m_tuning.bendingModel===1?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===2?this.SolveBend_XPBD_Angle(t):this.m_tuning.bendingModel===3?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===4?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===5&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===0?this.SolveStretch_PBD():this.m_tuning.stretchingModel===1&&this.SolveStretch_XPBD(t);for(let l=0;l<this.m_count;++l)this.m_vs[l].x=o*(this.m_ps[l].x-this.m_p0s[l].x),this.m_vs[l].y=o*(this.m_ps[l].y-this.m_p0s[l].y),this.m_p0s[l].Copy(this.m_ps[l])}Reset(t){this.m_position.Copy(t);for(let e=0;e<this.m_count;++e)n.Add(this.m_bindPositions[e],this.m_position,this.m_ps[e]),this.m_p0s[e].Copy(this.m_ps[e]),this.m_vs[e].SetZero();for(let e=0;e<this.m_bendCount;++e)this.m_bendConstraints[e].lambda=0;for(let e=0;e<this.m_stretchCount;++e)this.m_stretchConstraints[e].lambda=0}SolveStretch_PBD(){let t=this.m_tuning.stretchStiffness,{d:e}=rr;for(let r=0;r<this.m_stretchCount;++r){let o=this.m_stretchConstraints[r],s=this.m_ps[o.i1],l=this.m_ps[o.i2];n.Subtract(l,s,e);let a=e.Normalize(),c=o.invMass1+o.invMass2;if(c===0)continue;let u=o.invMass1/c,m=o.invMass2/c;s.SubtractScaled(t*u*(o.L-a),e),l.AddScaled(t*m*(o.L-a),e)}}SolveStretch_XPBD(t){let{dp1:e,dp2:r,u:o,J1:s}=rr;for(let l=0;l<this.m_stretchCount;++l){let a=this.m_stretchConstraints[l],c=this.m_ps[a.i1],u=this.m_ps[a.i2];n.Subtract(c,this.m_p0s[a.i1],e),n.Subtract(u,this.m_p0s[a.i2],r),n.Subtract(u,c,o);let m=o.Normalize();n.Negate(o,s);let p=o,d=a.invMass1+a.invMass2;if(d===0)continue;let h=1/(a.spring*t*t),f=t*t*a.damper,b=h*f/t,x=m-a.L,_=n.Dot(s,e)+n.Dot(p,r),y=x+h*a.lambda+b*_,g=(1+b)*d+h,S=-y/g;c.AddScaled(a.invMass1*S,s),u.AddScaled(a.invMass2*S,p),a.lambda+=S}}SolveBend_PBD_Angle(){let t=this.m_tuning.bendStiffness,{Jd1:e,Jd2:r,J1:o,J2:s,d1:l,d2:a}=rr;for(let c=0;c<this.m_bendCount;++c){let u=this.m_bendConstraints[c],m=this.m_ps[u.i1],p=this.m_ps[u.i2],d=this.m_ps[u.i3];n.Subtract(p,m,l),n.Subtract(d,p,a);let h=n.Cross(l,a),f=n.Dot(l,a),b=Math.atan2(h,f),x,_;if(this.m_tuning.isometric?(x=u.L1*u.L1,_=u.L2*u.L2):(x=l.LengthSquared(),_=a.LengthSquared()),x*_===0)continue;n.Skew(l,e).Scale(-1/x),n.Skew(a,r).Scale(1/_),n.Negate(e,o),n.Subtract(e,r,s);let y=r,g;this.m_tuning.fixedEffectiveMass?g=u.invEffectiveMass:g=u.invMass1*n.Dot(o,o)+u.invMass2*n.Dot(s,s)+u.invMass3*n.Dot(y,y),g===0&&(g=u.invEffectiveMass);let S=-t*b/g;m.AddScaled(u.invMass1*S,o),p.AddScaled(u.invMass2*S,s),d.AddScaled(u.invMass3*S,y)}}SolveBend_XPBD_Angle(t){let{dp1:e,dp2:r,dp3:o,d1:s,d2:l,Jd1:a,Jd2:c,J1:u,J2:m}=rr;for(let p=0;p<this.m_bendCount;++p){let d=this.m_bendConstraints[p],h=this.m_ps[d.i1],f=this.m_ps[d.i2],b=this.m_ps[d.i3];n.Subtract(h,this.m_p0s[d.i1],e),n.Subtract(f,this.m_p0s[d.i2],r),n.Subtract(b,this.m_p0s[d.i3],o),n.Subtract(f,h,s),n.Subtract(b,f,l);let x,_;if(this.m_tuning.isometric?(x=d.L1*d.L1,_=d.L2*d.L2):(x=s.LengthSquared(),_=l.LengthSquared()),x*_===0)continue;let y=n.Cross(s,l),g=n.Dot(s,l),S=Math.atan2(y,g);n.Skew(s,a).Scale(-1/x),n.Skew(l,c).Scale(1/_),n.Negate(a,u),n.Subtract(a,c,m);let w=c,B;if(this.m_tuning.fixedEffectiveMass?B=d.invEffectiveMass:B=d.invMass1*n.Dot(u,u)+d.invMass2*n.Dot(m,m)+d.invMass3*n.Dot(w,w),B===0)continue;let C=1/(d.spring*t*t),A=t*t*d.damper,k=C*A/t,M=S,E=n.Dot(u,e)+n.Dot(m,r)+n.Dot(w,o),L=M+C*d.lambda+k*E,U=(1+k)*B+C,Y=-L/U;h.AddScaled(d.invMass1*Y,u),f.AddScaled(d.invMass2*Y,m),b.AddScaled(d.invMass3*Y,w),d.lambda+=Y}}SolveBend_PBD_Distance(){let t=this.m_tuning.bendStiffness,{d:e}=rr;for(let r=0;r<this.m_bendCount;++r){let o=this.m_bendConstraints[r],{i1:s}=o,l=o.i3,a=this.m_ps[s],c=this.m_ps[l];n.Subtract(c,a,e);let u=e.Normalize(),m=o.invMass1+o.invMass3;if(m===0)continue;let p=o.invMass1/m,d=o.invMass3/m;a.SubtractScaled(t*p*(o.L1+o.L2-u),e),c.AddScaled(t*d*(o.L1+o.L2-u),e)}}SolveBend_PBD_Height(){let t=this.m_tuning.bendStiffness,{dHat:e,J1:r,J2:o,J3:s,d:l}=rr;for(let a=0;a<this.m_bendCount;++a){let c=this.m_bendConstraints[a],u=this.m_ps[c.i1],m=this.m_ps[c.i2],p=this.m_ps[c.i3];l.x=c.alpha1*u.x+c.alpha2*p.x-m.x,l.y=c.alpha1*u.y+c.alpha2*p.y-m.y;let d=l.Length();if(d===0)continue;n.Scale(1/d,l,e),n.Scale(c.alpha1,e,r),n.Negate(e,o),n.Scale(c.alpha2,e,s);let h=c.invMass1*c.alpha1*c.alpha1+c.invMass2+c.invMass3*c.alpha2*c.alpha2;if(h===0)continue;let f=d,b=1/h,x=-t*b*f;u.AddScaled(c.invMass1*x,r),m.AddScaled(c.invMass2*x,o),p.AddScaled(c.invMass3*x,s)}}SolveBend_PBD_Triangle(){let t=this.m_tuning.bendStiffness,{d:e}=rr;for(let r=0;r<this.m_bendCount;++r){let o=this.m_bendConstraints[r],s=this.m_ps[o.i1],l=this.m_ps[o.i2],a=this.m_ps[o.i3],c=o.invMass1,u=o.invMass2,m=o.invMass3,p=c+m+2*u,d=t/p;e.x=l.x-1/3*(s.x+l.x+a.x),e.y=l.y-1/3*(s.y+l.y+a.y),s.AddScaled(2*c*d,e),l.AddScaled(-4*u*d,e),a.AddScaled(2*m*d,e)}}ApplyBendForces(t){let e=2*Math.PI*this.m_tuning.bendHertz,{d1:r,d2:o,Jd1:s,Jd2:l,J1:a,J2:c}=rr;for(let u=0;u<this.m_bendCount;++u){let m=this.m_bendConstraints[u],p=this.m_ps[m.i1],d=this.m_ps[m.i2],h=this.m_ps[m.i3],f=this.m_vs[m.i1],b=this.m_vs[m.i2],x=this.m_vs[m.i3];n.Subtract(d,p,r),n.Subtract(h,d,o);let _,y;if(this.m_tuning.isometric?(_=m.L1*m.L1,y=m.L2*m.L2):(_=r.LengthSquared(),y=o.LengthSquared()),_*y===0)continue;let g=n.Cross(r,o),S=n.Dot(r,o),w=Math.atan2(g,S);n.Skew(r,s).Scale(-1/_),n.Skew(o,l).Scale(1/y),n.Negate(s,a),n.Subtract(s,l,c);let B=l,C;if(this.m_tuning.fixedEffectiveMass?C=m.invEffectiveMass:C=m.invMass1*n.Dot(a,a)+m.invMass2*n.Dot(c,c)+m.invMass3*n.Dot(B,B),C===0)continue;let A=1/C,k=A*e*e,M=2*A*this.m_tuning.bendDamping*e,E=w,L=n.Dot(a,f)+n.Dot(c,b)+n.Dot(B,x),U=-t*(k*E+M*L);this.m_vs[m.i1].AddScaled(m.invMass1*U,a),this.m_vs[m.i2].AddScaled(m.invMass2*U,c),this.m_vs[m.i3].AddScaled(m.invMass3*U,B)}}Draw(t){for(let r=0;r<this.m_count-1;++r){t.DrawSegment(this.m_ps[r],this.m_ps[r+1],Q.rope);let o=this.m_invMasses[r]>0?Q.ropePointD:Q.ropePointG;t.DrawPoint(this.m_ps[r],5,o)}let e=this.m_invMasses[this.m_count-1]>0?Q.ropePointD:Q.ropePointG;t.DrawPoint(this.m_ps[this.m_count-1],5,e)}};var _1=new F(.5,.9,.5),Gn=class i{ctx;center=new n;zoom=1;constructor(t){this.ctx=t}Prepare(t,e,r,o=!1){this.center.Set(t,e),this.zoom=r,this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.ctx.translate(.5*this.ctx.canvas.width,.5*this.ctx.canvas.height),o&&this.ctx.scale(1,-1),this.ctx.scale(r,r),this.ctx.lineWidth/=r,this.ctx.translate(-t,-e)}Finish(){this.ctx.restore()}PushTransform(t){this.ctx.save(),this.ctx.translate(t.p.x,t.p.y),this.ctx.rotate(t.q.GetAngle())}PopTransform(t){this.ctx.restore()}DrawPolygon(t,e,r){if(!(e<2)){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let o=1;o<e;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}}DrawSolidPolygon(t,e,r){if(!(e<2)){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let o=1;o<e;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.fillStyle=i.MakeStyleString(r,.5),this.ctx.fill(),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}}DrawCircle(t,e,r){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2,!0),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}DrawSolidCircle(t,e,r,o){let s=t.x,l=t.y;this.ctx.beginPath(),this.ctx.arc(s,l,e,0,Math.PI*2,!0),this.ctx.moveTo(s,l),this.ctx.lineTo(s+r.x*e,l+r.y*e),this.ctx.fillStyle=i.MakeStyleString(o,.5),this.ctx.fill(),this.ctx.strokeStyle=i.MakeStyleString(o,1),this.ctx.stroke()}DrawParticles(t,e,r,o){if(r)for(let s=0;s<o;++s){let l=t[s],a=r[s];this.ctx.fillStyle=i.MakeStyleString(a),this.ctx.beginPath(),this.ctx.arc(l.x,l.y,e,0,Math.PI*2,!0),this.ctx.fill()}else{this.ctx.fillStyle="rgba(255,255,255,0.5)";for(let s=0;s<o;++s){let l=t[s];this.ctx.beginPath(),this.ctx.arc(l.x,l.y,e,0,Math.PI*2,!0),this.ctx.fill()}}}DrawSegment(t,e,r){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.strokeStyle=i.MakeStyleString(r,1),this.ctx.stroke()}DrawTransform(t){this.PushTransform(t),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(1,0),this.ctx.strokeStyle=i.MakeStyleString(F.RED),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(0,1),this.ctx.strokeStyle=i.MakeStyleString(F.GREEN),this.ctx.stroke(),this.PopTransform(t)}DrawPoint(t,e,r){this.ctx.fillStyle=i.MakeStyleString(r),e/=this.zoom;let o=e/2;this.ctx.fillRect(t.x-o,t.y-o,e,e)}DrawString(t,e,r,o){this.ctx.font="16px Open Sans",this.ctx.textAlign=r,this.ctx.fillStyle=i.MakeStyleString(F.WHITE),this.ctx.fillText(o,t,e)}DrawStringWorld(t,e,r){let o=(t-this.center.x)*this.zoom+.5*this.ctx.canvas.width,s=(e-this.center.y)*-this.zoom+.5*this.ctx.canvas.height;this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.font="15px Open Sans",this.ctx.fillStyle=i.MakeStyleString(_1),this.ctx.fillText(r,o,s),this.ctx.restore()}DrawAABB(t,e){this.ctx.strokeStyle=i.MakeStyleString(e);let{x:r,y:o}=t.lowerBound,s=t.upperBound.x-r,l=t.upperBound.y-o;this.ctx.strokeRect(r,o,s,l)}static MakeStyleString(t,e=t.a){let r=et(t.r*255,0,255),o=et(t.g*255,0,255),s=et(t.b*255,0,255);return e<1?(e=et(e,0,1),`rgba(${r},${o},${s},${e})`):`rgb(${r},${o},${s})`}};var vu=$(ye()),Fx=$(T0());var St=1e-6,oi=typeof Float32Array<"u"?Float32Array:Array,wd=Math.random;var pF=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Si={};Zf(Si,{add:()=>fB,adjoint:()=>U1,clone:()=>F1,copy:()=>I1,create:()=>k1,determinant:()=>Y1,equals:()=>xB,exactEquals:()=>yB,frob:()=>hB,fromQuat:()=>oB,fromQuat2:()=>$1,fromRotation:()=>Q1,fromRotationTranslation:()=>R0,fromRotationTranslationScale:()=>iB,fromRotationTranslationScaleOrigin:()=>rB,fromScaling:()=>Z1,fromTranslation:()=>N1,fromValues:()=>L1,fromXRotation:()=>q1,fromYRotation:()=>W1,fromZRotation:()=>K1,frustum:()=>sB,getRotation:()=>eB,getScaling:()=>k0,getTranslation:()=>tB,identity:()=>D0,invert:()=>E1,lookAt:()=>mB,mul:()=>gB,multiply:()=>M0,multiplyScalar:()=>bB,multiplyScalarAndAdd:()=>_B,ortho:()=>cB,orthoNO:()=>I0,orthoZO:()=>uB,perspective:()=>nB,perspectiveFromFieldOfView:()=>aB,perspectiveNO:()=>F0,perspectiveZO:()=>lB,rotate:()=>j1,rotateX:()=>X1,rotateY:()=>H1,rotateZ:()=>O1,scale:()=>z1,set:()=>G1,str:()=>dB,sub:()=>SB,subtract:()=>L0,targetTo:()=>pB,translate:()=>J1,transpose:()=>V1});function k1(){var i=new oi(16);return oi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function F1(i){var t=new oi(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function I1(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function L1(i,t,e,r,o,s,l,a,c,u,m,p,d,h,f,b){var x=new oi(16);return x[0]=i,x[1]=t,x[2]=e,x[3]=r,x[4]=o,x[5]=s,x[6]=l,x[7]=a,x[8]=c,x[9]=u,x[10]=m,x[11]=p,x[12]=d,x[13]=h,x[14]=f,x[15]=b,x}function G1(i,t,e,r,o,s,l,a,c,u,m,p,d,h,f,b,x){return i[0]=t,i[1]=e,i[2]=r,i[3]=o,i[4]=s,i[5]=l,i[6]=a,i[7]=c,i[8]=u,i[9]=m,i[10]=p,i[11]=d,i[12]=h,i[13]=f,i[14]=b,i[15]=x,i}function D0(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function V1(i,t){if(i===t){var e=t[1],r=t[2],o=t[3],s=t[6],l=t[7],a=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=r,i[9]=s,i[11]=t[14],i[12]=o,i[13]=l,i[14]=a}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function E1(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],a=t[5],c=t[6],u=t[7],m=t[8],p=t[9],d=t[10],h=t[11],f=t[12],b=t[13],x=t[14],_=t[15],y=e*a-r*l,g=e*c-o*l,S=e*u-s*l,w=r*c-o*a,B=r*u-s*a,C=o*u-s*c,A=m*b-p*f,k=m*x-d*f,M=m*_-h*f,E=p*x-d*b,L=p*_-h*b,U=d*_-h*x,Y=y*U-g*L+S*E+w*M-B*k+C*A;return Y?(Y=1/Y,i[0]=(a*U-c*L+u*E)*Y,i[1]=(o*L-r*U-s*E)*Y,i[2]=(b*C-x*B+_*w)*Y,i[3]=(d*B-p*C-h*w)*Y,i[4]=(c*M-l*U-u*k)*Y,i[5]=(e*U-o*M+s*k)*Y,i[6]=(x*S-f*C-_*g)*Y,i[7]=(m*C-d*S+h*g)*Y,i[8]=(l*L-a*M+u*A)*Y,i[9]=(r*M-e*L-s*A)*Y,i[10]=(f*B-b*S+_*y)*Y,i[11]=(p*S-m*B-h*y)*Y,i[12]=(a*k-l*E-c*A)*Y,i[13]=(e*E-r*k+o*A)*Y,i[14]=(b*g-f*w-x*y)*Y,i[15]=(m*w-p*g+d*y)*Y,i):null}function U1(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=t[4],a=t[5],c=t[6],u=t[7],m=t[8],p=t[9],d=t[10],h=t[11],f=t[12],b=t[13],x=t[14],_=t[15];return i[0]=a*(d*_-h*x)-p*(c*_-u*x)+b*(c*h-u*d),i[1]=-(r*(d*_-h*x)-p*(o*_-s*x)+b*(o*h-s*d)),i[2]=r*(c*_-u*x)-a*(o*_-s*x)+b*(o*u-s*c),i[3]=-(r*(c*h-u*d)-a*(o*h-s*d)+p*(o*u-s*c)),i[4]=-(l*(d*_-h*x)-m*(c*_-u*x)+f*(c*h-u*d)),i[5]=e*(d*_-h*x)-m*(o*_-s*x)+f*(o*h-s*d),i[6]=-(e*(c*_-u*x)-l*(o*_-s*x)+f*(o*u-s*c)),i[7]=e*(c*h-u*d)-l*(o*h-s*d)+m*(o*u-s*c),i[8]=l*(p*_-h*b)-m*(a*_-u*b)+f*(a*h-u*p),i[9]=-(e*(p*_-h*b)-m*(r*_-s*b)+f*(r*h-s*p)),i[10]=e*(a*_-u*b)-l*(r*_-s*b)+f*(r*u-s*a),i[11]=-(e*(a*h-u*p)-l*(r*h-s*p)+m*(r*u-s*a)),i[12]=-(l*(p*x-d*b)-m*(a*x-c*b)+f*(a*d-c*p)),i[13]=e*(p*x-d*b)-m*(r*x-o*b)+f*(r*d-o*p),i[14]=-(e*(a*x-c*b)-l*(r*x-o*b)+f*(r*c-o*a)),i[15]=e*(a*d-c*p)-l*(r*d-o*p)+m*(r*c-o*a),i}function Y1(i){var t=i[0],e=i[1],r=i[2],o=i[3],s=i[4],l=i[5],a=i[6],c=i[7],u=i[8],m=i[9],p=i[10],d=i[11],h=i[12],f=i[13],b=i[14],x=i[15],_=t*l-e*s,y=t*a-r*s,g=t*c-o*s,S=e*a-r*l,w=e*c-o*l,B=r*c-o*a,C=u*f-m*h,A=u*b-p*h,k=u*x-d*h,M=m*b-p*f,E=m*x-d*f,L=p*x-d*b;return _*L-y*E+g*M+S*k-w*A+B*C}function M0(i,t,e){var r=t[0],o=t[1],s=t[2],l=t[3],a=t[4],c=t[5],u=t[6],m=t[7],p=t[8],d=t[9],h=t[10],f=t[11],b=t[12],x=t[13],_=t[14],y=t[15],g=e[0],S=e[1],w=e[2],B=e[3];return i[0]=g*r+S*a+w*p+B*b,i[1]=g*o+S*c+w*d+B*x,i[2]=g*s+S*u+w*h+B*_,i[3]=g*l+S*m+w*f+B*y,g=e[4],S=e[5],w=e[6],B=e[7],i[4]=g*r+S*a+w*p+B*b,i[5]=g*o+S*c+w*d+B*x,i[6]=g*s+S*u+w*h+B*_,i[7]=g*l+S*m+w*f+B*y,g=e[8],S=e[9],w=e[10],B=e[11],i[8]=g*r+S*a+w*p+B*b,i[9]=g*o+S*c+w*d+B*x,i[10]=g*s+S*u+w*h+B*_,i[11]=g*l+S*m+w*f+B*y,g=e[12],S=e[13],w=e[14],B=e[15],i[12]=g*r+S*a+w*p+B*b,i[13]=g*o+S*c+w*d+B*x,i[14]=g*s+S*u+w*h+B*_,i[15]=g*l+S*m+w*f+B*y,i}function J1(i,t,e){var r=e[0],o=e[1],s=e[2],l,a,c,u,m,p,d,h,f,b,x,_;return t===i?(i[12]=t[0]*r+t[4]*o+t[8]*s+t[12],i[13]=t[1]*r+t[5]*o+t[9]*s+t[13],i[14]=t[2]*r+t[6]*o+t[10]*s+t[14],i[15]=t[3]*r+t[7]*o+t[11]*s+t[15]):(l=t[0],a=t[1],c=t[2],u=t[3],m=t[4],p=t[5],d=t[6],h=t[7],f=t[8],b=t[9],x=t[10],_=t[11],i[0]=l,i[1]=a,i[2]=c,i[3]=u,i[4]=m,i[5]=p,i[6]=d,i[7]=h,i[8]=f,i[9]=b,i[10]=x,i[11]=_,i[12]=l*r+m*o+f*s+t[12],i[13]=a*r+p*o+b*s+t[13],i[14]=c*r+d*o+x*s+t[14],i[15]=u*r+h*o+_*s+t[15]),i}function z1(i,t,e){var r=e[0],o=e[1],s=e[2];return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*o,i[5]=t[5]*o,i[6]=t[6]*o,i[7]=t[7]*o,i[8]=t[8]*s,i[9]=t[9]*s,i[10]=t[10]*s,i[11]=t[11]*s,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function j1(i,t,e,r){var o=r[0],s=r[1],l=r[2],a=Math.hypot(o,s,l),c,u,m,p,d,h,f,b,x,_,y,g,S,w,B,C,A,k,M,E,L,U,Y,O;return a<St?null:(a=1/a,o*=a,s*=a,l*=a,c=Math.sin(e),u=Math.cos(e),m=1-u,p=t[0],d=t[1],h=t[2],f=t[3],b=t[4],x=t[5],_=t[6],y=t[7],g=t[8],S=t[9],w=t[10],B=t[11],C=o*o*m+u,A=s*o*m+l*c,k=l*o*m-s*c,M=o*s*m-l*c,E=s*s*m+u,L=l*s*m+o*c,U=o*l*m+s*c,Y=s*l*m-o*c,O=l*l*m+u,i[0]=p*C+b*A+g*k,i[1]=d*C+x*A+S*k,i[2]=h*C+_*A+w*k,i[3]=f*C+y*A+B*k,i[4]=p*M+b*E+g*L,i[5]=d*M+x*E+S*L,i[6]=h*M+_*E+w*L,i[7]=f*M+y*E+B*L,i[8]=p*U+b*Y+g*O,i[9]=d*U+x*Y+S*O,i[10]=h*U+_*Y+w*O,i[11]=f*U+y*Y+B*O,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function X1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[4],l=t[5],a=t[6],c=t[7],u=t[8],m=t[9],p=t[10],d=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=s*o+u*r,i[5]=l*o+m*r,i[6]=a*o+p*r,i[7]=c*o+d*r,i[8]=u*o-s*r,i[9]=m*o-l*r,i[10]=p*o-a*r,i[11]=d*o-c*r,i}function H1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[0],l=t[1],a=t[2],c=t[3],u=t[8],m=t[9],p=t[10],d=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*o-u*r,i[1]=l*o-m*r,i[2]=a*o-p*r,i[3]=c*o-d*r,i[8]=s*r+u*o,i[9]=l*r+m*o,i[10]=a*r+p*o,i[11]=c*r+d*o,i}function O1(i,t,e){var r=Math.sin(e),o=Math.cos(e),s=t[0],l=t[1],a=t[2],c=t[3],u=t[4],m=t[5],p=t[6],d=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=s*o+u*r,i[1]=l*o+m*r,i[2]=a*o+p*r,i[3]=c*o+d*r,i[4]=u*o-s*r,i[5]=m*o-l*r,i[6]=p*o-a*r,i[7]=d*o-c*r,i}function N1(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function Z1(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Q1(i,t,e){var r=e[0],o=e[1],s=e[2],l=Math.hypot(r,o,s),a,c,u;return l<St?null:(l=1/l,r*=l,o*=l,s*=l,a=Math.sin(t),c=Math.cos(t),u=1-c,i[0]=r*r*u+c,i[1]=o*r*u+s*a,i[2]=s*r*u-o*a,i[3]=0,i[4]=r*o*u-s*a,i[5]=o*o*u+c,i[6]=s*o*u+r*a,i[7]=0,i[8]=r*s*u+o*a,i[9]=o*s*u-r*a,i[10]=s*s*u+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function q1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function W1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=r,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function K1(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=r,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function R0(i,t,e){var r=t[0],o=t[1],s=t[2],l=t[3],a=r+r,c=o+o,u=s+s,m=r*a,p=r*c,d=r*u,h=o*c,f=o*u,b=s*u,x=l*a,_=l*c,y=l*u;return i[0]=1-(h+b),i[1]=p+y,i[2]=d-_,i[3]=0,i[4]=p-y,i[5]=1-(m+b),i[6]=f+x,i[7]=0,i[8]=d+_,i[9]=f-x,i[10]=1-(m+h),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function $1(i,t){var e=new oi(3),r=-t[0],o=-t[1],s=-t[2],l=t[3],a=t[4],c=t[5],u=t[6],m=t[7],p=r*r+o*o+s*s+l*l;return p>0?(e[0]=(a*l+m*r+c*s-u*o)*2/p,e[1]=(c*l+m*o+u*r-a*s)*2/p,e[2]=(u*l+m*s+a*o-c*r)*2/p):(e[0]=(a*l+m*r+c*s-u*o)*2,e[1]=(c*l+m*o+u*r-a*s)*2,e[2]=(u*l+m*s+a*o-c*r)*2),R0(i,t,e),i}function tB(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i}function k0(i,t){var e=t[0],r=t[1],o=t[2],s=t[4],l=t[5],a=t[6],c=t[8],u=t[9],m=t[10];return i[0]=Math.hypot(e,r,o),i[1]=Math.hypot(s,l,a),i[2]=Math.hypot(c,u,m),i}function eB(i,t){var e=new oi(3);k0(e,t);var r=1/e[0],o=1/e[1],s=1/e[2],l=t[0]*r,a=t[1]*o,c=t[2]*s,u=t[4]*r,m=t[5]*o,p=t[6]*s,d=t[8]*r,h=t[9]*o,f=t[10]*s,b=l+m+f,x=0;return b>0?(x=Math.sqrt(b+1)*2,i[3]=.25*x,i[0]=(p-h)/x,i[1]=(d-c)/x,i[2]=(a-u)/x):l>m&&l>f?(x=Math.sqrt(1+l-m-f)*2,i[3]=(p-h)/x,i[0]=.25*x,i[1]=(a+u)/x,i[2]=(d+c)/x):m>f?(x=Math.sqrt(1+m-l-f)*2,i[3]=(d-c)/x,i[0]=(a+u)/x,i[1]=.25*x,i[2]=(p+h)/x):(x=Math.sqrt(1+f-l-m)*2,i[3]=(a-u)/x,i[0]=(d+c)/x,i[1]=(p+h)/x,i[2]=.25*x),i}function iB(i,t,e,r){var o=t[0],s=t[1],l=t[2],a=t[3],c=o+o,u=s+s,m=l+l,p=o*c,d=o*u,h=o*m,f=s*u,b=s*m,x=l*m,_=a*c,y=a*u,g=a*m,S=r[0],w=r[1],B=r[2];return i[0]=(1-(f+x))*S,i[1]=(d+g)*S,i[2]=(h-y)*S,i[3]=0,i[4]=(d-g)*w,i[5]=(1-(p+x))*w,i[6]=(b+_)*w,i[7]=0,i[8]=(h+y)*B,i[9]=(b-_)*B,i[10]=(1-(p+f))*B,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function rB(i,t,e,r,o){var s=t[0],l=t[1],a=t[2],c=t[3],u=s+s,m=l+l,p=a+a,d=s*u,h=s*m,f=s*p,b=l*m,x=l*p,_=a*p,y=c*u,g=c*m,S=c*p,w=r[0],B=r[1],C=r[2],A=o[0],k=o[1],M=o[2],E=(1-(b+_))*w,L=(h+S)*w,U=(f-g)*w,Y=(h-S)*B,O=(1-(d+_))*B,K=(x+y)*B,mt=(f+g)*C,at=(x-y)*C,At=(1-(d+b))*C;return i[0]=E,i[1]=L,i[2]=U,i[3]=0,i[4]=Y,i[5]=O,i[6]=K,i[7]=0,i[8]=mt,i[9]=at,i[10]=At,i[11]=0,i[12]=e[0]+A-(E*A+Y*k+mt*M),i[13]=e[1]+k-(L*A+O*k+at*M),i[14]=e[2]+M-(U*A+K*k+At*M),i[15]=1,i}function oB(i,t){var e=t[0],r=t[1],o=t[2],s=t[3],l=e+e,a=r+r,c=o+o,u=e*l,m=r*l,p=r*a,d=o*l,h=o*a,f=o*c,b=s*l,x=s*a,_=s*c;return i[0]=1-p-f,i[1]=m+_,i[2]=d-x,i[3]=0,i[4]=m-_,i[5]=1-u-f,i[6]=h+b,i[7]=0,i[8]=d+x,i[9]=h-b,i[10]=1-u-p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function sB(i,t,e,r,o,s,l){var a=1/(e-t),c=1/(o-r),u=1/(s-l);return i[0]=s*2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s*2*c,i[6]=0,i[7]=0,i[8]=(e+t)*a,i[9]=(o+r)*c,i[10]=(l+s)*u,i[11]=-1,i[12]=0,i[13]=0,i[14]=l*s*2*u,i[15]=0,i}function F0(i,t,e,r,o){var s=1/Math.tan(t/2),l;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(l=1/(r-o),i[10]=(o+r)*l,i[14]=2*o*r*l):(i[10]=-1,i[14]=-2*r),i}var nB=F0;function lB(i,t,e,r,o){var s=1/Math.tan(t/2),l;return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(l=1/(r-o),i[10]=o*l,i[14]=o*r*l):(i[10]=-1,i[14]=-r),i}function aB(i,t,e,r){var o=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),l=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(l+a),u=2/(o+s);return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=-((l-a)*c*.5),i[9]=(o-s)*u*.5,i[10]=r/(e-r),i[11]=-1,i[12]=0,i[13]=0,i[14]=r*e/(e-r),i[15]=0,i}function I0(i,t,e,r,o,s,l){var a=1/(t-e),c=1/(r-o),u=1/(s-l);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*u,i[11]=0,i[12]=(t+e)*a,i[13]=(o+r)*c,i[14]=(l+s)*u,i[15]=1,i}var cB=I0;function uB(i,t,e,r,o,s,l){var a=1/(t-e),c=1/(r-o),u=1/(s-l);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=u,i[11]=0,i[12]=(t+e)*a,i[13]=(o+r)*c,i[14]=s*u,i[15]=1,i}function mB(i,t,e,r){var o,s,l,a,c,u,m,p,d,h,f=t[0],b=t[1],x=t[2],_=r[0],y=r[1],g=r[2],S=e[0],w=e[1],B=e[2];return Math.abs(f-S)<St&&Math.abs(b-w)<St&&Math.abs(x-B)<St?D0(i):(m=f-S,p=b-w,d=x-B,h=1/Math.hypot(m,p,d),m*=h,p*=h,d*=h,o=y*d-g*p,s=g*m-_*d,l=_*p-y*m,h=Math.hypot(o,s,l),h?(h=1/h,o*=h,s*=h,l*=h):(o=0,s=0,l=0),a=p*l-d*s,c=d*o-m*l,u=m*s-p*o,h=Math.hypot(a,c,u),h?(h=1/h,a*=h,c*=h,u*=h):(a=0,c=0,u=0),i[0]=o,i[1]=a,i[2]=m,i[3]=0,i[4]=s,i[5]=c,i[6]=p,i[7]=0,i[8]=l,i[9]=u,i[10]=d,i[11]=0,i[12]=-(o*f+s*b+l*x),i[13]=-(a*f+c*b+u*x),i[14]=-(m*f+p*b+d*x),i[15]=1,i)}function pB(i,t,e,r){var o=t[0],s=t[1],l=t[2],a=r[0],c=r[1],u=r[2],m=o-e[0],p=s-e[1],d=l-e[2],h=m*m+p*p+d*d;h>0&&(h=1/Math.sqrt(h),m*=h,p*=h,d*=h);var f=c*d-u*p,b=u*m-a*d,x=a*p-c*m;return h=f*f+b*b+x*x,h>0&&(h=1/Math.sqrt(h),f*=h,b*=h,x*=h),i[0]=f,i[1]=b,i[2]=x,i[3]=0,i[4]=p*x-d*b,i[5]=d*f-m*x,i[6]=m*b-p*f,i[7]=0,i[8]=m,i[9]=p,i[10]=d,i[11]=0,i[12]=o,i[13]=s,i[14]=l,i[15]=1,i}function dB(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"}function hB(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}function fB(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i[9]=t[9]+e[9],i[10]=t[10]+e[10],i[11]=t[11]+e[11],i[12]=t[12]+e[12],i[13]=t[13]+e[13],i[14]=t[14]+e[14],i[15]=t[15]+e[15],i}function L0(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i[9]=t[9]-e[9],i[10]=t[10]-e[10],i[11]=t[11]-e[11],i[12]=t[12]-e[12],i[13]=t[13]-e[13],i[14]=t[14]-e[14],i[15]=t[15]-e[15],i}function bB(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12]*e,i[13]=t[13]*e,i[14]=t[14]*e,i[15]=t[15]*e,i}function _B(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i[2]=t[2]+e[2]*r,i[3]=t[3]+e[3]*r,i[4]=t[4]+e[4]*r,i[5]=t[5]+e[5]*r,i[6]=t[6]+e[6]*r,i[7]=t[7]+e[7]*r,i[8]=t[8]+e[8]*r,i[9]=t[9]+e[9]*r,i[10]=t[10]+e[10]*r,i[11]=t[11]+e[11]*r,i[12]=t[12]+e[12]*r,i[13]=t[13]+e[13]*r,i[14]=t[14]+e[14]*r,i[15]=t[15]+e[15]*r,i}function yB(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]}function xB(i,t){var e=i[0],r=i[1],o=i[2],s=i[3],l=i[4],a=i[5],c=i[6],u=i[7],m=i[8],p=i[9],d=i[10],h=i[11],f=i[12],b=i[13],x=i[14],_=i[15],y=t[0],g=t[1],S=t[2],w=t[3],B=t[4],C=t[5],A=t[6],k=t[7],M=t[8],E=t[9],L=t[10],U=t[11],Y=t[12],O=t[13],K=t[14],mt=t[15];return Math.abs(e-y)<=St*Math.max(1,Math.abs(e),Math.abs(y))&&Math.abs(r-g)<=St*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(o-S)<=St*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-w)<=St*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-B)<=St*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(a-C)<=St*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(c-A)<=St*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-k)<=St*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(m-M)<=St*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-E)<=St*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-L)<=St*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(h-U)<=St*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(f-Y)<=St*Math.max(1,Math.abs(f),Math.abs(Y))&&Math.abs(b-O)<=St*Math.max(1,Math.abs(b),Math.abs(O))&&Math.abs(x-K)<=St*Math.max(1,Math.abs(x),Math.abs(K))&&Math.abs(_-mt)<=St*Math.max(1,Math.abs(_),Math.abs(mt))}var gB=M0,SB=L0;var Vn={};Zf(Vn,{add:()=>AB,angle:()=>ZB,bezier:()=>YB,ceil:()=>TB,clone:()=>wB,copy:()=>BB,create:()=>G0,cross:()=>VB,dist:()=>iC,distance:()=>J0,div:()=>eC,divide:()=>Y0,dot:()=>X0,equals:()=>KB,exactEquals:()=>WB,floor:()=>PB,forEach:()=>nC,fromValues:()=>vB,hermite:()=>UB,inverse:()=>LB,len:()=>oC,length:()=>V0,lerp:()=>EB,max:()=>MB,min:()=>DB,mul:()=>tC,multiply:()=>U0,negate:()=>IB,normalize:()=>GB,random:()=>JB,rotateX:()=>HB,rotateY:()=>OB,rotateZ:()=>NB,round:()=>RB,scale:()=>kB,scaleAndAdd:()=>FB,set:()=>CB,sqrDist:()=>rC,sqrLen:()=>sC,squaredDistance:()=>z0,squaredLength:()=>j0,str:()=>qB,sub:()=>$B,subtract:()=>E0,transformMat3:()=>jB,transformMat4:()=>zB,transformQuat:()=>XB,zero:()=>QB});function G0(){var i=new oi(3);return oi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function wB(i){var t=new oi(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function V0(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function vB(i,t,e){var r=new oi(3);return r[0]=i,r[1]=t,r[2]=e,r}function BB(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function CB(i,t,e,r){return i[0]=t,i[1]=e,i[2]=r,i}function AB(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function E0(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function U0(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function Y0(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function TB(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i}function PB(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i}function DB(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.min(t[2],e[2]),i}function MB(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i}function RB(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i}function kB(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function FB(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i[2]=t[2]+e[2]*r,i}function J0(i,t){var e=t[0]-i[0],r=t[1]-i[1],o=t[2]-i[2];return Math.hypot(e,r,o)}function z0(i,t){var e=t[0]-i[0],r=t[1]-i[1],o=t[2]-i[2];return e*e+r*r+o*o}function j0(i){var t=i[0],e=i[1],r=i[2];return t*t+e*e+r*r}function IB(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function LB(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function GB(i,t){var e=t[0],r=t[1],o=t[2],s=e*e+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i}function X0(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function VB(i,t,e){var r=t[0],o=t[1],s=t[2],l=e[0],a=e[1],c=e[2];return i[0]=o*c-s*a,i[1]=s*l-r*c,i[2]=r*a-o*l,i}function EB(i,t,e,r){var o=t[0],s=t[1],l=t[2];return i[0]=o+r*(e[0]-o),i[1]=s+r*(e[1]-s),i[2]=l+r*(e[2]-l),i}function UB(i,t,e,r,o,s){var l=s*s,a=l*(2*s-3)+1,c=l*(s-2)+s,u=l*(s-1),m=l*(3-2*s);return i[0]=t[0]*a+e[0]*c+r[0]*u+o[0]*m,i[1]=t[1]*a+e[1]*c+r[1]*u+o[1]*m,i[2]=t[2]*a+e[2]*c+r[2]*u+o[2]*m,i}function YB(i,t,e,r,o,s){var l=1-s,a=l*l,c=s*s,u=a*l,m=3*s*a,p=3*c*l,d=c*s;return i[0]=t[0]*u+e[0]*m+r[0]*p+o[0]*d,i[1]=t[1]*u+e[1]*m+r[1]*p+o[1]*d,i[2]=t[2]*u+e[2]*m+r[2]*p+o[2]*d,i}function JB(i,t){t=t||1;var e=wd()*2*Math.PI,r=wd()*2-1,o=Math.sqrt(1-r*r)*t;return i[0]=Math.cos(e)*o,i[1]=Math.sin(e)*o,i[2]=r*t,i}function zB(i,t,e){var r=t[0],o=t[1],s=t[2],l=e[3]*r+e[7]*o+e[11]*s+e[15];return l=l||1,i[0]=(e[0]*r+e[4]*o+e[8]*s+e[12])/l,i[1]=(e[1]*r+e[5]*o+e[9]*s+e[13])/l,i[2]=(e[2]*r+e[6]*o+e[10]*s+e[14])/l,i}function jB(i,t,e){var r=t[0],o=t[1],s=t[2];return i[0]=r*e[0]+o*e[3]+s*e[6],i[1]=r*e[1]+o*e[4]+s*e[7],i[2]=r*e[2]+o*e[5]+s*e[8],i}function XB(i,t,e){var r=e[0],o=e[1],s=e[2],l=e[3],a=t[0],c=t[1],u=t[2],m=o*u-s*c,p=s*a-r*u,d=r*c-o*a,h=o*d-s*p,f=s*m-r*d,b=r*p-o*m,x=l*2;return m*=x,p*=x,d*=x,h*=2,f*=2,b*=2,i[0]=a+m+h,i[1]=c+p+f,i[2]=u+d+b,i}function HB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[0],s[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),s[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function OB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),s[1]=o[1],s[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function NB(i,t,e,r){var o=[],s=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],s[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),s[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),s[2]=o[2],i[0]=s[0]+e[0],i[1]=s[1]+e[1],i[2]=s[2]+e[2],i}function ZB(i,t){var e=i[0],r=i[1],o=i[2],s=t[0],l=t[1],a=t[2],c=Math.sqrt(e*e+r*r+o*o),u=Math.sqrt(s*s+l*l+a*a),m=c*u,p=m&&X0(i,t)/m;return Math.acos(Math.min(Math.max(p,-1),1))}function QB(i){return i[0]=0,i[1]=0,i[2]=0,i}function qB(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"}function WB(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}function KB(i,t){var e=i[0],r=i[1],o=i[2],s=t[0],l=t[1],a=t[2];return Math.abs(e-s)<=St*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(r-l)<=St*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-a)<=St*Math.max(1,Math.abs(o),Math.abs(a))}var $B=E0,tC=U0,eC=Y0,iC=J0,rC=z0,oC=V0,sC=j0,nC=function(){var i=G0();return function(t,e,r,o,s,l){var a,c;for(e||(e=3),r||(r=0),o?c=Math.min(o*e+r,t.length):c=t.length,a=r;a<c;a+=e)i[0]=t[a],i[1]=t[a+1],i[2]=t[a+2],s(i,i,l),t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2];return t}}();var lC=[0,-1,0],aC=[0,0,1],cC=Vn.create(),vd={x:0,y:0};function H0(i,t,e,r){let o=1/(i*e[3]+t*e[7]+e[15]);r.x=(i*e[0]+t*e[4]+e[12])*o,r.y=(i*e[1]+t*e[5]+e[13])*o}var Bd=class{constructor(){this.center=new n(0,20);this.zoom=1;this.projection=Si.create();this.modelView=Si.create();this.combined=Si.create();this.inverse=Si.create();this.width=0;this.height=0}getZoom(){return this.zoom}getCenter(){return this.center}getWidth(){return this.width}getHeight(){return this.height}update(){let t=1/(2*this.zoom),e=this.width*t,r=this.height*t;Si.ortho(this.projection,-e,e,r,-r,0,1e4);let o=[this.center.x,this.center.y,0];Si.lookAt(this.modelView,o,Vn.add(cC,o,aC),lC),Si.mul(this.combined,this.projection,this.modelView),Si.invert(this.inverse,this.combined)}resize(t,e){this.width=t,this.height=e,this.update()}setPositionAndZoom(t,e,r){this.center.Set(t,e),this.zoom=r,this.update()}setPosition(t,e){this.center.Set(t,e),this.update()}setZoom(t){this.zoom=t,this.update()}project(t,e){return H0(t.x,t.y,this.combined,vd),e.x=this.width*(vd.x+1)/2,e.y=this.height-this.height*(vd.y+1)/2,e}unproject({x:t,y:e},r){return H0(2*t/this.width-1,2*(this.height-e)/this.height-1,this.inverse,r),r}},st=new Bd;function Er(i,t,e,r=!1){return{key:i,description:t,callback:e,step:r}}function G(i,t,e){return Er(i,t,r=>{r&&e()})}function Ur(i,t,e){return Er(i,t,e,!0)}function Yr(i,t,e,r){return Er(i,t,o=>{e[r]=o})}var O0="./marble-OOBBZ3IM.png";var N0="./bg-A6IQEPON.png";var pC={marble:O0,bg:N0};async function dC(i,t){let e={},r=Object.keys(t).map(o=>new Promise(s=>{let l=i.createTexture();i.bindTexture(i.TEXTURE_2D,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR);let a=new Image,c={width:0,height:0,texture:l};a.onload=()=>{c.width=a.width,c.height=a.height,i.bindTexture(i.TEXTURE_2D,l),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,a),s()},a.src=t[o],e[o]=c}));return await Promise.all(r),e}var Z0=i=>dC(i,pC);var En=$(_o()),yC=En.glsl`
attribute vec2 position;
attribute vec2 uv;
varying vec2 vUV;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vUV = uv;
    gl_Position = uPMatrix * uMVMatrix * vec4(position, 500.0, 1.0);
}
`,xC=En.glsl`
precision highp float;
varying vec2 vUV;
uniform float opacity;
uniform sampler2D textureID;
uniform vec2 uvOffset;

void main() {
    gl_FragColor = texture2D(textureID, vUV + uvOffset);
    gl_FragColor.w *= opacity;
}
`;function K0(i){return(0,En.createShaderProgram)(i,yC,xC,{position:"vertexAttribPointer",uv:"vertexAttribPointer",uMVMatrix:"uniformMatrix4f",uPMatrix:"uniformMatrix4f",textureID:"uniform1i",opacity:"uniform1f",uvOffset:"uniform2f"})}function $0(i){let t=i.getContext("webgl");return t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE),t.enable(t.BLEND),Cd(i,t,i.clientWidth,i.clientHeight),t}function Cd(i,t,e,r){i.width=e,i.height=r,t.viewport(0,0,e,r)}function bs(i,t,e,r,o){i.clearColor(t,e,r,o),i.clear(i.COLOR_BUFFER_BIT)}var wi=class{constructor(){this.flags=0;this.position=new n;this.velocity=new n;this.color=new F(0,0,0,0);this.lifetime=0;this.userData=null;this.group=null}};function Oc(i,t,e){let s=Math.ceil(Math.sqrt(i/(.01*t))*e);return et(s,1,8)}var Hc=class{constructor(){this.m_index=-1}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}};var it=class{constructor(){this.flags=0;this.groupFlags=0;this.position=new n;this.angle=0;this.linearVelocity=new n;this.angularVelocity=0;this.color=new F;this.strength=1;this.shapeCount=0;this.stride=0;this.particleCount=0;this.lifetime=0;this.userData=null;this.group=null}},Nc=class i{constructor(t){this.m_firstIndex=0;this.m_lastIndex=0;this.m_groupFlags=0;this.m_strength=1;this.m_prev=null;this.m_next=null;this.m_timestamp=-1;this.m_mass=0;this.m_inertia=0;this.m_center=new n;this.m_linearVelocity=new n;this.m_angularVelocity=0;this.m_transform=new T;this.m_userData=null;this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){N(this.m_system.m_flagsBuffer.data!==null);let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(t){t|=this.m_groupFlags&24,this.m_system.SetGroupFlags(this,t)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){let r=i.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),n.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,n.Subtract(t,this.m_center,r),e)}static{this.GetLinearVelocityFromWorldPoint_s_t0=new n}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){N(!this.m_system.m_world.IsLocked());for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){N(this.m_system.m_positionBuffer.data!==null),N(this.m_system.m_velocityBuffer.data!==null);let t=new n,e=new n;if(this.m_timestamp!==this.m_system.m_timestamp){let r=this.m_system.GetParticleMass();this.m_mass=r*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)this.m_center.AddScaled(r,this.m_system.m_positionBuffer.data[o]),this.m_linearVelocity.AddScaled(r,this.m_system.m_velocityBuffer.data[o]);if(this.m_mass>0){let o=1/this.m_mass;this.m_center.Scale(o),this.m_linearVelocity.Scale(o)}this.m_inertia=0,this.m_angularVelocity=0;for(let o=this.m_firstIndex;o<this.m_lastIndex;o++)n.Subtract(this.m_system.m_positionBuffer.data[o],this.m_center,t),n.Subtract(this.m_system.m_velocityBuffer.data[o],this.m_linearVelocity,e),this.m_inertia+=r*n.Dot(t,t),this.m_angularVelocity+=r*n.Cross(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}};var Zc=class{constructor(t){this.m_buffer=[];this.m_front=0;this.m_back=0;this.m_buffer.fill(null,0,t)}get m_capacity(){return this.m_buffer.length}Push(t){if(this.m_back>=this.m_capacity){for(let e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_buffer[this.m_front]=null,this.m_front++}Empty(){return this.m_front===this.m_back}Front(){let t=this.m_buffer[this.m_front];return N(t!==null),t}};var Qc=class{constructor(t){this.m_generatorCapacity=0;this.m_generatorCount=0;this.m_countX=0;this.m_countY=0;this.m_diagram=[];this.m_generatorBuffer=new Array(t);for(let e=0;e<t;e++)this.m_generatorBuffer[e]=new Ad;this.m_generatorCapacity=t}AddGenerator(t,e,r){let o=this.m_generatorBuffer[this.m_generatorCount++];o.center.Copy(t),o.tag=e,o.necessary=r}Generate(t,e){let r=1/t,o=new n(+tt,+tt),s=new n(-tt,-tt),l=0;for(let c=0;c<this.m_generatorCount;c++){let u=this.m_generatorBuffer[c];u.necessary&&(n.Min(o,u.center,o),n.Max(s,u.center,s),++l)}if(l===0){this.m_countX=0,this.m_countY=0;return}o.x-=e,o.y-=e,s.x+=e,s.y+=e,this.m_countX=1+Math.floor(r*(s.x-o.x)),this.m_countY=1+Math.floor(r*(s.y-o.y)),this.m_diagram=[];let a=new Zc(4*this.m_countX*this.m_countY);for(let c=0;c<this.m_generatorCount;c++){let u=this.m_generatorBuffer[c];u.center.Subtract(o).Scale(r);let m=Math.floor(u.center.x),p=Math.floor(u.center.y);m>=0&&p>=0&&m<this.m_countX&&p<this.m_countY&&a.Push(new ve(m,p,m+p*this.m_countX,u))}for(;!a.Empty();){let c=a.Front(),u=c.m_x,m=c.m_y,p=c.m_i,d=c.m_generator;a.Pop(),this.m_diagram[p]||(this.m_diagram[p]=d,u>0&&a.Push(new ve(u-1,m,p-1,d)),m>0&&a.Push(new ve(u,m-1,p-this.m_countX,d)),u<this.m_countX-1&&a.Push(new ve(u+1,m,p+1,d)),m<this.m_countY-1&&a.Push(new ve(u,m+1,p+this.m_countX,d)))}for(let c=0;c<this.m_countY;c++)for(let u=0;u<this.m_countX-1;u++){let m=u+c*this.m_countX,p=this.m_diagram[m],d=this.m_diagram[m+1];p!==d&&(a.Push(new ve(u,c,m,d)),a.Push(new ve(u+1,c,m+1,p)))}for(let c=0;c<this.m_countY-1;c++)for(let u=0;u<this.m_countX;u++){let m=u+c*this.m_countX,p=this.m_diagram[m],d=this.m_diagram[m+this.m_countX];p!==d&&(a.Push(new ve(u,c,m,d)),a.Push(new ve(u,c+1,m+this.m_countX,p)))}for(;!a.Empty();){let c=a.Front(),u=c.m_x,m=c.m_y,p=c.m_i,d=c.m_generator;a.Pop();let h=this.m_diagram[p],f=d;if(h!==f){let b=h.center.x-u,x=h.center.y-m,_=f.center.x-u,y=f.center.y-m,g=b*b+x*x,S=_*_+y*y;g>S&&(this.m_diagram[p]=f,u>0&&a.Push(new ve(u-1,m,p-1,f)),m>0&&a.Push(new ve(u,m-1,p-this.m_countX,f)),u<this.m_countX-1&&a.Push(new ve(u+1,m,p+1,f)),m<this.m_countY-1&&a.Push(new ve(u,m+1,p+this.m_countX,f)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let r=0;r<this.m_countX-1;r++){let o=r+e*this.m_countX,s=this.m_diagram[o],l=this.m_diagram[o+1],a=this.m_diagram[o+this.m_countX],c=this.m_diagram[o+1+this.m_countX];l!==a&&(s!==l&&s!==a&&(s.necessary||l.necessary||a.necessary)&&t(s.tag,l.tag,a.tag),c!==l&&c!==a&&(s.necessary||l.necessary||a.necessary)&&t(l.tag,c.tag,a.tag))}}},Ad=class{constructor(){this.center=new n;this.tag=0;this.necessary=!1}},ve=class{constructor(t,e,r,o){this.m_x=t,this.m_y=e,this.m_i=r,this.m_generator=o}};var tx=new I,gC=new n,SC=new n,wC=new n,vC=new n,BC=new n,CC=new n,AC=new n,TC=new n,PC=new n,ex=[(i,t,e,r)=>{let o=T.MultiplyVec2(t,i.m_p,PC);return n.Subtract(e,o,r),r.Normalize()-i.m_radius},(i,t,e,r)=>{let o=T.MultiplyVec2(t,i.m_vertex1,BC),s=T.MultiplyVec2(t,i.m_vertex2,CC),l=n.Subtract(e,o,AC),a=n.Subtract(s,o,TC),c=n.Dot(l,a);if(c>0){let u=n.Dot(a,a);c>u?n.Subtract(e,s,l):l.SubtractScaled(c/u,a)}return r.Copy(l),r.Normalize()},(i,t,e,r)=>{let o=T.TransposeMultiplyVec2(t,e,gC),s=-tt,l=SC.Copy(o);for(let a=0;a<i.m_count;++a){let c=n.Dot(i.m_normals[a],n.Subtract(o,i.m_vertices[a],n.s_t0));c>s&&(s=c,l.Copy(i.m_normals[a]))}if(s>0){let a=wC.Copy(l),c=s*s;for(let u=0;u<i.m_count;++u){let m=n.Subtract(o,i.m_vertices[u],vC),p=m.LengthSquared();c>p&&(a.Copy(m),c=p)}return D.MultiplyVec2(t.q,a,r),r.Normalize(),Math.sqrt(c)}return D.MultiplyVec2(t.q,l,r),s},(i,t,e,r,o)=>(i.GetChildEdge(tx,o),ex[1](tx,t,e,r,0))],qc=(i,t,e,r,o)=>{let s=ex[i.GetType()];return s?s(i,t,e,r,o):0};var Wc=class{constructor(t){this.m_system=t}ReportFixture(t){if(t.IsSensor())return!0;let r=t.GetShape().GetChildCount();for(let o=0;o<r;o++){let s=t.GetAABB(o),l=this.m_system.GetInsideBoundsEnumerator(s),a;for(;(a=l.GetNext())>=0;)this.ReportFixtureAndParticle(t,o,a)}return!0}},Kc=class i extends Wc{constructor(){super(...arguments);this.m_contactFilter=null}ShouldCollideFixtureParticle(e,r){return this.m_contactFilter&&this.m_system.GetFlagsBuffer()[r]&65536?this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,r):!0}ReportFixtureAndParticle(e,r,o){let s=i.ReportFixtureAndParticle_s_n,l=i.ReportFixtureAndParticle_s_rp,a=this.m_system.m_positionBuffer.data[o],c=s,u=qc(e.GetShape(),e.GetBody().GetTransform(),a,c,r);if(u<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,o)){let m=e.GetBody(),p=m.GetWorldCenter(),d=m.GetMass(),h=m.GetInertia()-d*m.GetLocalCenter().LengthSquared(),f=d>0?1/d:0,b=h>0?1/h:0,x=this.m_system.m_flagsBuffer.data[o]&4?0:this.m_system.GetParticleInvMass(),_=n.Subtract(a,p,l),y=n.Cross(_,c),g=x+f+b*y*y,S=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];S.index=o,S.body=m,S.fixture=e,S.weight=1-u*this.m_system.m_inverseDiameter,S.normal.Copy(c.Negate()),S.mass=g>0?1/g:0,this.m_system.DetectStuckParticle(o)}}static{this.ReportFixtureAndParticle_s_n=new n}static{this.ReportFixtureAndParticle_s_rp=new n}},$c=class i extends Wc{constructor(){super(...arguments);this.m_step=null}ReportFixtureAndParticle(e,r,o){let s=i.ReportFixtureAndParticle_s_p1,l=i.ReportFixtureAndParticle_s_output,a=i.ReportFixtureAndParticle_s_input,c=i.ReportFixtureAndParticle_s_p,u=i.ReportFixtureAndParticle_s_v,m=i.ReportFixtureAndParticle_s_f,p=e.GetBody(),d=this.m_system.m_positionBuffer.data[o],h=this.m_system.m_velocityBuffer.data[o],f=l,b=a;if(this.m_system.m_iterationIndex===0){let _=p.GetTransform(),y=T.TransposeMultiplyVec2(p.m_xf0,d,s);e.GetShape().GetType()===0&&(y.Subtract(p.GetLocalCenter()),D.MultiplyVec2(p.m_xf0.q,y,y),D.TransposeMultiplyVec2(_.q,y,y),y.Add(p.GetLocalCenter())),T.MultiplyVec2(_,y,b.p1)}else b.p1.Copy(d);let x=ct(this.m_step);if(n.AddScaled(d,x.dt,h,b.p2),b.maxFraction=1,e.RayCast(f,b,r)){let _=f.normal,y=c;y.x=(1-f.fraction)*b.p1.x+f.fraction*b.p2.x+Z*_.x,y.y=(1-f.fraction)*b.p1.y+f.fraction*b.p2.y+Z*_.y;let g=u;g.x=x.inv_dt*(y.x-d.x),g.y=x.inv_dt*(y.y-d.y),this.m_system.m_velocityBuffer.data[o].Copy(g);let S=m;S.x=x.inv_dt*this.m_system.GetParticleMass()*(h.x-g.x),S.y=x.inv_dt*this.m_system.GetParticleMass()*(h.y-g.y),this.m_system.ParticleApplyForce(o,S)}}static{this.ReportFixtureAndParticle_s_p1=new n}static{this.ReportFixtureAndParticle_s_output=new yi}static{this.ReportFixtureAndParticle_s_input=new _i}static{this.ReportFixtureAndParticle_s_p=new n}static{this.ReportFixtureAndParticle_s_v=new n}static{this.ReportFixtureAndParticle_s_f=new n}};function ru(i,t,e){let r=i[t];i[t]=i[e],i[e]=r}function lx(i,t){return i<t}function tu(i,t=0,e=i.length-t,r=lx){let o=t,s=[],l=0;for(;;){for(;o+1<e;e++){let a=i[o+Math.floor(Math.random()*(e-o))];s[l++]=e;for(let c=o-1;;){for(;r(i[++c],a););for(;r(a,i[--e]););if(c>=e)break;ru(i,c,e)}}if(l===0)break;o=e,e=s[--l]}return i}function ox(i,t=0,e=i.length-t,r=lx){return tu(i,t,e,r)}function ax(i,t,e=i.length){let r=0;for(let o=0;o<e;++o)if(!t(i[o])){if(o===r){++r;continue}ru(i,r++,o)}return r}function sx(i,t,e,r,o){let s=e-t;for(;s>0;){let l=Math.floor(s/2),a=t+l;o(i[a],r)?(t=++a,s-=l+1):s=l}return t}function nx(i,t,e,r,o){let s=e-t;for(;s>0;){let l=Math.floor(s/2),a=t+l;o(r,i[a])?s=l:(t=++a,s-=l+1)}return t}function Ie(i,t,e,r){let o=e;for(;t!==o;)ru(i,t++,o++),o===r?o=e:t===e&&(e=o)}function kC(i,t,e,r){if(t===e)return e;let o=t;for(;++t!==e;)r(i[o],i[t])||ru(i,++o,t);return++o}var Jr=class{constructor(t){this.data=[];this.count=0;this.capacity=0;this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){let t=this.capacity?2*this.capacity:256;this.Reserve(t)}Free(){this.data.length!==0&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){this.count=ax(this.data,t,this.count)}Unique(t){this.count=kC(this.data,0,this.count,t)}},Ne=class{constructor(){this.m_data=null;this.userSuppliedCapacity=0}get data(){return this.m_data}set data(t){this.m_data=t}},Dd=class{constructor(){this.indexA=0;this.indexB=0;this.weight=0;this.normal=new n;this.flags=0}SetIndices(t,e){this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&Math.abs(this.weight-t.weight)<.01&&n.DistanceSquared(this.normal,t.normal)<1e-4}},Md=class{constructor(){this.index=0;this.weight=0;this.normal=new n;this.mass=0}},Rd=class{constructor(){this.indexA=0;this.indexB=0;this.flags=0;this.strength=0;this.distance=0}},kd=class{constructor(){this.indexA=0;this.indexB=0;this.indexC=0;this.flags=0;this.strength=0;this.pa=new n;this.pb=new n;this.pc=new n;this.ka=0;this.kb=0;this.kc=0;this.s=0}},yo=class i{constructor(){this.strictContactCheck=!1;this.density=1;this.gravityScale=1;this.radius=1;this.maxCount=0;this.pressureStrength=.005;this.dampingStrength=1;this.elasticStrength=.25;this.springStrength=.25;this.viscousStrength=.25;this.surfaceTensionPressureStrength=.2;this.surfaceTensionNormalStrength=.2;this.repulsiveStrength=1;this.powderStrength=.5;this.ejectionStrength=.5;this.staticPressureStrength=.2;this.staticPressureRelaxation=.2;this.staticPressureIterations=8;this.colorMixingStrength=.5;this.destroyByAge=!0;this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return new i().Copy(this)}},or=class i{constructor(t,e){this.m_paused=!1;this.m_timestamp=0;this.m_allParticleFlags=0;this.m_needsUpdateAllParticleFlags=!1;this.m_allGroupFlags=0;this.m_needsUpdateAllGroupFlags=!1;this.m_hasForce=!1;this.m_iterationIndex=0;this.m_inverseDensity=0;this.m_particleDiameter=0;this.m_inverseDiameter=0;this.m_squaredDiameter=0;this.m_count=0;this.m_internalAllocatedCapacity=0;this.m_handleIndexBuffer=new Ne;this.m_flagsBuffer=new Ne;this.m_positionBuffer=new Ne;this.m_velocityBuffer=new Ne;this.m_forceBuffer=[];this.m_weightBuffer=[];this.m_staticPressureBuffer=[];this.m_accumulationBuffer=[];this.m_accumulation2Buffer=[];this.m_depthBuffer=[];this.m_colorBuffer=new Ne;this.m_groupBuffer=[];this.m_userDataBuffer=new Ne;this.m_stuckThreshold=0;this.m_lastBodyContactStepBuffer=new Ne;this.m_bodyContactCountBuffer=new Ne;this.m_consecutiveContactStepsBuffer=new Ne;this.m_stuckParticleBuffer=new Jr(()=>0);this.m_proxyBuffer=new Jr(()=>new zr);this.m_contactBuffer=new Jr(()=>new Dd);this.m_bodyContactBuffer=new Jr(()=>new Md);this.m_pairBuffer=new Jr(()=>new Rd);this.m_triadBuffer=new Jr(()=>new kd);this.m_expirationTimeBuffer=new Ne;this.m_indexByExpirationTimeBuffer=new Ne;this.m_timeElapsed=0;this.m_expirationTimeBufferRequiresSorting=!1;this.m_groupCount=0;this.m_groupList=null;this.m_def=new yo;this.m_prev=null;this.m_next=null;this.UpdateBodyContacts_callback=new Kc(this);this.SolveCollision_callback=new $c(this);this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static{this.xTruncBits=12}static{this.yTruncBits=12}static{this.tagBits=8*4}static{this.yOffset=1<<i.yTruncBits-1}static{this.yShift=i.tagBits-i.yTruncBits}static{this.xShift=i.tagBits-i.yTruncBits-i.xTruncBits}static{this.xScale=1<<i.xShift}static{this.xOffset=i.xScale*(1<<i.xTruncBits-1)}static{this.yMask=(1<<i.yTruncBits)-1<<i.yShift}static{this.xMask=~i.yMask}static computeTag(t,e){return(e+i.yOffset>>>0<<i.yShift)+(i.xScale*t+i.xOffset>>>0)>>>0}static computeRelativeTag(t,e,r){return t+(r<<i.yShift)+(e<<i.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer),this.FreeBuffer(this.m_weightBuffer),this.FreeBuffer(this.m_staticPressureBuffer),this.FreeBuffer(this.m_accumulationBuffer),this.FreeBuffer(this.m_accumulation2Buffer),this.FreeBuffer(this.m_depthBuffer),this.FreeBuffer(this.m_groupBuffer)}CreateParticle(t){if(N(!this.m_world.IsLocked()),this.m_count>=this.m_internalAllocatedCapacity){let c=this.m_count?2*this.m_count:256;this.ReallocateInternalAllocatedBuffers(c)}if(this.m_count>=this.m_internalAllocatedCapacity)if(this.m_def.destroyByAge)this.DestroyOldestParticle(0,!1),this.SolveZombie();else return-1;let e=this.m_count++;this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new n).Copy(t.position??n.ZERO),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new n).Copy(t.velocity??n.ZERO),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new n).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);let r=new F().Copy(t.color??F.ZERO);(this.m_colorBuffer.data||!r.IsZero())&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new F).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);let o=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=t.lifetime??0,l=s>0;(this.m_expirationTimeBuffer.data||l)&&(this.SetParticleLifetime(e,l?s:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[e]=e),o.index=e;let a=t.group??null;return this.m_groupBuffer[e]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,e),a.m_lastIndex=e+1):(a.m_firstIndex=e,a.m_lastIndex=e+1)),this.SetParticleFlags(e,t.flags??0),e}GetParticleHandleFromIndex(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||(e=new Hc,e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(t,e=!1){let r=2;e&&(r|=512),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|r)}DestroyOldestParticle(t,e=!1){let r=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data[r-(t+1)],s=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[o]>0?o:s,e)}DestroyParticlesInShape(t,e,r=!1){let o=i.DestroyParticlesInShape_s_aabb;N(!this.m_world.IsLocked());let s=o;t.ComputeAABB(s,e,0);let l=0;return this.QueryAABB(s,a=>(t.TestPoint(e,this.m_positionBuffer.data[a])&&(this.DestroyParticle(a,r),l++),!0)),l}static{this.DestroyParticlesInShape_s_aabb=new lt}CreateParticleGroup(t){let e=i.CreateParticleGroup_s_transform;N(!this.m_world.IsLocked());let r=e;r.SetPositionAngle(t.position??n.ZERO,t.angle??0);let o=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,r),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,t.shapeCount??t.shapes.length,t,r),t.positionData){let c=t.particleCount??t.positionData.length;for(let u=0;u<c;u++){let m=t.positionData[u];this.CreateParticleForGroup(t,r,m)}}let s=this.m_count,l=new Nc(this);l.m_firstIndex=o,l.m_lastIndex=s,l.m_strength=t.strength??1,l.m_userData=t.userData,l.m_transform.Copy(r),l.m_prev=null,l.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=l),this.m_groupList=l,++this.m_groupCount;for(let c=o;c<s;c++)this.m_groupBuffer[c]=l;this.SetGroupFlags(l,t.groupFlags??0);let a=new Un;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(o,s,a),t.group&&(this.JoinParticleGroups(t.group,l),l=t.group),l}static{this.CreateParticleGroup_s_transform=new T}JoinParticleGroups(t,e){N(!this.m_world.IsLocked()),this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);let r=new Vd(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,r);for(let s=e.m_firstIndex;s<e.m_lastIndex;s++)this.m_groupBuffer[s]=t;let o=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,o),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);let e=t.GetParticleCount(),r=new Array(e);for(let s=0;s<e;s++)r[s]=new Id;i.InitializeParticleLists(t,r),this.MergeParticleListsInContact(t,r);let o=i.FindLongestParticleList(t,r);this.MergeZombieParticleListNodes(t,r,o),this.CreateParticleGroupsFromParticleList(t,r,o),this.UpdatePairsAndTriadsWithParticleList(t,r)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&128&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&256&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}GetParticleFlags(t){return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}SetPositionBuffer(t){this.SetUserOverridableBuffer(this.m_positionBuffer,t)}SetVelocityBuffer(t){this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}SetColorBuffer(t){this.SetUserOverridableBuffer(this.m_colorBuffer,t)}SetUserDataBuffer(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){let t=i.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,r=0;for(let o=0;o<this.m_contactBuffer.count;o++){let s=this.m_contactBuffer.data[o],l=s.indexA,a=s.indexB,c=s.normal,u=n.Subtract(e[a],e[l],t),m=n.Dot(u,c);m<0&&(r+=m*m)}return .5*this.GetParticleMass()*r}static{this.ComputeCollisionEnergy_s_v=new n}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){let r=this.m_indexByExpirationTimeBuffer.data===null;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),r){let l=this.GetParticleCount();for(let a=0;a<l;++a)this.m_indexByExpirationTimeBuffer.data[a]=a}let o=e/this.m_def.lifetimeGranularity,s=o>0?this.GetQuantizedTimeElapsed()+o:o;s!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=s,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,r){let o=this.m_velocityBuffer.data,l=(e-t)*this.GetParticleMass(),a=n.Scale(1/l,r,new n);for(let c=t;c<e;c++)o[c].Add(a)}static IsSignificantForce(t){return t.x!==0||t.y!==0}ParticleApplyForce(t,e){i.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].Add(e))}ApplyForce(t,e,r){let o=n.Scale(1/(e-t),r,new n);if(i.IsSignificantForce(o)){this.PrepareForceBuffer();for(let s=t;s<e;s++)this.m_forceBuffer[s].Add(o)}}GetNext(){return this.m_next}QueryAABB(t,e){if(this.m_proxyBuffer.count===0)return;let r=0,o=this.m_proxyBuffer.count,s=sx(this.m_proxyBuffer.data,r,o,i.computeTag(this.m_inverseDiameter*t.lowerBound.x,this.m_inverseDiameter*t.lowerBound.y),zr.CompareProxyTag),l=nx(this.m_proxyBuffer.data,s,o,i.computeTag(this.m_inverseDiameter*t.upperBound.x,this.m_inverseDiameter*t.upperBound.y),zr.CompareTagProxy),a=this.m_positionBuffer.data;for(let c=s;c<l;++c){let m=this.m_proxyBuffer.data[c].index,p=a[m];if(t.lowerBound.x<p.x&&p.x<t.upperBound.x&&t.lowerBound.y<p.y&&p.y<t.upperBound.y&&!e(m))break}}QueryShapeAABB(t,e,r,o){let l=i.QueryShapeAABB_s_aabb;t.ComputeAABB(l,e,r),this.QueryAABB(l,o)}static{this.QueryShapeAABB_s_aabb=new lt}QueryPointAABB(t,e,r){let s=i.QueryPointAABB_s_aabb;s.lowerBound.Set(t.x-e,t.y-e),s.upperBound.Set(t.x+e,t.y+e),this.QueryAABB(s,r)}static{this.QueryPointAABB_s_aabb=new lt}RayCast(t,e,r){let o=i.RayCast_s_aabb,s=i.RayCast_s_p,l=i.RayCast_s_v,a=i.RayCast_s_n,c=i.RayCast_s_point;if(this.m_proxyBuffer.count===0)return;let u=this.m_positionBuffer.data,m=o;n.Min(t,e,m.lowerBound),n.Max(t,e,m.upperBound);let p=1,d=n.Subtract(e,t,l),h=n.Dot(d,d),f=this.GetInsideBoundsEnumerator(m),b;for(;(b=f.GetNext())>=0;){let x=n.Subtract(t,u[b],s),_=n.Dot(x,d),y=n.Dot(x,x),g=_*_-h*(y-this.m_squaredDiameter);if(g>=0){let S=Math.sqrt(g),w=(-_-S)/h;if(w>p||w<0&&(w=(-_+S)/h,w<0||w>p))continue;let B=n.AddScaled(x,w,d,a);B.Normalize();let C=r(b,n.AddScaled(t,w,d,c),B,w);if(p=Math.min(p,C),p<=0)break}}}static{this.RayCast_s_aabb=new lt}static{this.RayCast_s_p=new n}static{this.RayCast_s_v=new n}static{this.RayCast_s_n=new n}static{this.RayCast_s_point=new n}ComputeAABB(t){let e=this.GetParticleCount();t.lowerBound.x=+tt,t.lowerBound.y=+tt,t.upperBound.x=-tt,t.upperBound.y=-tt;let r=this.m_positionBuffer.data;for(let o=0;o<e;o++){let s=r[o];n.Min(t.lowerBound,s,t.lowerBound),n.Max(t.upperBound,s,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}static{this.k_pairFlags=8}static{this.k_triadFlags=16}static{this.k_noPressureFlags=192}static{this.k_extraDampingFlags=2048}static{this.k_barrierWallFlags=1028}FreeBuffer(t){t!==null&&(t.length=0)}FreeUserOverridableBuffer(t){t.userSuppliedCapacity===0&&this.FreeBuffer(t.data)}ReallocateBuffer3(t,e,r){N(r>e);let o=t?t.slice():[];return o.length=r,o}ReallocateBuffer5(t,e,r,o,s){return N(o>r),N(!e||o<=e),(!s||t)&&!e&&(t=this.ReallocateBuffer3(t,r,o)),t}ReallocateBuffer4(t,e,r,o){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,r,o)}RequestBuffer(t){return t||(this.m_internalAllocatedCapacity===0&&this.ReallocateInternalAllocatedBuffers(256),t=[],t.length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function e(r){return r&&t>r?r:t}if(t=e(this.m_def.maxCount),t=e(this.m_flagsBuffer.userSuppliedCapacity),t=e(this.m_positionBuffer.userSuppliedCapacity),t=e(this.m_velocityBuffer.userSuppliedCapacity),t=e(this.m_colorBuffer.userSuppliedCapacity),t=e(this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);let r=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,r),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,r),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,r),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,r){let o=new wi;o.flags=t.flags??0,T.MultiplyVec2(e,r,o.position),n.Add(t.linearVelocity??n.ZERO,n.CrossScalarVec2(t.angularVelocity??0,n.Subtract(o.position,t.position??n.ZERO,n.s_t0),n.s_t0),o.velocity),o.color.Copy(t.color??F.ZERO),o.lifetime=t.lifetime??0,o.userData=t.userData,this.CreateParticle(o)}CreateParticlesStrokeShapeForGroup(t,e,r){let o=i.CreateParticlesStrokeShapeForGroup_s_edge,s=i.CreateParticlesStrokeShapeForGroup_s_d,l=i.CreateParticlesStrokeShapeForGroup_s_p,a=e.stride??0;a===0&&(a=this.GetParticleStride());let c=0,u=t.GetChildCount();for(let m=0;m<u;m++){let p=null;t.GetType()===1?p=t:(p=o,t.GetChildEdge(p,m));let d=n.Subtract(p.m_vertex2,p.m_vertex1,s),h=d.Length();for(;c<h;){let f=n.AddScaled(p.m_vertex1,c/h,d,l);this.CreateParticleForGroup(e,r,f),c+=a}c-=h}}static{this.CreateParticlesStrokeShapeForGroup_s_edge=new I}static{this.CreateParticlesStrokeShapeForGroup_s_d=new n}static{this.CreateParticlesStrokeShapeForGroup_s_p=new n}CreateParticlesFillShapeForGroup(t,e,r){let o=i.CreateParticlesFillShapeForGroup_s_aabb,s=i.CreateParticlesFillShapeForGroup_s_p,l=e.stride??0;l===0&&(l=this.GetParticleStride());let a=T.IDENTITY,c=o;t.ComputeAABB(c,a,0);for(let u=Math.floor(c.lowerBound.y/l)*l;u<c.upperBound.y;u+=l)for(let m=Math.floor(c.lowerBound.x/l)*l;m<c.upperBound.x;m+=l){let p=s.Set(m,u);t.TestPoint(a,p)&&this.CreateParticleForGroup(e,r,p)}}static{this.CreateParticlesFillShapeForGroup_s_aabb=new lt}static{this.CreateParticlesFillShapeForGroup_s_p=new n}CreateParticlesWithShapeForGroup(t,e,r){switch(t.GetType()){case 1:case 3:this.CreateParticlesStrokeShapeForGroup(t,e,r);break;case 2:case 0:this.CreateParticlesFillShapeForGroup(t,e,r);break;default:break}}CreateParticlesWithShapesForGroup(t,e,r,o){let s=new Ed(t,e);this.CreateParticlesFillShapeForGroup(s,r,o)}CloneParticle(t,e){let r=new wi;r.flags=this.m_flagsBuffer.data[t],r.position.Copy(this.m_positionBuffer.data[t]),r.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&r.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(r.userData=this.m_userDataBuffer.data[t]),r.group=e;let o=this.CreateParticle(r);if(this.m_handleIndexBuffer.data){let s=this.m_handleIndexBuffer.data[t];s&&s.SetIndex(o),this.m_handleIndexBuffer.data[o]=s,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[o]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[o]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[o]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[o].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[o]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[o]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[o]=this.m_expirationTimeBuffer.data[t]),o}DestroyParticlesInGroup(t,e=!1){for(let r=t.m_firstIndex;r<t.m_lastIndex;r++)this.DestroyParticle(r,e)}DestroyParticleGroup(t){this.m_world.GetDestructionListener()?.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let r=t.m_firstIndex;r<t.m_lastIndex;r++)this.m_groupBuffer[r]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(t,e){return(t&28)!==0||e!==null&&(e.GetGroupFlags()&2)!==0}UpdatePairsAndTriads(t,e,r){let o=i.UpdatePairsAndTriads_s_dab,s=i.UpdatePairsAndTriads_s_dbc,l=i.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data,c=0;for(let u=t;u<e;u++)c|=this.m_flagsBuffer.data[u];if(c&i.k_pairFlags)for(let u=0;u<this.m_contactBuffer.count;u++){let m=this.m_contactBuffer.data[u],p=m.indexA,d=m.indexB,h=this.m_flagsBuffer.data[p],f=this.m_flagsBuffer.data[d],b=this.m_groupBuffer[p],x=this.m_groupBuffer[d];if(p>=t&&p<e&&d>=t&&d<e&&!((h|f)&2)&&(h|f)&i.k_pairFlags&&(r.IsNecessary(p)||r.IsNecessary(d))&&i.ParticleCanBeConnected(h,b)&&i.ParticleCanBeConnected(f,x)&&r.ShouldCreatePair(p,d)){let _=this.m_pairBuffer.data[this.m_pairBuffer.Append()];_.indexA=p,_.indexB=d,_.flags=m.flags,_.strength=Math.min(b?b.m_strength:1,x?x.m_strength:1),_.distance=n.Distance(a[p],a[d])}ox(this.m_pairBuffer.data,0,this.m_pairBuffer.count,i.ComparePairIndices),this.m_pairBuffer.Unique(i.MatchPairIndices)}if(c&i.k_triadFlags){let u=new Qc(e-t);for(let p=t;p<e;p++){let d=this.m_flagsBuffer.data[p],h=this.m_groupBuffer[p];!(d&2)&&i.ParticleCanBeConnected(d,h)&&u.AddGenerator(a[p],p,r.IsNecessary(p))}let m=this.GetParticleStride();u.Generate(m/2,m*2),u.GetNodes((p,d,h)=>{let f=this.m_flagsBuffer.data[p],b=this.m_flagsBuffer.data[d],x=this.m_flagsBuffer.data[h];if((f|b|x)&i.k_triadFlags&&r.ShouldCreateTriad(p,d,h)){let _=a[p],y=a[d],g=a[h],S=n.Subtract(_,y,o),w=n.Subtract(y,g,s),B=n.Subtract(g,_,l),C=4*this.m_squaredDiameter;if(n.Dot(S,S)>C||n.Dot(w,w)>C||n.Dot(B,B)>C)return;let A=this.m_groupBuffer[p],k=this.m_groupBuffer[d],M=this.m_groupBuffer[h],E=this.m_triadBuffer.data[this.m_triadBuffer.Append()];E.indexA=p,E.indexB=d,E.indexC=h,E.flags=f|b|x,E.strength=Math.min(Math.min(A?A.m_strength:1,k?k.m_strength:1),M?M.m_strength:1);let L=(_.x+y.x+g.x)/3,U=(_.y+y.y+g.y)/3;E.pa.x=_.x-L,E.pa.y=_.y-U,E.pb.x=y.x-L,E.pb.y=y.y-U,E.pc.x=g.x-L,E.pc.y=g.y-U,E.ka=-n.Dot(B,S),E.kb=-n.Dot(S,w),E.kc=-n.Dot(w,B),E.s=n.Cross(_,y)+n.Cross(y,g)+n.Cross(g,_)}}),ox(this.m_triadBuffer.data,0,this.m_triadBuffer.count,i.CompareTriadIndices),this.m_triadBuffer.Unique(i.MatchTriadIndices)}}static{this.UpdatePairsAndTriads_s_dab=new n}static{this.UpdatePairsAndTriads_s_dbc=new n}static{this.UpdatePairsAndTriads_s_dca=new n}UpdatePairsAndTriadsWithReactiveParticles(){let t=new Ud(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=-4097;this.m_allParticleFlags&=-4097}static ComparePairIndices(t,e){let r=t.indexA-e.indexA;return r!==0?r<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){let r=t.indexA-e.indexA;if(r!==0)return r<0;let o=t.indexB-e.indexB;return o!==0?o<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){let r=t.GetBufferIndex(),o=t.GetParticleCount();for(let s=0;s<o;s++){let l=e[s];l.list=l,l.next=null,l.count=1,l.index=s+r}}MergeParticleListsInContact(t,e){let r=t.GetBufferIndex();for(let o=0;o<this.m_contactBuffer.count;o++){let s=this.m_contactBuffer.data[o],l=s.indexA,a=s.indexB;if(!t.ContainsParticle(l)||!t.ContainsParticle(a))continue;let c=e[l-r].list,u=e[a-r].list;if(c!==u){if(c.count<u.count){let m=c;c=u,u=m}i.MergeParticleLists(c,u)}}}static MergeParticleLists(t,e){for(let r=e;;){r.list=t;let o=r.next;if(o)r=o;else{r.next=t.next;break}}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){let r=t.GetParticleCount(),o=e[0];for(let s=0;s<r;s++){let l=e[s];o.count<l.count&&(o=l)}return o}MergeZombieParticleListNodes(t,e,r){let o=t.GetParticleCount();for(let s=0;s<o;s++){let l=e[s];l!==r&&this.m_flagsBuffer.data[l.index]&2&&i.MergeParticleListAndNode(r,l)}}static MergeParticleListAndNode(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}CreateParticleGroupsFromParticleList(t,e,r){let o=t.GetParticleCount(),s=new it;s.groupFlags=t.GetGroupFlags(),s.userData=t.GetUserData();for(let l=0;l<o;l++){let a=e[l];if(!a.count||a===r)continue;let c=this.CreateParticleGroup(s);for(let u=a;u;u=u.next){let m=u.index,p=this.CloneParticle(m,c);this.m_flagsBuffer.data[m]|=2,u.index=p}}}UpdatePairsAndTriadsWithParticleList(t,e){let r=t.GetBufferIndex();for(let o=0;o<this.m_pairBuffer.count;o++){let s=this.m_pairBuffer.data[o],l=s.indexA,a=s.indexB;t.ContainsParticle(l)&&(s.indexA=e[l-r].index),t.ContainsParticle(a)&&(s.indexB=e[a-r].index)}for(let o=0;o<this.m_triadBuffer.count;o++){let s=this.m_triadBuffer.data[o],l=s.indexA,a=s.indexB,c=s.indexC;t.ContainsParticle(l)&&(s.indexA=e[l-r].index),t.ContainsParticle(a)&&(s.indexB=e[a-r].index),t.ContainsParticle(c)&&(s.indexC=e[c-r].index)}}ComputeDepth(){let t=[],e=0;for(let l=0;l<this.m_contactBuffer.count;l++){let a=this.m_contactBuffer.data[l],c=a.indexA,u=a.indexB,m=this.m_groupBuffer[c],p=this.m_groupBuffer[u];m&&m===p&&m.m_groupFlags&16&&(t[e++]=a)}let r=[],o=0;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&16){r[o++]=l,this.SetGroupFlags(l,l.m_groupFlags&-17);for(let a=l.m_firstIndex;a<l.m_lastIndex;a++)this.m_accumulationBuffer[a]=0}for(let l=0;l<e;l++){let a=t[l],c=a.indexA,u=a.indexB,m=a.weight;this.m_accumulationBuffer[c]+=m,this.m_accumulationBuffer[u]+=m}for(let l=0;l<o;l++){let a=r[l];for(let c=a.m_firstIndex;c<a.m_lastIndex;c++){let u=this.m_accumulationBuffer[c];this.m_depthBuffer[c]=u<.8?0:tt}}let s=Math.sqrt(this.m_count)>>0;for(let l=0;l<s;l++){let a=!1;for(let c=0;c<e;c++){let u=t[c],m=u.indexA,p=u.indexB,d=1-u.weight,h=this.m_depthBuffer[m],f=this.m_depthBuffer[p],b=f+d,x=h+d;h>b&&(this.m_depthBuffer[m]=b,a=!0),f>x&&(this.m_depthBuffer[p]=x,a=!0)}if(!a)break}for(let l=0;l<o;l++){let a=r[l];for(let c=a.m_firstIndex;c<a.m_lastIndex;c++)this.m_depthBuffer[c]<tt?this.m_depthBuffer[c]*=this.m_particleDiameter:this.m_depthBuffer[c]=0}}GetInsideBoundsEnumerator(t){let e=i.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),r=i.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),o=0,s=this.m_proxyBuffer.count,l=sx(this.m_proxyBuffer.data,o,s,e,zr.CompareProxyTag),a=nx(this.m_proxyBuffer.data,o,s,r,zr.CompareTagProxy);return new Fd(this,e,r,l,a)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e){let r=this.m_flagsBuffer.data,o=this.m_positionBuffer.data,s=n.Subtract(o[e],o[t],i.AddContact_s_d),l=n.Dot(s,s);if(l>0&&l<this.m_squaredDiameter){let a=1/Math.sqrt(l),c=this.m_contactBuffer.data[this.m_contactBuffer.Append()];c.indexA=t,c.indexB=e,c.flags=r[t]|r[e],c.weight=1-l*a*this.m_inverseDiameter,c.normal.x=a*s.x,c.normal.y=a*s.y}}static{this.AddContact_s_d=new n}FindContacts_Reference(){let e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let r=0,o=0;r<e;r++){let s=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,0);for(let c=r+1;c<e&&!(s<this.m_proxyBuffer.data[c].tag);c++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[c].index);let l=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,-1,1);for(;o<e&&!(l<=this.m_proxyBuffer.data[o].tag);o++);let a=i.computeRelativeTag(this.m_proxyBuffer.data[r].tag,1,1);for(let c=o;c<e&&!(a<this.m_proxyBuffer.data[c].tag);c++)this.AddContact(this.m_proxyBuffer.data[r].index,this.m_proxyBuffer.data[c].index)}}FindContacts(){this.FindContacts_Reference()}UpdateProxies_Reference(){let t=this.m_positionBuffer.data,e=this.m_inverseDiameter;for(let r=0;r<this.m_proxyBuffer.count;++r){let o=this.m_proxyBuffer.data[r],s=o.index,l=t[s];o.tag=i.computeTag(e*l.x,e*l.y)}}UpdateProxies(){this.UpdateProxies_Reference()}SortProxies(){tu(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,zr.CompareProxyProxy)}FilterContacts(){let t=this.GetParticleContactFilter();t!==null&&this.m_contactBuffer.RemoveIf(e=>(e.flags&131072)!==0&&!t.ShouldCollideParticleParticle(this,e.indexA,e.indexB))}NotifyContactListenerPreContact(t){if(this.GetParticleContactListener()!==null)throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){let e=this.GetParticleContactListener();if(e!==null){for(let r=0;r<this.m_contactBuffer.count;++r){let o=this.m_contactBuffer.data[r],s=-1;s>=0?t.Invalidate(s):e.BeginContactParticleParticle(this,o)}throw new Error}}static b2ParticleContactIsZombie(t){return(t.flags&2)===2}UpdateContacts(t){this.UpdateProxies(),this.SortProxies();let e=new Gd;this.NotifyContactListenerPreContact(e),this.FindContacts(),this.FilterContacts(),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(i.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(this.GetFixtureContactListener()!==null)throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){let e=this.GetFixtureContactListener();if(e!==null){for(let r=0;r<this.m_bodyContactBuffer.count;r++){let o=this.m_bodyContactBuffer.data[r],s=-1;s>=0?t.Invalidate(s):e.BeginContactFixtureParticle(this,o)}throw new Error}}UpdateBodyContacts(){let t=i.UpdateBodyContacts_s_aabb,e=new Ld;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){let s=this.GetParticleCount();for(let l=0;l<s;l++)this.m_bodyContactCountBuffer.data[l]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[l]+1&&(this.m_consecutiveContactStepsBuffer.data[l]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);let r=t;this.ComputeAABB(r);let o=this.UpdateBodyContacts_callback;o.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(r,s=>o.ReportFixture(s)),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}static{this.UpdateBodyContacts_s_aabb=new lt}Solve(t){let e=i.Solve_s_subStep;if(this.m_count===0||(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&2&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),this.m_paused))return;let{particleIterations:r}=t.config;for(this.m_iterationIndex=0;this.m_iterationIndex<r;this.m_iterationIndex++){++this.m_timestamp;let o=e.Copy(t);o.dt/=r,o.inv_dt*=r,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&16&&this.ComputeDepth(),this.m_allParticleFlags&4096&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(o),this.m_allParticleFlags&32&&this.SolveViscous(),this.m_allParticleFlags&8192&&this.SolveRepulsive(o),this.m_allParticleFlags&64&&this.SolvePowder(o),this.m_allParticleFlags&128&&this.SolveTensile(o),this.m_allGroupFlags&1&&this.SolveSolid(o),this.m_allParticleFlags&256&&this.SolveColorMixing(),this.SolveGravity(o),this.m_allParticleFlags&2048&&this.SolveStaticPressure(o),this.SolvePressure(o),this.SolveDamping(o),this.m_allParticleFlags&i.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&16&&this.SolveElastic(o),this.m_allParticleFlags&8&&this.SolveSpring(o),this.LimitVelocity(o),this.m_allGroupFlags&2&&this.SolveRigidDamping(),this.m_allParticleFlags&1024&&this.SolveBarrier(o),this.SolveCollision(o),this.m_allGroupFlags&2&&this.SolveRigid(o),this.m_allParticleFlags&4&&this.SolveWall();for(let s=0;s<this.m_count;s++)this.m_positionBuffer.data[s].AddScaled(o.dt,this.m_velocityBuffer.data[s])}}static{this.Solve_s_subStep=He.Create()}SolveCollision(t){let e=i.SolveCollision_s_aabb,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=e;s.lowerBound.x=+tt,s.lowerBound.y=+tt,s.upperBound.x=-tt,s.upperBound.y=-tt;for(let a=0;a<this.m_count;a++){let c=o[a],u=r[a],m=u.x+t.dt*c.x,p=u.y+t.dt*c.y;s.lowerBound.x=Math.min(s.lowerBound.x,Math.min(u.x,m)),s.lowerBound.y=Math.min(s.lowerBound.y,Math.min(u.y,p)),s.upperBound.x=Math.max(s.upperBound.x,Math.max(u.x,m)),s.upperBound.y=Math.max(s.upperBound.y,Math.max(u.y,p))}let l=this.SolveCollision_callback;l.m_step=t,this.m_world.QueryAABB(s,a=>l.ReportFixture(a))}static{this.SolveCollision_s_aabb=new lt}LimitVelocity(t){let e=this.m_velocityBuffer.data,r=this.GetCriticalVelocitySquared(t);for(let o=0;o<this.m_count;o++){let s=e[o],l=n.Dot(s,s);l>r&&s.Scale(Math.sqrt(r/l))}}SolveGravity(t){let e=i.SolveGravity_s_gravity,r=this.m_velocityBuffer.data,o=n.Scale(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let s=0;s<this.m_count;s++)r[s].Add(o)}static{this.SolveGravity_s_gravity=new n}SolveBarrier(t){let e=i.SolveBarrier_s_aabb,r=i.SolveBarrier_s_va,o=i.SolveBarrier_s_vb,s=i.SolveBarrier_s_pba,l=i.SolveBarrier_s_vba,a=i.SolveBarrier_s_vc,c=i.SolveBarrier_s_pca,u=i.SolveBarrier_s_vca,m=i.SolveBarrier_s_qba,p=i.SolveBarrier_s_qca,d=i.SolveBarrier_s_dv,h=i.SolveBarrier_s_f,f=this.m_positionBuffer.data,b=this.m_velocityBuffer.data;for(let y=0;y<this.m_count;y++)(this.m_flagsBuffer.data[y]&i.k_barrierWallFlags)!==0&&b[y].SetZero();let x=2.5*t.dt,_=this.GetParticleMass();for(let y=0;y<this.m_pairBuffer.count;y++){let g=this.m_pairBuffer.data[y];if(g.flags&1024){let S=g.indexA,w=g.indexB,B=f[S],C=f[w],A=e;n.Min(B,C,A.lowerBound),n.Max(B,C,A.upperBound);let k=this.m_groupBuffer[S],M=this.m_groupBuffer[w],E=this.GetLinearVelocity(k,S,B,r),L=this.GetLinearVelocity(M,w,C,o),U=n.Subtract(C,B,s),Y=n.Subtract(L,E,l),O=this.GetInsideBoundsEnumerator(A),K;for(;(K=O.GetNext())>=0;){let mt=f[K],at=this.m_groupBuffer[K];if(k!==at&&M!==at){let At=this.GetLinearVelocity(at,K,mt,a),Gt=n.Subtract(mt,B,c),wt=n.Subtract(At,E,u),Ce=n.Cross(Y,wt),Ui=n.Cross(U,wt)-n.Cross(Gt,Y),li=n.Cross(U,Gt),Xt,be,Ze=m,wo=p;if(Ce===0){if(Ui===0||(be=-li/Ui,!(be>=0&&be<x))||(n.AddScaled(U,be,Y,Ze),n.AddScaled(Gt,be,wt,wo),Xt=n.Dot(Ze,wo)/n.Dot(Ze,Ze),!(Xt>=0&&Xt<=1)))continue}else{let Ps=Ui*Ui-4*li*Ce;if(Ps<0)continue;let Ds=Math.sqrt(Ps),ll=(-Ui-Ds)/(2*Ce),al=(-Ui+Ds)/(2*Ce);if(ll>al){let Zx=ll;ll=al,al=Zx}if(be=ll,n.AddScaled(U,be,Y,Ze),n.AddScaled(Gt,be,wt,wo),Xt=n.Dot(Ze,wo)/n.Dot(Ze,Ze),!(be>=0&&be<x&&Xt>=0&&Xt<=1)&&(be=al,!(be>=0&&be<x)||(n.AddScaled(U,be,Y,Ze),n.AddScaled(Gt,be,wt,wo),Xt=n.Dot(Ze,wo)/n.Dot(Ze,Ze),!(Xt>=0&&Xt<=1))))continue}let nl=d;nl.x=E.x+Xt*Y.x-At.x,nl.y=E.y+Xt*Y.y-At.y;let Au=n.Scale(_,nl,h);if(at&&this.IsRigidGroup(at)){let Ps=at.GetMass(),Ds=at.GetInertia();Ps>0&&at.m_linearVelocity.AddScaled(1/Ps,Au),Ds>0&&(at.m_angularVelocity+=n.Cross(n.Subtract(mt,at.GetCenter(),n.s_t0),Au)/Ds)}else b[K].Add(nl);this.ParticleApplyForce(K,Au.Scale(-t.inv_dt))}}}}}static{this.SolveBarrier_s_aabb=new lt}static{this.SolveBarrier_s_va=new n}static{this.SolveBarrier_s_vb=new n}static{this.SolveBarrier_s_pba=new n}static{this.SolveBarrier_s_vba=new n}static{this.SolveBarrier_s_vc=new n}static{this.SolveBarrier_s_pca=new n}static{this.SolveBarrier_s_vca=new n}static{this.SolveBarrier_s_qba=new n}static{this.SolveBarrier_s_qca=new n}static{this.SolveBarrier_s_dv=new n}static{this.SolveBarrier_s_f=new n}SolveStaticPressure(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);let e=this.GetCriticalPressure(t),r=this.m_def.staticPressureStrength*e,o=.25*e,s=this.m_def.staticPressureRelaxation;for(let l=0;l<this.m_def.staticPressureIterations;l++){for(let a=0;a<this.m_count;a++)this.m_accumulationBuffer[a]=0;for(let a=0;a<this.m_contactBuffer.count;a++){let c=this.m_contactBuffer.data[a];if(c.flags&2048){let u=c.indexA,m=c.indexB,p=c.weight;this.m_accumulationBuffer[u]+=p*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=p*this.m_staticPressureBuffer[u]}}for(let a=0;a<this.m_count;a++){let c=this.m_weightBuffer[a];if(this.m_flagsBuffer.data[a]&2048){let m=(this.m_accumulationBuffer[a]+r*(c-1))/(c+s);this.m_staticPressureBuffer[a]=et(m,0,o)}else this.m_staticPressureBuffer[a]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t],r=e.index,o=e.weight;this.m_weightBuffer[r]+=o}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t],r=e.indexA,o=e.indexB,s=e.weight;this.m_weightBuffer[r]+=s,this.m_weightBuffer[o]+=s}}SolvePressure(t){let e=i.SolvePressure_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=this.GetCriticalPressure(t),l=this.m_def.pressureStrength*s,a=.25*s;for(let m=0;m<this.m_count;m++){let p=this.m_weightBuffer[m],d=l*Math.max(0,p-1);this.m_accumulationBuffer[m]=Math.min(d,a)}if(this.m_allParticleFlags&i.k_noPressureFlags)for(let m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&i.k_noPressureFlags&&(this.m_accumulationBuffer[m]=0);if(this.m_allParticleFlags&2048)for(let m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&2048&&(this.m_accumulationBuffer[m]+=this.m_staticPressureBuffer[m]);let c=t.dt/(this.m_def.density*this.m_particleDiameter),u=this.GetParticleInvMass();for(let m=0;m<this.m_bodyContactBuffer.count;m++){let p=this.m_bodyContactBuffer.data[m],d=p.index,h=p.body,f=p.weight,b=p.mass,x=p.normal,_=r[d],y=this.m_accumulationBuffer[d]+l*f,g=n.Scale(c*f*b*y,x,e);o[d].SubtractScaled(u,g),h.ApplyLinearImpulse(g,_,!0)}for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m],d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=this.m_accumulationBuffer[d]+this.m_accumulationBuffer[h],_=n.Scale(c*f*x,b,e);o[d].Subtract(_),o[h].Add(_)}}static{this.SolvePressure_s_f=new n}SolveDamping(t){let e=i.SolveDamping_s_v,r=i.SolveDamping_s_f,o=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,l=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),c=this.GetParticleInvMass();for(let u=0;u<this.m_bodyContactBuffer.count;u++){let m=this.m_bodyContactBuffer.data[u],p=m.index,d=m.body,h=m.weight,f=m.mass,b=m.normal,x=o[p],_=n.Subtract(d.GetLinearVelocityFromWorldPoint(x,n.s_t0),s[p],e),y=n.Dot(_,b);if(y<0){let g=Math.max(l*h,Math.min(-a*y,.5)),S=n.Scale(g*f*y,b,r);s[p].AddScaled(c,S),d.ApplyLinearImpulse(S.Negate(),x,!0)}}for(let u=0;u<this.m_contactBuffer.count;u++){let m=this.m_contactBuffer.data[u],p=m.indexA,d=m.indexB,h=m.weight,f=m.normal,b=n.Subtract(s[d],s[p],e),x=n.Dot(b,f);if(x<0){let _=Math.max(l*h,Math.min(-a*x,.5)),y=n.Scale(_*x,f,r);s[p].Add(y),s[d].Subtract(y)}}}static{this.SolveDamping_s_v=new n}static{this.SolveDamping_s_f=new n}SolveRigidDamping(){let t=i.SolveRigidDamping_s_t0,e=i.SolveRigidDamping_s_t1,r=i.SolveRigidDamping_s_p,o=i.SolveRigidDamping_s_v,s=[0],l=[0],a=[0],c=[0],u=[0],m=[0],p=this.m_positionBuffer.data,d=this.m_def.dampingStrength;for(let h=0;h<this.m_bodyContactBuffer.count;h++){let f=this.m_bodyContactBuffer.data[h],b=f.index,x=this.m_groupBuffer[b];if(x&&this.IsRigidGroup(x)){let _=f.body,y=f.normal,g=f.weight,S=p[b],w=n.Subtract(_.GetLinearVelocityFromWorldPoint(S,t),x.GetLinearVelocityFromWorldPoint(S,e),o),B=n.Dot(w,y);if(B<0){this.InitDampingParameterWithRigidGroupOrParticle(s,l,a,!0,x,b,S,y),this.InitDampingParameter(c,u,m,_.GetMass(),_.GetInertia()-_.GetMass()*_.GetLocalCenter().LengthSquared(),_.GetWorldCenter(),S,y);let C=d*Math.min(g,1)*this.ComputeDampingImpulse(s[0],l[0],a[0],c[0],u[0],m[0],B);this.ApplyDamping(s[0],l[0],a[0],!0,x,b,C,y),_.ApplyLinearImpulse(n.Scale(-C,y,n.s_t0),S,!0)}}}for(let h=0;h<this.m_contactBuffer.count;h++){let f=this.m_contactBuffer.data[h],b=f.indexA,x=f.indexB,_=f.normal,y=f.weight,g=this.m_groupBuffer[b],S=this.m_groupBuffer[x],w=this.IsRigidGroup(g),B=this.IsRigidGroup(S);if(g!==S&&(w||B)){let C=n.Mid(p[b],p[x],r),A=n.Subtract(this.GetLinearVelocity(S,x,C,t),this.GetLinearVelocity(g,b,C,e),o),k=n.Dot(A,_);if(k<0){this.InitDampingParameterWithRigidGroupOrParticle(s,l,a,w,g,b,C,_),this.InitDampingParameterWithRigidGroupOrParticle(c,u,m,B,S,x,C,_);let M=d*y*this.ComputeDampingImpulse(s[0],l[0],a[0],c[0],u[0],m[0],k);this.ApplyDamping(s[0],l[0],a[0],w,g,b,M,_),this.ApplyDamping(c[0],u[0],m[0],B,S,x,-M,_)}}}}static{this.SolveRigidDamping_s_t0=new n}static{this.SolveRigidDamping_s_t1=new n}static{this.SolveRigidDamping_s_p=new n}static{this.SolveRigidDamping_s_v=new n}SolveExtraDamping(){let t=i.SolveExtraDamping_s_v,e=i.SolveExtraDamping_s_f,r=this.m_velocityBuffer.data,o=this.m_positionBuffer.data,s=this.GetParticleInvMass();for(let l=0;l<this.m_bodyContactBuffer.count;l++){let a=this.m_bodyContactBuffer.data[l],c=a.index;if(this.m_flagsBuffer.data[c]&i.k_extraDampingFlags){let u=a.body,m=a.mass,p=a.normal,d=o[c],h=n.Subtract(u.GetLinearVelocityFromWorldPoint(d,n.s_t0),r[c],t),f=n.Dot(h,p);if(f<0){let b=n.Scale(.5*m*f,p,e);r[c].AddScaled(s,b),u.ApplyLinearImpulse(b.Negate(),d,!0)}}}}static{this.SolveExtraDamping_s_v=new n}static{this.SolveExtraDamping_s_f=new n}SolveWall(){let t=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&4&&t[e].SetZero()}SolveRigid(t){let e=i.SolveRigid_s_position,r=i.SolveRigid_s_rotation,o=i.SolveRigid_s_transform,s=i.SolveRigid_s_velocityTransform,l=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let c=this.m_groupList;c;c=c.GetNext())if(c.m_groupFlags&2){c.UpdateStatistics();let u=r;u.Set(t.dt*c.m_angularVelocity);let m=n.Add(c.m_center,n.Subtract(n.Scale(t.dt,c.m_linearVelocity,n.s_t0),D.MultiplyVec2(u,c.m_center,n.s_t1),n.s_t0),e),p=o;p.SetPositionRotation(m,u),T.Multiply(p,c.m_transform,c.m_transform);let d=s;d.p.x=t.inv_dt*p.p.x,d.p.y=t.inv_dt*p.p.y,d.q.s=t.inv_dt*p.q.s,d.q.c=t.inv_dt*(p.q.c-1);for(let h=c.m_firstIndex;h<c.m_lastIndex;h++)T.MultiplyVec2(d,l[h],a[h])}}static{this.SolveRigid_s_position=new n}static{this.SolveRigid_s_rotation=new D}static{this.SolveRigid_s_transform=new T}static{this.SolveRigid_s_velocityTransform=new T}SolveElastic(t){let e=i.SolveElastic_s_pa,r=i.SolveElastic_s_pb,o=i.SolveElastic_s_pc,s=i.SolveElastic_s_r,l=i.SolveElastic_s_t0,a=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,u=t.inv_dt*this.m_def.elasticStrength;for(let m=0;m<this.m_triadBuffer.count;m++){let p=this.m_triadBuffer.data[m];if(p.flags&16){let d=p.indexA,h=p.indexB,f=p.indexC,b=p.pa,x=p.pb,_=p.pc,y=e.Copy(a[d]),g=r.Copy(a[h]),S=o.Copy(a[f]),w=c[d],B=c[h],C=c[f];y.AddScaled(t.dt,w),g.AddScaled(t.dt,B),S.AddScaled(t.dt,C);let A=(y.x+g.x+S.x)/3,k=(y.y+g.y+S.y)/3;y.x-=A,y.y-=k,g.x-=A,g.y-=k,S.x-=A,S.y-=k;let M=s;M.s=n.Cross(b,y)+n.Cross(x,g)+n.Cross(_,S),M.c=n.Dot(b,y)+n.Dot(x,g)+n.Dot(_,S);let E=M.s*M.s+M.c*M.c,L=1/Math.sqrt(E);Number.isFinite(L)||(L=198177537e11),M.s*=L,M.c*=L;let U=u*p.strength;D.MultiplyVec2(M,b,l),n.Subtract(l,y,l),n.Scale(U,l,l),w.Add(l),D.MultiplyVec2(M,x,l),n.Subtract(l,g,l),n.Scale(U,l,l),B.Add(l),D.MultiplyVec2(M,_,l),n.Subtract(l,S,l),n.Scale(U,l,l),C.Add(l)}}}static{this.SolveElastic_s_pa=new n}static{this.SolveElastic_s_pb=new n}static{this.SolveElastic_s_pc=new n}static{this.SolveElastic_s_r=new D}static{this.SolveElastic_s_t0=new n}SolveSpring(t){let e=i.SolveSpring_s_pa,r=i.SolveSpring_s_pb,o=i.SolveSpring_s_d,s=i.SolveSpring_s_f,l=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,c=t.inv_dt*this.m_def.springStrength;for(let u=0;u<this.m_pairBuffer.count;u++){let m=this.m_pairBuffer.data[u];if(m.flags&8){let p=m.indexA,d=m.indexB,h=e.Copy(l[p]),f=r.Copy(l[d]),b=a[p],x=a[d];h.AddScaled(t.dt,b),f.AddScaled(t.dt,x);let _=n.Subtract(f,h,o),y=m.distance,g=_.Length(),S=c*m.strength,w=n.Scale(S*(y-g)/g,_,s);b.Subtract(w),x.Add(w)}}}static{this.SolveSpring_s_pa=new n}static{this.SolveSpring_s_pb=new n}static{this.SolveSpring_s_d=new n}static{this.SolveSpring_s_f=new n}SolveTensile(t){let e=i.SolveTensile_s_weightedNormal,r=i.SolveTensile_s_s,o=i.SolveTensile_s_f,s=this.m_velocityBuffer.data;for(let m=0;m<this.m_count;m++)this.m_accumulation2Buffer[m]=new n,this.m_accumulation2Buffer[m].SetZero();for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m];if(p.flags&128){let d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=n.Scale((1-f)*f,b,e);this.m_accumulation2Buffer[d].Subtract(x),this.m_accumulation2Buffer[h].Add(x)}}let l=this.GetCriticalVelocity(t),a=this.m_def.surfaceTensionPressureStrength*l,c=this.m_def.surfaceTensionNormalStrength*l,u=.5*l;for(let m=0;m<this.m_contactBuffer.count;m++){let p=this.m_contactBuffer.data[m];if(p.flags&128){let d=p.indexA,h=p.indexB,f=p.weight,b=p.normal,x=this.m_weightBuffer[d]+this.m_weightBuffer[h],_=n.Subtract(this.m_accumulation2Buffer[h],this.m_accumulation2Buffer[d],r),y=Math.min(a*(x-2)+c*n.Dot(_,b),u)*f,g=n.Scale(y,b,o);s[d].Subtract(g),s[h].Add(g)}}}static{this.SolveTensile_s_weightedNormal=new n}static{this.SolveTensile_s_s=new n}static{this.SolveTensile_s_f=new n}SolveViscous(){let t=i.SolveViscous_s_v,e=i.SolveViscous_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,{viscousStrength:s}=this.m_def,l=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){let c=this.m_bodyContactBuffer.data[a],u=c.index;if(this.m_flagsBuffer.data[u]&32){let m=c.body,p=c.weight,d=c.mass,h=r[u],f=n.Subtract(m.GetLinearVelocityFromWorldPoint(h,n.s_t0),o[u],t),b=n.Scale(s*d*p,f,e);o[u].AddScaled(l,b),m.ApplyLinearImpulse(b.Negate(),h,!0)}}for(let a=0;a<this.m_contactBuffer.count;a++){let c=this.m_contactBuffer.data[a];if(c.flags&32){let u=c.indexA,m=c.indexB,p=c.weight,d=n.Subtract(o[m],o[u],t),h=n.Scale(s*p,d,e);o[u].Add(h),o[m].Subtract(h)}}}static{this.SolveViscous_s_v=new n}static{this.SolveViscous_s_f=new n}SolveRepulsive(t){let e=i.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,o=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s];if(l.flags&8192){let a=l.indexA,c=l.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[c]){let u=l.weight,m=l.normal,p=n.Scale(o*u,m,e);r[a].Subtract(p),r[c].Add(p)}}}}static{this.SolveRepulsive_s_f=new n}SolvePowder(t){let e=i.SolvePowder_s_f,r=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=this.m_def.powderStrength*this.GetCriticalVelocity(t),l=1-.75,a=this.GetParticleInvMass();for(let c=0;c<this.m_bodyContactBuffer.count;c++){let u=this.m_bodyContactBuffer.data[c],m=u.index;if(this.m_flagsBuffer.data[m]&64){let p=u.weight;if(p>l){let d=u.body,h=u.mass,f=r[m],b=u.normal,x=n.Scale(s*h*(p-l),b,e);o[m].SubtractScaled(a,x),d.ApplyLinearImpulse(x,f,!0)}}}for(let c=0;c<this.m_contactBuffer.count;c++){let u=this.m_contactBuffer.data[c];if(u.flags&64){let m=u.weight;if(m>l){let p=u.indexA,d=u.indexB,h=u.normal,f=n.Scale(s*(m-l),h,e);o[p].Subtract(f),o[d].Add(f)}}}}static{this.SolvePowder_s_f=new n}SolveSolid(t){let e=i.SolveSolid_s_f,r=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);let o=t.inv_dt*this.m_def.ejectionStrength;for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s],a=l.indexA,c=l.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[c]){let u=l.weight,m=l.normal,p=this.m_depthBuffer[a]+this.m_depthBuffer[c],d=n.Scale(o*p*u,m,e);r[a].Subtract(d),r[c].Add(d)}}}static{this.SolveSolid_s_f=new n}SolveForce(t){let e=this.m_velocityBuffer.data,r=t.dt*this.GetParticleInvMass();for(let o=0;o<this.m_count;o++)e[o].AddScaled(r,this.m_forceBuffer[o]);this.m_hasForce=!1}SolveColorMixing(){let t=.5*this.m_def.colorMixingStrength;if(t)for(let e=0;e<this.m_contactBuffer.count;e++){let r=this.m_contactBuffer.data[e],o=r.indexA,s=r.indexB;if(this.m_flagsBuffer.data[o]&this.m_flagsBuffer.data[s]&256){let l=this.m_colorBuffer.data[o],a=this.m_colorBuffer.data[s];F.MixColors(l,a,t)}}}SolveZombie(){let t=0,e=[];for(let l=0;l<this.m_count;l++)e[l]=-1;let r=0,o=this.m_world.GetDestructionListener();for(let l=0;l<this.m_count;l++){let a=this.m_flagsBuffer.data[l];if(a&2){if(a&512&&o?.SayGoodbyeParticle(this,l),this.m_handleIndexBuffer.data){let c=this.m_handleIndexBuffer.data[l];c&&(c.SetIndex(-1),this.m_handleIndexBuffer.data[l]=null)}e[l]=-1}else{if(e[l]=t,l!==t){if(this.m_handleIndexBuffer.data){let c=this.m_handleIndexBuffer.data[l];c&&c.SetIndex(t),this.m_handleIndexBuffer.data[t]=c}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[l],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[l]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[l]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[l]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[l]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[l]),this.m_groupBuffer[t]=this.m_groupBuffer[l],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[l]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[l]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[l]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[l]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[l]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[l])}t++,r|=a}}let s={IsProxyInvalid:l=>l.index<0,IsContactInvalid:l=>l.indexA<0||l.indexB<0,IsBodyContactInvalid:l=>l.index<0,IsPairInvalid:l=>l.indexA<0||l.indexB<0,IsTriadInvalid:l=>l.indexA<0||l.indexB<0||l.indexC<0};for(let l=0;l<this.m_proxyBuffer.count;l++){let a=this.m_proxyBuffer.data[l];a.index=e[a.index]}this.m_proxyBuffer.RemoveIf(s.IsProxyInvalid);for(let l=0;l<this.m_contactBuffer.count;l++){let a=this.m_contactBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB]}this.m_contactBuffer.RemoveIf(s.IsContactInvalid);for(let l=0;l<this.m_bodyContactBuffer.count;l++){let a=this.m_bodyContactBuffer.data[l];a.index=e[a.index]}this.m_bodyContactBuffer.RemoveIf(s.IsBodyContactInvalid);for(let l=0;l<this.m_pairBuffer.count;l++){let a=this.m_pairBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB]}this.m_pairBuffer.RemoveIf(s.IsPairInvalid);for(let l=0;l<this.m_triadBuffer.count;l++){let a=this.m_triadBuffer.data[l];a.indexA=e[a.indexA],a.indexB=e[a.indexB],a.indexC=e[a.indexC]}if(this.m_triadBuffer.RemoveIf(s.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data){let l=0;for(let a=0;a<this.m_count;a++){let c=e[this.m_indexByExpirationTimeBuffer.data[a]];c!==-1&&(this.m_indexByExpirationTimeBuffer.data[l++]=c)}}for(let l=this.m_groupList;l;l=l.GetNext()){let a=t,c=0,u=!1;for(let m=l.m_firstIndex;m<l.m_lastIndex;m++){let p=e[m];p>=0?(a=Math.min(a,p),c=Math.max(c,p+1)):u=!0}a<c?(l.m_firstIndex=a,l.m_lastIndex=c,u&&l.m_groupFlags&1&&this.SetGroupFlags(l,l.m_groupFlags|16)):(l.m_firstIndex=0,l.m_lastIndex=0,l.m_groupFlags&4||this.SetGroupFlags(l,l.m_groupFlags|8))}this.m_count=t,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(let l=this.m_groupList;l;){let a=l.GetNext();l.m_groupFlags&8&&this.DestroyParticleGroup(l),l=a}}SolveLifetimes(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);let e=this.GetQuantizedTimeElapsed(),r=this.m_expirationTimeBuffer.data,o=this.m_indexByExpirationTimeBuffer.data,s=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(tu(o,0,s,(l,a)=>{let c=r[l],u=r[a],m=c<=0,p=u<=0;return m===p?c>u:m}),this.m_expirationTimeBufferRequiresSorting=!1);for(let l=s-1;l>=0;--l){let a=o[l],c=r[a];if(e<c||c<=0)break;this.DestroyParticle(a)}}RotateBuffer(t,e,r){if(t===e||e===r)return;function o(s){return s<t?s:s<e?s+r-e:s<r?s+t-e:s}if(Ie(this.m_flagsBuffer.data,t,e,r),this.m_lastBodyContactStepBuffer.data&&Ie(this.m_lastBodyContactStepBuffer.data,t,e,r),this.m_bodyContactCountBuffer.data&&Ie(this.m_bodyContactCountBuffer.data,t,e,r),this.m_consecutiveContactStepsBuffer.data&&Ie(this.m_consecutiveContactStepsBuffer.data,t,e,r),Ie(this.m_positionBuffer.data,t,e,r),Ie(this.m_velocityBuffer.data,t,e,r),Ie(this.m_groupBuffer,t,e,r),this.m_hasForce&&Ie(this.m_forceBuffer,t,e,r),this.m_staticPressureBuffer&&Ie(this.m_staticPressureBuffer,t,e,r),this.m_depthBuffer&&Ie(this.m_depthBuffer,t,e,r),this.m_colorBuffer.data&&Ie(this.m_colorBuffer.data,t,e,r),this.m_userDataBuffer.data&&Ie(this.m_userDataBuffer.data,t,e,r),this.m_handleIndexBuffer.data){Ie(this.m_handleIndexBuffer.data,t,e,r);for(let s=t;s<r;++s){let l=this.m_handleIndexBuffer.data[s];l&&l.SetIndex(o(l.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Ie(this.m_expirationTimeBuffer.data,t,e,r);let s=this.GetParticleCount(),l=this.m_indexByExpirationTimeBuffer.data;for(let a=0;a<s;++a)l[a]=o(l[a])}for(let s=0;s<this.m_proxyBuffer.count;s++){let l=this.m_proxyBuffer.data[s];l.index=o(l.index)}for(let s=0;s<this.m_contactBuffer.count;s++){let l=this.m_contactBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB)}for(let s=0;s<this.m_bodyContactBuffer.count;s++){let l=this.m_bodyContactBuffer.data[s];l.index=o(l.index)}for(let s=0;s<this.m_pairBuffer.count;s++){let l=this.m_pairBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB)}for(let s=0;s<this.m_triadBuffer.count;s++){let l=this.m_triadBuffer.data[s];l.indexA=o(l.indexA),l.indexB=o(l.indexB),l.indexC=o(l.indexC)}for(let s=this.m_groupList;s;s=s.GetNext())s.m_firstIndex=o(s.m_firstIndex),s.m_lastIndex=o(s.m_lastIndex-1)+1}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){let e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return .75*this.m_particleDiameter}GetParticleMass(){let t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){let t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&65536?this.m_world.GetContactManager().m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&131072?this.m_world.GetContactManager().m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&16384?this.m_world.GetContactManager().m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&32768?this.m_world.GetContactManager().m_contactListener:null}SetUserOverridableBuffer(t,e){t.data=e,t.userSuppliedCapacity=e.length}SetGroupFlags(t,e){let r=t.m_groupFlags;(r^e)&1&&(e|=16),r&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&1&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}RemoveSpuriousBodyContacts(){tu(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,i.BodyContactCompare);let t=i.RemoveSpuriousBodyContacts_s_n,e=i.RemoveSpuriousBodyContacts_s_pos,r=i.RemoveSpuriousBodyContacts_s_normal,o=3,s=-1,l=0,a=c=>{if(c.index!==s&&(l=0,s=c.index),l++>o)return!0;let u=t.Copy(c.normal);u.Scale(this.m_particleDiameter*(1-c.weight));let m=n.Add(this.m_positionBuffer.data[c.index],u,e);if(!c.fixture.TestPoint(m)){let p=c.fixture.GetShape().GetChildCount();for(let d=0;d<p;d++){let h=r;if(qc(c.fixture.GetShape(),c.fixture.GetBody().GetTransform(),m,h,d)<Z)return!1}return!0}return!1};this.m_bodyContactBuffer.count=ax(this.m_bodyContactBuffer.data,a,this.m_bodyContactBuffer.count)}static{this.RemoveSpuriousBodyContacts_s_n=new n}static{this.RemoveSpuriousBodyContacts_s_pos=new n}static{this.RemoveSpuriousBodyContacts_s_normal=new n}DetectStuckParticle(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],this.m_bodyContactCountBuffer.data[t]===2&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==-1}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(t){return!(t&4)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(t){return t!==null&&(t.m_groupFlags&2)!==0}GetLinearVelocity(t,e,r,o){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(r,o):o.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,r,o,s,l,a,c){t[0]=o>0?1/o:0,e[0]=s>0?1/s:0,r[0]=n.Cross(n.Subtract(a,l,n.s_t0),c)}InitDampingParameterWithRigidGroupOrParticle(t,e,r,o,s,l,a,c){if(s&&o)this.InitDampingParameter(t,e,r,s.GetMass(),s.GetInertia(),s.GetCenter(),a,c);else{let u=this.m_flagsBuffer.data[l];this.InitDampingParameter(t,e,r,u&4?0:this.GetParticleMass(),0,a,a,c)}}ComputeDampingImpulse(t,e,r,o,s,l,a){let c=t+e*r*r+o+s*l*l;return c>0?a/c:0}ApplyDamping(t,e,r,o,s,l,a,c){s&&o?(s.m_linearVelocity.AddScaled(a*t,c),s.m_angularVelocity+=a*r*e):this.m_velocityBuffer.data[l].AddScaled(a*t,c)}},zr=class{constructor(){this.index=-1;this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}},Fd=class{constructor(t,e,r,o,s){this.m_system=t,this.m_xLower=(e&or.xMask)>>>0,this.m_xUpper=(r&or.xMask)>>>0,this.m_yLower=(e&or.yMask)>>>0,this.m_yUpper=(r&or.yMask)>>>0,this.m_first=o,this.m_last=s}GetNext(){for(;this.m_first<this.m_last;){let t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&or.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1}},Id=class{constructor(){this.next=null;this.count=0;this.index=0}},eu=class{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}};var Ld=class extends eu{Initialize(t,e){}Find(t){return-1}};var Gd=class extends eu{Initialize(t,e){}Find(t){return-1}},Un=class{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,r){return!0}},Vd=class extends Un{constructor(e){super();this.m_threshold=0;this.m_threshold=e}ShouldCreatePair(e,r){return e<this.m_threshold&&this.m_threshold<=r||r<this.m_threshold&&this.m_threshold<=e}ShouldCreateTriad(e,r,o){return(e<this.m_threshold||r<this.m_threshold||o<this.m_threshold)&&(this.m_threshold<=e||this.m_threshold<=r||this.m_threshold<=o)}},Ed=class extends ii{constructor(e,r=e.length){super(-1,0);this.m_shapeCount=0;this.m_shapes=e,this.m_shapeCount=r}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(e,r){for(let o=0;o<this.m_shapeCount;o++)if(this.m_shapes[o].TestPoint(e,r))return!0;return!1}RayCast(e,r,o,s){return!1}ComputeAABB(e,r,o){let s=new lt;e.lowerBound.x=+tt,e.lowerBound.y=+tt,e.upperBound.x=-tt,e.upperBound.y=-tt;for(let l=0;l<this.m_shapeCount;l++){let a=this.m_shapes[l].GetChildCount();for(let c=0;c<a;c++){let u=s;this.m_shapes[l].ComputeAABB(u,r,c),e.Combine1(u)}}}ComputeMass(e,r){}SetupDistanceProxy(e,r){}Draw(){}},Ud=class extends Un{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(t){return(this.m_flagsBuffer.data[t]&4096)!==0}};Ii(Oe,{Create(i,t){let e=i(t);return e.m_particleSystemList=null,e}});function FC(i){let t=tt;for(let e=i.GetParticleSystemList();e!==null;e=e.m_next)t=Math.min(t,e.GetRadius());return t}Object.assign(Oe.prototype,{CreateParticleSystem(i){N(!this.IsLocked());let t=new or(i,this);return t.m_prev=null,t.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=t),this.m_particleSystemList=t,t},DestroyParticleSystem(i){N(!this.IsLocked()),i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i===this.m_particleSystemList&&(this.m_particleSystemList=i.m_next)},GetParticleSystemList(){return this.m_particleSystemList},CalculateReasonableParticleIterations(i){return this.m_particleSystemList===null?1:Oc(this.GetGravity().Length(),FC(this),i)}});Ii(Oe.prototype,{CreateBody(i,t={}){let e=i(t);return e.m_xf0=new T,e},Solve(i,t){for(let e=this.m_particleSystemList;e;e=e.m_next)e.Solve(t);for(let e=this.GetBodyList();e;e=e.GetNext())e.m_xf0.Copy(e.GetTransform());i(t)}});Ii(ho.prototype,{SetTransformXY(i,t,e,r){i(t,e,r),this.m_xf0.Copy(this.GetTransform())}});Object.assign(Li.prototype,{SayGoodbyeParticleGroup(){},SayGoodbyeParticle(){}});Object.assign(Gr.prototype,{SayGoodbyeParticleGroup(){return!0},SayGoodbyeParticle(){return!0}});Object.assign(Vr.prototype,{BeginContactFixtureParticle(){},EndContactFixtureParticle(){},BeginContactParticleParticle(){},EndContactParticleParticle(){}});Ii(He,{Create(i){let t=i();return t.config.particleIterations=0,t}});function IC(i,t){let e=t.GetParticleCount();if(e){let r=t.GetRadius(),o=t.GetPositionBuffer();if(t.m_colorBuffer.data){let s=t.GetColorBuffer();i.DrawParticles(o,r,s,e)}else i.DrawParticles(o,r,null,e)}}function cx(i,t){for(let e=t.GetParticleSystemList();e;e=e.m_next)IC(i,e)}var Le=()=>{},ou=class{constructor(){this.m_testIndex=0;this.m_windowWidth=1600;this.m_windowHeight=900;this.m_hertz=60;this.m_velocityIterations=8;this.m_positionIterations=3;this.m_particleIterations=Oc(10,.04,1/this.m_hertz);this.m_drawShapes=!0;this.m_drawParticles=!0;this.m_drawJoints=!0;this.m_drawAABBs=!1;this.m_drawContactPoints=!1;this.m_drawContactNormals=!1;this.m_drawContactImpulse=!1;this.m_drawFrictionImpulse=!1;this.m_drawCOMs=!1;this.m_drawControllers=!0;this.m_drawStats=!1;this.m_drawInputHelp=!0;this.m_drawFpsMeter=!0;this.m_drawProfile=!1;this.m_enableWarmStarting=!0;this.m_enableContinuous=!0;this.m_enableSubStepping=!1;this.m_enableSleep=!0;this.m_pause=!1;this.m_singleStep=!1;this.m_debugDraw={Prepare:Le,Finish:Le,PushTransform:Le,PopTransform:Le,DrawPolygon:Le,DrawSolidPolygon:Le,DrawCircle:Le,DrawSolidCircle:Le,DrawSegment:Le,DrawTransform:Le,DrawPoint:Le,DrawParticles:Le,DrawAABB:Le,DrawStringWorld:Le}}};Ii(Oe,{Create(i,t){let e=i(t);return e.m_controllerList=null,e.m_controllerCount=0,e}});Object.assign(Oe.prototype,{AddController(i){return i.m_next=this.m_controllerList,i.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=i),this.m_controllerList=i,++this.m_controllerCount,i},RemoveController(i){return i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),this.m_controllerList===i&&(this.m_controllerList=i.m_next),--this.m_controllerCount,i.m_prev=null,i.m_next=null,i}});Ii(Oe.prototype,{CreateBody(i,t={}){let e=i(t);return e.m_controllerList=null,e.m_controllerCount=0,e},DestroyBody(i,t){let e=t.m_controllerList;for(;e;){let r=e;e=e.nextController,r.controller.RemoveBody(t)}i(t)},Solve(i,t){for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);i(t)}});var Yd=class{constructor(t,e){this.prevBody=null;this.nextBody=null;this.prevController=null;this.nextController=null;this.controller=t,this.body=e}},jr=class{constructor(){this.m_bodyList=null;this.m_bodyCount=0;this.m_prev=null;this.m_next=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(t){let e=new Yd(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}RemoveBody(t){N(this.m_bodyCount>0,"Controller is empty");let e=this.m_bodyList;for(;e&&e.body!==t;)e=e.nextBody;N(e!==null,"Body is not attached to the controller"),e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}};var LC=new n,GC=new ke,VC=new n,EC=new n,UC=new n;function YC(i,t,e,r,o){let s=i,l=D.TransposeMultiplyVec2(r.q,t,LC),a=e-n.Dot(t,r.p),c=[],u=0,m=-1,p=-1,d=!1;for(let A=0;A<s.m_count;++A){c[A]=n.Dot(l,s.m_vertices[A])-a;let k=c[A]<-gt;A>0&&(k?d||(m=A-1,u++):d&&(p=A-1,u++)),d=k}switch(u){case 0:if(d){let A=GC;return s.ComputeMass(A,1),T.MultiplyVec2(r,A.center,o),A.mass}return 0;case 1:m===-1?m=s.m_count-1:p=s.m_count-1;break}let h=(m+1)%s.m_count,f=(p+1)%s.m_count,b=(0-c[m])/(c[h]-c[m]),x=(0-c[p])/(c[f]-c[p]),_=VC.Set(s.m_vertices[m].x*(1-b)+s.m_vertices[h].x*b,s.m_vertices[m].y*(1-b)+s.m_vertices[h].y*b),y=EC.Set(s.m_vertices[p].x*(1-x)+s.m_vertices[f].x*x,s.m_vertices[p].y*(1-x)+s.m_vertices[f].y*x),g=0,S=UC.SetZero(),w=s.m_vertices[h],B,C=h;for(;C!==f;){C=(C+1)%s.m_count,C===f?B=y:B=s.m_vertices[C];let A=.5*((w.x-_.x)*(B.y-_.y)-(w.y-_.y)*(B.x-_.x));g+=A,S.x+=A*(_.x+w.x+B.x)/3,S.y+=A*(_.y+w.y+B.y)/3,w=B}return S.Scale(1/g),T.MultiplyVec2(r,S,o),g}function JC(i,t,e,r,o){return o.SetZero(),0}function zC(i,t,e,r,o){return o.SetZero(),0}function jC(i,t,e,r,o){let s=i,l=T.MultiplyVec2(r,s.m_p,new n),a=-(n.Dot(t,l)-e);if(a<-s.m_radius+gt)return 0;if(a>s.m_radius)return o.Copy(l),Math.PI*s.m_radius*s.m_radius;let c=s.m_radius*s.m_radius,u=a*a,m=c*(Math.asin(a/s.m_radius)+Math.PI/2)+a*Math.sqrt(c-u),p=-2/3*(c-u)**1.5/m;return o.x=l.x+t.x*p,o.y=l.y+t.y*p,m}var Yn=[];Yn[0]=jC;Yn[1]=JC;Yn[2]=YC;Yn[3]=zC;function ux(i,t,e,r,o){let s=Yn[i.GetType()];return s?s(i,t,e,r,o):0}var XC={buoyancyForce:new n},_s=class extends jr{constructor(){super(...arguments);this.normal=new n(0,1);this.offset=0;this.density=0;this.velocity=new n;this.linearDrag=0;this.angularDrag=0;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=new n}Step(e){if(!this.m_bodyList)return;this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());let{buoyancyForce:r}=XC;for(let o=this.m_bodyList;o;o=o.nextBody){let{body:s}=o;if(!s.IsAwake())continue;let l=new n,a=new n,c=0,u=0;for(let p=s.GetFixtureList();p;p=p.GetNext()){let d=new n,h=ux(p.GetShape(),this.normal,this.offset,s.GetTransform(),d);c+=h,l.x+=h*d.x,l.y+=h*d.y;let f=0;this.useDensity?f=p.GetDensity():f=1,u+=h*f,a.x+=h*d.x*f,a.y+=h*d.y*f}if(l.x/=c,l.y/=c,a.x/=u,a.y/=u,c<gt)continue;n.Negate(this.gravity,r),r.Scale(this.density*c),s.ApplyForce(r,a);let m=s.GetLinearVelocityFromWorldPoint(l,new n);m.Subtract(this.velocity),m.Scale(-this.linearDrag*c),s.ApplyForce(m,l),s.ApplyTorque(-s.GetInertia()/s.GetMass()*c*s.GetAngularVelocity()*this.angularDrag)}}};var y3=new n;var T3=new n;var k3=new n;var HC={buoyancyController:new F(0,0,.8)},Jd=new n,zd=new n,su=100;function OC(i,t){Jd.x=t.normal.x*t.offset+t.normal.y*su,Jd.y=t.normal.y*t.offset-t.normal.x*su,zd.x=t.normal.x*t.offset-t.normal.y*su,zd.y=t.normal.y*t.offset+t.normal.x*su,i.DrawSegment(Jd,zd,HC.buoyancyController)}function mx(i,t){for(let e=t.m_controllerList;e;e=e.m_next)e instanceof _s&&OC(i,e)}var NC={aabb:new lt},jd={Controllers:[],Examples:[],Joints:[],Collision:[],Benchmark:[],Rope:[],Forces:[],Stacking:[],Geometry:[],Solver:[],Bugs:[],Continuous:[],Lights:[],Particles:[]};function P(i,t,e){jd[i].push({group:i,name:t,TestClass:e})}function px(){return Object.keys(jd).sort().map(i=>{let t=jd[i].sort((e,r)=>e.name<r.name?-1:1);return{name:i,tests:t}})}var Xd=class extends Li{constructor(t){super(),this.test=t}SayGoodbyeJoint(t){this.test.m_mouseJoint===t?this.test.m_mouseJoint=null:this.test.JointDestroyed(t)}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){this.test.ParticleGroupDestroyed(t)}},Hd=class{constructor(){this.normal=new n;this.position=new n;this.state=0;this.normalImpulse=0;this.tangentImpulse=0;this.separation=0}},Xr=(i,t,e)=>`${i.toFixed(2)} [${t.toFixed(2)}] (${e.toFixed(2)})`,R=class i extends Vr{constructor(e={x:0,y:-10}){super();this.m_bomb=null;this.m_textLines=[];this.m_debugLines=[];this.m_statisticLines=[];this.m_mouseJoint=null;this.m_points=Array.from({length:i.k_maxContactPoints},()=>new Hd);this.m_pointCount=0;this.m_bombSpawnPoint=new n;this.m_bombSpawning=!1;this.m_mouseWorld=new n;this.m_mouseTracing=!1;this.m_mouseTracerPosition=new n;this.m_mouseTracerVelocity=new n;this.m_stepCount=0;this.m_maxProfile=new ir;this.m_totalProfile=new ir;this.m_testControlGroups=[];this.m_world=Oe.Create(e),this.m_destructionListener=new Xd(this),this.m_world.SetDestructionListener(this.m_destructionListener),this.m_world.SetContactListener(this),this.m_groundBody=this.m_world.CreateBody()}static{this.k_maxContactPoints=2048}setupControls(){}addTestControlGroup(e,r){this.m_testControlGroups.push({legend:e,controls:r})}getBaseHotkeys(){return[G(" ","Launch Bomb",()=>{this.LaunchBomb()})]}getHotkeys(){return[]}JointDestroyed(e){}ParticleGroupDestroyed(e){}BeginContact(e){}EndContact(e){}static{this.PreSolve_s_state1=[]}static{this.PreSolve_s_state2=[]}static{this.PreSolve_s_worldManifold=new Fi}PreSolve(e,r){let o=e.GetManifold();if(o.pointCount===0)return;let s=e.GetFixtureA(),l=e.GetFixtureB(),a=i.PreSolve_s_state1,c=i.PreSolve_s_state2;i0(a,c,r,o);let u=i.PreSolve_s_worldManifold;e.GetWorldManifold(u);for(let m=0;m<o.pointCount&&this.m_pointCount<i.k_maxContactPoints;++m){let p=this.m_points[this.m_pointCount];p.fixtureA=s,p.fixtureB=l,p.position.Copy(u.points[m]),p.normal.Copy(u.normal),p.state=c[m],p.normalImpulse=o.points[m].normalImpulse,p.tangentImpulse=o.points[m].tangentImpulse,p.separation=u.separations[m],++this.m_pointCount}}PostSolve(e,r){}MouseDown(e){this.m_mouseWorld.Copy(e),this.m_mouseTracing=!0,this.m_mouseTracerPosition.Copy(e),this.m_mouseTracerVelocity.SetZero(),this.m_mouseJoint!==null&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null);let r;if(this.m_world.QueryPointAABB(e,o=>o.GetBody().GetType()===2&&o.TestPoint(e)?(r=o,!1):!0),r){let l=r.GetBody(),a=new sc;a.bodyA=this.m_groundBody,a.bodyB=l,a.target.Copy(e),a.maxForce=1e3*l.GetMass(),Ct(a,5,.7,a.bodyA,a.bodyB),this.m_mouseJoint=this.m_world.CreateJoint(a),l.SetAwake(!0)}}SpawnBomb(e){this.m_bombSpawnPoint.Copy(e),this.m_bombSpawning=!0}CompleteBombSpawn(e){if(!this.m_bombSpawning)return;let r=30,o=n.Subtract(this.m_bombSpawnPoint,e,new n);o.Scale(r),this.LaunchBombAt(this.m_bombSpawnPoint,o),this.m_bombSpawning=!1}ShiftMouseDown(e){this.m_mouseWorld.Copy(e),this.m_mouseJoint===null&&this.SpawnBomb(e)}MouseUp(e){this.m_mouseTracing=!1,this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(e)}MouseMove(e,r){this.m_mouseWorld.Copy(e),r&&this.m_mouseJoint&&this.m_mouseJoint.SetTarget(e)}LaunchBomb(){let e=new n(W(-15,15),30),r=n.Scale(-5,e,new n);this.LaunchBombAt(e,r)}LaunchBombAt(e,r){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null),this.m_bomb=this.m_world.CreateBody({type:2,position:e,bullet:!0}),this.m_bomb.SetLinearVelocity(r);let o=new V;o.m_radius=25/this.GetDefaultViewZoom(),this.m_bomb.CreateFixture({shape:o,density:20,restitution:0})}Resize(e,r){}RunStep(e){let r=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&(e.m_singleStep?e.m_singleStep=!1:r=0),this.m_debugLines.length=0,this.m_statisticLines.length=0,this.m_textLines.length=0,e.m_pause&&this.addDebug("Paused",!0),this.Step(e,r)}addText(e){this.m_textLines.push(e)}addDebug(e,r){this.m_debugLines.push([e,`${r}`])}addStatistic(e,r){this.m_statisticLines.push([e,`${r}`])}Step(e,r){this.m_world.SetAllowSleeping(e.m_enableSleep),this.m_world.SetWarmStarting(e.m_enableWarmStarting),this.m_world.SetContinuousPhysics(e.m_enableContinuous),this.m_world.SetSubStepping(e.m_enableSubStepping),this.m_pointCount=0,this.m_world.Step(r,{velocityIterations:e.m_velocityIterations,positionIterations:e.m_positionIterations,particleIterations:e.m_particleIterations});let o=e.m_debugDraw,{aabb:s}=NC;st.unproject({x:0,y:st.getHeight()},s.lowerBound),st.unproject({x:st.getWidth(),y:0},s.upperBound),e.m_drawShapes&&o0(o,this.m_world,s),e.m_drawParticles&&cx(o,this.m_world),e.m_drawJoints&&s0(o,this.m_world),e.m_drawAABBs&&n0(o,this.m_world),e.m_drawCOMs&&l0(o,this.m_world),e.m_drawControllers&&mx(o,this.m_world),r>0&&++this.m_stepCount,e.m_drawStats&&(this.addStatistic("Bodies",this.m_world.GetBodyCount()),this.addStatistic("Contacts",this.m_world.GetContactCount()),this.addStatistic("Joints",this.m_world.GetJointCount()),this.addStatistic("Proxies",this.m_world.GetProxyCount()),this.addStatistic("Height",this.m_world.GetTreeHeight()),this.addStatistic("Balance",this.m_world.GetTreeBalance()),this.addStatistic("Quality",this.m_world.GetTreeQuality().toFixed(2)));{let l=this.m_world.GetProfile();this.m_maxProfile.step=Math.max(this.m_maxProfile.step,l.step),this.m_maxProfile.collide=Math.max(this.m_maxProfile.collide,l.collide),this.m_maxProfile.solve=Math.max(this.m_maxProfile.solve,l.solve),this.m_maxProfile.solveInit=Math.max(this.m_maxProfile.solveInit,l.solveInit),this.m_maxProfile.solveVelocity=Math.max(this.m_maxProfile.solveVelocity,l.solveVelocity),this.m_maxProfile.solvePosition=Math.max(this.m_maxProfile.solvePosition,l.solvePosition),this.m_maxProfile.solveTOI=Math.max(this.m_maxProfile.solveTOI,l.solveTOI),this.m_maxProfile.broadphase=Math.max(this.m_maxProfile.broadphase,l.broadphase),this.m_totalProfile.step+=l.step,this.m_totalProfile.collide+=l.collide,this.m_totalProfile.solve+=l.solve,this.m_totalProfile.solveInit+=l.solveInit,this.m_totalProfile.solveVelocity+=l.solveVelocity,this.m_totalProfile.solvePosition+=l.solvePosition,this.m_totalProfile.solveTOI+=l.solveTOI,this.m_totalProfile.broadphase+=l.broadphase}if(e.m_drawProfile){let l=this.m_world.GetProfile(),a=new ir;if(this.m_stepCount>0){let c=1/this.m_stepCount;a.step=c*this.m_totalProfile.step,a.collide=c*this.m_totalProfile.collide,a.solve=c*this.m_totalProfile.solve,a.solveInit=c*this.m_totalProfile.solveInit,a.solveVelocity=c*this.m_totalProfile.solveVelocity,a.solvePosition=c*this.m_totalProfile.solvePosition,a.solveTOI=c*this.m_totalProfile.solveTOI,a.broadphase=c*this.m_totalProfile.broadphase}this.addDebug("Step [ave] (max)",Xr(l.step,a.step,this.m_maxProfile.step)),this.addDebug("Collide [ave] (max)",Xr(l.collide,a.collide,this.m_maxProfile.collide)),this.addDebug("Solve [ave] (max)",Xr(l.solve,a.solve,this.m_maxProfile.solve)),this.addDebug("Solve Init [ave] (max)",Xr(l.solveInit,a.solveInit,this.m_maxProfile.solveInit)),this.addDebug("Solve Velocity [ave] (max)",Xr(l.solveVelocity,a.solveVelocity,this.m_maxProfile.solveVelocity)),this.addDebug("Solve Position [ave] (max)",Xr(l.solvePosition,a.solvePosition,this.m_maxProfile.solvePosition)),this.addDebug("Solve TOI [ave] (max)",Xr(l.solveTOI,a.solveTOI,this.m_maxProfile.solveTOI)),this.addDebug("Broad-Phase [ave] (max)",Xr(l.broadphase,a.broadphase,this.m_maxProfile.broadphase))}if(this.m_mouseTracing&&!this.m_mouseJoint){let a=new n;a.x=2/.1*(1/.1*(this.m_mouseWorld.x-this.m_mouseTracerPosition.x)-this.m_mouseTracerVelocity.x),a.y=2/.1*(1/.1*(this.m_mouseWorld.y-this.m_mouseTracerPosition.y)-this.m_mouseTracerVelocity.y),this.m_mouseTracerVelocity.AddScaled(r,a),this.m_mouseTracerPosition.AddScaled(r,this.m_mouseTracerVelocity)}if(this.m_bombSpawning){let l=new F(0,0,1);o.DrawPoint(this.m_bombSpawnPoint,4,l),l.SetRGB(.8,.8,.8),o.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,l)}if(e.m_drawContactPoints)for(let c=0;c<this.m_pointCount;++c){let u=this.m_points[c];if(u.state===1?o.DrawPoint(u.position,10,new F(.3,.95,.3)):u.state===2&&o.DrawPoint(u.position,5,new F(.3,.3,.95)),e.m_drawContactNormals){let m=u.position,p=n.Add(m,n.Scale(.3,u.normal,n.s_t0),new n);o.DrawSegment(m,p,new F(.9,.9,.9))}else if(e.m_drawContactImpulse){let m=u.position,p=n.AddScaled(m,.1*u.normalImpulse,u.normal,new n);o.DrawSegment(m,p,new F(.9,.9,.3))}if(e.m_drawFrictionImpulse){let m=n.CrossVec2One(u.normal,new n),p=u.position,d=n.AddScaled(p,.1*u.tangentImpulse,m,new n);o.DrawSegment(p,d,new F(.9,.9,.3))}}}GetDefaultViewZoom(){return 25}getCenter(){return n.ZERO}Destroy(){}};var nu=class{constructor(t,e,r){this.index=0;this.lastTime=-1;this.nextUpdate=0;this.calculated={avgFps:0,avgTime:0,minTime:0,maxTime:0,minFps:0,maxFps:0};this.waitTime=t,this.frameTimes=Array.from({length:e},()=>r),this.calculate()}getFps(){return this.calculated}getFrames(){return this.index===0?this.frameTimes:this.frameTimes.slice(this.index).concat(this.frameTimes.slice(0,this.index))}addFrame(){let t=performance.now();if(this.lastTime===-1)return this.lastTime=t,0;let e=t-this.lastTime;return this.lastTime=t,this.frameTimes[this.index]=e,++this.index===this.frameTimes.length&&(this.index=0),this.nextUpdate-=e,this.nextUpdate<=0&&this.calculate(),e}calculate(){this.nextUpdate=this.waitTime;let t=this.frameTimes.reduce((s,l)=>s+l,0),e=Math.max(1,t/this.frameTimes.length),r=Math.min(...this.frameTimes),o=Math.max(...this.frameTimes);this.calculated={avgFps:1e3/e,avgTime:e,minTime:r,maxTime:o,minFps:1e3/o,maxFps:1e3/r}}};var ys=$(bt());function sr(i,t,e,r){return{type:"select",name:i,options:t,initialValue:e,update:r}}var dx=({control:i})=>(0,ys.jsxs)("label",{className:"select",children:[(0,ys.jsx)("div",{className:"select--wrapper",children:(0,ys.jsx)("select",{defaultValue:i.initialValue,className:"select--input",children:i.options.map(t=>(0,ys.jsx)("option",{value:t,onClick:()=>i.update(t),children:t},t))})}),i.name.split("#")[0]]});var Be={water:0,viscous:32,powder:64,tensile:128,"static pressure":2048},lu={...Be,spring:8,elastic:16,"color mixing":256,wall:4,barrier:1028},au=class{constructor(t){this.restartOnChange=!0;this.types=lu;this.selectedKey="";this.defaultKey="water";this.manager=t}SetValues(t,e){this.types=t,this.defaultKey=e}SetRestartOnChange(t=!0){this.restartOnChange=t}Reset(){this.types=lu,this.selectedKey="",this.defaultKey="water",this.restartOnChange=!0}GetSelectedKey(){return this.selectedKey||this.defaultKey}GetValue(){return this.types[this.GetSelectedKey()]}GetControl(){let t=Object.keys(this.types);return sr("Particle Type",t,this.GetSelectedKey(),e=>{!this.selectedKey&&e===this.defaultKey?this.selectedKey=e:this.selectedKey!==e&&(this.selectedKey=e,this.restartOnChange&&this.manager.scheduleRestart())})}};var cu=class{ParticleCreated(t,e){}},vi=class{constructor(){this.m_particleSystem=null;this.m_callback=null;this.m_origin=new n;this.m_startingVelocity=new n;this.m_speed=0;this.m_halfSize=new n;this.m_emitRate=1;this.m_color=new F;this.m_emitRemainder=0;this.m_flags=0;this.m_group=null}Destroy(){this.SetGroup(null)}SetPosition(t){this.m_origin.Copy(t)}GetPosition(t){return t.Copy(this.m_origin)}SetSize(t){n.Scale(.5,t,this.m_halfSize)}GetSize(t){return n.Scale(2,this.m_halfSize,t)}SetVelocity(t){this.m_startingVelocity.Copy(t)}GetVelocity(t){return t.Copy(this.m_startingVelocity)}SetSpeed(t){this.m_speed=t}GetSpeed(){return this.m_speed}SetParticleFlags(t){this.m_flags=t}GetParticleFlags(){return this.m_flags}SetColor(t){this.m_color.Copy(t)}GetColor(t){return t.Copy(this.m_color)}SetEmitRate(t){this.m_emitRate=t}GetEmitRate(){return this.m_emitRate}SetParticleSystem(t){this.m_particleSystem=t}GetParticleSystem(){return this.m_particleSystem}SetCallback(t){this.m_callback=t}GetCallback(){return this.m_callback}SetGroup(t){this.m_group&&this.m_group.SetGroupFlags(this.m_group.GetGroupFlags()&-5),this.m_group=t,this.m_group&&this.m_group.SetGroupFlags(this.m_group.GetGroupFlags()|4)}GetGroup(){return this.m_group}Step(t,e,r=e?e.length:0){N(this.m_particleSystem!==null);let o=0;this.m_emitRemainder+=this.m_emitRate*t;let s=new wi;for(s.color.Copy(this.m_color),s.flags=this.m_flags,s.group=this.m_group;this.m_emitRemainder>1;){this.m_emitRemainder-=1;let l=Math.random()*2*Math.PI,a=Math.random(),c=new n(Math.sin(l),Math.cos(l));s.position.Set(this.m_origin.x+c.x*a*this.m_halfSize.x,this.m_origin.y+c.y*a*this.m_halfSize.y),s.velocity.Copy(this.m_startingVelocity),this.m_speed!==0&&s.velocity.AddScaled(this.m_speed,c);let u=this.m_particleSystem.CreateParticle(s);this.m_callback&&this.m_callback.ParticleCreated(this.m_particleSystem,u),e&&o<r&&(e[o]=u),++o}return o}};var Jn=$(bt());function Yt(i,t,e){return{type:"checkbox",name:i,initialValue:t,update:e}}var hx=({control:i})=>(0,Jn.jsxs)("label",{className:"checkbox",children:[(0,Jn.jsx)("input",{type:"checkbox",className:"checkbox--input",onClick:t=>i.update(t.currentTarget.checked),defaultChecked:i.initialValue}),(0,Jn.jsx)("span",{children:i.name.split("#")[0]})]});var Gi=[new F().SetByteRGBA(255,0,0,255),new F().SetByteRGBA(0,255,0,255),new F().SetByteRGBA(0,0,255,255),new F().SetByteRGBA(255,140,0,255),new F().SetByteRGBA(0,206,209,255),new F().SetByteRGBA(255,0,255,255),new F().SetByteRGBA(255,215,0,255),new F().SetByteRGBA(0,255,255,255)],Zt=class i extends R{static{this.m_strictContacts=!1}constructor(t={x:0,y:-10}){super(t);let e=new yo;this.m_particleSystem=this.m_world.CreateParticleSystem(e),this.m_particleSystem.SetGravityScale(.4),this.m_particleSystem.SetDensity(1.2)}setupControls(){this.addTestControlGroup("Particles",[this.createStrictContactsCheckbox()])}createStrictContactsCheckbox(){return Yt("Strict Particle/Body Contacts",i.m_strictContacts,t=>{i.m_strictContacts=t})}Step(t,e){if(super.Step(t,e),this.m_particleSystem.SetStrictContactCheck(i.m_strictContacts),t.m_drawStats&&(this.addStatistic("Particles",this.m_particleSystem.GetParticleCount()),this.addStatistic("Groups",this.m_particleSystem.GetParticleGroupCount()),this.addStatistic("Pairs",this.m_particleSystem.GetPairCount()),this.addStatistic("Triads",this.m_particleSystem.GetTriadCount())),this.m_mouseTracing&&!this.m_mouseJoint){let r=new V;r.m_p.Copy(this.m_mouseTracerPosition),r.m_radius=this.getParticleSelectionRadius();let o=new lt,s=new T;s.SetIdentity(),r.ComputeAABB(o,s,0),this.m_particleSystem.QueryAABB(o,l=>{let a=this.m_particleSystem.GetPositionBuffer()[l];return r.TestPoint(T.IDENTITY,a)&&this.m_particleSystem.GetVelocityBuffer()[l].Copy(this.m_mouseTracerVelocity),!0})}}ColorParticleGroup(t,e){let r=this.m_particleSystem.GetColorBuffer(),o=t.GetParticleCount(),s=t.GetBufferIndex(),l=o+s,a=Gi.length;e||(e=Math.floor(o/a),e||(e=1));for(let c=s;c<l;c++)r[c]=Gi[Math.floor(c/e)%a].Clone()}getParticleSelectionRadius(){return 40/this.GetDefaultViewZoom()}},ht=class extends Zt{constructor(t,e={x:0,y:-10}){super(e),this.particleParameter=t}setupControls(){this.addTestControlGroup("Particles",[this.createStrictContactsCheckbox(),this.particleParameter.GetControl()])}};var ZC={water:0,powder:64,tensile:128,viscous:32,"tensile powder":192,"viscous powder":96,"viscous tensile powder":224,"tensile viscous water":160},rt=class{static{this.k_maxPumps=5}static{this.k_maxEmitters=5}static{this.k_flipTime=6}static{this.k_tileRadius=2}static{this.k_tileDiameter=4}static{this.k_pumpRadius=2-.05}static{this.k_playfieldLeftEdge=-20}static{this.k_playfieldRightEdge=20}static{this.k_playfieldBottomEdge=40}static{this.k_tileWidth=10}static{this.k_tileHeight=11}static{this.k_defaultEmitterRate=30}static{this.k_defaultEmitterSize=3}static{this.k_particleExitSpeedY=-9.8}static{this.k_pumpForce=600}static{this.k_numberOfSpecialParticles=256}},Od=class extends Li{constructor(e,r){super();this.m_particles=[];this.m_colorOscillationTime=0;this.m_colorOscillationPeriod=2;this.m_world=e,this.m_particleSystem=r,this.m_world.SetDestructionListener(this)}Destroy(){this.m_world.SetDestructionListener(null)}Add(e,r){for(let o=0;o<r&&this.m_particles.length<rt.k_numberOfSpecialParticles;++o){let s=e[o];this.m_particleSystem.SetParticleFlags(s,this.m_particleSystem.GetFlagsBuffer()[s]|512),this.m_particles.push(this.m_particleSystem.GetParticleHandleFromIndex(s))}}Step(e){function r(l,a){return l-Math.floor(l/a)*a}this.m_colorOscillationTime=r(this.m_colorOscillationTime+e,this.m_colorOscillationPeriod);let o=2*Math.abs(this.m_colorOscillationTime/this.m_colorOscillationPeriod-.5),s=new F().SetByteRGBA(128+128*(1-o),128+256*Math.abs(.5-o),128+128*o,255);for(let l of this.m_particles)this.m_particleSystem.GetColorBuffer()[l.GetIndex()].Copy(s)}SayGoodbyeJoint(e){}SayGoodbyeFixture(e){}SayGoodbyeParticleGroup(e){}SayGoodbyeParticle(e,r){e===this.m_particleSystem&&(this.m_particles=this.m_particles.filter(o=>o.GetIndex()!==r))}},Nd=class extends ht{constructor({particleParameter:e}){super(e,{x:0,y:-20});this.m_faucetEmitterIndex=0;this.m_pumpIndex=0;this.m_pumpTimer=0;this.m_pumpForce=new n;this.m_pumps=[];this.m_emitters=[];let r=this.m_world.CreateBody();for(let s=0;s<rt.k_maxEmitters;s++)this.m_emitters[s]=null;for(let s=0;s<rt.k_maxPumps;s++)this.m_pumps[s]=null;{let s=new v,l=[new n(-40,-10),new n(40,-10),new n(40,0),new n(-40,0)];s.Set(l,4),r.CreateFixture({shape:s})}{let s=new v,l=[new n(rt.k_playfieldLeftEdge-20,-1),new n(rt.k_playfieldLeftEdge,-1),new n(rt.k_playfieldLeftEdge,50),new n(rt.k_playfieldLeftEdge-20,50)];s.Set(l,4),r.CreateFixture({shape:s})}{let s=new v,l=[new n(rt.k_playfieldRightEdge,-1),new n(rt.k_playfieldRightEdge+20,-1),new n(rt.k_playfieldRightEdge+20,50),new n(rt.k_playfieldRightEdge,50)];s.Set(l,4),r.CreateFixture({shape:s})}this.m_particleSystem.SetRadius(.25),this.m_specialTracker=new Od(this.m_world,this.m_particleSystem),this.m_pumpTimer=0,this.SetupMaze(),this.m_killFieldShape=new v,this.m_killFieldShape.SetAsBox(rt.k_playfieldRightEdge-rt.k_playfieldLeftEdge,1),this.m_killFieldTransform=new T;let o=new n(-20,1);this.m_killFieldTransform.SetPositionAngle(o,0),e.SetValues(ZC,"water"),e.SetRestartOnChange(!1)}Destroy(){for(let e=0;e<this.m_faucetEmitterIndex;e++)this.m_emitters[e]=null}SetupMaze(){let e="# r#g #r##  /#  #  # ###     pA  #  /##### # /#  C  /# #   # ### # / # ## p /#   #  ####  A        /#####KK###";this.m_faucetEmitterIndex=0,this.m_pumpIndex=0;let r=new v;r.SetAsBox(rt.k_tileRadius,rt.k_tileRadius);let o=H(3,n);o[0].Set(-rt.k_tileRadius,-rt.k_tileRadius),o[1].Set(rt.k_tileRadius,rt.k_tileRadius),o[2].Set(rt.k_tileRadius,-rt.k_tileRadius);let s=new v;s.Set(o,3),o[1].Set(-rt.k_tileRadius,rt.k_tileRadius);let l=new v;l.Set(o,3);let a=new V;a.m_radius=rt.k_tileRadius*.7;let c=new F().SetByteRGBA(255,128,128,255),u=new F().SetByteRGBA(128,255,128,255),m=new F().SetByteRGBA(128,128,255,255);this.m_pumpForce.Set(rt.k_pumpForce,0);for(let p=0;p<rt.k_tileWidth;p++)for(let d=0;d<rt.k_tileHeight;d++){let h=e[d*rt.k_tileWidth+p],f=new n(rt.k_playfieldLeftEdge+rt.k_tileRadius*2*p+rt.k_tileRadius,rt.k_playfieldBottomEdge-rt.k_tileRadius*2*d+rt.k_tileRadius);switch(h){case"#":this.CreateBody(f,r,0);break;case"A":this.CreateBody(f,l,0);break;case"/":this.CreateBody(f,s,0);break;case"C":this.CreateBody(f,a,2);break;case"p":this.AddPump(f);break;case"b":this.AddFaucetEmitter(f,m);break;case"r":this.AddFaucetEmitter(f,c);break;case"g":this.AddFaucetEmitter(f,u);break;default:break}}}CreateBody(e,r,o){this.m_world.CreateBody({type:o,position:e}).CreateFixture({shape:r,density:10})}AddPump(e){let r=new v;r.SetAsBox(rt.k_pumpRadius,rt.k_pumpRadius);let o=this.m_world.CreateBody({position:e,type:2,angle:0});o.CreateFixture({shape:r,density:5});let s=new Nt;s.bodyA=this.m_groundBody,s.bodyB=o,s.collideConnected=!1,s.localAxisA.Set(1,0),s.localAnchorA.Copy(e),this.m_world.CreateJoint(s),this.m_pumps[this.m_pumpIndex]=o,this.m_pumpIndex++}AddFaucetEmitter(e,r){let o=new n(0,rt.k_particleExitSpeedY),s=new vi;s.SetParticleSystem(this.m_particleSystem),s.SetPosition(e),s.SetVelocity(o),s.SetSize(new n(rt.k_defaultEmitterSize,0)),s.SetEmitRate(rt.k_defaultEmitterRate),s.SetColor(r),this.m_emitters[this.m_faucetEmitterIndex]=s,this.m_faucetEmitterIndex++}JointDestroyed(e){super.JointDestroyed(e)}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e)}BeginContact(e){super.BeginContact(e)}EndContact(e){super.EndContact(e)}PreSolve(e,r){super.PreSolve(e,r)}PostSolve(e,r){super.PostSolve(e,r)}getCenter(){return{x:0,y:20}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r);let s=this.particleParameter.GetValue();for(let l=0;l<this.m_faucetEmitterIndex;l++){let a=[],c=this.m_emitters[l];if(c){c.SetParticleFlags(s);let u=c.Step(o,a,rt.k_numberOfSpecialParticles);this.m_specialTracker.Add(a,u)}}this.m_specialTracker.Step(o),this.m_particleSystem.DestroyParticlesInShape(this.m_killFieldShape,this.m_killFieldTransform);for(let l=0;l<this.m_pumpIndex;l++){let a=this.m_pumps[l];a&&a.ApplyForceToCenter(this.m_pumpForce,!0),this.m_pumpTimer+=o,this.m_pumpTimer>rt.k_flipTime&&(this.m_pumpTimer-=rt.k_flipTime,this.m_pumpForce.x*=-1)}}};P("Particles","Sandbox",Nd);var Zd=class{constructor(t,e,r,o,s,l){this.m_initialLifetime=0;this.m_remainingLifetime=0;this.m_halfLifetime=0;this.m_origColor=new F;let a=new V;a.m_p.Copy(e),a.m_radius=r;let c=new it;c.flags=l,c.shape=a;function u(f,b,x){return x<0&&(x+=1),x>1&&(x-=1),x<1/6?f+(b-f)*6*x:x<1/2?b:x<2/3?f+(b-f)*(2/3-x)*6:f}function m(f,b,x,_=1){let y,g,S;if(b===0)y=g=S=x;else{let w=x<.5?x*(1+b):x+b-x*b,B=2*x-w;y=u(B,w,f+1/3),g=u(B,w,f),S=u(B,w,f-1/3)}return{r:y,g,b:S,a:_}}this.m_origColor.Copy(m(Math.random(),1,.5)),c.color.Copy(this.m_origColor),this.m_particleSystem=t,this.m_pg=this.m_particleSystem.CreateParticleGroup(c),this.m_initialLifetime=this.m_remainingLifetime=s,this.m_halfLifetime=this.m_initialLifetime*.5;let p=this.m_pg.GetBufferIndex(),d=this.m_particleSystem.GetPositionBuffer(),h=this.m_particleSystem.GetVelocityBuffer();for(let f=p;f<p+this.m_pg.GetParticleCount();f++)n.Subtract(d[f],e,h[f]),h[f].Scale(o)}Drop(){this.m_pg.DestroyParticles(!1)}ColorCoeff(){return this.m_remainingLifetime>=this.m_halfLifetime?1:1-(this.m_halfLifetime-this.m_remainingLifetime)/this.m_halfLifetime}Step(t){if(t>0&&this.m_remainingLifetime>0){this.m_remainingLifetime=Math.max(this.m_remainingLifetime-t,0);let e=this.ColorCoeff(),r=this.m_particleSystem.GetColorBuffer(),o=this.m_pg.GetBufferIndex();for(let s=o;s<o+this.m_pg.GetParticleCount();s++){let l=r[s];l.a*=e}}}IsDone(){return this.m_remainingLifetime<=0}},Qd=class i extends ht{constructor({particleParameter:e}){super(e);this.m_VFXIndex=0;this.m_VFX=[];this.m_contact=!1;this.m_contactPoint=new n;this.m_VFXIndex=0;for(let r=0;r<i.c_maxVFX;r++)this.m_VFX[r]=null;this.CreateWalls(),this.m_particleSystem.SetRadius(.25*2);for(let r=0;r<i.c_maxCircles;r++){let o=this.m_world.CreateBody({type:2}),s=new V;s.m_p.Set(3*W(-1,1),i.SHAPE_HEIGHT_OFFSET+i.SHAPE_OFFSET*r),s.m_radius=2,o.CreateFixture({shape:s,density:.5,userData:{sparky:!0}})}e.SetValues(Be,"powder"),e.SetRestartOnChange(!1)}static{this.c_maxCircles=3}static{this.c_maxVFX=20}static{this.SHAPE_HEIGHT_OFFSET=7}static{this.SHAPE_OFFSET=4.5}BeginContact(e){super.BeginContact(e);let r=e.GetFixtureA().GetUserData(),o=e.GetFixtureB().GetUserData();if(r.sparky||o.sparky){let s=new Fi;e.GetWorldManifold(s),this.m_contactPoint.Copy(s.points[0]),this.m_contact=!0}}Step(e,r){let o=this.particleParameter.GetValue(),s=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(s=0),super.Step(e,r),this.m_contact&&(this.AddVFX(this.m_contactPoint,o),this.m_contact=!1);for(let l=0;l<i.c_maxVFX;l++){let a=this.m_VFX[l];a!==null&&(a.Step(s),a.IsDone()&&(a.Drop(),this.m_VFX[l]=null))}}AddVFX(e,r){let o=this.m_VFX[this.m_VFXIndex];o!==null&&(o.Drop(),this.m_VFX[this.m_VFXIndex]=null),this.m_VFX[this.m_VFXIndex]=new Zd(this.m_particleSystem,e,W(1,2),W(10,20),W(.5,1),r),++this.m_VFXIndex>=i.c_maxVFX&&(this.m_VFXIndex=0)}getCenter(){return{x:0,y:20}}CreateWalls(){let e=this.m_world.CreateBody();{let r=new v,o=[new n(-40,-10),new n(40,-10),new n(40,0),new n(-40,0)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(-40,40),new n(40,40),new n(40,50),new n(-40,50)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(-40,-10),new n(-20,-10),new n(-20,50),new n(-40,50)];r.Set(o,4),e.CreateFixture({shape:r})}{let r=new v,o=[new n(20,-10),new n(40,-10),new n(40,50),new n(20,50)];r.Set(o,4),e.CreateFixture({shape:r})}}};P("Particles","Sparky",Qd);var qd=class extends ht{constructor({particleParameter:t}){super(t);{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-2,0),new n(2,0),new n(2,4),new n(-2,4)];r.CreateLoop(o,4),e.CreateFixture({shape:r})}this.m_particleSystem.SetRadius(.025*2),this.m_particleSystem.SetDamping(.2);{let e=new v;e.SetAsBox(.8,1,new n(-1.2,1.01),0);let r=new it;r.flags=t.GetValue(),r.shape=e;let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","DamBreak",qd);var QC={"tensile + viscous":160,...Be},Wd=class extends ht{constructor({particleParameter:t}){super(t),t.SetValues(QC,"tensile + viscous");{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-2,0),new n(2,0),new n(2,4),new n(-2,4)];r.CreateLoop(o,4),e.CreateFixture({shape:r})}this.m_particleSystem.SetRadius(.025);{let e=new v;e.SetAsBox(2,.4,new n(0,3.6),0);let r=new it;r.flags=t.GetValue(),r.shape=e;let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-2,3.2),new n(-1.2,3.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.1,3.2),new n(2,3.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.2,3.2),new n(-1.2,2.8)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.1,3.2),new n(-1.1,2.8)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.6,2.4),new n(.8,2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(1.6,1.6),new n(-.8,1.2)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-1.2,.8),new n(-1.2,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-.4,.8),new n(-.4,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(.4,.8),new n(.4,0)),e.CreateFixture({shape:r,density:.1})}{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(1.2,.8),new n(1.2,0)),e.CreateFixture({shape:r,density:.1})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Liquid Timer",Wd);var Kd=class extends ht{constructor({particleParameter:e}){super(e);this.m_time=0;e.SetValues(Be,"water");let r=this.m_world.CreateBody();{let s=this.m_world.CreateBody({type:2,allowSleep:!1,position:{x:0,y:1}}),l=new v;l.SetAsBox(.05,1,new n(2,0),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(.05,1,new n(-2,0),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(2,.05,new n(0,1),0),s.CreateFixture({shape:l,density:5}),l.SetAsBox(2,.05,new n(0,-1),0),s.CreateFixture({shape:l,density:5});let a=new q;a.bodyA=r,a.bodyB=s,a.localAnchorA.Set(0,1),a.localAnchorB.Set(0,0),a.referenceAngle=0,a.motorSpeed=.05*Math.PI,a.maxMotorTorque=1e7,a.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(a)}this.m_particleSystem.SetRadius(.025*2);let o=e.GetValue();this.m_particleSystem.SetDamping(.2);{let s=new it;s.flags=o;let l=new v;l.SetAsBox(.9,.9,new n(0,1),0),s.shape=l;let a=this.m_particleSystem.CreateParticleGroup(s);s.flags&256&&this.ColorParticleGroup(a,0)}this.m_time=0}Step(e,r){super.Step(e,r),e.m_hertz>0&&(this.m_time+=1/e.m_hertz),this.m_joint.SetMotorSpeed(.05*Math.cos(this.m_time)*Math.PI)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Wave Machine",Kd);var $d=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody();{let o=new v,s=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,3)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(2,-.1),new n(4,-.1),new n(4,3),new n(2,2)];o.Set(s,4),r.CreateFixture({shape:o})}}this.m_particleSystem.SetRadius(.035*2);let e=t.GetValue();this.m_particleSystem.SetDamping(.2);{let r=new V;r.m_p.Set(0,3),r.m_radius=2;let o=new it;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}{let r=this.m_world.CreateBody({type:2}),o=new V;o.m_p.Set(0,8),o.m_radius=.5,r.CreateFixture({shape:o,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Particles",$d);var qC={...Be,"color mixing":256},th=class extends cu{constructor(e,r){super();this.m_minLifetime=0;this.m_maxLifetime=0;this.m_minLifetime=e,this.m_maxLifetime=r}ParticleCreated(e,r){e.SetParticleLifetime(r,Math.random()*(this.m_maxLifetime-this.m_minLifetime)+this.m_minLifetime)}},eh=class i extends ht{constructor({particleParameter:e}){super(e);this.m_particleColorOffset=0;this.m_emitter=new vi,this.m_lifetimeRandomizer=new th(i.k_particleLifetimeMin,i.k_particleLifetimeMax),this.m_particleSystem.SetRadius(.035),this.m_particleSystem.SetMaxParticleCount(i.k_maxParticleCount),this.m_particleSystem.SetDestructionByAge(!0);let r=this.m_world.CreateBody();{let o=new v,s=i.k_containerHeight+i.k_containerThickness;o.SetAsBox(i.k_containerWidth-i.k_containerThickness,i.k_containerThickness,new n,0),r.CreateFixture({shape:o}),o.SetAsBox(i.k_containerThickness,s,new n(-i.k_containerWidth,i.k_containerHeight),0),r.CreateFixture({shape:o}),o.SetAsBox(i.k_containerThickness,s,new n(i.k_containerWidth,i.k_containerHeight),0),r.CreateFixture({shape:o})}{let o=new v;o.SetAsBox(i.k_containerWidth*5,i.k_containerThickness,new n(0,i.k_containerThickness*-2),0),r.CreateFixture({shape:o})}{let o=new v,s=this.m_particleSystem.GetRadius()*2,a=i.k_faucetLength*s*i.k_spoutLength,c=i.k_containerWidth*i.k_faucetWidth*i.k_spoutWidth,u=i.k_containerHeight*i.k_faucetHeight+a*.5;o.SetAsBox(s,a,new n(-c,u),0),r.CreateFixture({shape:o}),o.SetAsBox(s,a,new n(c,u),0),r.CreateFixture({shape:o}),o.SetAsBox(c-s,s,new n(0,u+a-s),0),r.CreateFixture({shape:o})}{let o=this.m_particleSystem.GetRadius()*2*i.k_faucetLength;this.m_emitter.SetParticleSystem(this.m_particleSystem),this.m_emitter.SetCallback(this.m_lifetimeRandomizer),this.m_emitter.SetPosition(new n(i.k_containerWidth*i.k_faucetWidth,i.k_containerHeight*i.k_faucetHeight+o*.5)),this.m_emitter.SetVelocity(new n),this.m_emitter.SetSize(new n(0,o)),this.m_emitter.SetColor(new F(1,1,1,1)),this.m_emitter.SetEmitRate(120),this.m_emitter.SetParticleFlags(e.GetValue())}e.SetRestartOnChange(!1),e.SetValues(qC,"water")}static{this.k_particleLifetimeMin=30}static{this.k_particleLifetimeMax=50}static{this.k_containerHeight=.2}static{this.k_containerWidth=1}static{this.k_containerThickness=.05}static{this.k_faucetWidth=.1}static{this.k_faucetHeight=15}static{this.k_faucetLength=2}static{this.k_spoutLength=2}static{this.k_spoutWidth=1.1}static{this.k_maxParticleCount=1e3}static{this.k_emitRateChangeFactor=1.05}static{this.k_emitRateMin=1}static{this.k_emitRateMax=240}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.m_particleColorOffset+=o,this.m_particleColorOffset>=Gi.length&&(this.m_particleColorOffset-=Gi.length),this.m_emitter.SetParticleFlags(this.particleParameter.GetValue()),this.m_emitter.GetParticleFlags()&256?this.m_emitter.SetColor(Gi[Math.floor(this.m_particleColorOffset)%Gi.length]):this.m_emitter.SetColor(new F(1,1,1,1)),this.m_emitter.Step(o)}getHotkeys(){return[G("m","Increase Flow",()=>this.m_emitter.SetEmitRate(Math.max(i.k_emitRateMin,this.m_emitter.GetEmitRate()*i.k_emitRateChangeFactor))),G("n","Decrease Flow",()=>this.m_emitter.SetEmitRate(Math.min(i.k_emitRateMax,this.m_emitter.GetEmitRate()/i.k_emitRateChangeFactor)))]}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Faucet",eh);var WC={...lu,erase:2,rigid:0,"rigid barrier":1024,"elastic barrier":1040,"spring barrier":1032,"repulsive wall":8196},KC={elastic:1,rigid:3,spring:1,wall:1,"rigid barrier":2,"elastic barrier":1,"spring barrier":1,"repulsive wall":1},$C=28,ih=class extends ht{constructor({particleParameter:e}){super(e);this.m_colorIndex=0;{let r=this.m_world.CreateBody();{let o=new v,s=[new n(-4,-2),new n(4,-2),new n(4,0),new n(-4,0)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,-2),new n(-2,-2),new n(-2,6),new n(-4,6)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(2,-2),new n(4,-2),new n(4,6),new n(2,6)];o.Set(s,4),r.CreateFixture({shape:o})}{let o=new v,s=[new n(-4,4),new n(4,4),new n(4,6),new n(-4,6)];o.Set(s,4),r.CreateFixture({shape:o})}}this.m_colorIndex=0,this.m_particleSystem.SetRadius(.05*2),this.m_lastGroup=null,e.SetValues(WC,"water"),e.SetRestartOnChange(!1)}getGroupFlags(){return KC[this.particleParameter.GetSelectedKey()]??0}MouseMove(e,r){if(super.MouseMove(e,r),r){let o=this.particleParameter.GetValue(),s=new V;s.m_p.Copy(e),s.m_radius=.2,this.m_particleSystem.DestroyParticlesInShape(s,T.IDENTITY);let l=this.getGroupFlags();this.m_lastGroup&&l===this.m_lastGroup.GetGroupFlags()||(this.m_colorIndex=(this.m_colorIndex+1)%Gi.length);let c=new it;c.shape=s,c.flags=o,o&$C&&(c.flags|=4096),c.groupFlags=l,c.color.Copy(Gi[this.m_colorIndex]),c.group=this.m_lastGroup,this.m_lastGroup=this.m_particleSystem.CreateParticleGroup(c),this.m_mouseTracing=!1}}MouseUp(e){super.MouseUp(e),this.m_lastGroup=null}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e),e===this.m_lastGroup&&(this.m_lastGroup=null)}SplitParticleGroups(){for(let e=this.m_particleSystem.GetParticleGroupList();e;e=e.GetNext())e!==this.m_lastGroup&&e.GetGroupFlags()&2&&e.GetAllParticleFlags()&2&&this.m_particleSystem.SplitParticleGroup(e)}Step(e,r){this.m_particleSystem.GetAllParticleFlags()&2&&this.SplitParticleGroups(),super.Step(e,r)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Particle Drawing",ih);var tA={...Be,"color mixing":256},zn=class extends ht{constructor({particleParameter:t}){super(t),t.SetValues(tA,"water"),this.m_ground=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,3)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,3),new n(2,2)];e.Set(r,4),this.m_ground.CreateFixture({shape:e})}this.m_particleSystem.SetRadius(.035*2);{let e=new v;e.SetAsBox(2,1,new n(0,1),0);let r=new it;r.shape=e,r.flags=t.GetValue();let o=this.m_particleSystem.CreateParticleGroup(r);r.flags&256&&this.ColorParticleGroup(o,0)}{let e=this.m_world.CreateBody({type:2}),r=new V;r.m_p.Set(0,.5),r.m_radius=.1,e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new v;r.SetAsBox(.1,.1,new n(-1,.5),0),e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new v;r.SetAsBox(.1,.1,new n(1,.5),.5),e.CreateFixture({shape:r,density:.1}),this.m_particleSystem.DestroyParticlesInShape(r,e.GetTransform())}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(0,2),new n(.1,2.1)),e.CreateFixture({shape:r,density:1});let o=new ke;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(.3,2),new n(.4,2.1)),e.CreateFixture({shape:r,density:1});let o=new ke;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}{let e=this.m_world.CreateBody({type:2}),r=new I;r.SetTwoSided(new n(-.3,2.1),new n(-.2,2)),e.CreateFixture({shape:r,density:1});let o=new ke;o.mass=.1,o.center.x=.5*r.m_vertex1.x+r.m_vertex2.x,o.center.y=.5*r.m_vertex1.y+r.m_vertex2.y,o.I=0,e.SetMassData(o)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Soup",zn);var rh=class extends Zt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,2),t.m_radius=.5;let e=new it;e.flags=384,e.shape=t,e.color.SetRGBA(1,0,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,2),t.m_radius=.5;let e=new it;e.flags=384,e.shape=t,e.color.SetRGBA(0,1,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v,e=[new n(0,3),new n(2,3),new n(2,3.5),new n(0,3.5)];t.Set(e,4);let r=new it;r.flags=384,r.shape=t,r.color.SetRGBA(0,0,1,1),this.m_particleSystem.CreateParticleGroup(r)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Surface Tension",rh);var oh=class extends Zt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,3),t.m_radius=.5;let e=new it;e.flags=8,e.groupFlags=1,e.shape=t,e.color.SetRGBA(1,0,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,3),t.m_radius=.5;let e=new it;e.flags=16,e.groupFlags=1,e.shape=t,e.color.SetRGBA(0,1,0,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v;t.SetAsBox(1,.5);let e=new it;e.flags=16,e.groupFlags=1,e.position.Set(1,4),e.angle=-.5,e.angularVelocity=2,e.shape=t,e.color.SetRGBA(0,0,1,1),this.m_particleSystem.CreateParticleGroup(e)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}getParticleSelectionRadius(){return .4}};P("Particles","Elastic Particles",oh);var sh=class extends Zt{constructor(){super();{let t=this.m_world.CreateBody();{let e=new v,r=[new n(-4,-1),new n(4,-1),new n(4,0),new n(-4,0)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(-4,-.1),new n(-2,-.1),new n(-2,2),new n(-4,2)];e.Set(r,4),t.CreateFixture({shape:e})}{let e=new v,r=[new n(2,-.1),new n(4,-.1),new n(4,2),new n(2,2)];e.Set(r,4),t.CreateFixture({shape:e})}}this.m_particleSystem.SetRadius(.035*2);{let t=new V;t.m_p.Set(0,3),t.m_radius=.5;let e=new it;e.groupFlags=3,e.shape=t,e.color.SetByteRGBA(255,0,0,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=new V;t.m_p.Set(-1,3),t.m_radius=.5;let e=new it;e.groupFlags=3,e.shape=t,e.color.SetByteRGBA(0,255,0,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=new v;t.SetAsBox(1,.5);let e=new it;e.groupFlags=3,e.position.Set(1,4),e.angle=-.5,e.angularVelocity=2,e.shape=t,e.color.SetByteRGBA(0,0,255,255),this.m_particleSystem.CreateParticleGroup(e)}{let t=this.m_world.CreateBody({type:2}),e=new V;e.m_p.Set(0,8),e.m_radius=.5,t.CreateFixture({shape:e,density:.5})}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}getParticleSelectionRadius(){return .4}};P("Particles","Rigid Particles",sh);var nh=class i extends Zt{static{this.k_maxParticleCount=500}static{this.k_dynamicBoxSize=new n(.5,.5)}static{this.k_boxMass=1}static{this.k_emitRate=100}static{this.k_emitterPosition=new n(-5,4)}static{this.k_emitterVelocity=new n(7,-4)}static{this.k_emitterSize=new n(1,1)}static{this.k_leftEmitterColor=new F().SetByteRGBA(34,51,255,255)}static{this.k_rightEmitterColor=new F().SetByteRGBA(255,34,17,255)}constructor(){super(),this.m_emitters=[new vi,new vi],this.m_particleSystem.SetRadius(.05),this.m_particleSystem.SetMaxParticleCount(i.k_maxParticleCount),this.m_particleSystem.SetDestructionByAge(!0);let t=new yo;t.radius=this.m_particleSystem.GetRadius(),t.destroyByAge=!0,this.m_particleSystem2=this.m_world.CreateParticleSystem(t),this.m_particleSystem2.SetMaxParticleCount(i.k_maxParticleCount);{let e=this.m_world.CreateBody(),r=new v;r.SetAsBox(5,.1),e.CreateFixture({shape:r})}{let e=this.m_world.CreateBody({type:2}),r=new v,o=new n(0,1.2);r.SetAsBox(i.k_dynamicBoxSize.x,i.k_dynamicBoxSize.y,o,0),e.CreateFixture({shape:r});let s=new ke;s.mass=i.k_boxMass,s.center.Copy(o),s.I=0,e.SetMassData(s)}for(let e=0;e<this.m_emitters.length;++e){let r=e&1?-1:1,o=this.m_emitters[e];o.SetPosition(new n(i.k_emitterPosition.x*r,i.k_emitterPosition.y)),o.SetSize(i.k_emitterSize),o.SetVelocity(new n(i.k_emitterVelocity.x*r,i.k_emitterVelocity.y)),o.SetEmitRate(i.k_emitRate),o.SetColor(e&1?i.k_rightEmitterColor:i.k_leftEmitterColor),o.SetParticleSystem(e&1?this.m_particleSystem2:this.m_particleSystem)}}Step(t,e){let r=t.m_hertz>0?1/t.m_hertz:0;t.m_pause&&!t.m_singleStep&&(r=0),this.m_particleSystem2.SetStrictContactCheck(Zt.m_strictContacts),super.Step(t,e);for(let o of this.m_emitters)o.Step(r)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:1}}};P("Particles","Multiple Systems",nh);var lh=class i extends ht{constructor({particleParameter:e}){super(e);this.m_useLinearImpulse=!1;{let r=this.m_world.CreateBody(),o=[new n(i.kBoxLeft,i.kBoxBottom),new n(i.kBoxRight,i.kBoxBottom),new n(i.kBoxRight,i.kBoxTop),new n(i.kBoxLeft,i.kBoxTop)],s=new dt;s.CreateLoop(o,o.length),r.CreateFixture({shape:s})}this.m_particleSystem.SetRadius(.025*2),this.m_particleSystem.SetDamping(.2);{let r=new v;r.SetAsBox(.8,1,new n(0,1.01),0);let o=new it;o.flags=e.GetValue(),o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}static{this.kBoxLeft=-2}static{this.kBoxRight=2}static{this.kBoxBottom=0}static{this.kBoxTop=4}MouseUp(e){if(super.MouseUp(e),i.kBoxLeft<=e.x&&e.x<=i.kBoxRight&&i.kBoxBottom<=e.y&&e.y<=i.kBoxTop){let o=new n(.5*(i.kBoxLeft+i.kBoxRight),.5*(i.kBoxBottom+i.kBoxTop)),s=n.Subtract(e,o,new n);s.Normalize(),this.ApplyImpulseOrForce(s)}}getHotkeys(){return[G("l","Use Linear Impulse",()=>{this.m_useLinearImpulse=!0}),G("f","Use Force",()=>{this.m_useLinearImpulse=!1})]}ApplyImpulseOrForce(e){let r=this.m_world.GetParticleSystemList();N(r!==null);let o=r.GetParticleGroupList();N(o!==null);let s=o.GetParticleCount();if(this.m_useLinearImpulse){let a=n.Scale(.005*s,e,new n);o.ApplyLinearImpulse(a)}else{let a=n.Scale(1*s,e,new n);o.ApplyForce(a)}}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Impulse",lh);var ah=class extends zn{constructor(e){super(e);this.m_joint=null;this.m_oscillationOffset=0;this.m_particleSystem.SetDamping(1);let r=new V;r.m_p.Set(0,.7),r.m_radius=.4,this.m_stirrer=this.m_world.CreateBody({type:2}),this.m_stirrer.CreateFixture({shape:r,density:1});let o=new T;o.SetIdentity(),this.m_particleSystem.DestroyParticlesInShape(r,o),this.CreateJoint()}CreateJoint(){let e=new Nt;e.bodyA=this.m_groundBody,e.bodyB=this.m_stirrer,e.collideConnected=!0,e.localAxisA.Set(1,0),e.localAnchorA.Copy(this.m_stirrer.GetPosition()),this.m_joint=this.m_world.CreateJoint(e)}ToggleJoint(){this.m_joint?(this.m_world.DestroyJoint(this.m_joint),this.m_joint=null):this.CreateJoint()}getHotkeys(){return[G("t","Toggle Joint",()=>this.ToggleJoint())]}MouseUp(e){super.MouseUp(e),this.InSoup(e)&&this.ToggleJoint()}InSoup(e){return e.y>-1&&e.y<2&&e.x>-3&&e.x<3}Step(e,r){this.m_oscillationOffset+=1/e.m_hertz,this.m_oscillationOffset>5&&(this.m_oscillationOffset-=5);let c=this.m_oscillationOffset*.2*2*Math.PI,u=new n(Math.sin(c),Math.cos(c)).Scale(10);this.InSoup(this.m_stirrer.GetPosition())&&this.m_stirrer.GetLinearVelocity().Length()<2&&this.m_stirrer.ApplyForceToCenter(u,!0),super.Step(e,r)}};P("Particles","Soup Stirrer",ah);var ch=class{constructor(){this.m_emitterLifetime=[]}Destroy(){for(let t of this.m_emitterLifetime)t.emitter.Destroy()}Add(t,e){this.m_emitterLifetime.push({emitter:t,lifetime:e})}Step(t){let e=[];for(let r of this.m_emitterLifetime){let o=r.lifetime-t;o<=0&&e.push(r.emitter),r.lifetime=o,r.emitter.Step(t)}for(let r of e)r.Destroy(),this.m_emitterLifetime=this.m_emitterLifetime.filter(o=>o.emitter!==r)}},uh=class extends Li{constructor(){super(...arguments);this.m_particleGroups=[]}SayGoodbyeParticleGroup(e){this.RemoveParticleGroup(e)}AddParticleGroup(e){this.m_particleGroups.push(e)}RemoveParticleGroup(e){this.m_particleGroups.splice(this.m_particleGroups.indexOf(e),1)}GetParticleGroups(){return this.m_particleGroups}},j=class i{static{this.k_worldWidthTiles=24}static{this.k_worldHeightTiles=16}static{this.k_worldTiles=i.k_worldWidthTiles*i.k_worldHeightTiles}static{this.k_worldCenterX=0}static{this.k_worldCenterY=2}static{this.k_tileWidth=.2}static{this.k_tileHeight=.2}static{this.k_tileHalfWidth=i.k_tileWidth*.5}static{this.k_tileHalfHeight=i.k_tileHeight*.5}static{this.k_worldHalfWidth=i.k_worldWidthTiles*i.k_tileWidth*.5}static{this.k_worldHalfHeight=i.k_worldHeightTiles*i.k_tileHeight*.5}static{this.k_playerColor=new F(1,1,1)}static{this.k_playerFrackColor=new F(1,.5,.5)}static{this.k_wellColor=new F(.5,.5,.5)}static{this.k_oilColor=new F(1,0,0)}static{this.k_waterColor=new F(0,.2,1)}static{this.k_frackingFluidColor=new F(.8,.4,0)}static{this.k_density=.1}static{this.k_particleRadius=(i.k_tileWidth+i.k_tileHeight)*.5*.2}static{this.k_dirtProbability=80}static{this.k_emptyProbability=10}static{this.k_oilProbability=7}static{this.k_waterProbability=3}static{this.k_frackingFluidEmitterLifetime=5}static{this.k_wellSuckSpeedInside=i.k_tileHeight*5}static{this.k_wellSuckSpeedOutside=i.k_tileWidth*1}static{this.k_frackingFluidChargeTime=1}static{this.k_scorePerOilParticle=1}static{this.k_scorePerWaterParticle=-1}static{this.k_scorePerFrackingParticle=0}static{this.k_scorePerFrackingDeployment=-10}},mh=class extends uh{constructor(e){super();this.m_score=0;this.m_oil=0;this.m_previousListener=null;this.m_world=e,this.m_previousListener=e.GetDestructionListener(),this.m_world.SetDestructionListener(this)}Destroy(){this.m_world&&this.m_world.SetDestructionListener(this.m_previousListener)}AddScore(e){this.m_score+=e}GetScore(){return this.m_score}AddOil(e){this.m_oil+=e}GetOil(){return this.m_oil}SayGoodbyeParticle(e,r){let o=e.GetUserDataBuffer()[r];if(o)switch(o){case 3:this.AddScore(j.k_scorePerOilParticle),this.AddOil(-1);break;case 4:this.AddScore(j.k_scorePerWaterParticle);break;default:break}}},ph=class i extends Zt{constructor(){super();this.m_wellX=j.k_worldWidthTiles-j.k_worldWidthTiles/4;this.m_wellTop=j.k_worldHeightTiles-1;this.m_wellBottom=j.k_worldHeightTiles/8;this.m_tracker=new ch;this.m_allowInput=!1;this.m_frackingFluidChargeTime=-1;this.m_material=[];this.m_bodies=[];this.m_listener=new mh(this.m_world);this.m_particleSystem.SetRadius(j.k_particleRadius),this.InitializeLayout(),this.CreateGround(),this.CreateWell(),this.CreateGeo(),this.CreatePlayer()}Destroy(){this.m_listener.Destroy()}InitializeLayout(){for(let e=0;e<j.k_worldTiles;++e)this.m_material[e]=0,this.m_bodies[e]=null}GetMaterial(e,r){return this.m_material[i.TileToArrayOffset(e,r)]}SetMaterial(e,r,o){this.m_material[i.TileToArrayOffset(e,r)]=o}GetBody(e,r){return this.m_bodies[i.TileToArrayOffset(e,r)]}SetBody(e,r,o){let s=this.m_bodies[i.TileToArrayOffset(e,r)];s&&this.m_world.DestroyBody(s),this.m_bodies[i.TileToArrayOffset(e,r)]=o}CreatePlayer(){this.m_player=this.m_world.CreateBody({type:1});let e=new v;e.SetAsBox(j.k_tileHalfWidth,j.k_tileHalfHeight,new n(j.k_tileHalfWidth,j.k_tileHalfHeight),0),this.m_player.CreateFixture({shape:e,density:j.k_density}),this.m_player.SetTransformVec(i.TileToWorld(j.k_worldWidthTiles/2,j.k_worldHeightTiles/2),0)}CreateGeo(){for(let e=0;e<j.k_worldWidthTiles;e++)for(let r=0;r<j.k_worldHeightTiles;r++){if(this.GetMaterial(e,r)!==0)continue;let o=Math.random()*100;o<j.k_dirtProbability||r===0?this.CreateDirtBlock(e,r):o<j.k_dirtProbability+j.k_emptyProbability?this.SetMaterial(e,r,0):o<j.k_dirtProbability+j.k_emptyProbability+j.k_oilProbability?this.CreateReservoirBlock(e,r,3):this.CreateReservoirBlock(e,r,4)}}CreateGround(){let e=this.m_world.CreateBody(),r=new dt,o=new n,s=new n;i.GetExtents(o,s);let l=[new n(o.x,o.y),new n(s.x,o.y),new n(s.x,s.y),new n(o.x,s.y)];r.CreateLoop(l,4),e.CreateFixture({shape:r})}CreateDirtBlock(e,r){let o=i.TileToWorld(e,r),s=this.m_world.CreateBody(),l=new v;l.SetAsBox(j.k_tileHalfWidth,j.k_tileHalfHeight,i.CenteredPosition(o),0),s.CreateFixture({shape:l,density:j.k_density}),this.SetBody(e,r,s),this.SetMaterial(e,r,1)}CreateReservoirBlock(e,r,o){let s=i.TileToWorld(e,r),l=new v;this.SetMaterial(e,r,o),l.SetAsBox(j.k_tileHalfWidth,j.k_tileHalfHeight,i.CenteredPosition(s),0);let a=new it;a.flags=672,a.shape=l,a.color.Copy(o===3?j.k_oilColor:j.k_waterColor);let c=this.m_particleSystem.CreateParticleGroup(a);this.m_listener.AddParticleGroup(c);let u=c.GetParticleCount(),m=this.m_particleSystem.GetUserDataBuffer(),p=c.GetBufferIndex();for(let d=0;d<u;++d)m[p+d]=this.m_material[i.TileToArrayOffset(e,r)];o===3&&this.m_listener.AddOil(u)}CreateWell(){for(let e=this.m_wellBottom;e<=this.m_wellTop;e++)this.SetMaterial(this.m_wellX,e,5)}CreateFrackingFluidEmitter(e){let r=new it,o=this.m_particleSystem.CreateParticleGroup(r);this.m_listener.AddParticleGroup(o);let s=new vi;s.SetGroup(o),s.SetParticleSystem(this.m_particleSystem),s.SetPosition(i.CenteredPosition(e)),s.SetVelocity(new n(0,-j.k_tileHalfHeight)),s.SetSpeed(j.k_tileHalfWidth*.1),s.SetSize(new n(j.k_tileHalfWidth,j.k_tileHalfHeight)),s.SetEmitRate(20),s.SetColor(j.k_frackingFluidColor),s.SetParticleFlags(160),this.m_tracker.Add(s,j.k_frackingFluidEmitterLifetime),this.m_listener.AddScore(j.k_scorePerFrackingDeployment)}SetPlayerPosition(e,r){let o=this.m_player.GetTransform().p,s=[0],l=[0];i.WorldToTile(o,s,l),e=et(e,0,j.k_worldWidthTiles-1),r=et(r,0,j.k_worldHeightTiles-1),this.GetMaterial(e,r)!==5&&(s[0]!==e||l[0]!==r)&&(this.DeployFrackingFluid(),this.m_player.SetTransformVec(i.TileToWorld(e,r),0))}DeployFrackingFluid(){let e=!1,r=this.m_player.GetTransform().p;return this.m_frackingFluidChargeTime>j.k_frackingFluidChargeTime&&(this.CreateFrackingFluidEmitter(r),e=!0),this.m_frackingFluidChargeTime=-1,e}DestroyParticlesInTiles(e,r,o,s){let l=new v,a=o-e+1,c=s-r+1,u=e+a/2,m=r+c/2;l.SetAsBox(j.k_tileHalfWidth*a,j.k_tileHalfHeight*c);let p=new T;p.SetPositionAngle(i.CenteredPosition(i.TileToWorld(u,m)),0),this.m_particleSystem.DestroyParticlesInShape(l,p)}JointDestroyed(e){super.JointDestroyed(e)}ParticleGroupDestroyed(e){super.ParticleGroupDestroyed(e)}BeginContact(e){super.BeginContact(e)}EndContact(e){super.EndContact(e)}PreSolve(e,r){super.PreSolve(e,r)}PostSolve(e,r){super.PostSolve(e,r)}getHotkeys(){return[G("a","Left",()=>this.AdjustPlayerPosition(-1,0)),G("d","Right",()=>this.AdjustPlayerPosition(1,0)),G("w","Up",()=>this.AdjustPlayerPosition(0,1)),G("s","Down",()=>this.AdjustPlayerPosition(0,-1)),G("e","Deploy Fracking",()=>{this.m_frackingFluidChargeTime<0?this.m_frackingFluidChargeTime=0:this.DeployFrackingFluid()})]}AdjustPlayerPosition(e,r){if(!this.m_allowInput)return;let o=this.m_player.GetTransform().p,s=[0],l=[0];i.WorldToTile(o,s,l),this.SetPlayerPosition(s[0]+e,l[0]+r),this.m_allowInput=!1}MouseDown(e){super.MouseDown(e),this.m_frackingFluidChargeTime=0}MouseUp(e){if(super.MouseUp(e),!!this.m_allowInput){if(!this.DeployFrackingFluid()){let r=this.m_player.GetTransform().p,o=[0],s=[0];i.WorldToTile(r,o,s);let l=n.Subtract(e,i.CenteredPosition(r),new n),a=Math.abs(l.x),c=Math.abs(l.y);a>c&&a>=j.k_tileHalfWidth?o[0]+=l.x>0?1:-1:c>=j.k_tileHalfWidth&&(s[0]+=l.y>0?1:-1),this.SetPlayerPosition(o[0],s[0])}this.m_allowInput=!1}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.m_tracker.Step(o),this.m_allowInput=!0,this.m_frackingFluidChargeTime>=0&&(this.m_frackingFluidChargeTime+=o);let s=this.m_player.GetTransform().p,l=[0],a=[0];i.WorldToTile(s,l,a),this.GetMaterial(l[0],a[0])===1&&(this.SetMaterial(l[0],a[0],0),this.SetBody(l[0],a[0],null)),this.DestroyParticlesInTiles(this.m_wellX,this.m_wellTop,this.m_wellX,this.m_wellTop);let c=this.m_listener.GetParticleGroups();for(let m of c){let p=m.GetBufferIndex(),d=this.m_particleSystem.GetPositionBuffer(),h=this.m_particleSystem.GetVelocityBuffer(),f=m.GetParticleCount();for(let b=0;b<f;++b){let x=i.CenteredPosition(i.TileToWorld(this.m_wellX,this.m_wellBottom-2)),_=d[p+b],y=n.Subtract(_,x,new n),g=Math.abs(y.x);if(g<j.k_tileWidth&&y.y>j.k_tileWidth*-2&&y.y<0){let S=n.Subtract(x,_,new n);S.Normalize(),h[p+b].Copy(S.Scale(j.k_wellSuckSpeedOutside))}else if(g<=j.k_tileHalfWidth&&y.y>0){let S=Math.random()*j.k_tileHalfWidth-y.x,w=new n(S,j.k_tileHeight);w.Normalize(),h[p+b].Copy(w.Scale(j.k_wellSuckSpeedInside))}}}let u=e.m_debugDraw;this.DrawPlayer(u),this.DrawWell(u),this.DrawScore()}DrawWell(e){for(let r=this.m_wellBottom;r<=this.m_wellTop;++r)this.DrawQuad(e,i.TileToWorld(this.m_wellX,r),j.k_wellColor)}DrawPlayer(e){this.DrawQuad(e,this.m_player.GetTransform().p,i.LerpColor(j.k_playerColor,j.k_playerFrackColor,Math.max(this.m_frackingFluidChargeTime/j.k_frackingFluidChargeTime,0)),!0)}DrawScore(){this.addDebug("Score",this.m_listener.GetScore()),this.addDebug("Remaining Oil",this.m_listener.GetOil())}DrawQuad(e,r,o,s=!1){let l=H(4,n),a=r.x+j.k_tileWidth,c=r.y+j.k_tileHeight;l[0].Set(r.x,c),l[1].Set(r.x,r.y),l[2].Set(a,r.y),l[3].Set(a,c),s?e.DrawPolygon(l,4,o):e.DrawSolidPolygon(l,4,o)}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}static GetBottomLeft(e){e.Set(j.k_worldCenterX-j.k_worldHalfWidth,j.k_worldCenterY-j.k_worldHalfHeight)}static GetExtents(e,r){i.GetBottomLeft(e),r.Set(j.k_worldCenterX+j.k_worldHalfWidth,j.k_worldCenterY+j.k_worldHalfHeight)}static WorldToTile(e,r,o){let s=new n;i.GetBottomLeft(s),r[0]=Math.floor((e.x-s.x)/j.k_tileWidth+j.k_tileHalfWidth),o[0]=Math.floor((e.y-s.y)/j.k_tileHeight+j.k_tileHalfHeight)}static TileToWorld(e,r,o=new n){let s=new n;return i.GetBottomLeft(s),o.Set(e*j.k_tileWidth+s.x,r*j.k_tileHeight+s.y)}static TileToArrayOffset(e,r){return e+r*j.k_worldWidthTiles}static CenteredPosition(e,r=new n){return r.Set(e.x+j.k_tileHalfWidth,e.y+j.k_tileHalfHeight)}static LerpColor(e,r,o){return new F(i.Lerp(e.r,r.r,o),i.Lerp(e.g,r.g,o),i.Lerp(e.b,r.b,o))}static Lerp(e,r,o){return e*(1-o)+r*o}};P("Particles","Fracker",ph);var dh=class i extends Zt{constructor(){super(n.ZERO);this.m_density=i.k_densityDefault;this.m_position=i.k_containerHalfHeight;this.m_temperature=i.k_temperatureDefault;this.m_barrierBody=null;this.m_particleGroup=null;{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-i.k_containerHalfWidth,0),new n(i.k_containerHalfWidth,0),new n(i.k_containerHalfWidth,i.k_containerHeight),new n(-i.k_containerHalfWidth,i.k_containerHeight)];r.CreateLoop(o,4),e.CreateFixture({shape:r,density:0,restitution:1})}this.EnableBarrier(),this.ResetParticles()}static{this.k_containerWidth=2}static{this.k_containerHeight=4}static{this.k_containerHalfWidth=i.k_containerWidth/2}static{this.k_containerHalfHeight=i.k_containerHeight/2}static{this.k_barrierHeight=i.k_containerHalfHeight/100}static{this.k_barrierMovementIncrement=i.k_containerHalfHeight*.1}static{this.k_densityStep=1.25}static{this.k_densityMin=.01}static{this.k_densityMax=.8}static{this.k_densityDefault=.25}static{this.k_temperatureStep=.2}static{this.k_temperatureMin=.4}static{this.k_temperatureMax=10}static{this.k_temperatureDefault=5}DisableBarrier(){this.m_barrierBody&&(this.m_world.DestroyBody(this.m_barrierBody),this.m_barrierBody=null)}EnableBarrier(){if(!this.m_barrierBody){this.m_barrierBody=this.m_world.CreateBody();let e=new v;e.SetAsBox(i.k_containerHalfWidth,i.k_barrierHeight,new n(0,this.m_position),0),this.m_barrierBody.CreateFixture({shape:e,density:0,restitution:1})}}ToggleBarrier(){this.m_barrierBody?this.DisableBarrier():this.EnableBarrier()}ResetParticles(){this.m_particleGroup!==null&&(this.m_particleGroup.DestroyParticles(!1),this.m_particleGroup=null),this.m_particleSystem.SetRadius(i.k_containerHalfWidth/20);{let e=new v;e.SetAsBox(this.m_density*i.k_containerHalfWidth,this.m_density*i.k_containerHalfHeight,new n(0,i.k_containerHalfHeight),0);let r=new it;r.flags=64,r.shape=e,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(r);let o=this.m_particleSystem.GetVelocityBuffer(),s=this.m_particleGroup.GetBufferIndex();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=o[s+l];a.Set(W(-1,1)+1,W(-1,1)+1),a.Normalize(),a.Scale(this.m_temperature)}}}getHotkeys(){return[G("a","Toggle Barrier",()=>this.ToggleBarrier()),G("m","Increase the Particle Density",()=>{this.m_density=Math.min(this.m_density*i.k_densityStep,i.k_densityMax),this.Reset()}),G("n","Reduce the Particle Density",()=>{this.m_density=Math.max(this.m_density/i.k_densityStep,i.k_densityMin),this.Reset()}),G("w","Move the location of the divider up",()=>this.MoveDivider(this.m_position+i.k_barrierMovementIncrement)),G("s","Move the location of the divider down",()=>this.MoveDivider(this.m_position-i.k_barrierMovementIncrement)),G("h","Reduce the temperature (velocity of particles)",()=>{this.m_temperature=Math.max(this.m_temperature-i.k_temperatureStep,i.k_temperatureMin),this.Reset()}),G("j","Increase the temperature (velocity of particles)",()=>{this.m_temperature=Math.min(this.m_temperature+i.k_temperatureStep,i.k_temperatureMax),this.Reset()})]}InContainer(e){return e.x>=-i.k_containerHalfWidth&&e.x<=i.k_containerHalfWidth&&e.y>=0&&e.y<=i.k_containerHalfHeight*2}MouseDown(e){this.InContainer(e)||super.MouseDown(e)}MouseUp(e){this.InContainer(e)?this.ToggleBarrier():(this.MoveDivider(e.y),super.MouseUp(e))}Step(e,r){super.Step(e,r);let o=0,s=0;if(this.m_particleGroup){let c=this.m_particleGroup.GetBufferIndex(),u=this.m_particleSystem.GetVelocityBuffer(),m=this.m_particleSystem.GetPositionBuffer();for(let p=0;p<this.m_particleGroup.GetParticleCount();p++){let d=u[c+p];d.Normalize(),d.Scale(this.m_temperature),m[c+p].y>this.m_position?o++:s++}}let l=o/(i.k_containerHeight-this.m_position),a=s/this.m_position;this.addDebug("Score",l>0?a/l-1:0)}Reset(){this.DisableBarrier(),this.ResetParticles(),this.EnableBarrier()}MoveDivider(e){this.m_position=et(e,i.k_barrierMovementIncrement,i.k_containerHeight-i.k_barrierMovementIncrement),this.Reset()}GetDefaultViewZoom(){return 250}getCenter(){return{x:0,y:2}}};P("Particles","Maxwell",dh);var hh=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody(),o=5,s=5;for(let l=30;l>0;l-=s){let a=new v,c=[new n(-25,l),new n(-25,l-s),new n(0,15)];a.Set(c,3),r.CreateFixture({shape:a})}for(let l=-25;l<25;l+=o){let a=new v,c=[new n(l,0),new n(l+o,0),new n(0,15)];a.Set(c,3),r.CreateFixture({shape:a})}}this.m_particleSystem.SetRadius(.25);let e=t.GetValue();e===0&&this.m_particleSystem.SetDamping(.2);{let r=new V;r.m_p.Set(-20,33),r.m_radius=3;let o=new it;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}getCenter(){return{x:0,y:10}}};P("Particles","Ramp",hh);var fh=class extends ht{constructor({particleParameter:e}){super(e);this.m_killfieldShape=new v;this.m_killfieldTransform=new T;e.SetValues(Be,"water");{let s=this.m_world.CreateBody(),l=1;for(let a=-10;a<10;a+=l){let c=new v,u=[new n(a,-10),new n(a+l,-10),new n(0,25)];c.Set(u,3),s.CreateFixture({shape:c})}}this.m_particleSystem.SetRadius(.25*2),e.GetValue()===0&&this.m_particleSystem.SetDamping(.2),this.m_killfieldShape=new v,this.m_killfieldShape.SetAsBox(50,1),this.m_killfieldTransform=new T;let o=new n(-25,1);this.m_killfieldTransform.SetPositionAngle(o,0)}Step(e,r){super.Step(e,r);let o=this.particleParameter.GetValue(),s=new wi;if(s.position.Set(0,33),s.velocity.Set(0,-1),s.flags=o,o&24){let l=this.m_particleSystem.GetParticleCount();s.velocity.Set(l&1?-1:1,-5),s.flags|=4096}this.m_particleSystem.CreateParticle(s),this.m_particleSystem.DestroyParticlesInShape(this.m_killfieldShape,this.m_killfieldTransform)}getCenter(){return{x:0,y:20}}};P("Particles","Pointy",fh);var bh=class extends ht{constructor({particleParameter:e}){super(e);this.m_particlesToCreate=300;{let o=this.m_world.CreateBody(),s=1;for(let l=-10;l<10;l+=s){let a=new v,c=[new n(l,-10),new n(l+s,-10),new n(0,15)];a.Set(c,3),o.CreateFixture({shape:a})}for(let l=-10;l<35;l+=s){let a=new v,c=[new n(-10,l),new n(-10,l+s),new n(0,15)];a.Set(c,3),o.CreateFixture({shape:a});let u=[new n(10,l),new n(10,l+s),new n(0,15)];a.Set(u,3),o.CreateFixture({shape:a})}}this.m_particlesToCreate=300,this.m_particleSystem.SetRadius(.25*2),e.GetValue()===0&&this.m_particleSystem.SetDamping(.2),e.SetValues(Be,"water")}Step(e,r){if(super.Step(e,r),this.m_particlesToCreate<=0)return;--this.m_particlesToCreate;let o=this.particleParameter.GetValue(),s=new wi;if(s.position.Set(0,40),s.velocity.Set(0,-1),s.flags=o,o&24){let l=this.m_particleSystem.GetParticleCount();s.velocity.Set(l&1?-1:1,-5),s.flags|=4096}this.m_particleSystem.CreateParticle(s)}getCenter(){return{x:0,y:20}}};P("Particles","AntiPointy",bh);var _h=class extends ht{constructor({particleParameter:t}){super(t);{let r=this.m_world.CreateBody();{let c=new v,u=[new n(-20,30),new n(-20,0),new n(-25,0),new n(-25,30)];c.Set(u),r.CreateFixture({shape:c})}let o=30,s=o/10,l=20,a=l/2;{let c=new v,u=[new n(-25,0),new n(20,15),new n(25,0)];c.Set(u),r.CreateFixture({shape:c})}for(let c=-l;c<l;c+=a){let u=new v,m=[new n(-25,0),new n(c,15),new n(c+a,15)];u.Set(m),r.CreateFixture({shape:u})}for(let c=0;c<o;c+=s){let u=new v,m=[new n(25,c),new n(25,c+s),new n(20,15)];u.Set(m),r.CreateFixture({shape:u})}}this.m_particleSystem.SetRadius(1);let e=t.GetValue();{let r=new V;r.m_p.Set(0,35),r.m_radius=12;let o=new it;o.flags=e,o.shape=r;let s=this.m_particleSystem.CreateParticleGroup(o);o.flags&256&&this.ColorParticleGroup(s,0)}}getCenter(){return{x:0,y:20}}};P("Particles","Corner Case",_h);var yh=class extends Gr{constructor(){super(...arguments);this.m_enableFixtureParticleCollisions=!0;this.m_enableParticleParticleCollisions=!0}ShouldCollideFixtureParticle(){return this.m_enableFixtureParticleCollisions}ShouldCollideParticleParticle(){return this.m_enableParticleParticleCollisions}},xh=class i extends Zt{constructor(){super(n.ZERO);this.m_contactDisabler=new yh;this.m_world.SetContactFilter(this.m_contactDisabler);{let e=this.m_world.CreateBody(),r=new dt,o=[new n(-i.kBoxSize,-i.kBoxSize+i.kOffset),new n(i.kBoxSize,-i.kBoxSize+i.kOffset),new n(i.kBoxSize,i.kBoxSize+i.kOffset),new n(-i.kBoxSize,i.kBoxSize+i.kOffset)];r.CreateLoop(o),e.CreateFixture({shape:r,density:0,restitution:1})}this.m_particleSystem.SetRadius(.5);{let e=new v;e.SetAsBox(1.5,1.5,new n(i.kBoxSizeHalf,i.kBoxSizeHalf+i.kOffset),0);let r=new it;r.shape=e,r.flags=196672,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(r);let o=this.m_particleSystem.GetVelocityBuffer(),s=this.m_particleGroup.GetBufferIndex();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=o[s+l];a.Set(W(-1,1),W(-1,1)),a.Normalize(),a.Scale(i.kSpeedup)}}}Step(e,r){super.Step(e,r);let o=this.m_particleGroup.GetBufferIndex(),s=this.m_particleSystem.GetVelocityBuffer();for(let l=0;l<this.m_particleGroup.GetParticleCount();++l){let a=s[o+l];a.Normalize(),a.Scale(i.kSpeedup)}}getCenter(){return{x:0,y:20}}getHotkeys(){return[G("a","Toggle Fixture Collisions",()=>this.ToggleFixtureCollisions()),G("s","Toggle Particle Collisions",()=>this.ToggleParticleCollisions())]}ToggleFixtureCollisions(){this.m_contactDisabler.m_enableFixtureParticleCollisions=!this.m_contactDisabler.m_enableFixtureParticleCollisions}ToggleParticleCollisions(){this.m_contactDisabler.m_enableParticleParticleCollisions=!this.m_contactDisabler.m_enableParticleParticleCollisions}static{this.kBoxSize=10}static{this.kBoxSizeHalf=i.kBoxSize/2}static{this.kOffset=20}static{this.kParticlesContainerSize=i.kOffset+.5}static{this.kSpeedup=8}};P("Particles","Particle Collisions",xh);var gh=class extends Zt{constructor(){super(),this.m_particleSystem.SetDamping(.2),this.m_particleSystem.SetRadius(.3*2),this.m_particleSystem.SetGravityScale(.4),this.m_particleSystem.SetDensity(1.2);let t=this.m_world.CreateBody(),e=this.m_world.CreateBody({type:0,allowSleep:!1}),r=new v;r.SetAsBox(.5,10,new n(20,0),0),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,10,new n(-20,0),0),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,20,new n(0,10),Math.PI/2),e.CreateFixture({shape:r,density:5}),r.SetAsBox(.5,20,new n(0,-10),Math.PI/2),e.CreateFixture({shape:r,density:5}),this.m_mover=this.m_world.CreateBody({type:2}),r.SetAsBox(1,5,new n(0,2),0),this.m_mover.CreateFixture({shape:r,density:5});let o=new q;o.bodyA=t,o.bodyB=this.m_mover,o.localAnchorA.Set(0,0),o.localAnchorB.Set(0,5),o.referenceAngle=0,o.motorSpeed=0,o.maxMotorTorque=1e7,o.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(o);let s=new it;s.flags=0;let l=new v;l.SetAsBox(9,9,new n,0),s.shape=l,this.m_particleSystem.CreateParticleGroup(s)}Step(t,e){let r=new Date().getTime();this.m_joint.SetMotorSpeed(.7*Math.cos(r/1e3)),super.Step(t,e)}};P("Particles","Eye Candy",gh);var Hr=class{constructor(t,e,r){this.gl=t,this.default_sfactor=e,this.default_dfactor=r,this.sfactor=e,this.dfactor=r}set(t,e){this.sfactor=t,this.dfactor=e}reset(){this.sfactor=this.default_sfactor,this.dfactor=this.default_dfactor}apply(){this.gl.blendFunc(this.sfactor,this.dfactor)}};var Or=class{constructor(t=0,e=0,r=0,o=1){this.r=t,this.g=e,this.b=r,this.a=o}set(t,e,r,o=1){this.r=t,this.g=e,this.b=r,this.a=o}copy(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}toFloatBits(){return Math.round(255*this.a)<<24|Math.round(255*this.b)<<16|Math.round(255*this.g)<<8|Math.round(255*this.r)}};var jn=class{constructor(t,e,r){this.gl=t,this.width=e,this.height=r,this.texture=this.createTexture(),this.framebufferHandle=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebufferHandle),this.bindTexture(),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture,0),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.bindTexture();let o=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),o!==this.gl.FRAMEBUFFER_COMPLETE)throw this.dispose(),o===this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?new Error("Frame buffer couldn't be constructed: incomplete attachment"):o===this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?new Error("Frame buffer couldn't be constructed: incomplete dimensions"):o===this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?new Error("Frame buffer couldn't be constructed: missing attachment"):o===this.gl.FRAMEBUFFER_UNSUPPORTED?new Error("Frame buffer couldn't be constructed: unsupported combination of formats"):new Error(`Frame buffer couldn't be constructed: unknown error ${o}`)}bindTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}createTexture(){let t=this.gl.RGBA,e=this.gl.UNSIGNED_BYTE,r=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,t,this.width,this.height,0,t,e,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),r}dispose(){this.gl.deleteTexture(this.texture),this.gl.deleteFramebuffer(this.framebufferHandle)}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebufferHandle)}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}begin(){this.bind(),this.lastViewport=this.gl.getParameter(this.gl.VIEWPORT),this.gl.viewport(0,0,this.width,this.height)}endSimple(){this.end(this.lastViewport[0],this.lastViewport[1],this.lastViewport[2],this.lastViewport[3])}end(t,e,r,o){this.unbind(),this.gl.viewport(t,e,r,o)}};var ni=class{constructor(t,e,r){this.gl=t,this.buffer=t.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}setData(t,e=!0){e&&this.bind(),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,t),e&&this.unbind()}bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer)}unbind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}dispose(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.deleteBuffer(this.buffer)}};var Xn=class i{constructor(t,e){this.vertexNum=0;this.lightMapDrawingDisabled=!1;this.gl=t,this.setVertexNum(e)}static{this.MIN_VERTS=4}setVertexNum(t){t<i.MIN_VERTS&&(t=i.MIN_VERTS),this.vertexNum<t&&(this.vertexNum=t,this.vertices=new Float32Array(this.vertexNum*4),this.colors=new Int32Array(this.vertexNum*2),this.colorScales=new Float32Array(this.vertexNum*2),this.vertBuffer&&this.vertBuffer.dispose(),this.vertBuffer=new ni(this.gl,this.gl.DYNAMIC_DRAW,this.vertices),this.colorBuffer&&this.colorBuffer.dispose(),this.colorBuffer=new ni(this.gl,this.gl.DYNAMIC_DRAW,this.colors),this.sBuffer&&this.sBuffer.dispose(),this.sBuffer=new ni(this.gl,this.gl.DYNAMIC_DRAW,this.colorScales))}getVertices(){return this.vertices}getColors(){return this.colors}getColorScales(){return this.colorScales}render(t,e,r){this.vertBuffer.bind(),t.a_position.enable(),t.a_position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.colorBuffer.bind(),t.quad_colors.enable(),t.quad_colors.set(4,this.gl.UNSIGNED_BYTE,!0,0,0),this.colorBuffer.unbind(),this.sBuffer.bind(),t.s.enable(),t.s.set(1,this.gl.FLOAT,!1,0,0),this.sBuffer.unbind(),this.gl.drawArrays(e,0,r),t.a_position.disable(),t.quad_colors.disable(),t.s.disable()}update(){this.vertBuffer.setData(this.vertices),this.colorBuffer.setData(this.colors),this.sBuffer.setData(this.colorScales)}dispose(){this.vertBuffer.dispose(),this.colorBuffer.dispose(),this.sBuffer.dispose()}};var xo=class{constructor(){this.data=[1,0,0,0,1,0,0,0,1]}mulVec2(t){let e=t.x*this.data[0]+t.y*this.data[3]+this.data[6],r=t.x*this.data[1]+t.y*this.data[4]+this.data[7];return t.x=e,t.y=r,t}setToTranslation(t){let e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t.x,e[7]=t.y,e[8]=1,this}setToRotationRad(t){let e=Math.cos(t),r=Math.sin(t),o=this.data;return o[0]=e,o[1]=r,o[2]=0,o[3]=-r,o[4]=e,o[5]=0,o[6]=0,o[7]=0,o[8]=1,this}det(){let t=this.data;return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}set(t,e,r,o,s,l,a,c,u){return this.data[0]=t,this.data[1]=e,this.data[2]=r,this.data[3]=o,this.data[4]=s,this.data[5]=l,this.data[6]=a,this.data[7]=c,this.data[8]=u,this}inv(){let t=this.det();if(t===0)throw new Error("Can't invert a singular matrix");let e=1/t,r=this.data;return this.set(e*(r[4]*r[8]-r[5]*r[7]),e*(r[2]*r[7]-r[1]*r[8]),e*(r[1]*r[5]-r[2]*r[4]),e*(r[5]*r[6]-r[3]*r[8]),e*(r[0]*r[8]-r[2]*r[6]),e*(r[2]*r[3]-r[0]*r[5]),e*(r[3]*r[7]-r[4]*r[6]),e*(r[1]*r[6]-r[0]*r[7]),e*(r[0]*r[4]-r[1]*r[3]))}rotateRad(t){if(t===0)return this;let e=Math.cos(t),r=Math.sin(t);return this.mul(eA.set(e,r,0,-r,e,0,0,0,1))}mul(t){let e=this.data,r=t.data;return this.set(e[0]*r[0]+e[3]*r[1]+e[6]*r[2],e[1]*r[0]+e[4]*r[1]+e[7]*r[2],e[2]*r[0]+e[5]*r[1]+e[8]*r[2],e[0]*r[3]+e[3]*r[4]+e[6]*r[5],e[1]*r[3]+e[4]*r[4]+e[7]*r[5],e[2]*r[3]+e[5]*r[4]+e[8]*r[5],e[0]*r[6]+e[3]*r[7]+e[6]*r[8],e[1]*r[6]+e[4]*r[7]+e[7]*r[8],e[2]*r[6]+e[5]*r[7]+e[8]*r[8])}},eA=new xo;var xs=Math.PI/180,uu=180/Math.PI;function gs(i){return Math.sin(xs*i)}function Ss(i){return Math.cos(xs*i)}function Ge(i,t=0){let e=new Array(i);for(let r=0;r<i;r++)e[r]=t;return e}var Hn=class{constructor(){this.x=0;this.y=0;this.width=0;this.height=0}set(t,e,r,o){return this.x=t,this.y=e,this.width=r,this.height=o,this}contains(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}};var nr=class i{static{this.COSINE_THRESHOLD=.001}constructor(t=0,e=0){this.real=t,this.complex=e}setAngle(t){return t/=2,this.set(Math.cos(t),Math.sin(t))}copy(t){return this.set(t.real,t.complex),this}set(t,e){return this.real=t,this.complex=e,this}scale(t){return this.real*=t,this.complex*=t,this}invert(){return this.complex=-this.complex,this.scale(this.len2()),this}add(t){return this.real+=t.real,this.complex+=t.complex,this}addAngle(t){return t/=2,this.real+=Math.cos(t),this.complex+=Math.sin(t),this}sub(t){return this.real-=t.real,this.complex-=t.complex,this}subAngle(t){return t/=2,this.real-=Math.cos(t),this.complex-=Math.sin(t),this}len(){return Math.sqrt(this.real*this.real+this.complex*this.complex)}len2(){return this.real*this.real+this.complex*this.complex}mul(t){return this.set(this.real*t.real-this.complex*t.complex,this.real*t.complex+this.complex*t.real),this}nor(){let t=this.len();return this.real/=t,this.complex/=t,this}angle(){return Math.atan2(this.complex,this.real)*2}lerp(t,e,r){return this.scale(1-e),r.copy(t).scale(e),this.add(r),this.nor(),this}slerp(t,e){let r,o,s,l,a,c,u;return l=this.real*t.real+this.complex*t.complex,l<0?(l=-l,o=-t.complex,r=-t.real):(o=t.complex,r=t.real),1-l>i.COSINE_THRESHOLD?(s=Math.acos(l),a=Math.sin(s),c=Math.sin((1-e)*s)/a,u=Math.sin(e*s)/a):(c=1-e,u=e),this.complex=c*this.complex+u*o,this.real=c*this.real+u*r,this}toString(){let t=this.angle();return`radians: ${t}, degrees: ${t*uu*t}`}};var zt=class i{constructor(){this.x=0;this.y=0}set(t,e){return this.x=t,this.y=e,this}copy(t){return this.x=t.x,this.y=t.y,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){let t=this.length();if(t>0){let e=1/t;this.x*=e,this.y*=e}return this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,e){return this.x+=t,this.y+=e,this}subXY(t,e){return this.x-=t,this.y-=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}scale(t){return this.x*=t,this.y*=t,this}rotate(t){let e=Math.cos(t),r=Math.sin(t),{x:o}=this;return this.x=e*o-r*this.y,this.y=r*o+e*this.y,this}rotate90(t){let{x:e}=this;return t>=0?(this.x=-this.y,this.y=e):(this.x=this.y,this.y=-e),this}getAngle(){return Math.atan2(this.y,this.x)}static MakeArray(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=new i;return e}};var fe={isDiffuse:!1,gammaCorrection:1};function On(i,t){let e=i.indexOf(t);e>=0&&i.splice(e,1)}var Lt=class i{constructor(t,e,r,o,s){this.color=new Or;this.tmpPosition=new zt;this.active=!0;this.soft=!0;this.xray=!1;this.staticLight=!1;this.culled=!1;this.dirty=!0;this.ignoreBody=!1;this.rayNum=0;this.vertexNum=0;this.distance=0;this.direction=0;this.colorF=0;this.softShadowLength=2.5;this.softShadowMesh=null;this.mx=[];this.my=[];this.f=[];this.m_index=0;this.contactFilter=null;this.rayCast=t.createRayCastCallback(this),t.lightList.push(this),this.rayHandler=t,this.gl=t.gl,this.setRayNum(e,!1),this.setColorC(r),this.setDistance(o),this.setSoftnessLength(Number.isFinite(o)?o*.1:this.softShadowLength),this.setDirection(s),this.lightMesh=new Xn(this.gl,this.vertexNum),this.setupSoftShadowMesh()}static{this.DefaultColor=new Or(.75,.75,.5,.75)}static{this.DebugColor=new Or(1,1,0)}static{this.MIN_RAYS=3}static{this.globalContactFilter=null}setupSoftShadowMesh(){let t=this.soft&&!this.xray;this.softShadowMesh&&!t?(this.softShadowMesh.dispose(),this.softShadowMesh=null):this.softShadowMesh=new Xn(this.gl,this.getSoftShadowVertexCount())}getSoftShadowVertexCount(){return this.vertexNum}getPosition(){return this.tmpPosition}setColorC(t){this.color.copy(t),this.colorF=this.color.toFloatBits(),this.staticLight&&(this.dirty=!0)}setColor(t,e,r,o){this.color.set(t,e,r,o),this.colorF=this.color.toFloatBits(),this.staticLight&&(this.dirty=!0)}add(t){this.rayHandler=t,this.active?t.lightList.push(this):t.disabledLights.push(this)}remove(t=!0){this.rayHandler.removeLight(this),t&&this.dispose()}dispose(){this.lightMesh.dispose(),this.softShadowMesh?.dispose()}isActive(){return this.active}setActive(t){t!==this.active&&(this.active=t,t?(this.rayHandler.lightList.push(this),On(this.rayHandler.disabledLights,this)):(this.rayHandler.disabledLights.push(this),On(this.rayHandler.lightList,this)))}isXray(){return this.xray}setXray(t){this.xray=t,this.staticLight&&(this.dirty=!0),this.setupSoftShadowMesh()}isStaticLight(){return this.staticLight}setStaticLight(t){this.staticLight=t,t&&(this.dirty=!0)}isSoft(){return this.soft}setSoft(t){this.soft=t,this.staticLight&&(this.dirty=!0),this.setupSoftShadowMesh()}getSoftShadowLength(){return this.softShadowLength}setSoftnessLength(t){this.softShadowLength=t,this.staticLight&&(this.dirty=!0)}getColor(){return this.color}getDistance(){return this.distance/fe.gammaCorrection}getDirection(){return this.direction}contains(t,e){return!1}setIgnoreAttachedBody(t){this.ignoreBody=t}getIgnoreAttachedBody(){return this.ignoreBody}setRayNum(t,e=!0){t<i.MIN_RAYS&&(t=i.MIN_RAYS),this.rayNum=t,this.vertexNum=t+1,e&&(this.lightMesh.setVertexNum(this.vertexNum),this.softShadowMesh?.setVertexNum(this.getSoftShadowVertexCount())),this.mx=Ge(this.vertexNum),this.my=Ge(this.vertexNum),this.f=Ge(this.vertexNum)}getRayNum(){return this.rayNum}setContactFilter(t){this.contactFilter=t}getContactFilter(){return this.contactFilter}setContactFilterBits(t,e,r){this.contactFilter={categoryBits:t,groupIndex:e,maskBits:r}}static setGlobalContactFilter(t){this.globalContactFilter=t}static setGlobalContactFilterBits(t,e,r){this.globalContactFilter={categoryBits:t,groupIndex:e,maskBits:r}}static getGlobalContactFilter(){return this.globalContactFilter}reportFixture(t,e,r,o){let s=i.getGlobalContactFilter();if(s&&!this.runContactFilter(s,t))return-1;let l=this.getContactFilter();return l&&!this.runContactFilter(l,t)||this.ignoreBody&&this.getBody()===e?-1:(this.mx[this.m_index]=r.x,this.my[this.m_index]=r.y,this.f[this.m_index]=o,o)}runContactFilter(t,e){return t.groupIndex!==0&&t.groupIndex===e.groupIndex?t.groupIndex>0:(t.maskBits&e.categoryBits)!==0&&(t.categoryBits&e.maskBits)!==0}};var iA={v1:new zt,v2:new zt,vSegmentStart:new zt,vDirection:new zt,vRayOffset:new zt,previousAngle:new nr,currentAngle:new nr,nextAngle:new nr,startAngle:new nr,endAngle:new nr,rayAngle:new nr},mu=class i extends Lt{constructor(e,r,o,s,l,a){super(e,r,o,s,0);this.chain=[];this.bodyAngle=0;this.bodyAngleOffset=0;this.body=null;this.segmentAngles=[];this.segmentLengths=[];this.startX=[];this.startY=[];this.endX=[];this.endY=[];this.bodyPosition=new zt;this.tmpEnd=new zt;this.tmpStart=new zt;this.tmpPerp=new zt;this.tmpVec=new zt;this.zeroPosition=new xo;this.rotateAroundZero=new xo;this.restorePosition=new xo;this.chainLightBounds=new Hn;this.rayHandlerBounds=new Hn;this.rayStartOffset=i.defaultRayStartOffset,this.rayDirection=l,this.vertexNum=(this.vertexNum-1)*2,this.endX=Ge(r),this.endY=Ge(r),this.startX=Ge(r),this.startY=Ge(r),this.chain=a?a.slice():[],this.setMesh()}static{this.defaultRayStartOffset=.001}update(){this.dirty?(this.updateChain(),this.applyAttachment()):this.updateBody(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}render(){this.rayHandler.culling&&this.culled||(this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum))}debugRender(e){let r=[];for(let o=0;o<this.rayNum;o++)r.push({x:this.mx[o],y:this.my[o]});for(let o=this.rayNum-1;o>-1;o--)r.push({x:this.startX[o],y:this.startY[o]});e(r,r.length,Lt.DebugColor)}attachToBody(e,r=0){this.body=e,this.bodyPosition.copy(this.rayHandler.getBodyPosition(this.body)),this.bodyAngleOffset=xs*r,this.bodyAngle=this.rayHandler.getBodyAngle(e),this.applyAttachment(),this.staticLight&&(this.dirty=!0)}getBody(){return this.body}getX(){return this.tmpPosition.x}getY(){return this.tmpPosition.y}setPosition(e,r){this.tmpPosition.set(e,r),this.staticLight&&(this.dirty=!0)}setPositionV(e){this.tmpPosition.copy(e),this.staticLight&&(this.dirty=!0)}contains(e,r){if(!this.chainLightBounds.contains(e,r))return!1;let o=[];for(let a=0;a<this.rayNum;a++)o.push(this.mx[a],this.my[a]);for(let a=this.rayNum-1;a>-1;a--)o.push(this.startX[a],this.startY[a]);let s=0;for(let a=0;a<o.length;a+=2){let c=o[a],u=o[a+1],m=o[(a+2)%o.length],p=o[(a+3)%o.length];(u<=r&&r<p||p<=r&&r<u)&&e<(m-c)/(p-u)*(r-u)+c&&s++}return(s&1)===1}setDistance(e){e*=fe.gammaCorrection,this.distance=e<.01?.01:e,this.dirty=!0}setDirection(e){}updateChain(){let{v1:e,v2:r,vSegmentStart:o,vDirection:s,vRayOffset:l,previousAngle:a,currentAngle:c,nextAngle:u,startAngle:m,endAngle:p,rayAngle:d}=iA,h=Math.round(this.chain.length/2)-1;this.segmentAngles.length=0,this.segmentLengths.length=0;let f=0;for(let _=0,y=0;_<this.chain.length-2;_+=2,y++)e.set(this.chain[_+2],this.chain[_+3]).subXY(this.chain[_],this.chain[_+1]),this.segmentLengths.push(e.length()),this.segmentAngles.push(e.rotate90(this.rayDirection).getAngle()),f+=this.segmentLengths[y];let b=0,x=this.rayNum;for(let _=0;_<h;_++){a.setAngle(_===0?this.segmentAngles[_]:this.segmentAngles[_-1]),c.setAngle(this.segmentAngles[_]),u.setAngle(_===this.segmentAngles.length-1?this.segmentAngles[_]:this.segmentAngles[_+1]),m.copy(a).slerp(c,.5),p.copy(c).slerp(u,.5);let y=_*2;o.set(this.chain[y],this.chain[y+1]),s.set(this.chain[y+2],this.chain[y+3]).sub(o).normalize();let g=f/x,S=_===h-1?x:Math.round(this.segmentLengths[_]/f*x);for(let w=0;w<S;w++){let B=w*g;d.copy(m).slerp(p,B/this.segmentLengths[_]);let C=d.angle();l.set(this.rayStartOffset,0).rotate(C),e.copy(s).scale(B).add(o).add(l),this.startX[b]=e.x,this.startY[b]=e.y,r.set(this.distance,0).rotate(C).add(e),this.endX[b]=r.x,this.endY[b]=r.y,b++}x-=S,f-=this.segmentLengths[_]}}applyAttachment(){if(!(!this.body||this.staticLight)){this.restorePosition.setToTranslation(this.bodyPosition),this.rotateAroundZero.setToRotationRad(this.bodyAngle+this.bodyAngleOffset);for(let e=0;e<this.rayNum;e++)this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.tmpVec.set(this.startX[e],this.startY[e]))),this.startX[e]=this.tmpVec.x,this.startY[e]=this.tmpVec.y,this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.tmpVec.set(this.endX[e],this.endY[e]))),this.endX[e]=this.tmpVec.x,this.endY[e]=this.tmpVec.y}}cull(){return this.rayHandler.culling?(this.updateBoundingRects(),this.culled=this.chainLightBounds.width>0&&this.chainLightBounds.height>0&&!this.chainLightBounds.overlaps(this.rayHandlerBounds)):this.culled=!1,this.culled}updateBody(){if(!this.body||this.staticLight)return;let e=this.rayHandler.getBodyPosition(this.body),r=this.rayHandler.getBodyAngle(this.body);this.tmpVec.set(0,0).sub(this.bodyPosition),this.bodyPosition.copy(e),this.zeroPosition.setToTranslation(this.tmpVec),this.restorePosition.setToTranslation(this.bodyPosition),this.rotateAroundZero.setToRotationRad(this.bodyAngle).inv().rotateRad(r),this.bodyAngle=r;for(let o=0;o<this.rayNum;o++)this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.zeroPosition.mulVec2(this.tmpVec.set(this.startX[o],this.startY[o])))),this.startX[o]=this.tmpVec.x,this.startY[o]=this.tmpVec.y,this.restorePosition.mulVec2(this.rotateAroundZero.mulVec2(this.zeroPosition.mulVec2(this.tmpVec.set(this.endX[o],this.endY[o])))),this.endX[o]=this.tmpVec.x,this.endY[o]=this.tmpVec.y}updateMesh(){for(let e=0;e<this.rayNum;e++)this.m_index=e,this.f[e]=1,this.tmpEnd.x=this.endX[e],this.mx[e]=this.tmpEnd.x,this.tmpEnd.y=this.endY[e],this.my[e]=this.tmpEnd.y,this.tmpStart.x=this.startX[e],this.tmpStart.y=this.startY[e],this.xray||this.rayCast(this.tmpStart,this.tmpEnd);this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;for(let c=0;c<this.rayNum;c++)e[r++]=this.startX[c],e[r++]=this.startY[c],o[s++]=this.colorF,l[a++]=1,e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1-this.f[c];if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++){c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF;let b=1-this.f[f];d[h++]=b,this.tmpPerp.set(this.mx[f],this.my[f]).subXY(this.startX[f],this.startY[f]).normalize().scale(this.softShadowLength*b).addXY(this.mx[f],this.my[f]),c[u++]=this.tmpPerp.x,c[u++]=this.tmpPerp.y,m[p++]=0,d[h++]=0}this.softShadowMesh.update()}}updateBoundingRects(){let e=this.startX[0],r=this.startX[0],o=this.startY[0],s=this.startY[0];for(let l=0;l<this.rayNum;l++)e=e>this.startX[l]?e:this.startX[l],e=e>this.mx[l]?e:this.mx[l],r=r<this.startX[l]?r:this.startX[l],r=r<this.mx[l]?r:this.mx[l],o=o>this.startY[l]?o:this.startY[l],o=o>this.my[l]?o:this.my[l],s=s<this.startY[l]?s:this.startY[l],s=s<this.my[l]?s:this.my[l];this.chainLightBounds.set(r,s,e-r,o-s),this.rayHandlerBounds.set(this.rayHandler.x1,this.rayHandler.y1,this.rayHandler.x2-this.rayHandler.x1,this.rayHandler.y2-this.rayHandler.y1)}};var ws=class extends Lt{constructor(e,r,o,s,l,a,c){super(e,r,o,s,c);this.tmpEnd=new zt;this.start=new zt;this.body=null;this.bodyOffsetX=0;this.bodyOffsetY=0;this.bodyAngleOffset=0;this.sin=[];this.cos=[];this.endX=[];this.endY=[];this.start.x=l,this.start.y=a,this.setMesh()}getSoftShadowVertexCount(){return this.vertexNum*2}update(){this.updateBody(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}render(){this.rayHandler.culling&&this.culled||(this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_FAN,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.getSoftShadowVertexCount()-2))}debugRender(e){let r=[this.start];for(let o=0;o<this.rayNum;o++)r.push({x:this.mx[o],y:this.my[o]});e(r,r.length,Lt.DebugColor)}attachToBody(e,r=0,o=0,s=0){this.body=e,this.bodyOffsetX=r,this.bodyOffsetY=o,this.bodyAngleOffset=s,this.staticLight&&(this.dirty=!0)}getPosition(){return this.tmpPosition.copy(this.start)}getBody(){return this.body}getX(){return this.start.x}getY(){return this.start.y}setPosition(e,r){this.start.set(e,r),this.staticLight&&(this.dirty=!0)}setPositionV(e){this.start.copy(e),this.staticLight&&(this.dirty=!0)}contains(e,r){let o=this.start.x-e,s=this.start.y-r,l=o*o+s*s;if(this.distance*this.distance<=l)return!1;let a=!1,c=this.mx[this.rayNum]=this.start.x,u=this.my[this.rayNum]=this.start.y,m=0,p=0;for(let d=0;d<=this.rayNum;c=m,u=p,++d)m=this.mx[d],p=this.my[d],(p<r&&u>=r||p>=r&&u<r)&&(r-p)/(u-p)*(c-m)<e-m&&(a=!a);return a}setRayNum(e,r=!0){super.setRayNum(e,r),this.sin=Ge(e),this.cos=Ge(e),this.endX=Ge(e),this.endY=Ge(e)}cull(){return this.culled=this.rayHandler.culling&&!this.rayHandler.intersect(this.start.x,this.start.y,this.distance+this.softShadowLength),this.culled}updateBody(){if(!this.body||this.staticLight)return;let e=this.rayHandler.getBodyPosition(this.body),r=this.rayHandler.getBodyAngle(this.body),o=Math.cos(r),s=Math.sin(r),l=this.bodyOffsetX*o-this.bodyOffsetY*s,a=this.bodyOffsetX*s+this.bodyOffsetY*o;this.start.x=e.x+l,this.start.y=e.y+a,this.setDirection(this.bodyAngleOffset+uu*r)}updateMesh(){for(let e=0;e<this.rayNum;e++)this.m_index=e,this.f[e]=1,this.tmpEnd.x=this.endX[e]+this.start.x,this.mx[e]=this.tmpEnd.x,this.tmpEnd.y=this.endY[e]+this.start.y,this.my[e]=this.tmpEnd.y,this.xray||this.rayCast(this.start,this.tmpEnd);this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;e[r++]=this.start.x,e[r++]=this.start.y,o[s++]=this.colorF,l[a++]=1;for(let c=0;c<this.rayNum;c++)e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1-this.f[c];if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++){c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF;let b=1-this.f[f];d[h++]=b,c[u++]=this.mx[f]+b*this.softShadowLength*this.cos[f],c[u++]=this.my[f]+b*this.softShadowLength*this.sin[f],m[p++]=0,d[h++]=0}this.softShadowMesh.update()}}getBodyOffsetX(){return this.bodyOffsetX}getBodyOffsetY(){return this.bodyOffsetY}getBodyAngleOffset(){return this.bodyAngleOffset}setBodyOffsetX(e){this.bodyOffsetX=e}setBodyOffsetY(e){this.bodyOffsetY=e}setBodyAngleOffset(e){this.bodyAngleOffset=e}};var pu=class extends ws{constructor(t,e,r,o,s,l,a,c){super(t,e,r,o,s,l,a),this.setConeDegree(c)}update(){this.updateBody(),this.dirty&&this.setEndPoints(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}setDirection(t){this.direction=t,this.dirty=!0}getConeDegree(){return this.coneDegree}setConeDegree(t){this.coneDegree=Math.max(0,Math.min(180,t)),this.dirty=!0}setDistance(t){t*=fe.gammaCorrection,this.distance=t<.01?.01:t,this.dirty=!0}setEndPoints(){for(let t=0;t<this.rayNum;t++){let e=this.direction+this.coneDegree-2*this.coneDegree*t/(this.rayNum-1),r=this.sin[t]=gs(e),o=this.cos[t]=Ss(e);this.endX[t]=this.distance*o,this.endY[t]=this.distance*r}}};var du=class extends Lt{constructor(e,r,o,s){super(e,r,o,1/0,s);this.sin=0;this.cos=0;this.body=null;this.vertexNum=(this.vertexNum-1)*2,this.start=zt.MakeArray(this.rayNum),this.end=zt.MakeArray(this.rayNum),this.setMesh()}setDirection(e){this.direction=e,this.sin=gs(e),this.cos=Ss(e),this.staticLight&&(this.dirty=!0)}update(){this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh())}updateMesh(){let e=this.rayHandler.x2-this.rayHandler.x1,r=this.rayHandler.y2-this.rayHandler.y1,o=e>r?e:r,s=o*this.cos,l=o*this.sin;s*s<.1&&l*l<.1&&(s=1,l=1);let a=o*-this.sin,c=o*this.cos,u=(this.rayHandler.x1+this.rayHandler.x2)*.5-a,m=(this.rayHandler.y1+this.rayHandler.y2)*.5-c,p=2*a/(this.rayNum-1);u=Math.floor(u/(p*2))*p*2;let d=2*c/(this.rayNum-1);m=Math.ceil(m/(d*2))*d*2;for(let h=0;h<this.rayNum;h++){let f=h*p+u,b=h*d+m;this.m_index=h,this.start[h].x=f-s,this.start[h].y=b-l,this.mx[h]=this.end[h].x=f+s,this.my[h]=this.end[h].y=b+l,this.xray||this.rayCast(this.start[h],this.end[h])}this.setMesh()}setMesh(){let e=this.lightMesh.getVertices(),r=0,o=this.lightMesh.getColors(),s=0,l=this.lightMesh.getColorScales(),a=0;for(let c=0;c<this.rayNum;c++)e[r++]=this.start[c].x,e[r++]=this.start[c].y,o[s++]=this.colorF,l[a++]=1,e[r++]=this.mx[c],e[r++]=this.my[c],o[s++]=this.colorF,l[a++]=1;if(this.lightMesh.update(),this.softShadowMesh){let c=this.softShadowMesh.getVertices(),u=0,m=this.softShadowMesh.getColors(),p=0,d=this.softShadowMesh.getColorScales(),h=0;for(let f=0;f<this.rayNum;f++)c[u++]=this.mx[f],c[u++]=this.my[f],m[p++]=this.colorF,d[h++]=1,c[u++]=this.mx[f]+this.softShadowLength*this.cos,c[u++]=this.my[f]+this.softShadowLength*this.sin,m[p++]=0,d[h++]=1;this.softShadowMesh.update()}}render(){this.rayHandler.lightRenderedLastFrame++,this.lightMesh.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum),this.softShadowMesh?.render(this.rayHandler.lightShader,this.gl.TRIANGLE_STRIP,this.vertexNum)}debugRender(e){let r=[];for(let o=0;o<this.rayNum;o++)r.push(this.start[o],{x:this.mx[o],y:this.my[o]});e(r,r.length,Lt.DebugColor)}contains(e,r){let o=!1,s=this.mx[this.rayNum]=this.start[0].x,l=this.my[this.rayNum]=this.start[0].y,a,c;for(let u=0;u<=this.rayNum;s=a,l=c,++u)a=this.mx[u],c=this.my[u],(c<r&&l>=r||c>=r&&l<r)&&(r-c)/(l-c)*(s-a)<e-a&&(o=!o);for(let u=0;u<this.rayNum;s=a,l=c,++u)a=this.start[u].x,c=this.start[u].y,(c<r&&l>=r||c>=r&&l<r)&&(r-c)/(l-c)*(s-a)<e-a&&(o=!o);return o}attachToBody(e){}setPosition(e,r){}getBody(){return this.body}getX(){return 0}getY(){return 0}setPositionV(e){}setDistance(e){}setIgnoreAttachedBody(e){}getIgnoreAttachedBody(){return!1}setIgnoreBody(e){this.body=e,this.ignoreBody=!!e}};var vs=class extends ws{constructor(t,e,r=Lt.DefaultColor,o=15,s=0,l=0){super(t,e,r,o,s,l,0)}update(){this.updateBody(),this.dirty&&this.setEndPoints(),!this.cull()&&(this.staticLight&&!this.dirty||(this.dirty=!1,this.updateMesh()))}setDistance(t){t*=fe.gammaCorrection,this.distance=t<.01?.01:t,this.dirty=!0}setEndPoints(){let t=360/(this.rayNum-1);for(let e=0;e<this.rayNum;e++){let r=t*e;this.sin[e]=gs(r),this.cos[e]=Ss(r),this.endX[e]=this.distance*this.cos[e],this.endY[e]=this.distance*this.sin[e]}}setDirection(t){}};var Nn=$(_o()),rA=Nn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,oA=Nn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;
uniform  vec4 ambient;

void main() {
    gl_FragColor.rgb = (ambient.rgb + texture2D(u_texture, v_texCoords).rgb);
    gl_FragColor.a = 1.0;
}
`;function fx(i){return(0,Nn.createShaderProgram)(i,rA,oA,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var Zn=$(_o()),sA=(i,t)=>Zn.glsl`
attribute vec4 a_position;
uniform vec2  dir;
attribute vec2 a_texCoord;
varying vec2 v_texCoords0;
varying vec2 v_texCoords1;
varying vec2 v_texCoords2;
varying vec2 v_texCoords3;
varying vec2 v_texCoords4;

const vec2 futher = vec2(3.2307692308 / ${i}, 3.2307692308 / ${t} );
const vec2 closer = vec2(1.3846153846 / ${i}, 1.3846153846 / ${t} );

void main() {
    vec2 f = futher * dir;
    vec2 c = closer * dir;
    v_texCoords0 = a_texCoord - f;
    v_texCoords1 = a_texCoord - c;
    v_texCoords2 = a_texCoord;
    v_texCoords3 = a_texCoord + c;
    v_texCoords4 = a_texCoord + f;
    gl_Position = a_position;
}
`,nA=i=>Zn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

uniform sampler2D u_texture;
varying MED vec2 v_texCoords0;
varying MED vec2 v_texCoords1;
varying MED vec2 v_texCoords2;
varying MED vec2 v_texCoords3;
varying MED vec2 v_texCoords4;
const float center = 0.2270270270;
const float close  = 0.3162162162;
const float far    = 0.0702702703;

void main() {	 
    gl_FragColor${i} = far    * texture2D(u_texture, v_texCoords0)${i}
	      		+ close  * texture2D(u_texture, v_texCoords1)${i}
				+ center * texture2D(u_texture, v_texCoords2)${i}
				+ close  * texture2D(u_texture, v_texCoords3)${i}
				+ far    * texture2D(u_texture, v_texCoords4)${i};
}
`;function bx(i,t,e,r){let o=sA(t.toFixed(1),e.toFixed(1)),s=nA(r?".rgb":"");return(0,Zn.createShaderProgram)(i,o,s,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",dir:"uniform2f"})}var Qn=$(_o()),lA=Qn.glsl`
attribute vec4 a_position;
attribute vec4 quad_colors;
attribute float s;
uniform mat4 u_projTrans;
varying vec4 v_color;

void main() {
    v_color = s * quad_colors;
    gl_Position =  u_projTrans * a_position;
}
`,aA=i=>Qn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying vec4 v_color;

void main() {
    gl_FragColor = ${i}(v_color);
}
`;function _x(i,t){let e=aA(t?"sqrt":"");return(0,Qn.createShaderProgram)(i,lA,e,{a_position:"vertexAttribPointer",quad_colors:"vertexAttribPointer",s:"vertexAttribPointer",u_projTrans:"uniformMatrix4f"})}var qn=$(_o()),cA=qn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,uA=qn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec4 ambient;

void main() {
    vec4 c = texture2D(u_texture, v_texCoords);
    gl_FragColor.rgb = c.rgb * c.a + ambient.rgb;
    gl_FragColor.a = ambient.a - c.a;
}
`;function yx(i){return(0,qn.createShaderProgram)(i,cA,uA,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var Wn=$(_o()),mA=Wn.glsl`
attribute vec4 a_position;
attribute vec2 a_texCoord;
varying vec2 v_texCoords;

void main() {
    v_texCoords = a_texCoord;
    gl_Position = a_position;
}
`,pA=Wn.glsl`
#ifdef GL_ES
precision lowp float;
#define MED mediump
#else
#define MED 
#endif

varying MED vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;function xx(i){return(0,Wn.createShaderProgram)(i,mA,pA,{a_position:"vertexAttribPointer",a_texCoord:"vertexAttribPointer",u_texture:"uniform1i",ambient:"uniform4f"})}var hu=class{constructor(t,e,r){this.lightMapDrawingDisabled=!1;this.rayHandler=t,this.gl=t.gl,this.vertBuffer=new ni(this.gl,this.gl.STATIC_DRAW,this.createVertices()),this.uvBuffer=new ni(this.gl,this.gl.STATIC_DRAW,this.createUvCoords()),e<=0&&(e=1),r<=0&&(r=1),this.frameBuffer=new jn(this.gl,e,r),this.pingPongBuffer=new jn(this.gl,e,r),this.shadowShader=yx(this.gl),this.diffuseShader=fx(this.gl),this.withoutShadowShader=xx(this.gl),this.blurShader=bx(this.gl,e,r,fe.isDiffuse)}render(){let t=this.rayHandler.lightRenderedLastFrame>0;if(!this.lightMapDrawingDisabled){if(this.frameBuffer.bindTexture(),this.rayHandler.shadows){let e=this.rayHandler.ambientLight,r=this.shadowShader;fe.isDiffuse?(r=this.diffuseShader,r.use(),this.rayHandler.diffuseBlendFunc.apply(),r.ambient.set(e.r,e.g,e.b,e.a)):(r.use(),this.rayHandler.shadowBlendFunc.apply(),r.ambient.set(e.r*e.a,e.g*e.a,e.b*e.a,1-e.a)),this.renderTriangleFan(r)}else t&&(this.rayHandler.simpleBlendFunc.apply(),this.withoutShadowShader.use(),this.renderTriangleFan(this.withoutShadowShader));this.gl.disable(this.gl.BLEND)}}renderTriangleFan(t){this.vertBuffer.bind(),t.a_position.enable(),t.a_position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.uvBuffer.bind(),t.a_texCoord.enable(),t.a_texCoord.set(2,this.gl.FLOAT,!1,0,0),this.uvBuffer.unbind(),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),t.a_position.disable(),t.a_texCoord.disable()}gaussianBlur(){this.gl.disable(this.gl.BLEND);for(let t=0;t<this.rayHandler.blurNum;t++)this.frameBuffer.bindTexture(),this.pingPongBuffer.begin(),this.blurShader.use(),this.blurShader.dir.set(1,0),this.renderTriangleFan(this.blurShader),this.pingPongBuffer.endSimple(),this.pingPongBuffer.bindTexture(),this.frameBuffer.begin(),this.blurShader.use(),this.blurShader.dir.set(0,1),this.renderTriangleFan(this.blurShader),this.rayHandler.customViewport?this.frameBuffer.end(this.rayHandler.viewportX,this.rayHandler.viewportY,this.rayHandler.viewportWidth,this.rayHandler.viewportHeight):this.frameBuffer.endSimple();this.gl.enable(this.gl.BLEND)}dispose(){this.shadowShader.dispose(),this.blurShader.dispose(),this.vertBuffer.dispose(),this.uvBuffer.dispose(),this.frameBuffer.dispose(),this.pingPongBuffer.dispose()}createVertices(){return new Float32Array([-1,-1,1,-1,1,1,-1,1])}createUvCoords(){return new Float32Array([0,0,1,0,1,1,0,1])}};var fu=class{constructor(t,e,r,o,s){this.combined=new Float32Array(16);this.ambientLight=new Or;this.lightList=[];this.disabledLights=[];this.customLightShader=null;this.culling=!0;this.shadows=!0;this.blur=!0;this.blurNum=1;this.customViewport=!1;this.viewportX=0;this.viewportY=0;this.lightRenderedLastFrame=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;this.gl=t,this.diffuseBlendFunc=new Hr(t,t.DST_COLOR,t.ZERO),this.shadowBlendFunc=new Hr(t,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.simpleBlendFunc=new Hr(t,t.SRC_ALPHA,t.ONE),this.viewportWidth=o,this.viewportHeight=s,this.resizeFBO(e,r),this.lightShader=_x(t,fe.gammaCorrection!==1)}resizeFBO(t,e){this.lightMap?.dispose(),this.lightMap=new hu(this,t,e)}setCombinedMatrix(t,e,r,o,s){this.combined.set(t);let l=o*.5;this.x1=e-l,this.x2=e+l;let a=s*.5;this.y1=r-a,this.y2=r+a}intersect(t,e,r){return this.x1<t+r&&this.x2>t-r&&this.y1<e+r&&this.y2>e-r}updateAndRender(){this.update(),this.render()}update(){for(let t of this.lightList)t.update()}prepareRender(){this.lightRenderedLastFrame=0,this.gl.depthMask(!1),this.gl.enable(this.gl.BLEND),this.simpleBlendFunc.apply();let t=this.shadows||this.blur;t&&(this.lightMap.frameBuffer.begin(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT));let e=this.customLightShader??this.lightShader;e.use(),e.u_projTrans.set(!1,this.combined),this.customLightShader&&this.updateLightShader();for(let r of this.lightList)this.customLightShader&&this.updateLightShaderPerLight(r),r.render();t&&(this.customViewport?this.lightMap.frameBuffer.end(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight):this.lightMap.frameBuffer.endSimple(),this.lightRenderedLastFrame>0&&this.blur&&this.lightMap.gaussianBlur())}render(){this.prepareRender(),this.lightMap.render()}renderOnly(){this.lightMap.render()}updateLightShader(){}updateLightShaderPerLight(t){}pointAtLight(t,e){return this.lightList.some(r=>r.contains(t,e))}pointAtShadow(t,e){return!this.lightList.some(r=>r.contains(t,e))}dispose(){this.removeAll(),this.lightMap&&this.lightMap.dispose(),this.lightShader&&this.lightShader.dispose()}removeAll(){this.lightList.forEach(t=>t.dispose()),this.lightList.length=0,this.disabledLights.forEach(t=>t.dispose()),this.disabledLights.length=0}removeLight(t){let e=t.isActive()?this.lightList:this.disabledLights;On(e,t)}setLightShader(t){this.customLightShader=t}setCulling(t){this.culling=t}setBlur(t){this.blur=t}setBlurNum(t){this.blurNum=t}setShadows(t){this.shadows=t}setAmbientLightBrightness(t){this.ambientLight.a=Math.max(0,Math.min(1,t))}setAmbientLight(t,e,r,o){this.ambientLight.set(t,e,r,o)}setAmbientLightC(t){this.ambientLight.copy(t)}useCustomViewport(t,e,r,o){this.customViewport=!0,this.viewportX=t,this.viewportY=e,this.viewportWidth=r,this.viewportHeight=o}useDefaultViewport(){this.customViewport=!1}setLightMapRendering(t){this.lightMap.lightMapDrawingDisabled=!t}getLightMapBuffer(){return this.lightMap.frameBuffer}};function go(i){i.setColor(Math.random(),Math.random(),Math.random(),1)}var gx=[{x1:0,x2:1.625,y1:-14.0615415625,y2:-11.9990415625},{x1:2.5,x2:4.75,y1:-11.1240415625,y2:-8.6865415625},{x1:5.75,x2:7.875,y1:-7.9365415625,y2:-6.0615415625},{x1:8.6875,x2:10.5625,y1:-5.3115415625,y2:-3.5615415624999986},{x1:11.1875,x2:12.625,y1:-2.4365415624999986,y2:-.24904156249999865},{x1:13.1875,x2:14,y1:1.2509584375000014,y2:3.6259584375000014},{x1:14.1875,x2:13.875,y1:4.813458437500001,y2:7.3759584375000005},{x1:13.25,x2:11.75,y1:8.6884584375,y2:10.4384584375},{x1:10.625,x2:8.8125,y1:11.3759584375,y2:11.8759584375},{x1:7.508101249999999,x2:5.239583124999999,y1:11.9990415625,y2:11.9527453125},{x1:4.54513875,x2:2.6932868749999983,y1:11.8138565625,y2:10.8879309375},{x1:1.9988424999999985,x2:.9340274999999991,y1:10.5638565625,y2:9.4064490625},{x1:.33217562499999964,x2:.008101249999999283,y1:8.6194121875,y2:6.9990415625},{x1:0,x2:-1.625,y1:-14.0615415625,y2:-11.9990415625},{x1:-2.5,x2:-4.75,y1:-11.1240415625,y2:-8.6865415625},{x1:-5.75,x2:-7.875,y1:-7.9365415625,y2:-6.0615415625},{x1:-8.6875,x2:-10.5625,y1:-5.3115415625,y2:-3.5615415624999986},{x1:-11.1875,x2:-12.625,y1:-2.4365415624999986,y2:-.24904156249999865},{x1:-13.1875,x2:-14,y1:1.2509584375000014,y2:3.6259584375000014},{x1:-14.1875,x2:-13.875,y1:4.813458437500001,y2:7.3759584375000005},{x1:-13.25,x2:-11.75,y1:8.6884584375,y2:10.4384584375},{x1:-10.625,x2:-8.8125,y1:11.3759584375,y2:11.8759584375},{x1:-7.508101249999999,x2:-5.239583124999999,y1:11.9990415625,y2:11.9527453125},{x1:-4.54513875,x2:-2.6932868749999983,y1:11.8138565625,y2:10.8879309375},{x1:-1.9988424999999985,x2:-.9340274999999991,y1:10.5638565625,y2:9.4064490625},{x1:-.33217562499999964,x2:-.008101249999999283,y1:8.6194121875,y2:6.9990415625}];var bu=class extends fu{constructor(t,e,r,o,s,l){super(e,r,o,s,l),this.world=t}createRayCastCallback(t){return(e,r)=>this.world.RayCast(e,r,(o,s,l,a)=>t.reportFixture(o.GetFilterData(),o.GetBody(),s,a))}getBodyPosition(t){return t.GetPosition()}getBodyAngle(t){return t.GetAngle()}};var Bs=class extends R{constructor(e){super({x:0,y:0});this.gl=e;this.drawDebugLight=!1;this.soft=!0;this.mode="Default";this.blendFunc=new Hr(e,e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),fe.gammaCorrection=.625,fe.isDiffuse=!0;let r=this.getViewportSize();this.rayHandler=new bu(this.m_world,e,st.getWidth()/4,st.getHeight()/4,r.x,r.y),this.rayHandler.setAmbientLight(0,0,0,.5),this.rayHandler.setBlurNum(3)}setupControls(){this.addTestControlGroup("Light",this.getLightControls())}getLightControls(){return[sr("Blend Mode",["Default","Over-Burn","Some Other"],this.mode,e=>{this.setBlending(e)}),Yt("Debug Light Shapes",this.drawDebugLight,e=>{this.drawDebugLight=e}),Yt("Soft Shadows",this.soft,e=>{this.soft=e,this.setSoft(e)})]}Resize(e,r){this.rayHandler.resizeFBO(e/4,r/4)}Destroy(){super.Destroy(),this.rayHandler.dispose(),Lt.setGlobalContactFilter(null)}setBlending(e){this.mode=e,e==="Over-Burn"?this.rayHandler.diffuseBlendFunc.set(this.gl.DST_COLOR,this.gl.SRC_COLOR):e==="Some Other"?this.rayHandler.diffuseBlendFunc.set(this.gl.SRC_COLOR,this.gl.DST_COLOR):this.rayHandler.diffuseBlendFunc.reset()}Step(e,r){return super.Step(e,r),this.clearGlCanvas(),this.blendFunc.apply(),r}clearGlCanvas(){bs(this.gl,0,0,0,1)}renderLights(e,r){let o=this.getViewportSize();if(this.rayHandler.setCombinedMatrix(st.combined,o.x/2,o.y/2,o.x,o.y),r>0&&this.rayHandler.update(),this.rayHandler.render(),this.drawDebugLight){let s=e.m_debugDraw,l=s.DrawPolygon.bind(s);for(let a of this.rayHandler.lightList)a.debugRender(l)}}};var bA=512,_A=32,Sh=class extends Bs{constructor({gl:e,shader:r,textures:o}){super(e);this.lights=[];this.currentEdgeFixture=null;this.currentEdgeBody=null;this.dragStart=new n;this.gl=e,this.shader=r,this.textures=o,this.mouseLight=this.createLight(),this.mouseLight.setColor(1,0,0,1);let s=this.m_world.CreateBody();for(let l of gx){let a=new I;a.SetTwoSided({x:l.x1,y:l.y1},{x:l.x2,y:l.y2}),s.CreateFixture({shape:a,density:0,restitution:0})}}getViewportSize(){return{x:st.getWidth(),y:st.getHeight()}}setSoft(e){this.mouseLight.setSoft(e);for(let r of this.lights)r.setSoft(e)}createLight(){let e=new vs(this.rayHandler,bA,Lt.DefaultColor,_A,0,0);return go(e),e.setPositionV(this.m_mouseWorld),e.setSoft(this.soft),e}GetDefaultViewZoom(){return 30}getHotkeys(){return[G("a","Place current light",()=>{this.lights.push(this.mouseLight),this.mouseLight=this.createLight()})]}MouseDown(e){super.MouseDown(e),this.dragStart.Copy(e)}MouseUp(e){super.MouseUp(e),this.currentEdgeFixture=null,this.currentEdgeBody=null}MouseMove(e,r){if(super.MouseMove(e,r),r){if(!this.currentEdgeBody){let s=1/st.getZoom();this.currentEdgeBody=this.m_world.CreateBody({position:{x:-s,y:s}})}this.currentEdgeFixture&&this.currentEdgeBody.DestroyFixture(this.currentEdgeFixture);let o=new I;o.SetTwoSided(this.dragStart,e),this.currentEdgeFixture=this.currentEdgeBody.CreateFixture({shape:o,density:0,restitution:0})}}Step(e,r){super.Step(e,r),this.addText("Left drag to draw lines"),this.mouseLight.setPositionV(this.m_mouseWorld);let o=st.getCenter();return this.rayHandler.setCombinedMatrix(st.combined,o.x,o.y,st.getWidth(),st.getHeight()),this.renderLights(e,r),r}clearGlCanvas(){bs(this.gl,1,1,1,1)}};P("Lights","Draw World",Sh);function Sx(i,t,e,r,o){let s=t+r,l=e+o;return i.set([t,l,t,e,s,l,s,l,t,e,s,e]),i}function wx(i,t,e,r,o){return i.set([o,r,o,t,e,r,e,r,o,t,e,t]),i}function vx(i,t,e,r,o,s,l,a,c=1){let u=t+l,m=e+a,p=-l*c,d=-a*c,h=(r-l)*c,f=(o-a)*c,b=s*xs,x=Math.cos(b),_=Math.sin(b),y=x*p-_*f+u,g=_*p+x*f+m,S=x*p-_*d+u,w=_*p+x*d+m,B=x*h-_*f+u,C=_*h+x*f+m,A=S+(B-y),k=C-(g-w);return i.set([y,g,S,w,B,C,B,C,S,w,A,k]),i}var _u=new Float32Array(12),Kn=class{constructor(t,e,r){this.uvOffsetX=0;this.uvOffsetY=0;this.gl=t,this.shader=e,this.texture=r,this.vertBuffer=new ni(t,t.DYNAMIC_DRAW,_u),this.uvBuffer=new ni(t,t.STATIC_DRAW,wx(_u,0,1,1,0))}setUvOffset(t,e){this.uvOffsetX=t,this.uvOffsetY=e}destroy(){this.vertBuffer.dispose(),this.uvBuffer.dispose()}isDone(){return!0}setRect(t,e,r,o){this.vertBuffer.setData(Sx(_u,t,e,r,o))}setRotatedRect(t,e,r,o,s,l,a,c=1){this.vertBuffer.setData(vx(_u,t,e,r,o,s,l,a,c))}render(){this.vertBuffer.bind(),this.shader.position.enable(),this.shader.position.set(2,this.gl.FLOAT,!1,0,0),this.vertBuffer.unbind(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.uvBuffer.bind(),this.shader.uv.enable(),this.shader.uv.set(2,this.gl.FLOAT,!1,0,0),this.uvBuffer.unbind(),this.shader.opacity.set(1),this.shader.uvOffset.set(this.uvOffsetX,this.uvOffsetY),this.shader.textureID.set(0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}};var wh=i=>1<<i,Nr={WORLD:wh(1),MARBLE:wh(2),LIGHT:wh(3)},vh={WORLD:Nr.MARBLE,MARBLE:Nr.MARBLE|Nr.WORLD|Nr.LIGHT,LIGHT:Nr.MARBLE},Vi=1,Bx=Vi*2,yu=128,$n=16,tl=48,el=33,Bh=class{constructor(t,e){this.sprite=t;this.body=e}render(){let t=this.body.GetPosition();this.sprite.setRotatedRect(t.x-Vi,t.y-Vi,Bx,Bx,Z2(this.body.GetAngle()),Vi,Vi),this.sprite.render()}};function il(i,t){return i+Math.random()*(t-i)}var Ch=class extends Bs{constructor({gl:e,shader:r,textures:o}){super(e);this.sunDirection=-90;this.lightsType="Point";this.directionalLight=null;this.gl=e,this.shader=r,this.textures=o,this.bg=new Kn(e,r,o.bg.texture),this.createBoundary();let l={restitution:.9,friction:.01,shape:new V(Vi),density:1},a=()=>{let c=this.m_world.CreateBody({type:2,position:{x:4+Math.random()*40,y:4+Math.random()*25}});return c.CreateFixture(l).SetFilterData({categoryBits:Nr.MARBLE,maskBits:vh.MARBLE}),new Bh(new Kn(e,r,o.marble.texture),c)};this.marbles=Array.from({length:5},a),this.bg.setRect(0,0,tl,el),Lt.setGlobalContactFilterBits(Nr.LIGHT,0,vh.LIGHT),this.setLightsType(this.lightsType)}getLightControls(){return[sr("Lights Type",["Point","Cone","Chain","Directional"],this.lightsType,e=>{this.setLightsType(e)}),...super.getLightControls()]}getViewportSize(){return{x:tl,y:el}}setSoft(e){this.directionalLight?.setSoft(e);for(let r of this.marbles)r.light?.setSoft(e)}GetDefaultViewZoom(){return 20}getCenter(){return{x:tl/2,y:el/2}}Destroy(){this.bg.destroy();for(let e of this.marbles)e.light.dispose(),e.sprite.destroy();super.Destroy()}setLightsType(e){switch(e){case"Point":this.initPointLights();break;case"Cone":this.initConeLights();break;case"Chain":this.initChainLights();break;case"Directional":this.initDirectionalLight();break}this.lightsType=e}getHotkeys(){return[G("c","Random Light Colors",()=>{for(let e of this.marbles)go(e.light)}),G("d","Random Light Distance",()=>{for(let e of this.marbles)e.light.setDistance(il($n*.5,$n*2))})]}Step(e,r){super.Step(e,r),this.bg.render();for(let o of this.marbles)o.render();return this.directionalLight&&(this.sunDirection+=r*.008,this.directionalLight.setDirection(this.sunDirection)),this.renderLights(e,r),r}createBoundary(){let e=new dt;e.CreateLoop([new n,new n(0,el),new n(tl,el),new n(tl,0)]),this.groundBody=this.m_world.CreateBody({type:0}),this.groundBody.CreateFixture({shape:e,density:0}).SetFilterData({categoryBits:Nr.WORLD,maskBits:vh.WORLD})}clearLights(){this.directionalLight&&(this.directionalLight.remove(),this.directionalLight=null);for(let e of this.marbles)e.light?.remove()}initPointLights(){this.clearLights();for(let e of this.marbles){let r=new vs(this.rayHandler,yu,Lt.DefaultColor,$n,0,0);r.attachToBody(e.body,Vi/2,Vi/2),go(r),e.light=r,r.setSoft(this.soft)}}initConeLights(){this.clearLights();for(let e of this.marbles){let r=new pu(this.rayHandler,yu,Lt.DefaultColor,$n,0,0,0,il(15,40));r.attachToBody(e.body,Vi/2,Vi/2,il(0,360)),go(r),e.light=r,r.setSoft(this.soft)}}initChainLights(){this.clearLights();for(let e of this.marbles){let r=new mu(this.rayHandler,yu,Lt.DefaultColor,$n,1,[-5,0,0,3,5,0]);r.attachToBody(e.body,il(0,360)),go(r),e.light=r,r.setSoft(this.soft)}}initDirectionalLight(){this.clearLights(),this.sunDirection=il(0,360),this.directionalLight=new du(this.rayHandler,4*yu,Lt.DefaultColor,this.sunDirection),this.directionalLight.setSoftnessLength(5),this.directionalLight.setSoft(this.soft)}};P("Lights","Official Demo",Ch);var Ah=class extends R{constructor(){super(),this.m_bodies=[];let t=new _s;this.m_controller=t,t.normal.Set(0,1),t.offset=20,t.density=2,t.linearDrag=5,t.angularDrag=2;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r}),r.SetTwoSided(new n(-40,0),new n(-40,25)),e.CreateFixture({shape:r}),r.SetTwoSided(new n(40,0),new n(40,25)),e.CreateFixture({shape:r})}for(let r=0;r<5;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI}),s=new v;s.SetAsBox(Math.random()*.5+1,Math.random()*.5+1),o.CreateFixture({density:1,friction:.3,restitution:.1,shape:s}),this.m_bodies.push(o)}for(let r=0;r<5;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI});o.CreateFixture({density:1,friction:.3,restitution:.1,shape:new V(Math.random()*.5+1)}),this.m_bodies.push(o)}for(let r=0;r<15;r++){let o=this.m_world.CreateBody({type:2,position:{x:Math.random()*40-20,y:Math.random()*15+5},angle:Math.random()*Math.PI}),s=new v;if(Math.random()>.66)s.Set([new n(-1-Math.random()*1,1+Math.random()*1),new n(-.5-Math.random()*1,-1-Math.random()*1),new n(.5+Math.random()*1,-1-Math.random()*1),new n(1+Math.random()*1,1+Math.random()*1)]);else if(Math.random()>.5){let l=[];l[0]=new n(0,1+Math.random()*1),l[2]=new n(-.5-Math.random()*1,-1-Math.random()*1),l[3]=new n(.5+Math.random()*1,-1-Math.random()*1),l[1]=new n(l[0].x+l[2].x,l[0].y+l[2].y),l[1].Scale(Math.random()/2+.8),l[4]=new n(l[3].x+l[0].x,l[3].y+l[0].y),l[4].Scale(Math.random()/2+.8),s.Set(l)}else s.Set([new n(0,1+Math.random()*1),new n(-.5-Math.random()*1,-1-Math.random()*1),new n(.5+Math.random()*1,-1-Math.random()*1)]);o.CreateFixture({density:1,friction:.3,restitution:.1,shape:s}),this.m_bodies.push(o)}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:40},angle:0}),o=new v;o.SetAsBox(4,1),r.CreateFixture({density:3,shape:o}),this.m_bodies.push(r)}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:30}}),o=new V(.7),s={density:2,shape:o};o.m_p.Set(3,0),r.CreateFixture(s),o.m_p.Set(-3,0),r.CreateFixture(s),o.m_p.Set(0,3),r.CreateFixture(s),o.m_p.Set(0,-3),r.CreateFixture(s),s.density=2;let l=new v;s.shape=l,l.SetAsBox(3,.2),r.CreateFixture(s),l.SetAsBox(.2,3),r.CreateFixture(s),this.m_bodies.push(r)}for(let r of this.m_bodies)this.m_controller.AddBody(r);this.m_world.AddController(this.m_controller)}getCenter(){return{x:0,y:10}}};P("Controllers","Boyancy Test",Ah);var xu=class{constructor(){this.gainP=1;this.gainI=1;this.gainD=1;this.currentError=0;this.previousError=0;this.integral=0;this.output=0}step(t){this.integral=t*(this.integral+this.currentError);let e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError}},Th=class i extends R{constructor(){super({x:0,y:-30});this.targetPosition=10;this.targetPositionInterval=0;this.posAvg=0;this.angleController=new xu;this.positionController=new xu;this.angleController.gainP=1e3,this.angleController.gainI=0,this.angleController.gainD=250,this.positionController.gainP=.5,this.positionController.gainI=0,this.positionController.gainD=1.5,this.pendulumBody=this.m_world.CreateBody({type:2,position:{x:0,y:2+.5*i.PENDULUM_LENGTH}});let e=new v;e.SetAsBox(.5,.5*i.PENDULUM_LENGTH);let r={shape:e,density:1/(1*i.PENDULUM_LENGTH)};this.pendulumBody.CreateFixture(r),this.wheelBody=this.m_world.CreateBody({type:2,position:n.UNITY});let o=new V;o.m_radius=.6,r.shape=o,r.density=1/(Math.PI*.6*.6),r.friction=10,this.wheelBody.CreateFixture(r);let s=new q;s.Initialize(this.wheelBody,this.pendulumBody,{x:0,y:0}),s.localAnchorA.Set(0,0),s.localAnchorB.Set(0,-.5*i.PENDULUM_LENGTH),s.collideConnected=!1,s.enableMotor=!0,s.maxMotorTorque=40,this.wheelJoint=this.m_world.CreateJoint(s),this.groundBody=this.m_world.CreateBody({type:0,position:n.ZERO});let l=new I;l.SetTwoSided({x:-100,y:0},{x:100,y:0}),r.shape=l,r.friction=10,this.groundBody.CreateFixture(r)}static{this.PENDULUM_LENGTH=10}getCenter(){return{x:0,y:5}}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause&&!e.m_singleStep&&(o=0),super.Step(e,r),this.targetPositionInterval+=o,this.targetPositionInterval>=8&&(this.targetPositionInterval=0,this.targetPosition=this.targetPosition===10?-10:10);let s=0;{this.posAvg=(1-.4)*this.posAvg+.4*this.pendulumBody.GetPosition().x,this.positionController.currentError=this.targetPosition-this.posAvg,this.positionController.step(o);let m=this.positionController.output;m=et(m,-10,10),s=m/this.m_world.GetGravity().y,s=et(s,pt(-15),pt(15))}let l=this.pendulumBody.GetAngle();l=yA(l),this.angleController.currentError=s-l,this.angleController.step(o);let a=this.angleController.output;Math.abs(a)>1e3&&(a=0);let c=a/(2*Math.PI*.6);this.wheelJoint.SetMotorSpeed(c)}};function yA(i){for(;i>pt(180);)i-=pt(360);for(;i<pt(-180);)i+=pt(360);return i}P("Controllers","Segway",Th);var Ph=class extends R{constructor(){super(n.ZERO);{let t=new V;t.m_p.SetZero(),t.m_radius=.1;let e=-6,r=0,o=4,s=6;for(let l=0;l<400;++l)this.m_world.CreateBody({type:2,position:{x:W(e,r),y:W(o,s)}}).CreateFixture({shape:t,density:.01})}{let t=new v;t.SetAsBox(1.5,1.5);let e=this.m_world.CreateBody({type:2,position:{x:-40,y:5},bullet:!0});e.CreateFixture({shape:t,density:1}),e.SetLinearVelocity(new n(10,0))}}GetDefaultViewZoom(){return 65}getCenter(){return{x:0,y:5}}};P("Benchmark","Add Pair Stress Test",Ph);var Dh=class extends R{constructor(){super(n.ZERO);this.positiveForce=!1;this.negativeForce=!1;this.cwTorque=!1;this.ccwTorque=!1;let e=.4,r=this.m_world.CreateBody({position:{x:0,y:20}});{let o=new I,s={shape:o,density:0,restitution:e};o.SetTwoSided(new n(-20,-20),new n(-20,20)),r.CreateFixture(s),o.SetTwoSided(new n(20,-20),new n(20,20)),r.CreateFixture(s),o.SetTwoSided(new n(-20,20),new n(20,20)),r.CreateFixture(s),o.SetTwoSided(new n(-20,-20),new n(20,-20)),r.CreateFixture(s)}{let o=new T;o.q.Set(.3524*Math.PI),o.q.GetXAxis(o.p);let s=[];s[0]=T.MultiplyVec2(o,new n(-1,0),new n),s[1]=T.MultiplyVec2(o,new n(1,0),new n),s[2]=T.MultiplyVec2(o,new n(0,.5),new n);let l=new v;l.Set(s,3);let a=new T;a.q.Set(-.3524*Math.PI),a.q.GetXAxis(a.p).Negate(),a.p.Copy(D.MultiplyVec2(a.q,new n(-1,0),new n)),s[0]=T.MultiplyVec2(a,new n(-1,0),new n),s[1]=T.MultiplyVec2(a,new n(1,0),new n),s[2]=T.MultiplyVec2(a,new n(0,.5),new n);let c=new v;c.Set(s,3),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:3},angle:Math.PI,allowSleep:!1}),this.m_body.CreateFixture({shape:l,density:2}),this.m_body.CreateFixture({shape:c,density:2});let u=10,m=this.m_body.GetInertia(),p=this.m_body.GetMass(),d=Math.sqrt(2*m/p),h=new kn;h.bodyA=r,h.bodyB=this.m_body,h.localAnchorA.SetZero(),h.localAnchorB.Copy(this.m_body.GetLocalCenter()),h.collideConnected=!0,h.maxForce=.5*p*u,h.maxTorque=.2*p*d*u,this.m_world.CreateJoint(h)}{let o=new v;o.SetAsBox(.5,.5);let s={shape:o,density:1,friction:.3};for(let l=0;l<10;++l){let a=this.m_world.CreateBody({type:2,position:{x:0,y:7+1.54*l}});a.CreateFixture(s);let c=10,u=a.GetInertia(),m=a.GetMass(),p=Math.sqrt(2*u/m),d=new kn;d.localAnchorA.SetZero(),d.localAnchorB.SetZero(),d.bodyA=r,d.bodyB=a,d.collideConnected=!0,d.maxForce=m*c,d.maxTorque=.1*m*p*c,this.m_world.CreateJoint(d)}}}getHotkeys(){return[Ur("w","Apply Force",()=>this.ApplyForce(-50)),Ur("s","Apply Backward Force",()=>this.ApplyForce(50)),Ur("a","Apply Torque Counter-Clockwise",()=>this.m_body.ApplyTorque(10)),Ur("d","Apply Torque Clockwise",()=>this.m_body.ApplyTorque(-10))]}ApplyForce(e){let r=this.m_body.GetWorldVector(new n(0,e),new n),o=this.m_body.GetWorldPoint(new n(0,3),new n);this.m_body.ApplyForce(r,o)}getCenter(){return{x:0,y:15}}};P("Forces","Apply Force",Dh);var Mh=class extends R{constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:17}});{let e=t;{let r=new v;r.SetAsBox(4,1);let o=this.m_world.CreateBody({type:2,position:{x:-8,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(-12,20)),this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(8,1);let o=this.m_world.CreateBody({type:2,position:{x:4,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(-4,20)),this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(3,3);let o=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:12,y:20}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(12,20)),this.m_world.CreateJoint(s);let l=new Nt;l.Initialize(t,o,new n(12,17),new n(1,0)),this.m_world.CreateJoint(l)}}}getCenter(){return{x:0,y:15}}};P("Examples","Slider Crank 1",Mh);var Rh=class extends R{constructor(){super();this.m_speed=0;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{this.m_attachment=this.m_world.CreateBody({type:2,position:{x:0,y:3}});let r=new v;r.SetAsBox(.5,2),this.m_attachment.CreateFixture({shape:r,density:2})}{this.m_platform=this.m_world.CreateBody({type:2,position:{x:-4,y:5}});let r=new v;r.SetAsBox(.5,4,new n(4,0),.5*Math.PI),this.m_platform.CreateFixture({shape:r,friction:.6,density:2});let o=new q;o.Initialize(this.m_attachment,this.m_platform,new n(0,5)),o.maxMotorTorque=50,o.enableMotor=!0,this.m_world.CreateJoint(o);let s=new Nt;s.Initialize(e,this.m_platform,new n(0,5),new n(1,0)),s.maxMotorForce=1e3,s.enableMotor=!0,s.lowerTranslation=-10,s.upperTranslation=10,s.enableLimit=!0,this.m_world.CreateJoint(s),this.m_speed=3}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:8}}),o=new v;o.SetAsBox(.75,.75),r.CreateFixture({shape:o,friction:.6,density:2})}}getHotkeys(){return[G("d","Set Dynamic Body",()=>this.m_platform.SetType(2)),G("s","Set Static Body",()=>this.m_platform.SetType(0)),G("k","Set Kinematic Body",()=>{this.m_platform.SetType(1),this.m_platform.SetLinearVelocity(new n(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)})]}Step(e,r){if(this.m_platform.GetType()===1){let{p:o}=this.m_platform.GetTransform(),s=this.m_platform.GetLinearVelocity();(o.x<-10&&s.x<0||o.x>10&&s.x>0)&&this.m_platform.SetLinearVelocity(new n(-s.x,s.y))}super.Step(e,r)}};P("Examples","Body Types",Rh);var kh=class extends R{constructor(){super();this.m_velocity=new n;this.m_angularVelocity=0;this.m_shape1=new v;this.m_shape2=new v;this.m_broke=!1;this.m_break=!1;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}this.m_body1=this.m_world.CreateBody({type:2,position:{x:0,y:40},angle:.25*Math.PI}),this.m_shape1=new v,this.m_shape1.SetAsBox(.5,.5,new n(-.5,0),0),this.m_piece1=this.m_body1.CreateFixture({shape:this.m_shape1,density:1}),this.m_shape2=new v,this.m_shape2.SetAsBox(.5,.5,new n(.5,0),0),this.m_piece2=this.m_body1.CreateFixture({shape:this.m_shape2,density:1})}static{this.e_count=7}PostSolve(e,r){if(this.m_broke)return;let o=e.GetManifold().pointCount,s=0;for(let l=0;l<o;++l)s=Math.max(s,r.normalImpulses[l]);s>40&&(this.m_break=!0)}Break(){let e=this.m_piece1.GetBody(),r=e.GetWorldCenter();e.DestroyFixture(this.m_piece2);let o=this.m_world.CreateBody({type:2,position:e.GetPosition(),angle:e.GetAngle()});this.m_piece2=o.CreateFixture({shape:this.m_shape2,density:1});let s=e.GetWorldCenter(),l=o.GetWorldCenter(),a=n.AddCrossScalarVec2(this.m_velocity,this.m_angularVelocity,n.Subtract(s,r,n.s_t0),new n),c=n.AddCrossScalarVec2(this.m_velocity,this.m_angularVelocity,n.Subtract(l,r,n.s_t0),new n);e.SetAngularVelocity(this.m_angularVelocity),e.SetLinearVelocity(a),o.SetAngularVelocity(this.m_angularVelocity),o.SetLinearVelocity(c)}Step(e,r){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),this.m_broke||(this.m_velocity.Copy(this.m_body1.GetLinearVelocity()),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),super.Step(e,r)}};P("Examples","Breakable",kh);var Fh=class i extends R{static{this.e_count=30}constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20,friction:.2},o=new q,s=t;for(let a=0;a<i.e_count;++a){let c=this.m_world.CreateBody({type:2,position:{x:-14.5+1*a,y:5}});c.CreateFixture(r);let u=new n(-15+1*a,5);o.Initialize(s,c,u),this.m_world.CreateJoint(o),a===i.e_count>>1&&(this.m_middle=c),s=c}let l=new n(-15+1*i.e_count,5);o.Initialize(s,t,l),this.m_world.CreateJoint(o)}for(let e=0;e<2;++e){let r=[];r[0]=new n(-.5,0),r[1]=new n(.5,0),r[2]=new n(0,1.5);let o=new v;o.Set(r),this.m_world.CreateBody({type:2,position:{x:-8+8*e,y:12}}).CreateFixture({shape:o,density:1})}for(let e=0;e<3;++e){let r=new V;r.m_radius=.5,this.m_world.CreateBody({type:2,position:{x:-6+6*e,y:10}}).CreateFixture({shape:r,density:1})}}};P("Joints","Bridge",Fh);function Cx(i,t,e){return`${i.toFixed(0)} [${t.toFixed(1)}] (${e.toFixed(0)})`}var Ih=class extends R{constructor(){super();this.m_x=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-10,0),new n(10,0)),e.CreateFixture({shape:r});let o=new v;o.SetAsBox(.2,1,new n(.5,1),0),e.CreateFixture({shape:o})}{let e=new v;e.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:4}}),this.m_body.CreateFixture({shape:e,density:1}),e.SetAsBox(.25,.25),this.m_x=.20352793,this.m_bullet=this.m_world.CreateBody({type:2,bullet:!0,position:{x:this.m_x,y:10}}),this.m_bullet.CreateFixture({shape:e,density:100}),this.m_bullet.SetLinearVelocity(new n(0,-50))}}Launch(){this.m_body.SetTransformVec(new n(0,4),0),this.m_body.SetLinearVelocity(n.ZERO),this.m_body.SetAngularVelocity(0),this.m_x=W(-1,1),this.m_bullet.SetTransformVec(new n(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new n(0,-50)),this.m_bullet.SetAngularVelocity(0),Kt.reset(),ot.reset()}GetDefaultViewZoom(){return 50}Step(e,r){super.Step(e,r),this.addDebug("GJK Calls [ave Iters] (max Iters)",Kt.calls>0&&Cx(Kt.calls,Kt.iters/Kt.calls,Kt.maxIters)),this.addDebug("Toi Calls [ave Iters] (max Iters)",ot.calls>0&&Cx(ot.calls,ot.iters/ot.calls,ot.maxIters)),this.addDebug("Root Toi [ave Iters] (max Iters)",ot.calls>0&&`[${(ot.rootIters/ot.calls).toFixed(1)}] (${ot.maxRootIters})`),this.m_stepCount%60===0&&this.Launch()}};P("Continuous","Bullet Test",Ih);var Lh=class i extends R{static{this.e_count=8}constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new bo,s=t;for(let l=0;l<i.e_count;++l){let a=this.m_world.CreateBody({type:2,position:{x:-14.5+1*l,y:5}});a.CreateFixture(r);let c=new n(-15+1*l,5);o.Initialize(s,a,c),this.m_world.CreateJoint(o),s=a}}{let e=new v;e.SetAsBox(1,.125);let r={shape:e,density:20},o=new bo,s=5,l=.7,a=t;for(let c=0;c<3;++c){let u=this.m_world.CreateBody({type:2,position:{x:-14+2*c,y:15}});u.CreateFixture(r);let m=new n(-15+2*c,15);o.Initialize(a,u,m),cd(o,s,l,o.bodyA,o.bodyB),this.m_world.CreateJoint(o),a=u}}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new bo,s=t;for(let l=0;l<i.e_count;++l){let a=this.m_world.CreateBody({type:2,position:{x:-4.5+1*l,y:5}});if(a.CreateFixture(r),l>0){let c=new n(-5+1*l,5);o.Initialize(s,a,c),this.m_world.CreateJoint(o)}s=a}}{let e=new v;e.SetAsBox(.5,.125);let r={shape:e,density:20},o=new bo,s=8,l=.7,a=t;for(let c=0;c<i.e_count;++c){let u=this.m_world.CreateBody({type:2,position:{x:5.5+1*c,y:10}});if(u.CreateFixture(r),c>0){let m=new n(5+1*c,10);o.Initialize(a,u,m),cd(o,s,l,o.bodyA,o.bodyB),this.m_world.CreateJoint(o)}a=u}}for(let e=0;e<2;++e){let r=[];r[0]=new n(-.5,0),r[1]=new n(.5,0),r[2]=new n(0,1.5);let o=new v;o.Set(r),this.m_world.CreateBody({type:2,position:{x:-8+8*e,y:12}}).CreateFixture({shape:o,density:1})}for(let e=0;e<2;++e){let r=new V;r.m_radius=.5,this.m_world.CreateBody({type:2,position:{x:-6+6*e,y:10}}).CreateFixture({shape:r,density:1})}}};P("Joints","Cantilever",Lh);var Gh=class extends R{constructor(){super();this.m_speed=0;this.m_speed=50;let e;{e=this.m_world.CreateBody();let r=new I,o={shape:r,density:0,friction:.6};r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture(o);let s=[.25,1,4,0,0,-1,-2,-2,-1.25,0],l=20,a=0,c=5;for(let u=0;u<10;++u){let m=s[u];r.SetTwoSided(new n(l,a),new n(l+c,m)),e.CreateFixture(o),a=m,l+=c}for(let u=0;u<10;++u){let m=s[u];r.SetTwoSided(new n(l,a),new n(l+c,m)),e.CreateFixture(o),a=m,l+=c}r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=80,r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=40,r.SetTwoSided(new n(l,0),new n(l+10,5)),e.CreateFixture(o),l+=20,r.SetTwoSided(new n(l,0),new n(l+40,0)),e.CreateFixture(o),l+=40,r.SetTwoSided(new n(l,0),new n(l,20)),e.CreateFixture(o)}{let r=this.m_world.CreateBody({type:2,position:{x:140,y:1}}),o=new v;o.SetAsBox(10,.25),r.CreateFixture({shape:o,density:1});let s=new q;s.Initialize(e,r,r.GetPosition()),s.lowerAngle=-8*Math.PI/180,s.upperAngle=8*Math.PI/180,s.enableLimit=!0,this.m_world.CreateJoint(s),r.ApplyAngularImpulse(100)}{let o=new v;o.SetAsBox(1,.125);let s={shape:o,density:1,friction:.6},l=new q,a=e;for(let u=0;u<20;++u){let m=this.m_world.CreateBody({type:2,position:{x:161+2*u,y:-.125}});m.CreateFixture(s);let p=new n(160+2*u,-.125);l.Initialize(a,m,p),this.m_world.CreateJoint(l),a=m}let c=new n(160+2*20,-.125);l.Initialize(a,e,c),this.m_world.CreateJoint(l)}{let r=new v;r.SetAsBox(.5,.5);let o,s=new n,l={type:2,position:s};s.Set(230,.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,1.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,2.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,3.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5}),s.Set(230,4.5),o=this.m_world.CreateBody(l),o.CreateFixture({shape:r,density:.5})}{let r=new v,o=H(8,n);o[0].Set(-1.5,-.5),o[1].Set(1.5,-.5),o[2].Set(1.5,0),o[3].Set(0,.9),o[4].Set(-1.15,.9),o[5].Set(-1.5,.2),r.Set(o,6);let s=new V;s.m_radius=.4;let l=new n,a={type:2,position:l};l.Set(0,1),this.m_car=this.m_world.CreateBody(a),this.m_car.CreateFixture({shape:r,density:1});let c={shape:s,density:1,friction:.9};l.Set(-1,.35),this.m_wheel1=this.m_world.CreateBody(a),this.m_wheel1.CreateFixture(c),l.Set(1,.4),this.m_wheel2=this.m_world.CreateBody(a),this.m_wheel2.CreateFixture(c);let u=new ps,m=new n(0,1),p=this.m_wheel1.GetMass(),d=this.m_wheel2.GetMass(),h=4,f=.7,b=2*Math.PI*h;u.Initialize(this.m_car,this.m_wheel1,this.m_wheel1.GetPosition(),m),u.motorSpeed=0,u.maxMotorTorque=20,u.enableMotor=!0,u.stiffness=p*b*b,u.damping=2*p*f*b,u.lowerTranslation=-.25,u.upperTranslation=.25,u.enableLimit=!0,this.m_spring1=this.m_world.CreateJoint(u),u.Initialize(this.m_car,this.m_wheel2,this.m_wheel2.GetPosition(),m),u.motorSpeed=0,u.maxMotorTorque=10,u.enableMotor=!1,u.stiffness=d*b*b,u.damping=2*d*f*b,u.lowerTranslation=-.25,u.upperTranslation=.25,u.enableLimit=!0,this.m_spring2=this.m_world.CreateJoint(u)}}getHotkeys(){return[Er("a","Decelerate",e=>this.m_spring1.SetMotorSpeed(e?this.m_speed:0)),Er("d","Accelerate",e=>this.m_spring1.SetMotorSpeed(e?-this.m_speed:0))]}Step(e,r){let o=st.getCenter();st.setPosition(this.m_car.GetPosition().x,o.y),super.Step(e,r)}};P("Examples","Car",Gh);var Vh=class extends R{constructor(){super();this.m_angularVelocity=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-10,0),new n(10,0)),e.CreateFixture({shape:r});let o=new v;o.SetAsBox(.2,1,new n(.5,1),0),e.CreateFixture({shape:o})}{let e=new v;e.SetAsBox(2,.1),this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:20}}),this.m_body.CreateFixture({shape:e,density:1}),this.m_angularVelocity=W(-50,50),this.m_body.SetLinearVelocity(new n(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}Kt.reset(),ot.reset()}Launch(){Kt.reset(),ot.reset(),this.m_body.SetTransformVec(new n(0,20),0),this.m_angularVelocity=W(-50,50),this.m_body.SetLinearVelocity(new n(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}Step(e,r){super.Step(e,r),this.addDebug("GJK Calls [ave Iters] (max Iters)",Kt.calls>0&&`${Kt.calls.toFixed(0)} [${(Kt.iters/Kt.calls).toFixed(1)}] (${Kt.maxIters.toFixed(0)})`),this.addDebug("Toi Calls [ave Iters] (max Iters)",ot.calls>0&&`${ot.calls} [${(ot.iters/ot.calls).toFixed(1)}] (${ot.maxIters})`),this.addDebug("Toi Root [ave Iters] (max Iters)",ot.calls>0&&`${ot.calls} [${(ot.rootIters/ot.calls).toFixed(1)}] (${ot.maxRootIters})`),this.addDebug("Toi Time in ms [ave] (max)",ot.calls>0&&`[${(1e3*ot.time/ot.calls).toFixed(1)}] (${(1e3*ot.maxTime).toFixed(1)})`),this.m_stepCount%60===0&&this.Launch()}GetDefaultViewZoom(){return 50}};P("Continuous","Continuous Test",Vh);var xA=!1,Eh=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.6,.125);let r={shape:e,density:20,friction:.2},o=new q;o.collideConnected=!1;let s=25,l=t;for(let a=0;a<30;++a){let c=this.m_world.CreateBody({type:2,position:{x:.5+a,y:s}});xA&&(a===10?r.density=0:r.density=20),c.CreateFixture(r);let u=new n(a,s);o.Initialize(l,c,u),this.m_world.CreateJoint(o),l=c}}}};P("Joints","Chain",Eh);var Uh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-8,1),new n(-6,1)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-6,1),new n(-4,1)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-4,1),new n(-2,1)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody({angle:.25*Math.PI}),e=H(4,n);e[0].Set(5,7),e[1].Set(8,7),e[2].Set(7,8),e[3].Set(6,8);let r=new dt;r.CreateLoop(e,4),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody(),e=new v;e.SetAsBox(1,1,new n(4,3),0),t.CreateFixture({shape:e}),e.SetAsBox(1,1,new n(6,3),0),t.CreateFixture({shape:e}),e.SetAsBox(1,1,new n(8,3),0),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody(),e=H(4,n);e[0].Set(-1,3),e[1].Set(1,3),e[2].Set(1,5),e[3].Set(-1,5);let r=new dt;r.CreateLoop(e,4),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody({position:{x:-10,y:4}}),e=H(10,n);e[0].Set(0,0),e[1].Set(6,0),e[2].Set(6,2),e[3].Set(4,1),e[4].Set(2,2),e[5].Set(0,2),e[6].Set(-2,2),e[7].Set(-4,3),e[8].Set(-6,2),e[9].Set(-6,0);let r=new dt;r.CreateLoop(e,10),t.CreateFixture({shape:r})}{let t=this.m_world.CreateBody({position:{x:-3,y:8},type:2,fixedRotation:!0,allowSleep:!1}),e=new v;e.SetAsBox(.5,.5),t.CreateFixture({shape:e,density:20})}{let t=this.m_world.CreateBody({position:{x:-5,y:5},type:2,fixedRotation:!0,allowSleep:!1}),e=new v;e.SetAsBox(.25,.25),t.CreateFixture({shape:e,density:20})}{let t=this.m_world.CreateBody({position:{x:-5,y:8},type:2,fixedRotation:!0,allowSleep:!1}),e=0,r=Math.PI/3,o=H(6,n);for(let l=0;l<6;++l)o[l].Set(.5*Math.cos(e),.5*Math.sin(e)),e+=r;let s=new v;s.Set(o,6),t.CreateFixture({shape:s,density:20})}{let t=this.m_world.CreateBody({position:{x:3,y:5},type:2,fixedRotation:!0,allowSleep:!1}),e=new V;e.m_radius=.5,t.CreateFixture({shape:e,density:20})}{this.m_character=this.m_world.CreateBody({position:{x:-7,y:6},type:2,allowSleep:!1});let t=new V;t.m_radius=.25,this.m_character.CreateFixture({shape:t,density:20,friction:1})}}GetDefaultViewZoom(){return 30}getCenter(){return{x:-2,y:0}}Step(t,e){let r=this.m_character.GetLinearVelocity();this.m_character.SetLinearVelocity({x:-5,y:r.y}),super.Step(t,e),this.addText("This tests various character collision shapes"),this.addText("Limitation: square and hexagon can snag on aligned boxes."),this.addText("Feature: edge chains have smooth collision inside and out.")}};P("Examples","Character Collision",Uh);var Yh=class i extends R{static{this.k_smallGroup=1}static{this.k_largeGroup=-1}static{this.k_triangleCategory=2}static{this.k_boxCategory=4}static{this.k_circleCategory=8}static{this.k_triangleMask=65535}static{this.k_boxMask=65535^i.k_triangleCategory}static{this.k_circleMask=65535}constructor(){super();{let x=new I;x.SetTwoSided(new n(-40,0),new n(40,0)),this.m_world.CreateBody().CreateFixture({shape:x,friction:.3})}let t=[];t[0]=new n(-1,0),t[1]=new n(1,0),t[2]=new n(0,2);let e=new v;e.Set(t,3);let r={groupIndex:i.k_smallGroup,categoryBits:i.k_triangleCategory,maskBits:i.k_triangleMask},o={shape:e,density:1,filter:r};this.m_world.CreateBody({type:2,position:{x:-5,y:2}}).CreateFixture(o),t[0].Scale(2),t[1].Scale(2),t[2].Scale(2),e.Set(t,3),r.groupIndex=i.k_largeGroup;let l=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:-5,y:6}});l.CreateFixture(o);{let x=this.m_world.CreateBody({type:2,position:{x:-5,y:10}}),_=new v;_.SetAsBox(.5,1),x.CreateFixture({shape:_,density:1});let y=new Nt;y.bodyA=l,y.bodyB=x,y.enableLimit=!0,y.localAnchorA.Set(0,4),y.localAnchorB.SetZero(),y.localAxisA.Set(0,1),y.lowerTranslation=-1,y.upperTranslation=1,this.m_world.CreateJoint(y)}e.SetAsBox(1,.5);let a={groupIndex:i.k_smallGroup,categoryBits:i.k_boxCategory,maskBits:i.k_boxMask},c={shape:e,density:1,restitution:.1,filter:a};this.m_world.CreateBody({type:2,position:{x:0,y:2}}).CreateFixture(c),e.SetAsBox(2,1),a.groupIndex=i.k_largeGroup,this.m_world.CreateBody({type:2,position:{x:0,y:6}}).CreateFixture(c);let p=new V;p.m_radius=1;let d={groupIndex:i.k_smallGroup,categoryBits:i.k_circleCategory,maskBits:i.k_circleMask},h={shape:p,density:1,filter:d};this.m_world.CreateBody({type:2,position:{x:5,y:2}}).CreateFixture(h),p.m_radius*=2,d.groupIndex=i.k_largeGroup,this.m_world.CreateBody({type:2,position:{x:5,y:6}}).CreateFixture(h)}};P("Examples","Collision Filtering",Yh);var Jh=class extends R{constructor(){super();{let _=new I;_.SetTwoSided(new n(-50,0),new n(50,0)),this.m_world.CreateBody().CreateFixture({shape:_})}let t=-5,e=5,r=2,o=35,s=[new n(-1,0),new n(1,0),new n(0,2)],l=new v;l.Set(s,3);let a={shape:l,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(a),s[0].Scale(2),s[1].Scale(2),s[2].Scale(2),l.Set(s,3),this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(a),l.SetAsBox(1,.5);let m={shape:l,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(m),l.SetAsBox(2,1),this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(m);let h=new V;h.m_radius=1;let f={shape:h,density:1};this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(f),h.m_radius*=2,this.m_world.CreateBody({type:2,position:{x:W(t,e),y:W(r,o)}}).CreateFixture(f)}Step(t,e){super.Step(t,e);let r=6,o=new Array(r),s=0;for(let l=0;l<this.m_pointCount;++l){let a=this.m_points[l],c=a.fixtureA.GetBody(),u=a.fixtureB.GetBody(),m=c.GetMass(),p=u.GetMass();if(m>0&&p>0&&(p>m?o[s++]=c:o[s++]=u,s===r))break}for(let l=0;l<s;l++){let a=o[l];o.indexOf(a)===l&&a!==this.m_bomb&&this.m_world.DestroyBody(a)}}};P("Examples","Collision Processing",Jh);var zh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(50,0),new n(-50,0)),t.CreateFixture({shape:e})}{this.m_table1=this.m_world.CreateBody({type:2,position:new n(-15,1)});let t=new v;t.SetAsBox(3,.5,new n(0,3.5),0);let e=new v;e.SetAsBox(.5,1.5,new n(-2.5,1.5),0);let r=new v;r.SetAsBox(.5,1.5,new n(2.5,1.5),0),this.m_table1.CreateFixture({shape:t,density:2}),this.m_table1.CreateFixture({shape:e,density:2}),this.m_table1.CreateFixture({shape:r,density:2})}{this.m_table2=this.m_world.CreateBody({type:2,position:new n(-5,1)});let t=new v;t.SetAsBox(3,.5,new n(0,3.5),0);let e=new v;e.SetAsBox(.5,2,new n(-2.5,2),0);let r=new v;r.SetAsBox(.5,2,new n(2.5,2),0),this.m_table2.CreateFixture({shape:t,density:2}),this.m_table2.CreateFixture({shape:e,density:2}),this.m_table2.CreateFixture({shape:r,density:2})}{this.m_ship1=this.m_world.CreateBody({type:2,position:new n(5,1)});let t=[],e=new v;t[0]=new n(-2,0),t[1]=new n(0,4/3),t[2]=new n(0,4),e.Set(t,3);let r=new v;t[0]=new n(2,0),t[1]=new n(0,4/3),t[2]=new n(0,4),r.Set(t,3),this.m_ship1.CreateFixture({shape:e,density:2}),this.m_ship1.CreateFixture({shape:r,density:2})}{this.m_ship2=this.m_world.CreateBody({type:2,position:new n(15,1)});let t=[],e=new v;t[0]=new n(-2,0),t[1]=new n(1,2),t[2]=new n(0,4),e.Set(t,3);let r=new v;t[0]=new n(2,0),t[1]=new n(-1,2),t[2]=new n(0,4),r.Set(t,3),this.m_ship2.CreateFixture({shape:e,density:2}),this.m_ship2.CreateFixture({shape:r,density:2})}}Spawn(){{let t=this.m_world.CreateBody({type:2,position:this.m_table1.GetPosition(),angle:this.m_table1.GetAngle()}),e=new v;e.SetAsBox(4,.1,new n(0,3),0),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_table2.GetPosition(),angle:this.m_table2.GetAngle()}),e=new v;e.SetAsBox(4,.1,new n(0,3),0),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_ship1.GetPosition(),angle:this.m_ship1.GetAngle(),gravityScale:0}),e=new V(.5);e.m_p.Set(0,2),t.CreateFixture({shape:e,density:2})}{let t=this.m_world.CreateBody({type:2,position:this.m_ship2.GetPosition(),angle:this.m_ship2.GetAngle(),gravityScale:0}),e=new V(.5);e.m_p.Set(0,2),t.CreateFixture({shape:e,density:2})}}getHotkeys(){return[G("s","Spawn Items",()=>{this.Spawn()})]}getCenter(){return{x:0,y:5}}};P("Examples","Compound Shapes",zh);var jh=class i extends R{static{this.e_columnCount=0}static{this.e_rowCount=0}constructor(){super(n.ZERO);{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-10,0),new n(10,0)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-10,0),new n(-10,20)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(10,0),new n(10,20)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-10,20),new n(10,20)),o.CreateFixture({shape:s})}let t=.5,e=new V;e.m_p.SetZero(),e.m_radius=t;let r={shape:e,density:1,friction:.1};for(let o=0;o<i.e_columnCount;++o)for(let s=0;s<i.e_rowCount;++s)this.m_world.CreateBody({type:2,position:{x:-10+(2.1*o+1+.01*s)*t,y:(2*s+1)*t}}).CreateFixture(r)}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:10}}CreateCircle(){let e=new V;e.m_p.SetZero(),e.m_radius=2,this.m_world.CreateBody({type:2,position:{x:An(),y:3+An()}}).CreateFixture({shape:e,density:1,friction:0})}getHotkeys(){return[G("c","Create Circle",()=>this.CreateCircle())]}Step(t,e){for(let r=this.m_world.GetBodyList();r;r=r.GetNext())r.GetType(),2;this.m_stepCount===180&&(this.m_stepCount+=0),super.Step(t,e);for(let r=this.m_world.GetBodyList();r;r=r.GetNext())r.GetType(),2}};P("Solver","Confined",jh);var Xh=class i extends R{constructor(){super();this.m_test_points=[];this.m_count=0;this.m_generation=0;this.m_bulk=!1;this.m_auto=!1;this.Generate()}static{this.e_count=Wt}GetDefaultViewZoom(){return 50}Generate(){let e=Math.PI*An(),r=new D(e);for(let o=0;o<i.e_count;++o){let s=W(-10,10),l=W(-10,10);s=et(s,-4,4),l=et(l,-4,4),this.m_test_points[o]=D.MultiplyVec2(r,new n(s,l),new n)}this.m_count=i.e_count,this.m_generation+=1}getHotkeys(){return[G("a","Toggle Autogeneration",()=>{this.m_auto=!this.m_auto}),G("b","Toggle Bulk",()=>{this.m_bulk=!this.m_bulk}),G("g","Generate a new random convex hull",()=>this.Generate())]}Step(e,r){super.Step(e,r);let o,s=!1;if(this.m_bulk){for(let a=0;a<1e4;++a)if(this.Generate(),o=Dn(this.m_test_points,this.m_count),o.length!==0&&(s=Mn(o,o.length),s===!1)){this.m_bulk=!1;break}}else this.m_auto&&this.Generate(),o=Dn(this.m_test_points,this.m_count),o.length>0&&(s=Mn(o,o.length),s===!1&&(this.m_auto=!1));let l=e.m_debugDraw;s===!1?this.addText(`generation = ${this.m_generation}, FAILED`):this.addText(`generation = ${this.m_generation}, count = ${o.length}`),l.DrawPolygon(o,o.length,new F(.9,.9,.9));for(let a=0;a<this.m_count;++a){let c=this.m_test_points[a];l.DrawPoint(c,5,new F(.3,.3,.9)),l.DrawStringWorld(c.x+.1,c.y+.1,a.toFixed(0))}for(let a of o)l.DrawPoint(a,6,new F(.3,.7,.3))}};P("Geometry","Convex Hull",Xh);var Hh=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:e})}{let t=this.m_world.CreateBody({position:{x:-5,y:5}}),e=new v;e.SetAsBox(10,.5),this.m_platform=t.CreateFixture({shape:e,friction:.8})}for(let t=0;t<5;++t){let e=this.m_world.CreateBody({type:2,position:{x:-10+2*t,y:7}}),r=new v;r.SetAsBox(.5,.5),e.CreateFixture({shape:r,density:20})}}GetDefaultViewZoom(){return 40}PreSolve(t,e){super.PreSolve(t,e);let r=t.GetFixtureA(),o=t.GetFixtureB();r===this.m_platform&&t.SetTangentSpeed(5),o===this.m_platform&&t.SetTangentSpeed(-5)}};P("Examples","Conveyor Belt",Hh);var Oh=class extends R{constructor(){super();this.m_positionB=new n;this.m_angleB=0;this.m_transformA=new T;this.m_transformB=new T;this.m_polygonA=new v;this.m_polygonB=new v;this.m_transformA.SetIdentity(),this.m_transformA.p.Set(0,-.2),this.m_polygonA.SetAsBox(10,.2),this.m_positionB.Set(12.017401,.13678508),this.m_angleB=-.0109265,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB),this.m_polygonB.SetAsBox(2,.1)}GetDefaultViewZoom(){return 200}getCenter(){return{x:10,y:-.5}}getHotkeys(){return[G("a","Move Left",()=>this.Adjust(-.1,0,0)),G("d","Move Right",()=>this.Adjust(.1,0,0)),G("s","Move Down",()=>this.Adjust(0,-.1,0)),G("w","Move Up",()=>this.Adjust(0,.1,0)),G("q","Turn Left",()=>this.Adjust(0,0,.1*Math.PI)),G("e","Turn Right",()=>this.Adjust(0,0,-.1*Math.PI))]}Adjust(e,r,o){this.m_positionB.x+=e,this.m_positionB.y+=r,this.m_angleB+=o,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}Step(e,r){super.Step(e,r);let o=new Ri;o.proxyA.SetShape(this.m_polygonA,0),o.proxyB.SetShape(this.m_polygonB,0),o.transformA.Copy(this.m_transformA),o.transformB.Copy(this.m_transformB),o.useRadii=!0;let s=new Mi;s.count=0;let l=new ki;kr(l,s,o),this.addDebug("Distance",l.distance.toFixed(2)),this.addDebug("Iterations",l.iterations);let a=e.m_debugDraw;{let d=new F(.9,.9,.9),h=[];for(let f=0;f<this.m_polygonA.m_count;++f)h[f]=T.MultiplyVec2(this.m_transformA,this.m_polygonA.m_vertices[f],new n);a.DrawPolygon(h,this.m_polygonA.m_count,d);for(let f=0;f<this.m_polygonB.m_count;++f)h[f]=T.MultiplyVec2(this.m_transformB,this.m_polygonB.m_vertices[f],new n);a.DrawPolygon(h,this.m_polygonB.m_count,d)}let c=l.pointA,u=l.pointB,m=new F(1,0,0);a.DrawPoint(c,4,m);let p=new F(1,1,0);a.DrawPoint(u,4,p)}};P("Examples","Distance Test",Oh);var Nh=class extends R{constructor(){super();let t=null;{let d=new I;d.SetTwoSided(new n(-40,0),new n(40,0)),t=this.m_world.CreateBody(),t.CreateFixture({shape:d})}{let d=new v;d.SetAsBox(6,.25),this.m_world.CreateBody({position:{x:-1.5,y:10}}).CreateFixture({shape:d})}{let d=new v;d.SetAsBox(.1,1);let h={shape:d,density:20,friction:.1};for(let f=0;f<10;++f)this.m_world.CreateBody({type:2,position:{x:-6+1*f,y:11.25}}).CreateFixture(h)}{let d=new v;d.SetAsBox(7,.25,n.ZERO,.3),this.m_world.CreateBody({position:{x:1,y:6}}).CreateFixture({shape:d})}let e=null;{let d=new v;d.SetAsBox(.25,1.5),e=this.m_world.CreateBody({position:{x:-7,y:4}}),e.CreateFixture({shape:d})}let r=null;{let d=new v;d.SetAsBox(6,.125),r=this.m_world.CreateBody({type:2,angle:-.15,position:{x:-.9,y:1}}),r.CreateFixture({shape:d,density:10})}let o=new q,s=new n;s.Set(-2,1),o.Initialize(t,r,s),o.collideConnected=!0,this.m_world.CreateJoint(o);let l=null;{let d=new v;d.SetAsBox(.25,.25),l=this.m_world.CreateBody({type:2,position:{x:-10,y:15}}),l.CreateFixture({shape:d,density:10})}s.Set(-7,15),o.Initialize(e,l,s),this.m_world.CreateJoint(o);let a=null;{a=this.m_world.CreateBody({type:2,position:{x:6.5,y:3}});let d=new v,h={shape:d,density:10,friction:.1};d.SetAsBox(1,.1,new n(0,-.9),0),a.CreateFixture(h),d.SetAsBox(.1,1,new n(-.9,0),0),a.CreateFixture(h),d.SetAsBox(.1,1,new n(.9,0),0),a.CreateFixture(h)}s.Set(6,2),o.Initialize(t,a,s),this.m_world.CreateJoint(o);let c=null;{let d=new v;d.SetAsBox(1,.1),c=this.m_world.CreateBody({type:2,position:{x:6.5,y:4.1}}),c.CreateFixture({shape:d,density:30})}s.Set(7.5,4),o.Initialize(a,c,s),this.m_world.CreateJoint(o);let u=null;{let d=new v;d.SetAsBox(.1,1),u=this.m_world.CreateBody({type:2,position:{x:7.4,y:1}}),u.CreateFixture({shape:d,density:10})}let m=new Fe;m.bodyA=r,m.bodyB=u,m.localAnchorA.Set(6,0),m.localAnchorB.Set(0,-1);let p=n.Subtract(m.bodyB.GetWorldPoint(m.localAnchorB,new n),m.bodyA.GetWorldPoint(m.localAnchorA,new n),new n);m.length=p.Length(),Ct(m,1,1,m.bodyA,m.bodyB),this.m_world.CreateJoint(m);{let h=new V;h.m_radius=.2;for(let f=0;f<4;++f)this.m_world.CreateBody({type:2,position:{x:5.9+.4*f,y:2.4}}).CreateFixture({shape:h,density:10})}}GetDefaultViewZoom(){return 50}getCenter(){return{x:0,y:5}}};P("Examples","Dominos",Nh);var Zh=class extends R{constructor(){super(n.ZERO);let t=new Array(4),e=new Array(2);t[0]=this.m_world.CreateBody({type:0,angle:0,angularVelocity:0,linearDamping:0,angularDamping:0,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,0),r.m_vertex2.Set(44.5217399597168,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,16.69565200805664),r.m_vertex2.Set(44.5217399597168,16.69565200805664),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(0,16.69565200805664),r.m_vertex2.Set(0,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}{let r=new I;r.m_radius=.009999999776483,r.m_vertex0.Set(0,0),r.m_vertex1.Set(44.5217399597168,16.69565200805664),r.m_vertex2.Set(44.5217399597168,0),r.m_vertex3.Set(0,0),t[0].CreateFixture({friction:10,restitution:0,density:0,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[1]=this.m_world.CreateBody({type:2,position:{x:.847826063632965,y:2.5},angle:0,angularVelocity:0,linearDamping:.5,angularDamping:.5,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new v,o=H(8,n);o[0].Set(6.907599925994873,.327199995517731),o[1].Set(-.322800010442734,.282599985599518),o[2].Set(-.322800010442734,-.295700013637543),o[3].Set(6.885900020599365,-.364100009202957),r.Set(o,4),t[1].CreateFixture({friction:1,restitution:.5,density:10,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[2]=this.m_world.CreateBody({type:2,position:{x:13.04347801208496,y:2.5},angle:0,angularVelocity:0,linearDamping:.5,angularDamping:.5,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new v,o=H(8,n);o[0].Set(.200000002980232,-.300000011920929),o[1].Set(.200000002980232,.200000002980232),o[2].Set(-6.900000095367432,.200000002980232),o[3].Set(-6.900000095367432,-.300000011920929),r.Set(o,4),t[2].CreateFixture({friction:1,restitution:.5,density:10,isSensor:!1,filter:{categoryBits:1,maskBits:65535,groupIndex:0},shape:r})}t[3]=this.m_world.CreateBody({type:0,angle:0,angularVelocity:0,linearDamping:0,angularDamping:0,allowSleep:!0,awake:!0,fixedRotation:!1,bullet:!1,enabled:!0,gravityScale:1});{let r=new q;r.bodyA=t[1],r.bodyB=t[0],r.collideConnected=!1,r.localAnchorA.Set(0,0),r.localAnchorB.Set(.847826063632965,2.5),r.referenceAngle=0,r.enableLimit=!1,r.lowerAngle=0,r.upperAngle=0,r.enableMotor=!1,r.motorSpeed=0,r.maxMotorTorque=0,e[0]=this.m_world.CreateJoint(r)}{let r=new Nt;r.bodyA=t[1],r.bodyB=t[2],r.collideConnected=!1,r.localAnchorA.Set(0,0),r.localAnchorB.Set(-12.19565200805664,0),r.localAxisA.Set(-1,0),r.referenceAngle=0,r.enableLimit=!0,r.lowerTranslation=-20,r.upperTranslation=0,r.enableMotor=!0,r.motorSpeed=0,r.maxMotorForce=10,e[1]=this.m_world.CreateJoint(r)}}getCenter(){return{x:15,y:5}}};P("Examples","Dump Shell",Zh);var gA={aabb0:new lt,c0:new n,c1:new n},Qh=class{constructor(){this.aabb=new lt;this.fraction=0;this.overlap=!1;this.proxyId=null}},qh=class i extends R{constructor(){super();this.m_worldExtent=0;this.m_proxyExtent=0;this.m_tree=new os;this.m_queryAABB=new lt;this.m_rayCastInput=new _i;this.m_rayCastOutput=new yi;this.m_rayActor=null;this.m_actors=Array.from({length:i.e_actorCount},()=>new Qh);this.m_stepCount=0;this.m_automated=!1;this.m_worldExtent=15,this.m_proxyExtent=.5;for(let r=0;r<i.e_actorCount;++r){let o=this.m_actors[r];this.GetRandomAABB(o.aabb),o.proxyId=this.m_tree.CreateProxy(o.aabb,o)}this.m_stepCount=0;let e=this.m_worldExtent;this.m_queryAABB.lowerBound.Set(-3,-4+e),this.m_queryAABB.upperBound.Set(5,6+e),this.m_rayCastInput.p1.Set(-5,5+e),this.m_rayCastInput.p2.Set(7,-4+e),this.m_rayCastInput.maxFraction=1,this.m_automated=!1}static{this.e_actorCount=128}getCenter(){return{x:0,y:10}}Step(e,r){if(super.Step(e,r),this.Reset(),this.m_automated){let c=Math.max(1,i.e_actorCount>>2);for(let u=0;u<c;++u)this.Action()}this.Query(),this.RayCast();let o=e.m_debugDraw;for(let c=0;c<i.e_actorCount;++c){let u=this.m_actors[c];if(u.proxyId===null)continue;let m=new F(.9,.9,.9);u===this.m_rayActor&&u.overlap?m.SetRGB(.9,.6,.6):u===this.m_rayActor?m.SetRGB(.6,.9,.6):u.overlap&&m.SetRGB(.6,.6,.9),o.DrawAABB(u.aabb,m)}let s=new F(.7,.7,.7);o.DrawAABB(this.m_queryAABB,s),o.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,s);let l=new F(.2,.9,.2),a=new F(.9,.2,.2);if(o.DrawPoint(this.m_rayCastInput.p1,6,l),o.DrawPoint(this.m_rayCastInput.p2,6,a),this.m_rayActor){let c=new F(.2,.2,.9),u=n.Add(this.m_rayCastInput.p1,n.Scale(this.m_rayActor.fraction,n.Subtract(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new n),new n),new n);o.DrawPoint(u,6,c)}this.addDebug("Dynamic Tree Height",this.m_tree.GetHeight()),++this.m_stepCount}getHotkeys(){return[G("a","Toggle Automated",()=>{this.m_automated=!this.m_automated}),G("c","Create Proxy",()=>this.CreateProxy()),G("d","Destroy Proxy",()=>this.DestroyProxy()),G("m","Move Proxy",()=>this.MoveProxy())]}GetRandomAABB(e){let r=new n;r.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),e.lowerBound.x=W(-this.m_worldExtent,this.m_worldExtent),e.lowerBound.y=W(0,2*this.m_worldExtent),e.upperBound.Copy(e.lowerBound),e.upperBound.Add(r)}MoveAABB(e){let r=new n;r.x=W(-.5,.5),r.y=W(-.5,.5),e.lowerBound.Add(r),e.upperBound.Add(r);let o=n.Mid(e.lowerBound,e.upperBound,new n),s=new n(-this.m_worldExtent,0),l=new n(this.m_worldExtent,2*this.m_worldExtent),a=n.Clamp(o,s,l,new n);e.lowerBound.Add(n.Subtract(a,o,new n)),e.upperBound.Add(n.Subtract(a,o,new n))}CreateProxy(){for(let e=0;e<i.e_actorCount;++e){let r=Ga(0,i.e_actorCount-1),o=this.m_actors[r];if(o.proxyId===null){this.GetRandomAABB(o.aabb),o.proxyId=this.m_tree.CreateProxy(o.aabb,o);return}}}DestroyProxy(){for(let e=0;e<i.e_actorCount;++e){let r=Ga(0,i.e_actorCount-1),o=this.m_actors[r];if(o.proxyId!==null){this.m_tree.DestroyProxy(o.proxyId),o.proxyId=null;return}}}MoveProxy(){let{aabb0:e,c0:r,c1:o}=gA;for(let s=0;s<i.e_actorCount;++s){let l=Ga(0,i.e_actorCount-1),a=this.m_actors[l];if(a.proxyId===null)continue;e.Copy(a.aabb),this.MoveAABB(a.aabb);let c=n.Subtract(a.aabb.GetCenter(o),e.GetCenter(r),new n);this.m_tree.MoveProxy(a.proxyId,a.aabb,c);return}}Reset(){this.m_rayActor=null;for(let e=0;e<i.e_actorCount;++e)this.m_actors[e].fraction=1,this.m_actors[e].overlap=!1}Action(){switch(Math.floor(W(0,19))){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}}Query(){this.m_tree.Query(this.m_queryAABB,e=>{let r=ct(e.userData);return r.overlap=this.m_queryAABB.TestOverlap(r.aabb),!0});for(let e=0;e<i.e_actorCount;++e)if(this.m_actors[e].proxyId!==null){let r=this.m_queryAABB.TestOverlap(this.m_actors[e].aabb);N(r===this.m_actors[e].overlap)}}RayCast(){this.m_rayActor=null;let e=new _i().Copy(this.m_rayCastInput);this.m_tree.RayCast(e,(s,l)=>{let a=ct(l.userData),c=new yi;return a.aabb.RayCast(c,s)?(this.m_rayCastOutput=c,this.m_rayActor=a,this.m_rayActor.fraction=c.fraction,c.fraction):s.maxFraction});let r=null,o=new yi;for(let s=0;s<i.e_actorCount;++s){if(this.m_actors[s].proxyId===null)continue;let l=new yi;this.m_actors[s].aabb.RayCast(l,e)&&(r=this.m_actors[s],o.Copy(l),e.maxFraction=l.fraction)}}};P("Collision","Dynamic Tree",qh);var Wh=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_circle=new V;this.m_angle=0;this.m_bodies=new Array(i.e_maxBodies),this.m_polygons=new Array(4);for(let e=0;e<4;++e)this.m_polygons[e]=new v;{let e=this.m_world.CreateBody(),r=-20,o=2*Math.cos(r/10*Math.PI);for(let s=0;s<80;++s){let l=r+.5,a=2*Math.cos(l/10*Math.PI),c=new I;c.SetTwoSided(new n(r,o),new n(l,a)),e.CreateFixture({shape:c}),r=l,o=a}}{let e=new Array(3);e[0]=new n(-.5,0),e[1]=new n(.5,0),e[2]=new n(0,1.5),this.m_polygons[0].Set(e,3)}{let e=new Array(3);e[0]=new n(-.1,0),e[1]=new n(.1,0),e[2]=new n(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=new Array(8);s[0]=new n(.5*o,0),s[1]=new n(.5*1,r),s[2]=new n(.5*1,r+o),s[3]=new n(.5*o,1),s[4]=new n(-.5*o,1),s[5]=new n(-.5*1,r+o),s[6]=new n(-.5*1,r),s[7]=new n(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r!==null&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null);let o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({position:{x:W(-10,10),y:W(10,20)},angle:W(-Math.PI,Math.PI),type:2,angularDamping:e===4?.02:0});e<4?o.CreateFixture({shape:this.m_polygons[e],friction:.3,density:20}):o.CreateFixture({shape:this.m_circle,friction:.3,density:20}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r!==null){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){let o=!e.m_pause||e.m_singleStep;super.Step(e,r);let s=25,l=new n(0,10),a=new n(s*Math.cos(this.m_angle),-s*Math.abs(Math.sin(this.m_angle))),c=n.Add(l,a,new n),u=null,m=new n,p=new n;this.m_world.RayCast(l,c,(h,f,b,x)=>(u=h,m.Copy(f),p.Copy(b),x));let d=e.m_debugDraw;if(u){d.DrawPoint(m,5,new F(.4,.9,.4)),d.DrawSegment(l,m,new F(.8,.8,.8));let h=n.Add(m,n.Scale(.5,p,n.s_t0),new n);d.DrawSegment(m,h,new F(.9,.9,.4))}else d.DrawSegment(l,c,new F(.8,.8,.8));o&&(this.m_angle+=.25*Math.PI/180)}};P("Geometry","Edge Shapes",Wh);var Zr=$(bt());function gu(i,t,e,r){return{type:"radio",name:i,options:t,initialValue:e,update:r}}var Ax=({control:i})=>(0,Zr.jsxs)(Zr.Fragment,{children:[i.options.map(t=>(0,Zr.jsxs)("label",{className:"radio",children:[(0,Zr.jsx)("input",{name:i.name,type:"radio",className:"radio--input",value:t,onClick:()=>i.update(t),defaultChecked:i.initialValue===t}),(0,Zr.jsx)("span",{children:t})]},t))," "]});var Kh=class extends R{constructor(){super();this.m_offset1=new n;this.m_offset2=new n;this.m_body1=null;this.m_body2=null;let e=[new n(10,-4),new n(10,0),new n(6,0),new n(4,2),new n(2,0),new n(-2,0),new n(-6,0),new n(-8,-3),new n(-10,0),new n(-10,-4)];this.m_offset1.Set(0,8),this.m_offset2.Set(0,16);{let r=e[0].Clone().Add(this.m_offset1),o=e[1].Clone().Add(this.m_offset1),s=e[2].Clone().Add(this.m_offset1),l=e[3].Clone().Add(this.m_offset1),a=e[4].Clone().Add(this.m_offset1),c=e[5].Clone().Add(this.m_offset1),u=e[6].Clone().Add(this.m_offset1),m=e[7].Clone().Add(this.m_offset1),p=e[8].Clone().Add(this.m_offset1),d=e[9].Clone().Add(this.m_offset1),h=this.m_world.CreateBody(),f=new I;f.SetOneSided(d,r,o,s),h.CreateFixture({shape:f}),f.SetOneSided(r,o,s,l),h.CreateFixture({shape:f}),f.SetOneSided(o,s,l,a),h.CreateFixture({shape:f}),f.SetOneSided(s,l,a,c),h.CreateFixture({shape:f}),f.SetOneSided(l,a,c,u),h.CreateFixture({shape:f}),f.SetOneSided(a,c,u,m),h.CreateFixture({shape:f}),f.SetOneSided(c,u,m,p),h.CreateFixture({shape:f}),f.SetOneSided(u,m,p,d),h.CreateFixture({shape:f}),f.SetOneSided(m,p,d,r),h.CreateFixture({shape:f}),f.SetOneSided(p,d,r,o),h.CreateFixture({shape:f})}{let r=e[0].Clone().Add(this.m_offset2),o=e[1].Clone().Add(this.m_offset2),s=e[2].Clone().Add(this.m_offset2),l=e[3].Clone().Add(this.m_offset2),a=e[4].Clone().Add(this.m_offset2),c=e[5].Clone().Add(this.m_offset2),u=e[6].Clone().Add(this.m_offset2),m=e[7].Clone().Add(this.m_offset2),p=e[8].Clone().Add(this.m_offset2),d=e[9].Clone().Add(this.m_offset2),h=this.m_world.CreateBody(),f=new I;f.SetTwoSided(r,o),h.CreateFixture({shape:f}),f.SetTwoSided(o,s),h.CreateFixture({shape:f}),f.SetTwoSided(s,l),h.CreateFixture({shape:f}),f.SetTwoSided(l,a),h.CreateFixture({shape:f}),f.SetTwoSided(a,c),h.CreateFixture({shape:f}),f.SetTwoSided(c,u),h.CreateFixture({shape:f}),f.SetTwoSided(u,m),h.CreateFixture({shape:f}),f.SetTwoSided(m,p),h.CreateFixture({shape:f}),f.SetTwoSided(p,d),h.CreateFixture({shape:f}),f.SetTwoSided(d,r),h.CreateFixture({shape:f})}this.m_body1=null,this.m_body2=null,this.CreateBoxes()}setupControls(){this.addTestControlGroup("Custom",[gu("Type",["Boxes","Circles"],"Boxes",e=>{e==="Boxes"?this.CreateBoxes():this.CreateCircles()})])}CreateBoxes(){this.m_body1&&(this.m_world.DestroyBody(this.m_body1),this.m_body1=null),this.m_body2&&(this.m_world.DestroyBody(this.m_body2),this.m_body2=null);{this.m_body1=this.m_world.CreateBody({type:2,position:{x:8+this.m_offset1.x,y:2.6+this.m_offset1.y},allowSleep:!1});let e=new v;e.SetAsBox(.5,1),this.m_body1.CreateFixture({shape:e,density:1})}{this.m_body2=this.m_world.CreateBody({type:2,position:{x:8+this.m_offset2.x,y:2.6+this.m_offset2.y},allowSleep:!1});let e=new v;e.SetAsBox(.5,1),this.m_body2.CreateFixture({shape:e,density:1})}}CreateCircles(){this.m_body1&&(this.m_world.DestroyBody(this.m_body1),this.m_body1=null),this.m_body2&&(this.m_world.DestroyBody(this.m_body2),this.m_body2=null);{this.m_body1=this.m_world.CreateBody({type:2,position:{x:this.m_offset1.x-.5,y:this.m_offset1.y+.6},allowSleep:!1});let e=new V(.5);this.m_body1.CreateFixture({shape:e,density:1})}{this.m_body2=this.m_world.CreateBody({type:2,position:{x:this.m_offset2.x-.5,y:this.m_offset2.y+.6},allowSleep:!1});let e=new V(.5);this.m_body2.CreateFixture({shape:e,density:1})}}getHotkeys(){return[Ur("a","Apply Force Left",()=>{this.m_body1?.ApplyForceToCenter(new n(-10,0),!0),this.m_body2?.ApplyForceToCenter(new n(-10,0),!0)}),Ur("d","Apply Force Right",()=>{this.m_body1?.ApplyForceToCenter(new n(10,0),!0),this.m_body2?.ApplyForceToCenter(new n(10,0),!0)})]}};P("Geometry","Edge Test",Kh);var $h=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-50,0),new n(50,0)),t.CreateFixture({shape:e})}{let e=new V;e.m_radius=1;let r=new v;r.SetAsBox(.5,5);let o=new V;o.m_radius=2;let s={x:10,y:9},l=this.m_world.CreateBody({type:0,position:s});l.CreateFixture({shape:e,density:5});let a=this.m_world.CreateBody({type:2,position:{x:10,y:8}});a.CreateFixture({shape:r,density:5});let c={x:10,y:6},u=this.m_world.CreateBody({type:2,position:c});u.CreateFixture({shape:o,density:5});let m=new q;m.Initialize(a,l,s);let p=this.m_world.CreateJoint(m),d=new q;d.Initialize(a,u,c);let h=this.m_world.CreateJoint(d),f=new cs;f.bodyA=l,f.bodyB=u,f.joint1=p,f.joint2=h,f.ratio=o.m_radius/e.m_radius,this.m_world.CreateJoint(f)}{let e=new V;e.m_radius=1;let r=new V;r.m_radius=2;let o=new v;o.SetAsBox(.5,5);let s={x:-3,y:12},l=this.m_world.CreateBody({type:2,position:s});l.CreateFixture({shape:e,density:5});let a=new q;a.bodyA=t,a.bodyB=l,t.GetLocalPoint(s,a.localAnchorA),l.GetLocalPoint(s,a.localAnchorB),a.referenceAngle=l.GetAngle()-t.GetAngle(),this.m_joint1=this.m_world.CreateJoint(a);let c={x:0,y:12},u=this.m_world.CreateBody({type:2,position:c});u.CreateFixture({shape:r,density:5});let m=new q;m.Initialize(t,u,c),this.m_joint2=this.m_world.CreateJoint(m);let p={x:2.5,y:12},d=this.m_world.CreateBody({type:2,position:p});d.CreateFixture({shape:o,density:5});let h=new Nt;h.Initialize(t,d,p,new n(0,1)),h.lowerTranslation=-5,h.upperTranslation=5,h.enableLimit=!0,this.m_joint3=this.m_world.CreateJoint(h);let f=new cs;f.bodyA=l,f.bodyB=u,f.joint1=this.m_joint1,f.joint2=this.m_joint2,f.ratio=r.m_radius/e.m_radius,this.m_joint4=this.m_world.CreateJoint(f);let b=new cs;b.bodyA=u,b.bodyB=d,b.joint1=this.m_joint2,b.joint2=this.m_joint3,b.ratio=-1/r.m_radius,this.m_joint5=this.m_world.CreateJoint(b)}}};P("Joints","Gear",$h);var tf=class extends R{constructor(){super();{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o})}let t=this.m_world.CreateBody({type:2,position:{x:0,y:.5}}),e=new V;e.m_radius=.5,t.CreateFixture({shape:e,density:10}),t=this.m_world.CreateBody({type:2,position:{x:0,y:6}}),e.m_radius=5,t.CreateFixture({shape:e,density:10})}};P("Solver","Heavy 1",tf);var ef=class extends R{constructor(){super();this.m_heavy=null;{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-40,0),new n(40,0)),o.CreateFixture({shape:s})}let e=this.m_world.CreateBody({type:2,position:{x:0,y:2.5}}),r=new V;r.m_radius=.5,e.CreateFixture({shape:r,density:10}),e=this.m_world.CreateBody({type:2,position:{x:0,y:3.5}}),e.CreateFixture({shape:r,density:10})}ToggleHeavy(){if(this.m_heavy!==null)this.m_world.DestroyBody(this.m_heavy),this.m_heavy=null;else{this.m_heavy=this.m_world.CreateBody({type:2,position:{x:0,y:9}});let e=new V;e.m_radius=5,this.m_heavy.CreateFixture({shape:e,density:10})}}getHotkeys(){return[G("h","Toggle Heavy",()=>this.ToggleHeavy())]}};P("Solver","Heavy 2",ef);var rf=class i extends R{static{this.e_depth=4}constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:20}}),e=.5,r=new n(0,e),o=this.AddNode(t,n.ZERO,0,3,e),s=new q;s.bodyA=t,s.bodyB=o,s.localAnchorA.SetZero(),s.localAnchorB.Copy(r),this.m_world.CreateJoint(s)}GetDefaultViewZoom(){return 60}getCenter(){return{x:0,y:15}}AddNode(t,e,r,o,s){let a=new n(0,s),c=this.m_world.CreateBody({type:2,position:t.GetPosition().Clone().Add(e).Subtract(a)}),u=new v;if(u.SetAsBox(.25*s,s),c.CreateFixture({shape:u,density:20}),r===i.e_depth)return c;let m=new n(o,-s),p=new n(-o,-s),d=this.AddNode(c,m,r+1,.5*o,s),h=this.AddNode(c,p,r+1,.5*o,s),f=new q;return f.bodyA=c,f.localAnchorB.Copy(a),f.localAnchorA.Copy(m),f.bodyB=d,this.m_world.CreateJoint(f),f.localAnchorA.Copy(p),f.bodyB=h,this.m_world.CreateJoint(f),c}};P("Solver","Mobile Unbalanced",rf);var of=class i extends R{static{this.e_depth=4}constructor(){super();let t=this.m_world.CreateBody({position:{x:0,y:20}}),e=.5,r=new n(0,e),o=this.AddNode(t,n.ZERO,0,3,e),s=new q;s.bodyA=t,s.bodyB=o,s.localAnchorA.SetZero(),s.localAnchorB.Copy(r),this.m_world.CreateJoint(s)}GetDefaultViewZoom(){return 60}getCenter(){return{x:0,y:15}}AddNode(t,e,r,o,s){let a=new n(0,s),c=t.GetPosition().Clone().Add(e).Subtract(a),u=this.m_world.CreateBody({type:2,position:c}),m=new v;if(m.SetAsBox(.25*s,s),u.CreateFixture({shape:m,density:20}),r===i.e_depth)return u;m.SetAsBox(o,.25*s,new n(0,-s),0),u.CreateFixture({shape:m,density:20});let p=new n(o,-s),d=new n(-o,-s),h=this.AddNode(u,p,r+1,.5*o,s),f=this.AddNode(u,d,r+1,.5*o,s),b=new q;return b.bodyA=u,b.localAnchorB.Copy(a),b.localAnchorA.Copy(p),b.bodyB=h,this.m_world.CreateJoint(b),b.localAnchorA.Copy(d),b.bodyB=f,this.m_world.CreateJoint(b),u}};P("Solver","Mobile Balanced",of);var sf=class extends R{constructor(){super();this.m_time=0;this.m_go=!1;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{let r=this.m_world.CreateBody({type:2,position:{x:0,y:8}}),o=new v;o.SetAsBox(2,.5),r.CreateFixture({shape:o,friction:.6,density:2});let s=new us;s.Initialize(e,r),s.maxForce=1e3,s.maxTorque=1e3,this.m_joint=this.m_world.CreateJoint(s)}this.m_go=!1,this.m_time=0}getHotkeys(){return[G("s","Start/Stop",()=>{this.m_go=!this.m_go})]}Step(e,r){this.m_go&&e.m_hertz>0&&(this.m_time+=1/e.m_hertz);let o=new n;o.x=6*Math.sin(2*this.m_time),o.y=8+4*Math.sin(1*this.m_time);let s=4*this.m_time;this.m_joint.SetLinearOffset(o),this.m_joint.SetAngularOffset(s),e.m_debugDraw.DrawPoint(o,4,new F(.9,.9,.9)),super.Step(e,r)}};P("Joints","Motor Joint",sf);var nf=class extends R{constructor(){super();this.m_radius=0;this.m_top=0;this.m_bottom=0;this.m_state=0;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-20,0),new n(20,0)),e.CreateFixture({shape:r})}{let e=this.m_world.CreateBody({position:{x:0,y:10}}),r=new v;r.SetAsBox(3,.5),this.m_platform=e.CreateFixture({shape:r}),this.m_bottom=10-.5,this.m_top=10+.5}{let e=this.m_world.CreateBody({type:2,position:{x:0,y:12}});this.m_radius=.5;let r=new V;r.m_radius=this.m_radius,this.m_character=e.CreateFixture({shape:r,density:20}),e.SetLinearVelocity(new n(0,-50)),this.m_state=0}}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:5}}PreSolve(e,r){super.PreSolve(e,r);let o=e.GetFixtureA(),s=e.GetFixtureB();if(o!==this.m_platform&&o!==this.m_character||s!==this.m_platform&&s!==this.m_character)return;this.m_character.GetBody().GetPosition().y<this.m_top+this.m_radius-3*Z&&e.SetEnabled(!1)}};P("Examples","Platformer",nf);var lf=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=H(5,n);e[0].Set(-8,6),e[1].Set(-8,20),e[2].Set(8,20),e[3].Set(8,6),e[4].Set(0,-2);let r=new dt;r.CreateLoop(e,5),t.CreateFixture({shape:r,density:0})}{let e=new n(-2,0),r=new n(2,0),o=this.m_world.CreateBody({type:2,position:e}),s=this.m_world.CreateBody({type:2,position:r}),l=new v;l.SetAsBox(1.75,.1);let a={shape:l,density:1};o.CreateFixture(a),s.CreateFixture(a);let c=new q;c.bodyA=t,c.localAnchorB.SetZero(),c.enableMotor=!0,c.maxMotorTorque=1e3,c.enableLimit=!0,c.motorSpeed=-10,c.localAnchorA.Copy(e),c.bodyB=o,c.lowerAngle=-30*Math.PI/180,c.upperAngle=5*Math.PI/180,this.m_leftJoint=this.m_world.CreateJoint(c),c.motorSpeed=10,c.localAnchorA.Copy(r),c.bodyB=s,c.lowerAngle=-5*Math.PI/180,c.upperAngle=30*Math.PI/180,this.m_rightJoint=this.m_world.CreateJoint(c)}{this.m_ball=this.m_world.CreateBody({position:{x:1,y:15},type:2,bullet:!0});let e=new V;e.m_radius=.2;let r={shape:e,density:1};this.m_ball.CreateFixture(r)}}GetDefaultViewZoom(){return 40}getCenter(){return{x:0,y:5}}getHotkeys(){return[Er("a","Hold Flipper",t=>{t?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10))})]}};P("Examples","Pinball",lf);var af=class extends R{constructor(){super();this.m_polygonA=new v;this.m_polygonB=new v;this.m_transformA=new T;this.m_transformB=new T;this.m_positionB=new n;this.m_angleB=0;this.m_polygonA.SetAsBox(.2,.4),this.m_transformA.SetPositionAngle(new n,0),this.m_polygonB.SetAsBox(.5,.5),this.m_positionB.Set(1,1),this.m_angleB=1.9160721,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}GetDefaultViewZoom(){return 100}getHotkeys(){return[G("a","Move Left",()=>this.Adjust(-.1,0,0)),G("d","Move Right",()=>this.Adjust(.1,0,0)),G("s","Move Down",()=>this.Adjust(0,-.1,0)),G("w","Move Up",()=>this.Adjust(0,.1,0)),G("q","Turn Left",()=>this.Adjust(0,0,.1*Math.PI)),G("e","Turn Right",()=>this.Adjust(0,0,-.1*Math.PI))]}Adjust(e,r,o){this.m_positionB.x+=e,this.m_positionB.y+=r,this.m_angleB+=o,this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}Step(e,r){super.Step(e,r);let o=new po;Na(o,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);let s=new Fi;s.Initialize(o,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),this.addDebug("Point Count",o.pointCount);let l=e.m_debugDraw;{let a=new F(.9,.9,.9),c=[];for(let u=0;u<this.m_polygonA.m_count;++u)c[u]=T.MultiplyVec2(this.m_transformA,this.m_polygonA.m_vertices[u],new n);l.DrawPolygon(c,this.m_polygonA.m_count,a);for(let u=0;u<this.m_polygonB.m_count;++u)c[u]=T.MultiplyVec2(this.m_transformB,this.m_polygonB.m_vertices[u],new n);l.DrawPolygon(c,this.m_polygonB.m_count,a)}for(let a=0;a<o.pointCount;++a)l.DrawPoint(s.points[a],4,new F(.9,.3,.3))}};P("Geometry","Polygon Collision",af);var SA=4,wA={Step:{circle:new V,transform:new T}},cf=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_bodies=Array.from({length:i.e_maxBodies},()=>null);this.m_polygons=Array.from({length:4},()=>new v);this.m_circle=new V;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=new Array(3);e[0]=new n(-.5,0),e[1]=new n(.5,0),e[2]=new n(0,1.5),this.m_polygons[0].Set(e,3)}{let e=new Array(3);e[0]=new n(-.1,0),e[1]=new n(.1,0),e[2]=new n(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=new Array(8);s[0]=new n(.5*o,0),s[1]=new n(.5*1,r),s[2]=new n(.5*1,r+o),s[3]=new n(.5*o,1),s[4]=new n(-.5*o,1),s[5]=new n(-.5*1,r+o),s[6]=new n(-.5*1,r),s[7]=new n(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null),r=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({type:2,position:{x:W(-2,2),y:10},angle:W(-Math.PI,Math.PI),angularDamping:e===4?.02:0}),e<4?r.CreateFixture({shape:this.m_polygons[e],density:1,friction:.3}):r.CreateFixture({shape:this.m_circle,density:1,friction:.3}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("a","Toggle Enabled of Even Bodies",()=>{for(let e=0;e<i.e_maxBodies;e+=2){let r=this.m_bodies[e];r&&r.SetEnabled(!r.IsEnabled())}}),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){super.Step(e,r);let o=e.m_debugDraw,s=0,{circle:l,transform:a}=wA.Step;l.m_radius=2,l.m_p.Set(0,1.1),a.SetIdentity();let c=new lt;l.ComputeAABB(c,a,0),this.m_world.QueryAABB(c,m=>{if(s===SA)return!1;let p=m.GetBody(),d=m.GetShape();if(rs(d,0,l,0,p.GetTransform(),a)){let f=new F(.95,.95,.6),b=p.GetWorldCenter();o.DrawPoint(b,5,f),++s}return!0});let u=new F(.4,.7,.8);o.DrawCircle(l.m_p,l.m_radius,u)}};P("Geometry","Polygon Shapes",cf);var Tx=$(ye());var Cs=$(bt());function _t(i,t,e,r,o,s){return{type:"slider",name:i,min:t,max:e,step:r,initialValue:o,update:s}}function Px({control:i}){let[t,e]=(0,Tx.useState)(i.initialValue);return(0,Cs.jsxs)("label",{className:"slider",children:[(0,Cs.jsxs)("div",{className:"slider--input",children:[(0,Cs.jsx)("input",{type:"range",min:i.min,max:i.max,step:i.step,defaultValue:t,onChange:r=>{let o=parseFloat(r.currentTarget.value);e(o),i.update(o)}}),(0,Cs.jsx)("span",{children:t})]}),i.name.split("#")[0]]})}var uf=class extends R{constructor(){super();this.m_motorSpeed=10;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(1,1);let o={x:0,y:10},s=this.m_world.CreateBody({type:2,position:o,angle:.5*Math.PI,allowSleep:!1});s.CreateFixture({shape:r,density:5});let l=new Nt;l.Initialize(e,s,o,new n(1,0)),l.motorSpeed=this.m_motorSpeed,l.maxMotorForce=1e4,l.enableMotor=this.m_enableMotor,l.lowerTranslation=-10,l.upperTranslation=10,l.enableLimit=this.m_enableLimit,this.m_joint=this.m_world.CreateJoint(l)}}setupControls(){this.addTestControlGroup("Joint",[Yt("Limit",this.m_enableLimit,e=>{this.m_enableLimit=this.m_joint.EnableLimit(e)}),Yt("Motor",this.m_enableMotor,e=>{this.m_enableMotor=this.m_joint.EnableMotor(e)}),_t("Speed",-100,100,1,this.m_motorSpeed,e=>{this.m_motorSpeed=this.m_joint.SetMotorSpeed(e)})])}getHotkeys(){return[G("l","Toggle Limit",()=>this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled())),G("m","Start/Stop",()=>this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())),G("s","Reverse Direction",()=>this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed()))]}Step(e,r){super.Step(e,r);let o=this.m_joint.GetMotorForce(e.m_hertz);this.addDebug("Motor Force",o.toFixed())}};P("Joints","Prismatic",uf);var mf=class extends R{constructor(){super();let t=16,e=12,r=1,o=2,s=null;{s=this.m_world.CreateBody();let l=new V;l.m_radius=2,l.m_p.Set(-10,t+o+e),s.CreateFixture({shape:l}),l.m_p.Set(10,t+o+e),s.CreateFixture({shape:l})}{let l=new v;l.SetAsBox(r,o);let a=this.m_world.CreateBody({type:2,position:{x:-10,y:t}});a.CreateFixture({shape:l,density:5});let c=this.m_world.CreateBody({type:2,position:{x:10,y:t}});c.CreateFixture({shape:l,density:5});let u=new ac,m=new n(-10,t+o),p=new n(10,t+o),d=new n(-10,t+o+e),h=new n(10,t+o+e);u.Initialize(a,c,d,h,m,p,1.5),this.m_joint1=this.m_world.CreateJoint(u)}}getCenter(){return{x:0,y:15}}Step(t,e){super.Step(t,e),this.addDebug("Ratio",this.m_joint1.GetRatio().toFixed(2)),this.addDebug("Length A",this.m_joint1.GetCurrentLengthA().toFixed(2)),this.addDebug("Length B",this.m_joint1.GetCurrentLengthB().toFixed(2))}};P("Joints","Pulley",mf);var pf=class i extends R{static{this.e_count=20}constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=new v;e.SetAsBox(.5,.5);let r=new n(-7,.75),o=new n,s=new n(.5625,1.25),l=new n(1.125,0);for(let a=0;a<i.e_count;++a){o.Copy(r);for(let c=a;c<i.e_count;++c)this.m_world.CreateBody({type:2,position:o}).CreateFixture({shape:e,density:5}),o.Add(l);r.Add(s)}}}};P("Stacking","Pyramid",pf);var df=class i extends R{constructor(){super();this.m_bodyIndex=0;this.m_bodies=[];this.m_polygons=H(4,v);this.m_circle=new V;this.m_edge=new I;this.m_degrees=0;this.m_mode="Closest";{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=H(3,n);e[0].Set(-.5,0),e[1].Set(.5,0),e[2].Set(0,1.5),this.m_polygons[0].Set(e,3)}{let e=H(3,n);e[0].Set(-.1,0),e[1].Set(.1,0),e[2].Set(0,1.5),this.m_polygons[1].Set(e,3)}{let r=1/(2+Math.sqrt(2)),o=Math.sqrt(2)*r,s=H(8,n);s[0].Set(.5*o,0),s[1].Set(.5*1,r),s[2].Set(.5*1,r+o),s[3].Set(.5*o,1),s[4].Set(-.5*o,1),s[5].Set(-.5*1,r+o),s[6].Set(-.5*1,r),s[7].Set(-.5*o,0),this.m_polygons[2].Set(s,8)}this.m_polygons[3].SetAsBox(.5,.5),this.m_circle.m_radius=.5,this.m_edge.SetTwoSided(new n(-1,0),new n(1,0)),this.m_bodyIndex=0;for(let e=0;e<i.e_maxBodies;++e)this.m_bodies[e]=null}static{this.e_maxBodies=256}setupControls(){this.addTestControlGroup("Ray-cast",[gu("Mode",["Any","Closest","Multiple"],this.m_mode,e=>{this.m_mode=e}),_t("Angle",0,360,1,this.m_degrees,e=>{this.m_degrees=e})])}CreateBody(e){let r=this.m_bodies[this.m_bodyIndex];r!==null&&(this.m_world.DestroyBody(r),this.m_bodies[this.m_bodyIndex]=null);let o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody({position:{x:W(-10,10),y:W(0,20)},angle:W(-Math.PI,Math.PI),angularDamping:e===4?.02:0,userData:{rayCastBodyIndex:e}});e<4?o.CreateFixture({shape:this.m_polygons[e],friction:.3}):e<5?o.CreateFixture({shape:this.m_circle,friction:.3}):o.CreateFixture({shape:this.m_edge,friction:.3}),this.m_bodyIndex=(this.m_bodyIndex+1)%i.e_maxBodies}DestroyBody(){for(let e=0;e<i.e_maxBodies;++e){let r=this.m_bodies[e];if(r!==null){this.m_world.DestroyBody(r),this.m_bodies[e]=null;return}}}getHotkeys(){return[G("1","Create Triangle",()=>this.CreateBody(0)),G("2","Create Flat Triangle",()=>this.CreateBody(1)),G("3","Create Octagon",()=>this.CreateBody(2)),G("4","Create Box",()=>this.CreateBody(3)),G("5","Create Circle",()=>this.CreateBody(4)),G("6","Create Edge",()=>this.CreateBody(5)),G("d","Destroy Body",()=>this.DestroyBody())]}Step(e,r){super.Step(e,r);let o=pt(this.m_degrees),s=11,l=new n(0,10),a=new n(s*Math.cos(o),s*Math.sin(o)),c=n.Add(l,a,new n);switch(this.addText("Shape 1 is intentionally ignored by the ray"),this.m_mode){case"Closest":this.addDebug("Ray-Cast Mode","Find closest fixture along the ray"),this.rayCastClosest(l,c,e);break;case"Any":this.addDebug("Ray-Cast Mode","Check for obstruction"),this.rayCastAny(l,c,e);break;case"Multiple":this.addDebug("Ray-Cast Mode","Gather multiple fixtures"),this.rayCastMultiple(l,c,e);break}}rayCastClosest(e,r,o){let s=!1,l=new n,a=new n;this.m_world.RayCast(e,r,(u,m,p,d)=>{let{rayCastBodyIndex:h}=u.GetBody().GetUserData();return h===0?-1:(s=!0,l.Copy(m),a.Copy(p),d)});let c=o.m_debugDraw;if(s){c.DrawPoint(l,5,new F(.4,.9,.4)),c.DrawSegment(e,l,new F(.8,.8,.8));let u=n.Add(l,n.Scale(.5,a,n.s_t0),new n);c.DrawSegment(l,u,new F(.9,.9,.4))}else c.DrawSegment(e,r,new F(.8,.8,.8))}rayCastAny(e,r,o){let s=!1,l=new n,a=new n;this.m_world.RayCast(e,r,(u,m,p,d)=>{let{rayCastBodyIndex:h}=u.GetBody().GetUserData();return h===0?-1:(s=!0,l.Copy(m),a.Copy(p),0)});let c=o.m_debugDraw;if(s){c.DrawPoint(l,5,new F(.4,.9,.4)),c.DrawSegment(e,l,new F(.8,.8,.8));let u=n.Add(l,n.Scale(.5,a,n.s_t0),new n);c.DrawSegment(l,u,new F(.9,.9,.4))}else c.DrawSegment(e,r,new F(.8,.8,.8))}rayCastMultiple(e,r,o){let l=H(3,n),a=H(3,n),c=0;this.m_world.RayCast(e,r,(m,p,d)=>{let{rayCastBodyIndex:h}=m.GetBody().GetUserData();return h===0?-1:(l[c].Copy(p),a[c].Copy(d),++c,c===3?0:1)});let u=o.m_debugDraw;u.DrawSegment(e,r,new F(.8,.8,.8));for(let m=0;m<c;++m){let p=l[m],d=a[m];u.DrawPoint(p,5,new F(.4,.9,.4)),u.DrawSegment(e,p,new F(.8,.8,.8));let h=n.Add(p,n.Scale(.5,d,n.s_t0),new n);u.DrawSegment(p,h,new F(.9,.9,.4))}}};P("Collision","Ray Cast",df);var hf=class extends R{constructor(){super();this.m_motorSpeed=1;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(.25,3,new n(0,3),0);let o=this.m_world.CreateBody({type:2,position:new n(-10,20)});o.CreateFixture({shape:r,density:5});let s=new q;s.Initialize(e,o,new n(-10,20.5)),s.motorSpeed=this.m_motorSpeed,s.maxMotorTorque=1e4,s.enableMotor=this.m_enableMotor,s.lowerAngle=-.25*Math.PI,s.upperAngle=.5*Math.PI,s.enableLimit=this.m_enableLimit,this.m_joint1=this.m_world.CreateJoint(s)}{let r=new V(2);this.m_ball=this.m_world.CreateBody({type:2,position:new n(5,30)}),this.m_ball.CreateFixture({density:5,filter:{maskBits:1},shape:r});let o=new v;o.SetAsBox(10,.5,new n(-10,0),0);let s=this.m_world.CreateBody({position:new n(20,10),type:2,bullet:!0});s.CreateFixture({shape:o,density:2});let l=new q;l.Initialize(e,s,new n(19,10)),l.lowerAngle=-.25*Math.PI,l.upperAngle=0*Math.PI,l.enableLimit=!0,l.enableMotor=!0,l.motorSpeed=0,l.maxMotorTorque=1e4,this.m_joint2=this.m_world.CreateJoint(l)}this.addTestControlGroup("Joint Controls",[Yt("Limit",this.m_enableLimit,r=>{this.m_enableLimit=this.m_joint1.EnableLimit(r)}),Yt("Motor",this.m_enableMotor,r=>{this.m_enableMotor=this.m_joint1.EnableMotor(r)}),_t("Speed",-20,20,1,this.m_motorSpeed,r=>{this.m_motorSpeed=this.m_joint1.SetMotorSpeed(r)})])}getCenter(){return{x:0,y:5}}Step(e,r){super.Step(e,r);let o=this.m_joint1.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque 1",o.toFixed(0));let s=this.m_joint2.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque 2",s.toFixed(0))}};P("Joints","Revolute",hf);var ff=class i extends R{constructor(){super();this.m_bodies=new Array(i.e_count);this.m_force=100;this.m_touching=O2(i.e_count);let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new V;r.m_radius=5,r.m_p.Set(0,10),this.m_sensor=e.CreateFixture({shape:r,isSensor:!0})}{let r=new V;r.m_radius=1;for(let o=0;o<i.e_count;++o)this.m_touching[o]=!1,this.m_bodies[o]=this.m_world.CreateBody({type:2,position:{x:-10+3*o,y:20},userData:{sensor:o}}),this.m_bodies[o].CreateFixture({shape:r,density:1})}}static{this.e_count=7}setupControls(){this.addTestControlGroup("Sensor",[_t("Force",0,2e3,1,this.m_force,e=>{this.m_force=e})])}getCenter(){return{x:0,y:5}}BeginContact(e){let r=e.GetFixtureA(),o=e.GetFixtureB();if(r===this.m_sensor){let{sensor:s}=o.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!0)}if(o===this.m_sensor){let{sensor:s}=r.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!0)}}EndContact(e){let r=e.GetFixtureA(),o=e.GetFixtureB();if(r===this.m_sensor){let{sensor:s}=o.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!1)}if(o===this.m_sensor){let{sensor:s}=r.GetBody().GetUserData();s!==void 0&&(this.m_touching[s]=!1)}}Step(e,r){super.Step(e,r);for(let o=0;o<i.e_count;++o){if(!this.m_touching[o])continue;let s=this.m_bodies[o],l=this.m_sensor.GetBody(),a=this.m_sensor.GetShape(),c=l.GetWorldPoint(a.m_p,new n),u=s.GetPosition(),m=n.Subtract(c,u,new n);if(m.LengthSquared()<Rr)continue;m.Normalize();let p=n.Scale(this.m_force,m,new n);s.ApplyForce(p,u)}}};P("Collision","Sensor Test",ff);var Dx=new F(.9,.9,.9),Mx=new F(.5,.9,.5),Rx=new F(.5,.7,.9),kx=new F(.9,.3,.3),bf=class extends R{constructor(){super();this.m_vAs=H(Wt,n);this.m_countA=0;this.m_radiusA=0;this.m_vBs=H(Wt,n);this.m_countB=0;this.m_radiusB=0;this.m_transformA=new T;this.m_transformB=new T;this.m_translationB=new n;this.m_vAs[0].Set(-.5,1),this.m_vAs[1].Set(.5,1),this.m_vAs[2].Set(0,0),this.m_countA=3,this.m_radiusA=Re,this.m_vBs[0].Set(-.5,-.5),this.m_vBs[1].Set(.5,-.5),this.m_vBs[2].Set(.5,.5),this.m_vBs[3].Set(-.5,.5),this.m_countB=4,this.m_radiusB=Re,this.m_transformA.p.Set(0,.25),this.m_transformA.q.SetIdentity(),this.m_transformB.p.Set(-4,0),this.m_transformB.q.SetIdentity(),this.m_translationB.Set(8,0)}static{this.e_vertexCount=8}Step(e,r){super.Step(e,r);let o=new Va;o.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),o.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),o.transformA.Copy(this.m_transformA),o.transformB.Copy(this.m_transformB),o.translationB.Copy(this.m_translationB);let s=new Ea,l=W2(s,o),a=new T;a.q.Copy(this.m_transformB.q),a.p.Copy(this.m_transformB.p).AddScaled(s.lambda,o.translationB);let c=new Ri;c.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),c.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),c.transformA.Copy(this.m_transformA),c.transformB.Copy(a),c.useRadii=!1;let u=new Mi;u.count=0;let m=new ki;kr(m,u,c),this.addDebug("Hit",l),this.addDebug("Iters",s.iterations),this.addDebug("Lambda",s.lambda.toFixed(6)),this.addDebug("Distance",m.distance.toFixed(6));let p=H(Wt,n);for(let h=0;h<this.m_countA;++h)T.MultiplyVec2(this.m_transformA,this.m_vAs[h],p[h]);let d=e.m_debugDraw;this.m_countA===1?d.DrawCircle(p[0],this.m_radiusA,Dx):d.DrawPolygon(p,this.m_countA,Dx);for(let h=0;h<this.m_countB;++h)T.MultiplyVec2(this.m_transformB,this.m_vBs[h],p[h]);this.m_countB===1?d.DrawCircle(p[0],this.m_radiusB,Mx):d.DrawPolygon(p,this.m_countB,Mx);for(let h=0;h<this.m_countB;++h)T.MultiplyVec2(a,this.m_vBs[h],p[h]);if(this.m_countB===1?d.DrawCircle(p[0],this.m_radiusB,Rx):d.DrawPolygon(p,this.m_countB,Rx),l){let h=s.point;d.DrawPoint(h,10,kx);let f=n.Add(h,s.normal,n.s_t0);d.DrawSegment(h,f,kx)}}};P("Collision","Shape Cast",bf);var _f=class extends R{constructor(){super();this.m_fixture2=null;this.m_sensor=!1;{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o})}this.m_body=this.m_world.CreateBody({type:2,position:{x:0,y:10}});let e=new v;e.SetAsBox(4,4,new n,0),this.m_fixture1=this.m_body.CreateFixture({shape:e,density:10})}getHotkeys(){return[G("c","Create a Shape",()=>{if(this.m_fixture2===null){let e=new V;e.m_radius=3,e.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture({shape:e,density:10}),this.m_body.SetAwake(!0)}}),G("d","Destroy a Shape",()=>{this.m_fixture2!==null&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0))}),G("s","Toggle Sensor",()=>{this.m_fixture2!==null&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))})]}Step(e,r){super.Step(e,r),this.addDebug("Sensor",this.m_sensor)}};P("Examples","Shape Editing",_f);var yf=class extends R{constructor(){super();let t=this.m_world.CreateBody(),e=8,r=-30,o=10,s=2,l=.2,a=-r*Math.PI/180,c=a-o*Math.PI/180;this.m_platform_width=e;let u=new n(-e,0),m=new n,p=new n(s*Math.cos(a),-s*Math.sin(a)),d=new n(p.x+s*Math.cos(c),p.y-s*Math.sin(c)),f=[new n(d.x,d.y-1),d,p,m,u],b=new dt;b.CreateLoop(f),t.CreateFixture({shape:b,density:0,friction:l});{let B=this.m_world.CreateBody({type:2,position:{x:-this.m_platform_width/2,y:1.55}}),C=new v,A=H(4,n);A[0].Set(-3/2-.3,-2.5/2),A[1].Set(-3/2,-2.5/2-.3),A[2].Set(3/2,-2.5/2-.3),A[3].Set(3/2+.3,-2.5/2),C.Set(A),B.CreateFixture({density:1,friction:0,restitution:.15,shape:C}),B.SetLinearVelocity(new n(.5,0)),this.m_skier=B}st.setPositionAndZoom(this.m_platform_width/2,0,.4),this.m_fixed_camera=!0}GetDefaultViewZoom(){return 50}getHotkeys(){return[G("c","Switch Camera Fixed/Tracking",()=>{this.m_fixed_camera=!this.m_fixed_camera,this.m_fixed_camera&&st.setPosition(this.m_platform_width/2,0)})]}Step(t,e){if(!this.m_fixed_camera){let r=this.m_skier.GetPosition();st.setPosition(r.x,r.y)}super.Step(t,e)}};P("Bugs","Skier",yf);var xf=class extends R{constructor(){super();let t=null;{t=this.m_world.CreateBody();let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let e=t;{let r=new v;r.SetAsBox(.5,2);let o=this.m_world.CreateBody({type:2,position:{x:0,y:7}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,5)),s.motorSpeed=1*Math.PI,s.maxMotorTorque=1e4,s.enableMotor=!0,this.m_joint1=this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(.5,4);let o=this.m_world.CreateBody({type:2,position:{x:0,y:13}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,9)),s.enableMotor=!1,this.m_world.CreateJoint(s),e=o}{let r=new v;r.SetAsBox(1.5,1.5);let o=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:0,y:17}});o.CreateFixture({shape:r,density:2});let s=new q;s.Initialize(e,o,new n(0,17)),this.m_world.CreateJoint(s);let l=new Nt;l.Initialize(t,o,new n(0,17),new n(0,1)),l.maxMotorForce=1e3,l.enableMotor=!0,this.m_joint2=this.m_world.CreateJoint(l)}{let r=new v;r.SetAsBox(1.5,1.5),this.m_world.CreateBody({type:2,position:{x:0,y:23}}).CreateFixture({shape:r,density:2})}}}getHotkeys(){return[G("f","Toggle Friction",()=>{this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0)}),G("m","Toggle Motor",()=>{this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)})]}Step(t,e){super.Step(t,e);let r=this.m_joint1.GetMotorTorque(t.m_hertz);this.addDebug("Motor Torque",r.toFixed(0))}};P("Examples","Slider Crank 2",xf);var gf=class i extends R{constructor(){super();this.m_bodies=[];{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let e=new V;e.m_radius=1;for(let r=0;r<i.e_count;++r)this.m_bodies[r]=this.m_world.CreateBody({type:2,position:{x:0,y:4+3*r}}),this.m_bodies[r].CreateFixture({shape:e,density:1}),this.m_bodies[r].SetLinearVelocity(new n(0,-50))}}static{this.e_count=10}};P("Stacking","Circle Stack",gf);var Sf=class extends R{constructor(){super();this.m_offset=new n;this.m_motorOn=!0;this.m_motorSpeed=2;this.m_offset.Set(0,8);let e=new n(0,.8);{let o=this.m_world.CreateBody(),s=new I;s.SetTwoSided(new n(-50,0),new n(50,0)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(-50,0),new n(-50,10)),o.CreateFixture({shape:s}),s.SetTwoSided(new n(50,0),new n(50,10)),o.CreateFixture({shape:s})}for(let o=0;o<40;++o){let s=new V;s.m_radius=.25,this.m_world.CreateBody({type:2,position:{x:-40+2*o,y:.5}}).CreateFixture({shape:s,density:1})}{let o=new v;o.SetAsBox(2.5,1),this.m_chassis=this.m_world.CreateBody({type:2,position:{x:e.x+this.m_offset.x,y:e.y+this.m_offset.y}}),this.m_chassis.CreateFixture({density:1,shape:o,filter:{groupIndex:-1}})}{let o=new V;o.m_radius=1.6,this.m_wheel=this.m_world.CreateBody({type:2,position:{x:e.x+this.m_offset.x,y:e.y+this.m_offset.y}}),this.m_wheel.CreateFixture({density:1,shape:o,filter:{groupIndex:-1}})}{let o=new q;o.Initialize(this.m_wheel,this.m_chassis,n.Add(e,this.m_offset,new n)),o.collideConnected=!1,o.motorSpeed=this.m_motorSpeed,o.maxMotorTorque=400,o.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(o)}let r=n.Add(e,new n(0,-.8),new n);this.CreateLeg(-1,r),this.CreateLeg(1,r),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),120*Math.PI/180),this.CreateLeg(-1,r),this.CreateLeg(1,r),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),-120*Math.PI/180),this.CreateLeg(-1,r),this.CreateLeg(1,r)}CreateLeg(e,r){let o=new n(5.4*e,-6.1),s=new n(7.2*e,-1.2),l=new n(4.3*e,-1.9),a=new n(3.1*e,.8),c=new n(6*e,1.5),u=new n(2.5*e,3.7),m=new v,p=new v;if(e>0){let f=[];f[0]=o,f[1]=s,f[2]=l,m.Set(f),f[0]=n.ZERO,f[1]=n.Subtract(c,a,new n),f[2]=n.Subtract(u,a,new n),p.Set(f)}else{let f=[];f[0]=o,f[1]=l,f[2]=s,m.Set(f),f[0]=n.ZERO,f[1]=n.Subtract(u,a,new n),f[2]=n.Subtract(c,a,new n),p.Set(f)}let d=this.m_world.CreateBody({type:2,position:this.m_offset,angularDamping:10}),h=this.m_world.CreateBody({type:2,position:n.Add(a,this.m_offset,new n),angularDamping:10});d.CreateFixture({filter:{groupIndex:-1},shape:m,density:1}),h.CreateFixture({filter:{groupIndex:-1},density:1,shape:p});{let f=new Fe,b=.5,x=10;f.Initialize(d,h,n.Add(s,this.m_offset,new n),n.Add(c,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(d,h,n.Add(l,this.m_offset,new n),n.Add(a,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(d,this.m_wheel,n.Add(l,this.m_offset,new n),n.Add(r,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f),f.Initialize(h,this.m_wheel,n.Add(u,this.m_offset,new n),n.Add(r,this.m_offset,new n)),Ct(f,x,b,f.bodyA,f.bodyB),this.m_world.CreateJoint(f)}{let f=new q;f.Initialize(h,this.m_chassis,n.Add(a,this.m_offset,new n)),this.m_world.CreateJoint(f)}}getHotkeys(){return[G("a","Left",()=>this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed)),G("s","Brake",()=>this.m_motorJoint.SetMotorSpeed(0)),G("d","Right",()=>this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed)),G("m","Toggle Enabled",()=>this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled()))]}};P("Examples","Theo Jansen's Walker",Sf);var wf=class i extends R{constructor(){super();this.m_fixtureCount=0;this.m_createTime=0;this.m_fixtureCount=0;let e=new ri;{let o=this.m_world.CreateBody({position:{x:0,y:-.5}});{let a=new n;a.y=0;for(let c=0;c<10;++c){a.x=-200*.5;for(let u=0;u<200;++u){let m=new v;m.SetAsBox(.5,.5,a,0),o.CreateFixture({shape:m}),++this.m_fixtureCount,a.x+=2*.5}a.y-=2*.5}}}{let o=new v;o.SetAsBox(.5,.5);let s=new n(-7,.75),l=new n,a=new n(.5625,1.25),c=new n(1.125,0);for(let u=0;u<i.e_count;++u){l.Copy(s);for(let m=u;m<i.e_count;++m)this.m_world.CreateBody({type:2,position:l}).CreateFixture({shape:o,density:5}),++this.m_fixtureCount,l.Add(c);s.Add(a)}}this.m_createTime=e.GetMilliseconds()}static{this.e_count=20}Step(e,r){let o=this.m_world.GetContactManager(),s=o.m_broadPhase.GetTreeHeight(),a=2*o.m_broadPhase.GetProxyCount()-1,c=Math.ceil(Math.log(a)/Math.log(2));this.addDebug("Dynamic Tree Height",s),this.addDebug("Min Height",c),super.Step(e,r),this.addDebug("Create Time",`${this.m_createTime.toFixed(2)} ms`),this.addDebug("Fixture Count",this.m_fixtureCount)}};P("Benchmark","Tiles",wf);var vf=class extends R{constructor(){super();this.m_shapeA=new v;this.m_shapeB=new v;this.m_shapeA.SetAsBox(25,5),this.m_shapeB.SetAsBox(2.5,2.5)}Step(e,r){super.Step(e,r);let o=new ee;o.c0.Set(0,20+8*Math.cos(Date.now()/1e3)),o.a0=2.95,o.c.Copy(o.c0),o.a=o.a0,o.localCenter.SetZero();let s=new ee;s.c0.Set(20,40),s.a0=.1,s.c.Set(-20,0),s.a=3.1,s.localCenter.SetZero();let l=new ns;l.proxyA.SetShape(this.m_shapeA,0),l.proxyB.SetShape(this.m_shapeB,0),l.sweepA.Copy(o),l.sweepB.Copy(s),l.tMax=1;let a=new ls;Oa(a,l),this.addDebug("Toi",a.t.toFixed(3)),this.addDebug("Max Toi Iters",ot.maxIters),this.addDebug("Max Root Iters",ot.maxRootIters);let c=[],u=new T;o.GetTransform(u,0);for(let d=0;d<this.m_shapeA.m_count;++d)c[d]=T.MultiplyVec2(u,this.m_shapeA.m_vertices[d],new n);let m=e.m_debugDraw;m.DrawPolygon(c,this.m_shapeA.m_count,new F(.9,.9,.9));let p=new T;s.GetTransform(p,0);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.9,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${0 .toFixed(1)}`),s.GetTransform(p,a.t);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.7,.9)),m.DrawStringWorld(p.p.x,p.p.y,`${a.t.toFixed(3)}`),s.GetTransform(p,1);for(let d=0;d<this.m_shapeB.m_count;++d)c[d]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[d],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.9,.5,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${1 .toFixed(1)}`);for(let d=0;d<1;d+=.1){s.GetTransform(p,d);for(let h=0;h<this.m_shapeB.m_count;++h)c[h]=T.MultiplyVec2(p,this.m_shapeB.m_vertices[h],new n);m.DrawPolygon(c,this.m_shapeB.m_count,new F(.5,.5,.5)),m.DrawStringWorld(p.p.x,p.p.y,`${d.toFixed(1)}`)}}GetDefaultViewZoom(){return 20}getCenter(){return{x:0,y:10}}};P("Collision","Time of Impact",vf);var Bf=class i extends R{constructor(){super();this.m_count=0;let e=this.m_world.CreateBody();{let r=this.m_world.CreateBody({type:2,allowSleep:!1,position:{x:0,y:10}}),o=new v;o.SetAsBox(.5,10,new n(10,0),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(.5,10,new n(-10,0),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(10,.5,new n(0,10),0),r.CreateFixture({shape:o,density:5}),o.SetAsBox(10,.5,new n(0,-10),0),r.CreateFixture({shape:o,density:5});let s=new q;s.bodyA=e,s.bodyB=r,s.localAnchorA.Set(0,10),s.localAnchorB.Set(0,0),s.referenceAngle=0,s.motorSpeed=.05*Math.PI,s.maxMotorTorque=1e8,s.enableMotor=!0,this.m_joint=this.m_world.CreateJoint(s)}this.m_count=0}static{this.e_count=800}getCenter(){return{x:0,y:5}}Step(e,r){if(super.Step(e,r),this.m_count<i.e_count){let o=this.m_world.CreateBody({type:2,position:{x:0,y:10}}),s=new v;s.SetAsBox(.125,.125),o.CreateFixture({shape:s,density:1}),++this.m_count}}};P("Benchmark","Tumbler",Bf);var Cf=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:-4,y:22},angle:-.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.25,1),this.m_world.CreateBody({position:{x:10.5,y:19}}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:4,y:14},angle:.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.25,1),this.m_world.CreateBody({position:{x:-10.5,y:11}}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(13,.25),this.m_world.CreateBody({position:{x:-4,y:6},angle:-.25}).CreateFixture({shape:t})}{let t=new v;t.SetAsBox(.5,.5);let e={shape:t,density:25},r=[.75,.5,.35,.1,0];for(let o=0;o<5;++o){let s=this.m_world.CreateBody({type:2,position:{x:-15+4*o,y:28}});e.friction=r[o],s.CreateFixture(e)}}}getCenter(){return{x:0,y:10}}};P("Forces","Friction",Cf);var Af=class extends R{constructor(){super();let t=10;{let e=this.m_world.CreateBody(),r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,restitutionThreshold:t})}{let e=new V;e.m_radius=1;let r={shape:e,density:1,restitutionThreshold:t},o=[0,.1,.3,.5,.75,.9,1];for(let s=0;s<7;++s){let l=this.m_world.CreateBody({type:2,position:{x:-10+3*s,y:20}});r.restitution=o[s],l.CreateFixture(r)}}}};P("Forces","Restitution",Af);var Tf=class i extends R{constructor(){super();this.m_bullet=null;this.m_bodies=new Array(i.e_rowCount*i.e_columnCount);this.m_indices=je(i.e_rowCount*i.e_columnCount);{let r=this.m_world.CreateBody(),o=new I;o.SetTwoSided(new n(-40,0),new n(40,0)),r.CreateFixture({shape:o}),o.SetTwoSided(new n(20,0),new n(20,20)),r.CreateFixture({shape:o})}let e=[0,-10,-5,5,10];for(let r=0;r<i.e_columnCount;++r){let o=new v;o.SetAsBox(.5,.5);let s={shape:o,density:1,friction:.3};for(let l=0;l<i.e_rowCount;++l){let a=r*i.e_rowCount+l;this.m_indices[a]=a;let u=this.m_world.CreateBody({type:2,position:{x:e[r]+0,y:.55+1.1*l}});this.m_bodies[a]=u,u.CreateFixture(s)}}}static{this.e_columnCount=1}static{this.e_rowCount=15}getHotkeys(){return[G("Enter","Launch a bullet",()=>this.LaunchBullet()),G("b","Toggle Block solving",()=>Rc(!kc()))]}Destroy(){Rc(!0)}LaunchBullet(){this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);{let e=new V;e.m_radius=.25;let r={shape:e,density:20,restitution:.05};this.m_bullet=this.m_world.CreateBody({type:2,bullet:!0,position:{x:-31,y:5}}),this.m_bullet.CreateFixture(r),this.m_bullet.SetLinearVelocity(new n(400,0))}}Step(e,r){super.Step(e,r),this.addDebug("Blocksolve",kc())}};P("Stacking","Box Stack",Tf);var Pf=class extends R{constructor(){super();this.m_bodies=new Array(4);this.m_joints=new Array(8);let e=null;{e=this.m_world.CreateBody();let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r})}{let r=new v;r.SetAsBox(.5,.5);let o=this.m_bodies[0]=this.m_world.CreateBody({type:2,position:{x:-5,y:5}});o.CreateFixture({shape:r,density:5});let s=this.m_bodies[1]=this.m_world.CreateBody({type:2,position:{x:5,y:5}});s.CreateFixture({shape:r,density:5});let l=this.m_bodies[2]=this.m_world.CreateBody({type:2,position:{x:5,y:15}});l.CreateFixture({shape:r,density:5});let a=this.m_bodies[3]=this.m_world.CreateBody({type:2,position:{x:-5,y:15}});a.CreateFixture({shape:r,density:5});let c=new Fe,u,m,p,d=2,h=0;c.bodyA=e,c.bodyB=o,c.localAnchorA.Set(-10,0),c.localAnchorB.Set(-.5,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[0]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=s,c.localAnchorA.Set(10,0),c.localAnchorB.Set(.5,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[1]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=l,c.localAnchorA.Set(10,20),c.localAnchorB.Set(.5,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[2]=this.m_world.CreateJoint(c),c.bodyA=e,c.bodyB=a,c.localAnchorA.Set(-10,20),c.localAnchorB.Set(-.5,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[3]=this.m_world.CreateJoint(c),c.bodyA=o,c.bodyB=s,c.localAnchorA.Set(.5,0),c.localAnchorB.Set(-.5,0),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[4]=this.m_world.CreateJoint(c),c.bodyA=s,c.bodyB=l,c.localAnchorA.Set(0,.5),c.localAnchorB.Set(0,-.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[5]=this.m_world.CreateJoint(c),c.bodyA=l,c.bodyB=a,c.localAnchorA.Set(-.5,0),c.localAnchorB.Set(.5,0),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[6]=this.m_world.CreateJoint(c),c.bodyA=a,c.bodyB=o,c.localAnchorA.Set(0,-.5),c.localAnchorB.Set(0,.5),u=c.bodyA.GetWorldPoint(c.localAnchorA,new n),m=c.bodyB.GetWorldPoint(c.localAnchorB,new n),p=n.Subtract(m,u,new n),c.length=p.Length(),Ct(c,d,h,c.bodyA,c.bodyB),this.m_joints[7]=this.m_world.CreateJoint(c)}}JointDestroyed(e){for(let r=0;r<8;++r)if(this.m_joints[r]===e){this.m_joints[r]=null;break}}getHotkeys(){return[G("b","Delete a Body",()=>{for(let e=0;e<4;++e){let r=this.m_bodies[e];if(r){this.m_world.DestroyBody(r),this.m_bodies[e]=null;break}}}),G("j","Delete a Joint",()=>{for(let e=0;e<8;++e){let r=this.m_joints[e];if(r){this.m_world.DestroyJoint(r),this.m_joints[e]=null;break}}})]}Step(e,r){super.Step(e,r),this.addText("This demonstrates a soft distance joint.")}};P("Examples","Web",Pf);var Df=["Spring","PBD Ang","XPBD Ang","PBD Dist","PBD Height","PBD Triangle"],Mf=["PBD","XPBD"],Rf=class extends R{constructor(){super();this.m_tuning1=new ds;this.m_tuning2=new ds;this.m_iterations=[8,8];this.m_position1=new n;this.m_position2=new n;this.m_speed=10;this.m_moveLeft=!1;this.m_moveRight=!1;let e=20,r=.5,o=H(e,n),s=je(e);for(let a=0;a<e;++a)o[a].Set(0,r*(e-a)),s[a]=1;s[0]=0,s[1]=0,this.m_tuning1.bendHertz=30,this.m_tuning1.bendDamping=4,this.m_tuning1.bendStiffness=1,this.m_tuning1.bendingModel=5,this.m_tuning1.isometric=!0,this.m_tuning1.stretchHertz=30,this.m_tuning1.stretchDamping=4,this.m_tuning1.stretchStiffness=1,this.m_tuning1.stretchingModel=0,this.m_tuning2.bendHertz=30,this.m_tuning2.bendDamping=.7,this.m_tuning2.bendStiffness=1,this.m_tuning2.bendingModel=4,this.m_tuning2.isometric=!0,this.m_tuning2.stretchHertz=30,this.m_tuning2.stretchDamping=1,this.m_tuning2.stretchStiffness=1,this.m_tuning2.stretchingModel=0,this.m_position1.Set(-5,15),this.m_position2.Set(5,15);let l={position:this.m_position1,vertices:o,masses:s,gravity:{x:0,y:-10},tuning:this.m_tuning1};this.m_rope1=new Ln(l),l.position=this.m_position2,l.tuning=this.m_tuning2,this.m_rope2=new Ln(l)}setupControls(){this.addTestControlGroup("Rope 1",this.ropeControls(0,this.m_tuning1)),this.addTestControlGroup("Rope 2",this.ropeControls(1,this.m_tuning2)),this.addTestControlGroup("Speed",[_t("",10,100,1,this.m_speed,e=>{this.m_speed=e})])}ropeControls(e,r){return[sr("Bend Model#",Df,Df[r.bendingModel],o=>{r.bendingModel=Df.indexOf(o)}),_t("Damping#b",0,4,.1,r.bendDamping,o=>{r.bendDamping=o}),_t("Hertz#b",0,60,1,r.bendHertz,o=>{r.bendHertz=o}),_t("Stiffness#b",0,1,.1,r.bendStiffness,o=>{r.bendStiffness=o}),Yt("Isometric",r.isometric,o=>{r.isometric=o}),Yt("Fixed Mass",r.fixedEffectiveMass,o=>{r.fixedEffectiveMass=o}),Yt("Warm Start",r.warmStart,o=>{r.warmStart=o}),sr("Stretch Model",Mf,Mf[r.stretchingModel],o=>{r.stretchingModel=Mf.indexOf(o)}),_t("Damping#s",0,4,.1,r.stretchDamping,o=>{r.stretchDamping=o}),_t("Hertz#s",0,60,1,r.stretchHertz,o=>{r.stretchHertz=o}),_t("Stiffness#s",0,1,.1,r.stretchStiffness,o=>{r.stretchStiffness=o}),_t("Iterations",0,100,1,this.m_iterations[e],o=>{this.m_iterations[e]=o})]}GetDefaultViewZoom(){return 45}getCenter(){return{x:0,y:20}}getHotkeys(){return[Yr("a","Move Left",this,"m_moveLeft"),Yr("d","Move Right",this,"m_moveRight"),G("s","Reset Ropes",()=>{this.m_position1.Set(-5,15),this.m_position2.Set(5,15),this.m_rope1.Reset(this.m_position1),this.m_rope2.Reset(this.m_position2)})]}Step(e,r){let o=e.m_hertz>0?1/e.m_hertz:0;e.m_pause===!0&&e.m_singleStep===!1&&(o=0);let s=0;this.m_moveLeft&&(s-=1),this.m_moveRight&&(s+=1),s&&(this.m_position1.x+=s*this.m_speed*o,this.m_position2.x+=s*this.m_speed*o),this.m_rope1.SetTuning(this.m_tuning1),this.m_rope2.SetTuning(this.m_tuning2),this.m_rope1.Step(o,this.m_iterations[0],this.m_position1),this.m_rope2.Step(o,this.m_iterations[1],this.m_position2),super.Step(e,r);let l=e.m_debugDraw;this.m_rope1.Draw(l),this.m_rope2.Draw(l)}};P("Rope","Bending",Rf);var kf=class extends R{constructor(){super();let t;{t=this.m_world.CreateBody();let o=new I;o.SetTwoSided(new n(-20,0),new n(20,0)),t.CreateFixture({shape:o})}let e;{e=this.m_world.CreateBody({type:2,position:{x:0,y:4}});let o=new V;o.m_radius=1,e.CreateFixture({shape:o,friction:.6,density:2})}let r;{r=this.m_world.CreateBody({type:2,position:{x:4,y:8}});let o=new V;o.m_radius=1,r.CreateFixture({shape:o,friction:.6,density:2})}{let o=new us;o.Initialize(e,r),o.maxForce=1e3,o.maxTorque=1e3,this.m_joint=this.m_world.CreateJoint(o)}}};P("Bugs","Motor Joint (Bug #487)",kf);var Ff=class extends R{constructor(){super();let t=this.m_world.CreateBody();{let e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(-40,0),new n(-40,25)),t.CreateFixture({shape:e}),e.SetTwoSided(new n(40,0),new n(40,25)),t.CreateFixture({shape:e})}{let e=new $a,r=0,o=10,s=5,l=5,a=20,c=.5;for(let p=0;p<a;++p){let d=p*2*Math.PI/a,h=this.m_world.CreateBody({type:2,fixedRotation:!0,position:{x:r+s*Math.cos(d),y:o+l*Math.sin(d)}});h.CreateFixture({shape:new V(c),density:1}),e.AddBody(h)}Ct(e,10,1,e.bodyA,e.bodyB),this.m_world.CreateJoint(e)}}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:5}}};P("Examples","Blob Test",Ff);var If=class extends R{constructor(){super();{let t=this.m_world.CreateBody(),e=new dt;e.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),t.CreateFixture({shape:e})}this.m_world.SetContinuousPhysics(!0);{let t=this.m_world.CreateBody({type:2,bullet:!0,position:{x:15,y:5}}),e=new v;e.SetAsBox(4.5,.45);let r={density:4,restitution:1.4,shape:e};t.CreateFixture(r);let o=new v;o.SetAsBox(.45,8.1,new n(-4.35,7.05),.2),r.shape=o,t.CreateFixture(r);let s=new v;s.SetAsBox(.45,8.1,new n(4.35,7.05),-.2),r.shape=s,t.CreateFixture(r)}for(let t=0;t<5;t++){let e=new V(Math.random()*1+.5);this.m_world.CreateBody({type:2,bullet:!0,position:{x:Math.random()*30-25,y:Math.random()*32+2}}).CreateFixture({shape:e,friction:.3,density:1,restitution:1.1})}}GetDefaultViewZoom(){return 20}getCenter(){return{x:0,y:15}}};P("Continuous","Continuous Collision",If);var Lf=class extends R{constructor(){super();{let l=this.m_world.CreateBody(),a=new dt;a.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),l.CreateFixture({shape:a})}let t=new n,e={position:t},r=new q;for(let l=0;l<2;++l){let a=-20+Math.random()*2+40*l,c=30+Math.random()*5;e.type=2;let u={shape:new V(1.25),density:1,friction:.4,restitution:.3};t.Set(a,c);let m=this.m_world.CreateBody(e);m.CreateFixture(u),m.ApplyLinearImpulse(new n(Math.random()*1e3-500,Math.random()*1e3-500),m.GetWorldCenter());let p=new v;u.shape=p,p.SetAsBox(1.5,1),u.density=1,u.friction=.4,u.restitution=.1,t.Set(a,c-2.8);let d=this.m_world.CreateBody(e);d.CreateFixture(u),p.SetAsBox(1.5,1),t.Set(a,c-4.3);let h=this.m_world.CreateBody(e);h.CreateFixture(u),p.SetAsBox(1.5,1),t.Set(a,c-5.8);let f=this.m_world.CreateBody(e);f.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(1.8,.65),t.Set(a-3,c-2);let b=this.m_world.CreateBody(e);b.CreateFixture(u),p.SetAsBox(1.8,.65),t.Set(a+3,c-2);let x=this.m_world.CreateBody(e);x.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(1.7,.6),t.Set(a-5.7,c-2);let _=this.m_world.CreateBody(e);_.CreateFixture(u),p.SetAsBox(1.7,.6),t.Set(a+5.7,c-2);let y=this.m_world.CreateBody(e);y.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(.75,2.2),t.Set(a-.8,c-8.5);let g=this.m_world.CreateBody(e);g.CreateFixture(u),p.SetAsBox(.75,2.2),t.Set(a+.8,c-8.5);let S=this.m_world.CreateBody(e);S.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,p.SetAsBox(.6,2),t.Set(a-.8,c-12);let w=this.m_world.CreateBody(e);w.CreateFixture(u),p.SetAsBox(.6,2),t.Set(a+.8,c-12);let B=this.m_world.CreateBody(e);B.CreateFixture(u),r.enableLimit=!0,r.lowerAngle=pt(-40),r.upperAngle=pt(40),r.Initialize(d,m,new n(a,c-1.5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-85),r.upperAngle=pt(130),r.Initialize(d,b,new n(a-1.8,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-130),r.upperAngle=pt(85),r.Initialize(d,x,new n(a+1.8,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-130),r.upperAngle=pt(10),r.Initialize(b,_,new n(a-4.5,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-10),r.upperAngle=pt(130),r.Initialize(x,y,new n(a+4.5,c-2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-15),r.upperAngle=pt(15),r.Initialize(d,h,new n(a,c-3.5)),this.m_world.CreateJoint(r),r.Initialize(h,f,new n(a,c-5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-25),r.upperAngle=pt(45),r.Initialize(f,g,new n(a-.8,c-7.2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-45),r.upperAngle=pt(25),r.Initialize(f,S,new n(a+.8,c-7.2)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-25),r.upperAngle=pt(115),r.Initialize(g,w,new n(a-.8,c-10.5)),this.m_world.CreateJoint(r),r.lowerAngle=pt(-115),r.upperAngle=pt(25),r.Initialize(S,B,new n(a+.8,c-10.5)),this.m_world.CreateJoint(r)}e.type=0;let o=new v,s={shape:o,density:0,friction:.4,restitution:.3};for(let l=1;l<=10;++l)o.SetAsBox(1*l,1),t.Set(1*l-30,21-2*l),this.m_world.CreateBody(e).CreateFixture(s);for(let l=1;l<=10;++l)o.SetAsBox(1*l,1),t.Set(30-1*l,21-2*l),this.m_world.CreateBody(e).CreateFixture(s);o.SetAsBox(3,4),t.Set(0,4),this.m_world.CreateBody(e).CreateFixture(s)}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:15}}};P("Examples","Ragdolls",Lf);var Gf=class extends R{constructor(){super();{let l=this.m_world.CreateBody(),a=new dt;a.CreateLoop([new n(-30,0),new n(-30,40),new n(30,40),new n(30,0)]),l.CreateFixture({shape:a})}let t=new n,e={type:2,position:t},r=new v,o={shape:r,density:1,friction:.5,restitution:.1};r.SetAsBox(1,1);for(let l=0;l<10;++l)t.Set(0+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);for(let l=0;l<10;++l)t.Set(10+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);for(let l=0;l<10;++l)t.Set(20+Math.random()*.2-.1,30-l*2.5),this.m_world.CreateBody(e).CreateFixture(o);e.type=0,t.Set(0,0);let s=[new n(-30,0),new n(-10,0),new n(-30,10)];r.Set(s,s.length),o.density=0,this.m_world.CreateBody(e).CreateFixture(o),e.type=2,t.Set(-25,20),o.shape=new V(4),o.density=2,o.restitution=.2,o.friction=.5,this.m_world.CreateBody(e).CreateFixture(o)}GetDefaultViewZoom(){return 15}getCenter(){return{x:0,y:15}}};P("Stacking","Stacked Boxes",Gf);var Vf=class extends R{constructor(){super();let t=4,e=30,r=(c,u,m)=>{let d=c.CreateBody({type:2,position:u}),h=new v;m?h.SetAsBox(.5*e,.5*t):h.SetAsBox(.5*t,.5*e),d.CreateFixture({shape:h,density:1/(t*e),friction:.6,restitution:0})},o=this.m_world,s=o.CreateBody(),l=new I;l.SetTwoSided(new n(-600,-240),new n(600,-240)),s.CreateFixture({shape:l,friction:1,restitution:1});let a=12;for(let c=0;c<a;c++)for(let u=0;u<a-c;u++){let m=new n((u-(a-1-c)*.5)*1.5*e,(c+.5)*(e+2*t)-t-240);r(o,m,!1),r(o,n.Add(m,new n(0,(e+t)/2),new n),!0),u===0&&r(o,n.Add(m,new n(.5*(t-e),e+t),new n),!1),u!==a-c-1?r(o,n.Add(m,new n(e*.75,(e+3*t)/2),new n),!0):r(o,n.Add(m,new n(.5*(e-t),e+t),new n),!1)}}GetDefaultViewZoom(){return 1.5}getCenter(){return{x:0,y:1}}};P("Stacking","Pyramid Topple",Vf);var Ef=class extends R{constructor(){super();let t=.2,e=.1,r=1,o=25,s,l=this.m_world;function a(c,u,m){let p=new v;p.SetAsBox(.5*t,.5*r),l.CreateBody({type:2,position:{x:c,y:u},angle:m?Math.PI/2:0}).CreateFixture({shape:p,density:s,friction:e,restitution:.65})}{let c=new v;c.SetAsBox(50,10),l.CreateBody({position:{x:0,y:-10}}).CreateFixture({shape:c,density:0})}{s=10;let c=new v;c.SetAsBox(.7,.7);let u={density:35,shape:c,friction:0,restitution:.85},m=l.CreateBody({type:2,bullet:!0,position:{x:30,y:5}});m.CreateFixture(u),m.SetLinearVelocity(new n(-25,-25)),m.SetAngularVelocity(6.7),u.density=25,m=l.CreateBody({type:2,bullet:!0,position:{x:-30,y:25}}),m.CreateFixture(u),m.SetLinearVelocity(new n(35,-10)),m.SetAngularVelocity(-8.3)}{let c;for(let u=0;u<o;++u)c=u*1.5*r-1.5*r*o/2,a(c,r/2,!1),a(c,r+t/2,!0);c=o*1.5*r-1.5*r*o/2;for(let u=1;u<o;++u){u>3&&(s*=.8);let m=r*.5+(r+2*t)*.99*u;for(let p=0;p<o-u;++p)c=p*1.5*r-1.5*r*(o-u)/2,s*=2.5,p===0&&a(c-1.25*r+.5*t,m-t,!1),p===o-u-1&&a(c+1.25*r-.5*t,m-t,!1),s/=2.5,a(c,m,!1),a(c,m+.5*(t+r),!0),a(c,m-.5*(t+r),!0)}}}};P("Benchmark","Domino Tower",Ef);var Su=.017453292519943295,wu=class{constructor(t,e){this.frictionModifier=t,this.outOfCourse=e}},As=class{constructor(t){this.m_groundAreas=[];this.m_currentTraction=1;this.m_maxForwardSpeed=0;this.m_maxBackwardSpeed=0;this.m_maxDriveForce=0;this.m_maxLateralImpulse=0;this.m_body=t.CreateBody({type:2,userData:{tire:this}});let e=new v;e.SetAsBox(.5,1.25),this.m_body.CreateFixture({shape:e,density:1,userData:{tire:!0}})}setCharacteristics(t,e,r,o){this.m_maxForwardSpeed=t,this.m_maxBackwardSpeed=e,this.m_maxDriveForce=r,this.m_maxLateralImpulse=o}addGroundArea(t){this.m_groundAreas.push(t),this.updateTraction()}removeGroundArea(t){this.m_groundAreas.splice(this.m_groundAreas.indexOf(t)),this.updateTraction()}updateTraction(){this.m_groundAreas.length===0?this.m_currentTraction=1:(this.m_currentTraction=0,this.m_groundAreas.forEach(t=>{t.frictionModifier>this.m_currentTraction&&(this.m_currentTraction=t.frictionModifier)}))}getLateralVelocity(){let t=this.m_body.GetWorldVector(new n(1,0),new n);return t.Scale(n.Dot(t,this.m_body.GetLinearVelocity()))}getForwardVelocity(){let t=this.m_body.GetWorldVector(new n(0,1),new n);return t.Scale(n.Dot(t,this.m_body.GetLinearVelocity()))}updateFriction(){let t=this.getLateralVelocity().Scale(-1*this.m_body.GetMass());t.Length()>this.m_maxLateralImpulse&&t.Scale(this.m_maxLateralImpulse/t.Length()),this.m_body.ApplyLinearImpulse(t.Scale(this.m_currentTraction),this.m_body.GetWorldCenter()),this.m_body.ApplyAngularImpulse(this.m_currentTraction*.1*this.m_body.GetInertia()*-this.m_body.GetAngularVelocity());let e=this.getForwardVelocity(),o=-2*e.Normalize();this.m_body.ApplyForce(e.Scale(this.m_currentTraction*o),this.m_body.GetWorldCenter())}updateDrive(t){if(t.up===t.down)return;let e=0;t.up?e=this.m_maxForwardSpeed:t.down&&(e=this.m_maxBackwardSpeed);let r=this.m_body.GetWorldVector(new n(0,1),new n),o=n.Dot(this.getForwardVelocity(),r),s=0;if(e>o)s=this.m_maxDriveForce;else if(e<o)s=-this.m_maxDriveForce;else return;this.m_body.ApplyForce(r.Scale(this.m_currentTraction*s),this.m_body.GetWorldCenter())}updateTurn(t){let e=0;t.left&&(e+=15),t.right&&(e-=15),this.m_body.ApplyTorque(e)}},Uf=class{constructor(t){this.m_tires=[],this.m_body=t.CreateBody({type:2}),this.m_body.SetAngularDamping(3);let e=[];e[0]=new n(1.5,0),e[1]=new n(3,2.5),e[2]=new n(2.8,5.5),e[3]=new n(1,10),e[4]=new n(-1,10),e[5]=new n(-2.8,5.5),e[6]=new n(-3,2.5),e[7]=new n(-1.5,0);let r=new v;r.Set(e,8),this.m_body.CreateFixture({shape:r,density:.1});let o=new q;o.bodyA=this.m_body,o.enableLimit=!0,o.lowerAngle=0,o.upperAngle=0,o.localAnchorB.SetZero();let s=250,l=-40,a=300,c=500,u=8.5,m=7.5,p=new As(t);p.setCharacteristics(s,l,a,u),o.bodyB=p.m_body,o.localAnchorA.Set(-3,.75),t.CreateJoint(o),this.m_tires.push(p),p=new As(t),p.setCharacteristics(s,l,a,u),o.bodyB=p.m_body,o.localAnchorA.Set(3,.75),t.CreateJoint(o),this.m_tires.push(p),p=new As(t),p.setCharacteristics(s,l,c,m),o.bodyB=p.m_body,o.localAnchorA.Set(-3,8.5),this.flJoint=t.CreateJoint(o),this.m_tires.push(p),p=new As(t),p.setCharacteristics(s,l,c,m),o.bodyB=p.m_body,o.localAnchorA.Set(3,8.5),this.frJoint=t.CreateJoint(o),this.m_tires.push(p)}update(t){this.m_tires.forEach(u=>{u.updateFriction()}),this.m_tires.forEach(u=>{u.updateDrive(t)});let e=35*Su,o=160*Su/60,s=0;t.left&&(s+=e),t.right&&(s-=e);let l=this.flJoint.GetJointAngle(),a=s-l;a=et(a,-o,o);let c=l+a;this.flJoint.SetLimits(c,c),this.frJoint.SetLimits(c,c)}},Yf=class i extends R{constructor(){super(n.ZERO);this.m_controlState={left:!1,right:!1,up:!1,down:!1};{this.m_groundBody=this.m_world.CreateBody();let e=new v,r={shape:e,isSensor:!0,userData:{groundArea:new wu(.5,!1)}};e.SetAsBox(9,7,new n(-10,15),20*Su),this.m_groundBody.CreateFixture(r),e.SetAsBox(9,5,new n(5,20),-40*Su),r.userData={groundArea:new wu(.2,!1)},this.m_groundBody.CreateFixture(r)}this.m_car=new Uf(this.m_world)}getHotkeys(){return[Yr("a","Turn Left",this.m_controlState,"left"),Yr("d","Turn Right",this.m_controlState,"right"),Yr("w","Move Forward",this.m_controlState,"up"),Yr("s","Move Backward",this.m_controlState,"down")]}static handleContact(e,r){let o=e.GetFixtureA(),s=e.GetFixtureB(),l=o.GetUserData(),a=s.GetUserData();l.tire||a.groundArea?i.tire_vs_groundArea(o,s,r):(l.groundArea||a.tire)&&i.tire_vs_groundArea(s,o,r)}BeginContact(e){i.handleContact(e,!0)}EndContact(e){i.handleContact(e,!1)}static tire_vs_groundArea(e,r,o){let{tire:s}=e.GetBody().GetUserData(),{groundArea:l}=r.GetUserData();s&&l&&(o?s.addGroundArea(l):s.removeGroundArea(l))}Step(e,r){this.m_car.update(this.m_controlState),super.Step(e,r)}};P("Examples","TopDown Car",Yf);var Jf=class extends R{constructor(){super();let t=this.m_world.CreateBody(),e=new I;e.SetTwoSided(new n(-40,0),new n(40,0)),t.CreateFixture({shape:e});let r={x:0,y:5},o=this.m_world.CreateBody({type:2,angularDamping:.1,position:r}),s=new v;s.SetAsBox(.5,.5),o.CreateFixture({shape:s,density:5}),this.m_hertz=1,this.m_dampingRatio=.7;let l=new Fe;l.Initialize(t,o,new n(0,15),r),l.collideConnected=!0,this.m_length=l.length,this.m_minLength=this.m_length,this.m_maxLength=this.m_length,Ct(l,this.m_hertz,this.m_dampingRatio,l.bodyA,l.bodyB),this.m_joint=this.m_world.CreateJoint(l)}setupControls(){this.addTestControlGroup("Joint",[_t("Length",0,20,1,this.m_length,t=>{this.m_length=this.m_joint.SetLength(t)}),_t("Min Length",0,20,1,this.m_minLength,t=>{this.m_minLength=this.m_joint.SetMinLength(t)}),_t("Max Length",0,20,1,this.m_maxLength,t=>{this.m_maxLength=this.m_joint.SetMaxLength(t)}),_t("Hertz",0,10,.1,this.m_hertz,t=>{this.m_hertz=t,this.UpdateStiffness()}),_t("Damping Ratio",0,2,.1,this.m_dampingRatio,t=>{this.m_dampingRatio=t,this.UpdateStiffness()})])}UpdateStiffness(){let t={stiffness:0,damping:0};Ct(t,this.m_hertz,this.m_dampingRatio,this.m_joint.GetBodyA(),this.m_joint.GetBodyB()),this.m_joint.SetStiffness(t.stiffness),this.m_joint.SetDamping(t.damping)}};P("Joints","Distance Joint",Jf);var zf=class extends R{constructor(){super();this.m_motorSpeed=10;this.m_enableMotor=!1;this.m_enableLimit=!0;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,density:0})}{let r=new V(2),o=new n(0,10),s=this.m_world.CreateBody({type:2,position:o,allowSleep:!1});s.CreateFixture({shape:r,density:5});let l=new ps;l.Initialize(e,s,o,new n(0,1)),l.motorSpeed=this.m_motorSpeed,l.maxMotorTorque=1e4,l.enableMotor=this.m_enableMotor,l.lowerTranslation=-3,l.upperTranslation=3,l.enableLimit=this.m_enableLimit,Ct(l,1,.7,e,s),this.m_joint=this.m_world.CreateJoint(l)}this.addTestControlGroup("Joint",[Yt("Limit",this.m_enableLimit,r=>{this.m_enableLimit=this.m_joint.EnableLimit(r)}),Yt("Motor",this.m_enableMotor,r=>{this.m_enableMotor=this.m_joint.EnableMotor(r)}),_t("Speed",-100,100,1,this.m_motorSpeed,r=>{this.m_motorSpeed=this.m_joint.SetMotorSpeed(r)})])}Step(e,r){super.Step(e,r);let o=this.m_joint.GetMotorTorque(e.m_hertz);this.addDebug("Motor Torque",o);let s=this.m_joint.GetReactionForce(e.m_hertz,new n);this.addDebug("Reaction Force",`(${s.x.toFixed(1)}, ${s.y.toFixed(1)})`)}};P("Joints","Wheel",zf);var jf=class extends R{constructor(){super();this.m_distanceJointDef=new Fe;this.m_stabilize=!1;let e=this.m_world.CreateBody();{let r=new I;r.SetTwoSided(new n(-40,0),new n(40,0)),e.CreateFixture({shape:r,density:0})}{let r=new v;r.SetAsBox(.5,.125);let o={shape:r,density:20,friction:.2,filter:{categoryBits:1,maskBits:65533}},s=new q;s.collideConnected=!1;let l=10,a=15;this.m_distanceJointDef.localAnchorA.Set(0,a);let c=e;for(let m=0;m<l;++m){let p=new n(.5+1*m,a),d={type:2,position:p};m===l-1&&(p.Set(1*m,a),d.angularDamping=.4);let h=this.m_world.CreateBody(d);if(m===l-1){let b=new V(1.5);h.CreateFixture({shape:b,density:100,filter:{categoryBits:2}})}else h.CreateFixture(o);let f=new n(m,a);s.Initialize(c,h,f),this.m_world.CreateJoint(s),c=h}this.m_distanceJointDef.localAnchorB.SetZero();let u=.01;this.m_distanceJointDef.minLength=0,this.m_distanceJointDef.maxLength=l-1+u,this.m_distanceJointDef.bodyB=c}this.m_distanceJointDef.bodyA=e,this.m_distanceJoint=this.m_world.CreateJoint(this.m_distanceJointDef),this.m_stabilize=!0}setupControls(){this.addTestControlGroup("Wrecking Ball",[Yt("Stabilize",this.m_stabilize,e=>{this.m_stabilize=e,e&&this.m_distanceJoint===null?this.m_distanceJoint=this.m_world.CreateJoint(this.m_distanceJointDef):!e&&this.m_distanceJoint!==null&&(this.m_world.DestroyJoint(this.m_distanceJoint),this.m_distanceJoint=null)})])}Step(e,r){super.Step(e,r),this.addDebug("Distance Joint",this.m_distanceJoint?"ON":"OFF")}};P("Examples","Wrecking Ball",jf);var Xf=class extends R{constructor(){super();let t=new n(0,-10);this.m_world.SetGravity(t);let e=[];e[0]=this.m_world.CreateBody({type:0});{let r=new n(0,1),o=new n(0,0),s=new n(4,0),l=new I;l.SetTwoSided(r,o),e[0].CreateFixture({shape:l}),l.SetTwoSided(o,s),e[0].CreateFixture({shape:l})}e[1]=this.m_world.CreateBody({type:2,position:new n(1,3)});{let r=new v,o=H(8,n);o[0].Set(.5,-3),o[1].Set(.5,3),o[2].Set(-.5,3),o[3].Set(-.5,-3),r.Set(o,4),e[1].CreateFixture({shape:r,friction:.2,density:10})}}};P("Bugs","Chain Problem",Xf);var Hf=class extends R{constructor(){super();let t=25,e=this.m_world.CreateBody();{let m=new v;m.SetAsBox(.5,2),e.CreateFixture({shape:m}),e=this.m_world.CreateBody({angle:.5*Math.PI,position:{x:t,y:2*t}}),m.SetAsBox(2*t,1.2),e.CreateFixture({shape:m}),e=this.m_world.CreateBody({angle:.5*Math.PI,position:{x:-t,y:2*t}}),e.CreateFixture({shape:m})}let r=26,s=.5*2,l=s*r/2,a=s/2,c=new v;c.SetAsBox(.5,.5);let u=5*r;for(let m=0;m<r;++m){let p=m*s-l;for(let d=0;d<u;++d){let h=d*s+a+2;this.m_world.CreateBody({type:2,position:{x:p,y:h}}).CreateFixture({shape:c,density:1,friction:.5})}}}GetDefaultViewZoom(){return 10}getCenter(){return{x:0,y:50}}};P("Benchmark","Boxes",Hf);function vA(i){return i.key===" "?"Space":i.key}var Of=class{constructor(){this.m_fpsCalculator=new nu(200,200,16);this.m_settings=new ou;this.m_test=null;this.m_lMouseDown=!1;this.m_rMouseDown=!1;this.m_max_demo_time=1e3*10;this.m_ctx=null;this.m_mouse=new n;this.testBaseHotKeys=[];this.testHotKeys=[];this.allHotKeys=[];this.stepHotKeys=[];this.groupedTests=px();this.flatTests=[];this.testConstructor=null;this.testTitle="Unset";this.onPauseChanged=new Fx.Signal;this.m_hoveringCanvas=!1;this.shouldRestart=!1;this.m_keyMap={};this.gl=null;this.textures=null;this.defaultShader=null;this.activateTest=()=>{};this.setLeftTable=()=>{};this.setRightTable=()=>{};this.setTestControlGroups=()=>{};this.particleParameter=new au(this);for(let{tests:t}of this.groupedTests)this.flatTests.push(...t);this.ownHotKeys=[G("0","Reset Camera",()=>this.HomeCamera()),G("+","Zoom In",()=>this.ZoomCamera(1.1)),G("-","Zoom Out",()=>this.ZoomCamera(.9)),G("r","Reload Test",()=>this.LoadTest()),G("o","Single Step",()=>this.SingleStep()),G("p","Pause/Continue",()=>this.SetPause(!this.m_settings.m_pause)),G("PageUp","Previous Test",()=>this.DecrementTest()),G("PageDown","Next Test",()=>this.IncrementTest())]}init(t,e,r,o,s,l,a){this.setLeftTable=s,this.setRightTable=l,this.activateTest=o,this.setTestControlGroups=a,e.addEventListener("mousedown",u=>this.HandleMouseDown(u)),e.addEventListener("mouseup",u=>this.HandleMouseUp(u)),e.addEventListener("mousemove",u=>this.HandleMouseMove(u)),e.addEventListener("wheel",u=>this.HandleMouseWheel(u)),e.addEventListener("mouseenter",()=>{this.m_hoveringCanvas=!0}),e.addEventListener("mouseleave",()=>{this.m_hoveringCanvas=!1});let c=()=>{let{clientWidth:u,clientHeight:m}=r;(e.width!==u||e.height!==m)&&(e.width=t.width=u,e.height=t.height=m,st.resize(u,m),this.m_test?.Resize(u,m),this.gl&&Cd(t,this.gl,u,r.clientHeight))};if(window.addEventListener("resize",c),window.addEventListener("orientationchange",c),c(),this.m_ctx=e.getContext("2d"),!this.m_ctx)throw new Error("Could not create 2d context for debug-draw");this.m_settings.m_debugDraw=new Gn(this.m_ctx),window.addEventListener("contextmenu",u=>{u.target instanceof HTMLElement&&u.target.closest("main")&&u.preventDefault()},!0),window.addEventListener("keydown",u=>this.HandleKey(u,!0)),window.addEventListener("keyup",u=>this.HandleKey(u,!1)),this.LoadTest(),this.prepareGl(t)}async prepareGl(t){this.gl=$0(t),this.textures=await Z0(this.gl),this.defaultShader=K0(this.gl),this.LoadTest()}setTest(t,e){this.testTitle=t,this.testConstructor=e,this.LoadTest()}HomeCamera(){let t=this.m_test?this.m_test.GetDefaultViewZoom():25,e=this.m_test?this.m_test.getCenter():n.ZERO;st.setPositionAndZoom(e.x,e.y,t)}ZoomCamera(t){st.setZoom(et(st.getZoom()*t,.5,500))}HandleMouseMove(t){let e=new n(t.offsetX,t.offsetY),r=st.unproject(e,new n);if(this.m_mouse.Copy(e),this.m_test?.MouseMove(r,this.m_lMouseDown),this.m_rMouseDown){let{x:o,y:s}=st.getCenter(),l=1/st.getZoom();st.setPosition(o-t.movementX*l,s+t.movementY*l)}}HandleMouseDown(t){let e=new n(t.offsetX,t.offsetY),r=st.unproject(e,new n);switch(t.button){case 0:this.m_lMouseDown=!0,t.shiftKey?this.m_test?.ShiftMouseDown(r):this.m_test?.MouseDown(r);break;case 2:this.m_rMouseDown=!0;break}}HandleMouseUp(t){let e=new n(t.offsetX,t.offsetY),r=st.unproject(e,new n);switch(t.button){case 0:this.m_lMouseDown=!1,this.m_test?.MouseUp(r);break;case 2:this.m_rMouseDown=!1;break}}HandleMouseWheel(t){this.m_hoveringCanvas&&(t.deltaY<0?this.ZoomCamera(1.1):t.deltaY>0&&this.ZoomCamera(1/1.1),t.preventDefault())}HandleKey(t,e){if(this.m_hoveringCanvas||!e){let{key:r}=t,o=this.allHotKeys.find(s=>s.key===r);o&&(!!this.m_keyMap[r]!==e&&(o.step||o.callback(e),this.m_keyMap[r]=e),this.m_hoveringCanvas&&t.preventDefault())}}DecrementTest(){let t=this.flatTests.findIndex(e=>e.name===this.testTitle)-1;t<0?this.activateTest(this.flatTests[this.flatTests.length-1]):t>=0&&this.activateTest(this.flatTests[t])}IncrementTest(){let t=this.flatTests.findIndex(e=>e.name===this.testTitle)+1;t>=this.flatTests.length?this.activateTest(this.flatTests[0]):t>0&&this.activateTest(this.flatTests[t])}LoadTest(t=!1){let e=this.testConstructor;if(!(!e||!this.m_ctx||!this.gl||!this.defaultShader||!this.textures||!this.m_settings.m_debugDraw)){t||this.particleParameter.Reset(),this.m_test?.Destroy(),this.m_test=new e({gl:this.gl,shader:this.defaultShader,textures:this.textures,particleParameter:this.particleParameter}),this.m_test.setupControls(),this.testBaseHotKeys=this.m_test.getBaseHotkeys(),this.testHotKeys=this.m_test.getHotkeys(),this.allHotKeys=[...this.ownHotKeys,...this.testBaseHotKeys,...this.testHotKeys],this.stepHotKeys=this.allHotKeys.filter(r=>r.step);for(let r of this.allHotKeys){let o=this.allHotKeys.find(s=>r.key===s.key);o&&r!==o&&console.error(`Conflicting keys "${r.description}" and "${o.description}"`)}t||this.HomeCamera(),this.setTestControlGroups(this.m_test.m_testControlGroups.slice())}}SetPause(t){this.m_settings.m_pause=t,this.onPauseChanged.emit(t)}SingleStep(){this.m_settings.m_pause||(this.m_settings.m_pause=!0,this.onPauseChanged.emit(!0)),this.m_settings.m_singleStep=!0}scheduleRestart(){this.shouldRestart=!0}SimulationLoop(){let t=this.m_settings.m_debugDraw;if(this.m_fpsCalculator.addFrame()<=0||!this.gl||!this.defaultShader||!this.m_ctx||!t)return;bs(this.gl,0,0,0,0),this.gl.enable(this.gl.BLEND),this.defaultShader.use(),this.defaultShader.uMVMatrix.set(!1,st.modelView),this.defaultShader.uPMatrix.set(!1,st.projection);let e=st.getCenter(),r=st.getZoom();if(t.Prepare(e.x,e.y,r,!0),this.m_test?.RunStep(this.m_settings),this.m_hoveringCanvas)for(let o of this.stepHotKeys)this.m_keyMap[o.key]&&o.callback(!0);t.Finish(),this.m_settings.m_drawFpsMeter&&this.DrawFpsMeter(this.m_ctx),this.UpdateText(),this.shouldRestart&&(this.shouldRestart=!1,this.LoadTest(!0))}DrawFpsMeter(t){t.save(),t.translate(0,st.getHeight()),t.scale(1,-1),t.fillStyle=Gn.MakeStyleString(F.GREEN);let e=5;for(let r of this.m_fpsCalculator.getFrames())t.fillRect(e,5,1,r),e++;t.restore()}UpdateText(){let t=[],e=this.m_fpsCalculator.getFps(),r=[["Performance:","!"],["Avg. FPS",e.avgFps.toFixed(1)],["Max. Time in ms",e.maxTime.toFixed(1)],["Min. Time in ms",e.minTime.toFixed(1)],["",""]];this.m_test&&(this.m_test.m_textLines.length&&t.push(["Description:","!"],...this.m_test.m_textLines.map(o=>[o,"-"]),["",""]),this.m_settings.m_drawInputHelp&&(t.push(["Mouse:","!"],["Right Drag","Move Camera"],["Left Drag","Grab Objects"],["Wheel","Zoom"],["",""]),t.push(["Keyboard:","!"],...this.allHotKeys.map(o=>[vA(o),o.description]),["",""])),this.m_test.m_debugLines.length&&r.push(["Debug Info:","!"],...this.m_test.m_debugLines,["",""]),this.m_test.m_statisticLines.length&&r.push(["Statistics:","!"],...this.m_test.m_statisticLines,["",""])),this.setLeftTable(t),this.setRightTable(r)}},BA=(0,vu.createContext)(new Of),rl=()=>(0,vu.useContext)(BA);var Ix=/[^a-z0-9-]+/gi,lr=({group:i,name:t})=>`/${i.replace(Ix,"_")}#${t.replace(Ix,"_")}`;var jt=$(bt());function Lx(i,t){return JSON.stringify(i)!==JSON.stringify(t)?t:i}var CA=({label:i,value:t})=>t==="!"?(0,jt.jsx)("tr",{children:(0,jt.jsx)("th",{colSpan:2,children:i})}):t==="-"?(0,jt.jsx)("tr",{children:(0,jt.jsx)("td",{colSpan:2,children:i})}):(0,jt.jsxs)("tr",{children:[(0,jt.jsx)("td",{children:t}),(0,jt.jsx)("td",{children:i})]}),Gx=({id:i,table:t})=>(0,jt.jsx)("div",{id:i,children:(0,jt.jsx)("table",{children:(0,jt.jsx)("tbody",{children:t.map(([e,r],o)=>(0,jt.jsx)(CA,{label:e,value:r},o))})})}),AA=({entry:{name:i,TestClass:t},setTestControlGroups:e})=>{let[r,o]=(0,Ei.useReducer)(Lx,[]),[s,l]=(0,Ei.useReducer)(Lx,[]),a=(0,Ei.useRef)(null),c=(0,Ei.useRef)(null),u=(0,Ei.useRef)(null),m=rl(),p=qi(),d=Vx();return(0,Ei.useEffect)(()=>{let h=a.current,f=c.current,b=u.current;if(h&&f&&b){let x=()=>{try{m.SimulationLoop(),window.requestAnimationFrame(x)}catch(y){console.error("Error during simulation loop",y)}},_=()=>{let y=g=>{p.history.push(lr(g))};m.init(h,f,b,y,o,l,e),window.requestAnimationFrame(x)};window.requestAnimationFrame(_)}},[c.current,a.current,u.current,m]),(0,Ei.useEffect)(()=>{m.setTest(i,t)},[m,t]),(0,jt.jsxs)("main",{ref:u,children:[(0,jt.jsx)("canvas",{ref:a}),(0,jt.jsx)("canvas",{ref:c}),(0,jt.jsx)(Gx,{id:"left_overlay",table:r}),(0,jt.jsx)("div",{id:"title_overlay",children:d?.name??""}),(0,jt.jsx)(Gx,{id:"right_overlay",table:s})]})};function Vx(){let i=qi(),t=decodeURIComponent(i.path);return rl().flatTests.find(r=>lr(r)===t)}var Ex=({setTestControlGroups:i})=>{let t=Vx();return t?(0,jt.jsx)(AA,{entry:t,setTestControlGroups:i}):(0,jt.jsx)("main",{children:"Select a test from the right sidebar"})};var qr=$(ye());var Yx=$(bt());var Ux=()=>(0,Yx.jsx)("div",{className:"separator"});var Jx=$(ye());var ol=$(bt()),Bu=({className:i,legend:t,legendClassName:e,children:r,defaultOpen:o=!1})=>{let[s,l]=(0,Jx.useState)(o),a=[];return e&&a.push(e),s&&a.push("open-legend"),(0,ol.jsxs)("fieldset",{className:`section ${i??""}`,children:[(0,ol.jsx)("legend",{onClick:()=>l(!s),tabIndex:0,className:a.join(" "),children:t}),(0,ol.jsx)("div",{className:s?"section-content":"section-content section-content-hidden",children:r})]})};var Qr=$(bt()),TA=({control:i})=>{switch(i.type){case"slider":return(0,Qr.jsx)(Px,{control:i});case"checkbox":return(0,Qr.jsx)(hx,{control:i});case"radio":return(0,Qr.jsx)(Ax,{control:i});case"select":return(0,Qr.jsx)(dx,{control:i});case"separator":return(0,Qr.jsx)(Ux,{})}return null},Ts=({legend:i,controls:t,defaultOpen:e})=>(0,Qr.jsx)(Bu,{legend:i,defaultOpen:e,className:"settings-section",children:t.map(r=>(0,Qr.jsx)(TA,{control:r},r.name))});function ie(i,t,e){let r=i[t];return Yt(e,r,o=>{i[t]=o})}function sl(i,t,e,r,o,s){let l=i[t];return _t(e,r,o,s,l,a=>{i[t]=a})}var zx=$(bt()),Cu=({label:i,onClick:t})=>(0,zx.jsx)("button",{className:"button",onClick:t,children:i});var Nf=$(bt()),jx=({name:i,link:t,tests:e})=>{let r=e.some(o=>t===lr(o));return(0,Nf.jsx)(Bu,{legend:i,legendClassName:r?"active-legend":"",children:e.map(o=>(0,Nf.jsx)(G2,{href:lr(o),className:t===lr(o)?"active-link":"",children:o.name},o.name))})};var re=$(bt()),Xx=({testControlGroups:i})=>{let[t,e]=(0,qr.useState)("controls"),[r,o]=(0,qr.useState)(!1),s=rl(),l=qi(),a=decodeURIComponent(l.path),c=(0,qr.useMemo)(()=>s.groupedTests.some(f=>f.tests.some(b=>a===lr(b))),[s,a]);(0,qr.useEffect)(()=>{let f=s.onPauseChanged.connect(o);return()=>{f.disconnect()}}),(0,qr.useEffect)(()=>{!c&&t!=="tests"&&e("tests")},[c,t]);let u=s.m_settings,m=[sl(u,"m_velocityIterations","Velocity Iters",0,50,1),sl(u,"m_positionIterations","Position Iters",0,50,1),sl(u,"m_particleIterations","Particle Iters",0,50,1),sl(u,"m_hertz","Hertz",5,120,1)],p=[ie(u,"m_enableSleep","Sleep"),ie(u,"m_enableWarmStarting","Warm Starting"),ie(u,"m_enableContinuous","Time of Impact"),ie(u,"m_enableSubStepping","Sub-Stepping")],d=[ie(u,"m_drawShapes","Shapes"),ie(u,"m_drawParticles","Particles"),ie(u,"m_drawJoints","Joints"),ie(u,"m_drawAABBs","AABBs"),ie(u,"m_drawContactPoints","Contact Points"),ie(u,"m_drawContactNormals","Contact Normals"),ie(u,"m_drawContactImpulse","Contact Impulses"),ie(u,"m_drawFrictionImpulse","Friction Impulses"),ie(u,"m_drawCOMs","Center of Masses")],h=[ie(u,"m_drawStats","Statistics"),ie(u,"m_drawInputHelp","Input Help"),ie(u,"m_drawProfile","Profile"),ie(u,"m_drawFpsMeter","FPS Meter")];return(0,re.jsxs)("div",{className:"sidebar",children:[(0,re.jsxs)("div",{className:"sidebar--tabs",children:[(0,re.jsx)("div",{onClick:()=>e("controls"),className:t==="controls"?"active-tab":"",children:"Controls"}),(0,re.jsx)("div",{onClick:()=>e("tests"),className:t==="tests"?"active-tab":"",children:"Tests"})]}),(0,re.jsxs)("div",{className:t==="controls"?"tab-content":"tab-content tab-content-hidden",children:[(0,re.jsx)(Ts,{legend:"Iterations",controls:m}),(0,re.jsx)(Ts,{legend:"General",controls:p}),(0,re.jsx)(Ts,{legend:"Draw",controls:d}),(0,re.jsx)(Ts,{legend:"Overlay",controls:h}),i.groups.map((f,b)=>(0,re.jsx)(Ts,{defaultOpen:!0,legend:`[Test] ${f.legend}`,controls:f.controls},`${i.key}-${b}`))]}),(0,re.jsx)("div",{className:t==="tests"?"tab-content":"tab-content tab-content-hidden",children:s.groupedTests.map(({name:f,tests:b})=>(0,re.jsx)(jx,{name:f,tests:b,link:a},f))}),t==="controls"&&(0,re.jsxs)("div",{className:"sidebar--buttons",children:[(0,re.jsx)(Cu,{label:r?"Continue (P)":"Pause (P)",onClick:()=>s.SetPause(!r)}),(0,re.jsx)(Cu,{label:"Single Step (O)",onClick:()=>s.SingleStep()}),(0,re.jsx)(Cu,{label:"Restart (R)",onClick:()=>s.LoadTest(!0)})]})]})};var Hx={name:"@box2d/testbed",version:"0.10.0",private:!0,description:"A Testbed for all @box2d packages",homepage:"https://lusito.github.io/box2d.ts/",bugs:{url:"https://github.com/lusito/box2d.ts/issues"},repository:{type:"git",url:"https://github.com/lusito/box2d.ts.git"},license:"MIT",author:"Santo Pfingsten",files:["dist"],scripts:{build:"rimraf dist && node src/ui/esbuild.js",start:"node src/ui/esbuild.js serve"},browserslist:["> 5%"],dependencies:{"@box2d/controllers":"^0.11.0","@box2d/core":"^0.11.0","@box2d/debug-draw":"^0.11.0","@box2d/lights":"^0.11.0","@box2d/particles":"^0.11.0","@react-nano/router":"^0.15.0","@types/randomcolor":"^0.5.9","@types/react":"^18.3.18","@types/react-dom":"^18.3.5",esbuild:"^0.25.0","esbuild-sass-plugin":"^3.3.1","esbuild-ts-paths":"^1.1.3","gl-matrix":"^3.4.3",react:"^18.3.1","react-dom":"^18.3.1","sort-package-json":"^2.14.0","typed-glsl":"0.11.2","typed-signals":"^3.0.0","typeface-open-sans":"1.1.13"}};var So=$(bt()),DA={key:0,groups:[]};function MA(i,t){return{key:i.key+1,groups:t}}function RA(){let[i,t]=(0,Ox.useReducer)(MA,DA);return(0,So.jsxs)("div",{className:"container",children:[(0,So.jsx)(Ex,{setTestControlGroups:t}),(0,So.jsx)(Xx,{testControlGroups:i})]})}document.title=`@Box2D Testbed v${Hx.version}`;var kA=(0,Nx.createRoot)(document.getElementById("root"));kA.render((0,So.jsx)(J2,{mode:"hash",children:(0,So.jsx)(RA,{})}));})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
